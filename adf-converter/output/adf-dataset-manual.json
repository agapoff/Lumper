[
  {
    "key": "SA-247",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The purpose of the Teamcity monitor is, currently, to remove finished QA test runs from Teamcity."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "We want to make some improvements."
            }
          ]
        },
        {
          "type": "orderedList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": " Keep the last X build configurations and their build logs (all or only the ones who failed?)"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": " The program tends to crash because of some invalid parsing."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Copy/paste from logs, regarding the crash:"
                    }
                  ]
                },
                {
                  "type": "codeBlock",
                  "attrs": {},
                  "content": [
                    {
                      "type": "text",
                      "text": "kos@akira:~$ sudo zcat /var/log/upstart/teamcity-monitor.log.1.gz \n2015/04/26 03:57:02 Get https://github.salt:7byWJhSLVL8z@teamcity.cryptzone.ad:443/httpAuth/app/rest/builds/?locator=running%3Atrue: EOF\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value\n2015/04/27 04:01:40 invalid character '<' looking for beginning of value"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I think is better to integrate on the toolchain, we can have a periodic task to clean the builds, we have currently the API to talk with TC so it's going to take less time and is better to have everything integrated in the same place and async."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "aitor.iturri",
        "created": 1433168611124
      }
    ]
  },
  {
    "key": "SA-410",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Place a button on OTP message to start initialization."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "GET "
            },
            {
              "type": "text",
              "text": "/client/authentication/otp/initialize",
              "marks": [
                {
                  "type": "code"
                }
              ]
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "{\n  \"secret\": \"ABCDABCDABCD\",\n  \"barcodeUrl\": http://www.google.com/chart?someidentifier\n}"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "example URL: "
            },
            {
              "type": "text",
              "text": "https://www.google.com/chart?chs=200x200&chld=M%%7C0&cht=qr&chl=otpauth://totp/natan@appgate2%%3Fsecret%%3DABCDABCDABCD",
              "marks": [
                {
                  "type": "code"
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Returns HTTP 409 if the user already has the seed."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "A new initialization button on OTP dialog."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "[^image.png]"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "If it's already initialized, it will return \"Conflict\" error."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "If it isn't this dialog will pop-up again."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "[^image2.png]"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1438676995087
      }
    ]
  },
  {
    "key": "SA-266",
    "description": {
      "version": 1,
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:13]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "hi Kristinn... when you setup azure.. did you specify any tcp source port range ?"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:14]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "when azure gw is connecting to logserver , i usually see a port like 1081 -> 1087 .."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:14]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "but at some times, it does a port reuse, when a new tcp connection is made..."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:14]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "and at those times i can see that there is a delay to connect.."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:17]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "hm nope not to my knowledge"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:17]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "that's weird"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:17]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "so it's trying to reuse a port that is already in use or?"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:26]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "i dont know..  it is strange..    from azure i just do a simple connect to the logging server..."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:26]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "all goes ok..."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:26]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "i can see that azure is using ports"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:26]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "like 1080"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:26]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "1081"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:26]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "1082"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:27]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "1083"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:27]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "etc etc.."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:27]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "but then all the sudden it uses 1064"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:27]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "and for some reason the SYN fails."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:27]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "it does not get any responce from the log server"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:27]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "same pattern every time"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:27]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "I'm wondering if it has something to do with the natting of the log server"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:28]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "or does it work from aws?"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:28]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "it allways work from amazon"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:28]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "ok"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:28]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "hm"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:28]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "let me look into it"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:28]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "need to google and stuff, not sure what it can be"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:29]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "i reproduce it like:"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:29]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "nc -vz "
            },
            {
              "type": "text",
              "text": "log.sa.cryptzone.com",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "http://log.sa.cryptzone.com"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": " 5000      <-- on azure"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:29]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "sudo tcpdump -i eth0 tcp port 5000 -n -X  <-- on logging server"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:29]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "ok cool"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:29]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "I will investigate this now"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [16:29]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "thanks"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [16:30]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "np"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Per Leino [17:01]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "there is a article @ "
            },
            {
              "type": "text",
              "text": "https://msdn.microsoft.com/en-us/library/azure/dn848316.aspx",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://msdn.microsoft.com/en-us/library/azure/dn848316.aspx"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": "   where the number of source ports can be configured?"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:02]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "maybe we will need to use the security groups feature. It isn't available in the GUI (at least I haven't found it) so we didn't know about it, that's the reason we use the SNAT hack"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:02]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "but if this can be fixed by using security groups then we might need to do that"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:23]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "I think it just uses the next available port. I don't know why this would be an issue"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:24]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "weird"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:24]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "it's using 1024-1040 ca. for me now and it's working"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:24]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "from a different azure vm"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:24]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "we should investigate this further after RSA"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:24]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "I can't do any good tests now"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:28]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "I'll add this to the devops backlog in youtrack"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Kristinn Örn Sigurðsson [17:28]"
            },
            {
              "type": "hardBreak"
            },
            {
              "type": "text",
              "text": "we'll take a better look after RSA, unless this is a showstopper for RSA"
            }
          ]
        }
      ]
    }
  },
  {
    "key": "SA-15016",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "When receiving a route from the controller, the lite client doesn't check if that route already exists (and ignore it if so). This cause the client to be permanently updating the PAC file in the OS and also (aparently) increase the number of routes internally allocated in the TcpIp/stack lib. It also keeps login the same message all the time."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2020-09-30T18:19:51.559Z] Info : 'VPN Proxy Device': 2 new routes have been added to the Proxy\n[2020-09-30T18:19:51.559Z] Info : ProxyPacUpdated "
            },
            {
              "type": "text",
              "text": "http://localhost:3198/sdp_proxy_pac_1601489991.pac"
            },
            {
              "type": "text",
              "text": "\n[2020-09-30T18:20:51.564Z] Info : 'VPN Proxy Device': 2 new routes have been added to the Proxy\n[2020-09-30T18:20:51.565Z] Info : ProxyPacUpdated "
            },
            {
              "type": "text",
              "text": "http://localhost:3198/sdp_proxy_pac_1601490051.pac"
            },
            {
              "type": "text",
              "text": "\n[2020-09-30T18:21:51.566Z] Info : 'VPN Proxy Device': 3 new routes have been added to the Proxy\n[2020-09-30T18:21:51.566Z] Info : ProxyPacUpdated "
            },
            {
              "type": "text",
              "text": "http://localhost:3198/sdp_proxy_pac_1601490111.pac"
            },
            {
              "type": "text",
              "text": "\n[2020-09-30T18:22:51.564Z] Info : 'VPN Proxy Device': 2 new routes have been added to the Proxy\n[2020-09-30T18:22:51.565Z] Info : ProxyPacUpdated "
            },
            {
              "type": "text",
              "text": "http://localhost:3198/sdp_proxy_pac_1601490171.pac"
            },
            {
              "type": "text",
              "text": "\n[2020-09-30T18:23:51.565Z] Info : 'VPN Proxy Device': 3 new routes have been added to the Proxy\n[2020-09-30T18:23:51.565Z] Info : ProxyPacUpdated "
            },
            {
              "type": "text",
              "text": "http://localhost:3198/sdp_proxy_pac_1601490231.pac"
            },
            {
              "type": "text",
              "text": "\n[2020-09-30T18:24:21.822Z] Info : 'VPN Proxy Device': 3 new routes have been added to the Proxy\n[2020-09-30T18:24:21.822Z] Info : ProxyPacUpdated "
            },
            {
              "type": "text",
              "text": "http://localhost:3198/sdp_proxy_pac_1601490261.pac"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-15054",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The kibana authentication seems to fail"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "In nginx: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": " \nlocation /auditlogs {\n        auth_request /kibana-authorization;\n        proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9310"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n    }\n"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "disabling the auth"
                },
                {
                  "type": "text",
                  "text": "request /kibana-authorization;  seems to make it work again.",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And it feels related to the removal of open-resty"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601904613372
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ditched completely the whole 3rd party "
                },
                {
                  "type": "text",
                  "text": "nginx-c-function",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " module calling our lua which was using x509.c. Layers upon layers... As a result all the luajit dependencies + compilation/linking from nginx could be removed. Added instead a pure module of our own that just hooks in the access phase in identical way like url"
                },
                {
                  "type": "text",
                  "text": "access. ",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/stratus-appliance/pull/4036",
                  "marks": [
                    {
                      "type": "em"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-appliance/pull/4036"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "+290 \u22121,416",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " legit"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1602067146791
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ok, so we are merged... time to retest then"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1602141099568
      }
    ]
  },
  {
    "key": "SA-15061",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "\\[2020-10-05T18:50:19.991Z\\] Info : Token renewal for \\[70bde4f0-5735-42e5-94ba-c45fdc668f71\\] is received by 'aws - purple40'. Will update the token.\n\n...\n\n\\[2020-10-05T18:50:21.526Z\\] Info : Received SAML token. Will send it to controller.\n\n\\[2020-10-05T18:50:21.559Z\\] Info : Retrieving claims token.\n\n\\[2020-10-05T18:50:21.560Z\\] Info : Fetching on-boarding cookie for 'onboardingcookie-f9:17:fd:6a:4b:45:9a:b1:85:44:7d:dd:2b:e4:50:92:23:30:dd:bf:9d:2d:d2:40:81:ca:7e:7c:0b:fb:18:e6-AppGate Azure AD SAML Client-kurt.glazemakers-830fc1db-1bf0-4c89-9768-854884ea8958' from secure storage.\n\n\\[2020-10-05T18:50:21.560Z\\] Info : On-boarding cookie available for 'onboardingcookie-f9:17:fd:6a:4b:45:9a:b1:85:44:7d:dd:2b:e4:50:92:23:30:dd:bf:9d:2d:d2:40:81:ca:7e:7c:0b:fb:18:e6-AppGate Azure AD SAML Client-kurt.glazemakers-830fc1db-1bf0-4c89-9768-854884ea8958'.\n\n\\[2020-10-05T18:50:21.561Z\\] Info : Resolving hostname 'purple.cryptzone.com'\n\n\\[2020-10-05T18:50:21.582Z\\] Info : Resolved IPs: \\[35.177.27.1, 35.157.222.129, 35.157.235.196\\]\n\n\\[2020-10-05T18:50:21.582Z\\] Info : Trying to connect 'purple.cryptzone.com/35.157.222.129' with SPA key name 'CryptZone'.\n\n\\[2020-10-05T18:50:21.863Z\\] Info : 2FA required while updating claims token at '["
            },
            {
              "type": "text",
              "text": "https://purple.cryptzone.com/'](https://purple.cryptzone.com/')"
            },
            {
              "type": "text",
              "text": "."
            },
            {
              "type": "text",
              "text": "\n\n\\[2020-10-05T18:50:21.867Z\\] Info : Initializing on-boarding OTP seed.\n\n\\[2020-10-05T18:50:21.907Z\\] Info : OTP seed is already initialized for this user.\n\n...\n\n\\[2020-10-06T07:24:35.739Z\\] Info : Sending on-boarding OTP to controller.\n\n\\[2020-10-06T07:24:35.739Z\\] Info : Resolving hostname 'purple.cryptzone.com'\n\n\\[2020-10-06T07:24:35.796Z\\] Info : Resolved IPs: \\[35.157.235.196, 35.157.222.129, 35.177.27.1\\]\n\n\\[2020-10-06T07:24:35.796Z\\] Info : Trying to connect 'purple.cryptzone.com/35.177.27.1' with SPA key name 'CryptZone'.\n\n\\[2020-10-06T07:24:36.232Z\\] Info : On-boarding OTP authentication has been failed because the initial authentication has expired.\n\n\\[2020-10-06T07:24:36.247Z\\] Info : Retrieving claims token.\n\n\\[2020-10-06T07:24:36.248Z\\] Info : Fetching on-boarding cookie for 'onboardingcookie-f9:17:fd:6a:4b:45:9a:b1:85:44:7d:dd:2b:e4:50:92:23:30:dd:bf:9d:2d:d2:40:81:ca:7e:7c:0b:fb:18:e6-AppGate Azure AD SAML Client-kurt.glazemakers-830fc1db-1bf0-4c89-9768-854884ea8958' from secure storage.\n\n\\[2020-10-06T07:24:36.249Z\\] Info : On-boarding cookie available for 'onboardingcookie-f9:17:fd:6a:4b:45:9a:b1:85:44:7d:dd:2b:e4:50:92:23:30:dd:bf:9d:2d:d2:40:81:ca:7e:7c:0b:fb:18:e6-AppGate Azure AD SAML Client-kurt.glazemakers-830fc1db-1bf0-4c89-9768-854884ea8958'.\n\n\\[2020-10-06T07:24:36.292Z\\] Warn : Authentication to '["
            },
            {
              "type": "text",
              "text": "https://purple.cryptzone.com/'](https://purple.cryptzone.com/')"
            },
            {
              "type": "text",
              "text": " failed while renewing claims token. Prompting user to re-authenticate.\n\n\\[2020-10-06T07:24:36.516Z\\] Info : Starting HTTP Server to receive SAML token.\n\n\\[2020-10-06T07:24:36.516Z\\] Info : Starting the browser to ["
            },
            {
              "type": "text",
              "text": "https://login.microsoftonline.com/b93e809a-49c5-4a0f-a606-82b846acc30d/saml2?SAMLRequest=fZBNS8NAEIb%2FSth742abjemQpBSiUFAspu3BS5ikowaS3bizEX%2B%2BQSu0F48v78c8TLb%2BGvrgkxx31uQiCqUIyLT21Jm3XBz294tUrIuMcejVCJvJv5tn%2BpiIfTAXDcOvk4vJGbDIHYPBgRh8C9Xm8QFUKGF01tvW9iLYlrmoY2pvXzVhg6hUg6uEVISnRmuZLmWc4Bxjnmhr2KPxuVBSyUUkF1LvZQI6hqUOV2n0IoLjH%2Fd8RZwp4afsLvH%2Bp0Nmcn6eEUVV7sq7Y72b3NhTXVVP9WH2spvL4eIsr79RfAM%3D](https://login.microsoftonline.com/b93e809a-49c5-4a0f-a606-82b846acc30d/saml2?SAMLRequest=fZBNS8NAEIb%2FSth742abjemQpBSiUFAspu3BS5ikowaS3bizEX%2B%2BQSu0F48v78c8TLb%2BGvrgkxx31uQiCqUIyLT21Jm3XBz294tUrIuMcejVCJvJv5tn%2BpiIfTAXDcOvk4vJGbDIHYPBgRh8C9Xm8QFUKGF01tvW9iLYlrmoY2pvXzVhg6hUg6uEVISnRmuZLmWc4Bxjnmhr2KPxuVBSyUUkF1LvZQI6hqUOV2n0IoLjH%2Fd8RZwp4afsLvH%2Bp0Nmcn6eEUVV7sq7Y72b3NhTXVVP9WH2spvL4eIsr79RfAM%3D)"
            },
            {
              "type": "text",
              "text": "."
            },
            {
              "type": "text",
              "text": "\n\n\\[2020-10-06T07:24:37.882Z\\] Info : A new HTTP connection has been opened to the client.\n\n\\[2020-10-06T07:24:37.882Z\\] Info : Parsed HTTP header. Waiting for payload.\n\n\\[2020-10-06T07:24:37.883Z\\] Info : Received SAML token. Will send it to controller.\n\n\\[2020-10-06T07:24:37.995Z\\] Info : Retrieving claims token.\n\n\\[2020-10-06T07:24:37.995Z\\] Info : Fetching on-boarding cookie for 'onboardingcookie-f9:17:fd:6a:4b:45:9a:b1:85:44:7d:dd:2b:e4:50:92:23:30:dd:bf:9d:2d:d2:40:81:ca:7e:7c:0b:fb:18:e6-AppGate Azure AD SAML Client-kurt.glazemakers-830fc1db-1bf0-4c89-9768-854884ea8958' from secure storage.\n\n\\[2020-10-06T07:24:37.996Z\\] Info : On-boarding cookie available for 'onboardingcookie-f9:17:fd:6a:4b:45:9a:b1:85:44:7d:dd:2b:e4:50:92:23:30:dd:bf:9d:2d:d2:40:81:ca:7e:7c:0b:fb:18:e6-AppGate Azure AD SAML Client-kurt.glazemakers-830fc1db-1bf0-4c89-9768-854884ea8958'.\n\n\\[2020-10-06T07:24:38.040Z\\] Info : 2FA required while updating claims token at '["
            },
            {
              "type": "text",
              "text": "https://purple.cryptzone.com/'](https://purple.cryptzone.com/')"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Token expires"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Auto-SAML happens but fails because 2fa required"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Day passes"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Kurt enters OTP"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Fails because SAML has expired"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  OTP does not pop-up?"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "One catch is that, when it auto-samled the second time, it still used the old SAML token. Should be fixed but can't have caused the original issue."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This issue makes it impossible to connect with chromebook, I always get \"invalid OTP\""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "hadrien.luttiau",
        "created": 1601978459881
      }
    ]
  },
  {
    "key": "SA-15065",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "/\\* This should return an object of claims. For example: return {'posture': 25}; \\*/\n\nvar meta = JSON.parse(httpGet(\"["
            },
            {
              "type": "text",
              "text": "https://bin.appgate-sdp.com/github/ips.json](https://bin.appgate-sdp.com/github/ips.json)\").data)"
            },
            {
              "type": "text",
              "text": ";"
            },
            {
              "type": "text",
              "text": "\n\nvar fields = \\[\"hooks\", \"web\", \"api\", \"git\", \"pages\", \"importer\"\\];\n\nvar hosts = \\[\\];\n\nfor(var i in fields) { \n\n  hosts = hosts.concat(meta\\[fields\\[i\\]\\]);\n\n}\n\nconsole.log(hosts);\n\nconsole.log(JSON.stringify({ \"github\\_ips\" : hosts }));\n\nreturn { \"github\\_ips\" : hosts };"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Result: { \"github\\_ips\": { \"0\": \"192.30.252.0/22\", \"1\": \"185.199.108.0/22\", \"2\": \"140.82.112.0/20\", \"3\": \"192.30.252.0/22\", \"4\": \"185.199.108.0/22\", \"5\": \"140.82.112.0/20\", \"6\": \"13.114.40.48/32\", \"7\": \"52.192.72.89/32\", \"8\": \"52.69.186.44/32\", \"9\": \"15.164.81.167/32\", \"10\": \"52.78.231.108/32\", \"11\": \"13.234.176.102/32\", \"12\": \"13.234.210.38/32\", \"13\": \"13.229.188.59/32\", \"14\": \"13.250.177.223/32\", \"15\": \"52.74.223.119/32\", \"16\": \"13.236.229.21/32\", \"17\": \"13.237.44.5/32\", \"18\": \"52.64.108.95/32\", \"19\": \"18.228.52.138/32\", \"20\": \"18.228.67.229/32\", \"21\": \"18.231.5.6/32\", \"22\": \"192.30.252.0/22\", \"23\": \"185.199.108.0/22\", \"24\": \"140.82.112.0/20\", \"25\": \"13.230.158.120/32\", \"26\": \"18.179.245.253/32\", \"27\": \"52.69.239.207/32\", \"28\": \"13.209.163.61/32\", \"29\": \"54.180.75.25/32\", \"30\": \"13.233.76.15/32\", \"31\": \"13.234.168.60/32\", \"32\": \"13.250.168.23/32\", \"33\": \"13.250.94.254/32\", \"34\": \"54.169.195.247/32\", \"35\": \"13.236.14.80/32\", \"36\": \"13.238.54.232/32\", \"37\": \"52.63.231.178/32\", \"38\": \"18.229.199.252/32\", \"39\": \"54.207.47.76/32\", \"40\": \"192.30.252.0/22\", \"41\": \"185.199.108.0/22\", \"42\": \"140.82.112.0/20\", \"43\": \"13.114.40.48/32\", \"44\": \"52.192.72.89/32\", \"45\": \"52.69.186.44/32\", \"46\": \"15.164.81.167/32\", \"47\": \"52.78.231.108/32\", \"48\": \"13.234.176.102/32\", \"49\": \"13.234.210.38/32\", \"50\": \"13.229.188.59/32\", \"51\": \"13.250.177.223/32\", \"52\": \"52.74.223.119/32\", \"53\": \"13.236.229.21/32\", \"54\": \"13.237.44.5/32\", \"55\": \"52.64.108.95/32\", \"56\": \"18.228.52.138/32\", \"57\": \"18.228.67.229/32\", \"58\": \"18.231.5.6/32\", \"59\": \"18.181.13.223/32\", \"60\": \"54.238.117.237/32\", \"61\": \"54.168.17.15/32\", \"62\": \"3.34.26.58/32\", \"63\": \"13.125.114.27/32\", \"64\": \"3.7.2.84/32\", \"65\": \"3.6.106.81/32\", \"66\": \"18.140.96.234/32\", \"67\": \"18.141.90.153/32\", \"68\": \"18.138.202.180/32\", \"69\": \"52.63.152.235/32\", \"70\": \"3.105.147.174/32\", \"71\": \"3.106.158.203/32\", \"72\": \"54.233.131.104/32\", \"73\": \"18.231.104.233/32\", \"74\": \"18.228.167.86/32\", \"75\": \"192.30.252.153/32\", \"76\": \"192.30.252.154/32\", \"77\": \"185.199.108.153/32\", \"78\": \"185.199.109.153/32\", \"79\": \"185.199.110.153/32\", \"80\": \"185.199.111.153/32\", \"81\": \"192.30.252.0/22\", \"82\": \"185.199.108.0/22\", \"83\": \"140.82.112.0/20\" } }"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "hosts is indeed an array but represented by nashorn&jackson as object"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://gist.github.com/thomasdarimont/b30357185d44e86b5fa2",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://gist.github.com/thomasdarimont/b30357185d44e86b5fa2"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1601986739791
      }
    ]
  },
  {
    "key": "SA-15071",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Given the following condition:"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601993667549
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So.. its a OR logic with remedies."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601993684137
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I attach that to a entitlement"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601993694932
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "like this"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601993726730
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So when i connect with client..  for the first time"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601993756990
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "so gateway sends: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": " \n{\n\t\"method\": \"app-update\",\n\t\"params\": {\n\t\t\"apps\": {\n\t\t\t\"entitlement\": {\n\t\t\t\t\"remedies\": [{\n\t\t\t\t\t\"method\": \"OtpAuthentication\",\n\t\t\t\t\t\"params\": {\n\t\t\t\t\t\t\"providerId\": \"03542d1e-733c-4c43-a567-d28fbc4649a7\",\n\t\t\t\t\t\t\"message\": \"Please provide additional authentication.\",\n\t\t\t\t\t\t\"claimSuffix\": \"mfa\",\n\t\t\t\t\t\t\"actionIdentifier\": \"1774345838\"\n\t\t\t\t\t},\n\t\t\t\t\t\"active\": true,\n\t\t\t\t\t\"groupId\": \"839381241\"\n\t\t\t\t}, {\n\t\t\t\t\t\"method\": \"Reason\",\n\t\t\t\t\t\"params\": {\n\t\t\t\t\t\t\"message\": \"Please provide a reason.\",\n\t\t\t\t\t\t\"claimSuffix\": \"reason\",\n\t\t\t\t\t\t\"actionIdentifier\": \"-934964597\"\n\t\t\t\t\t},\n\t\t\t\t\t\"active\": true,\n\t\t\t\t\t\"groupId\": \"839381241\"\n\t\t\t\t}],\n\t\t\t\t\"status\": \"Remedy\",\n\t\t\t\t\"appData\": {\n\t\t\t\t\t\"name\": \"someApp\",\n\t\t\t\t\t\"description\": \"\",\n\t\t\t\t\t\"url\": \""
                },
                {
                  "type": "text",
                  "text": "http://172.17.131.2/\""
                },
                {
                  "type": "text",
                  "text": ","
                },
                {
                  "type": "text",
                  "text": "\n\t\t\t\t\t\"colorCode\": 3\n\t\t\t\t},\n\t\t\t\t\"appDatas\": [{\n\t\t\t\t\t\"name\": \"someApp\",\n\t\t\t\t\t\"description\": \"\",\n\t\t\t\t\t\"url\": \""
                },
                {
                  "type": "text",
                  "text": "http://172.17.131.2/\""
                },
                {
                  "type": "text",
                  "text": ","
                },
                {
                  "type": "text",
                  "text": "\n\t\t\t\t\t\"colorCode\": 3\n\t\t\t\t}],\n\t\t\t\t\"displayName\": \"someApp\",\n\t\t\t\t\"name\": \"someApp\"\n\t\t\t}\n\t\t}\n\t},\n\t\"jsonrpc\": \"2.0\"\n}"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601993812785
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So in this case, you can choose to use OTP or Reason..  So in this case i want to use reason."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601994044296
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So if i click the app shortcut"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601994060093
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I get the dialog for setting up the OTP.. but i dont want todo that"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601994091240
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Anyway. i go along.. and set it up. hopeing that we see reason late on."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601994132422
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "but we dont.. if we continue we get:"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601994160981
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "agh, the last commit must have broken the whole thing."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1601994194522
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Wrong client verion..."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1601994617121
      }
    ]
  },
  {
    "key": "SA-15161",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "When the download fails due to a HTTP 404 - Not Found error, the client logs says that the download was succesfull but failed to verify the file."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2020-10-14T22:11:04.608Z] Info : Starting package download to 'C:\\Users\\Arturo\\AppData\\Local\\Temp\\AppGate\\Appgate__SDP__5.3.0-23925-release__Installer' from '"
            },
            {
              "type": "text",
              "text": "http://localhost:8000/Appgate__SDP__5.3.0-23925-release__Installer'"
            },
            {
              "type": "text",
              "text": "."
            },
            {
              "type": "text",
              "text": "\n[2020-10-14T22:11:04.777Z] Info : Download completed, file is in 'C:\\Users\\Arturo\\AppData\\Local\\Temp\\AppGate\\Appgate__SDP__5.3.0-23925-release__Installer'\n[2020-10-14T22:11:04.788Z] Error : Could not parse the certificate of installer. Cannot find the requested object.\n[2020-10-14T22:11:04.788Z] Warn : Installer was downloaded but not verified"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "C:\\Users\\Arturo\\Downloads>python -m http.server\nServing HTTP on :: port 8000 ("
            },
            {
              "type": "text",
              "text": "http://[::]:8000/)"
            },
            {
              "type": "text",
              "text": " ...\n::1 - - [14/Oct/2020 15:11:04] code 404, message File not found\n::1 - - [14/Oct/2020 15:11:04] \"GET /Appgate__SDP__5.3.0-23925-release__Installer HTTP/1.1\" 404 -"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Very odd that it doesn't end up in the exception handler.. Perhaps it never has."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1602746764847
      }
    ]
  },
  {
    "key": "SA-15175",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "In the logs I get stuff Like"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "ott 15 07:00:21 magma AppGate[6130]: Info : Starting the browser to "
            },
            {
              "type": "text",
              "text": "https://login.microsoftonline.com/b93e809a-49c5-4a0f-a606-82b846acc30d/saml2?SAMLRequest=fZBNa4NAEIb0.000000isw9dnfVxgxqCJhCoKWhJjn0IltdG0F37c5a%2BvO7tCkkl8JchvdjHiZbf41D8Kks9UbnwEMGgdKNaXv9nsPx8LBIYV1kJMdBTLiZ3Vm0.000000qI9ZkQt8UBP%2BKjnMVqOR1BNqOSpC12C1eXpEETKcrHGmMQMEuzKHuhVcdjxRTdLeL1naiU7J6C1dxh3nq4Q13kY0q50mJ7XLQTDBFtxPdOArjBjGSZjG0SsEpz9ufwUulPgTttd48516284015314208902742317606792550877757440.0000009NJImWdr4GiKvfl9lTvZzsNqq6q50.000000rotezuuri4rLffKL4B"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "However trying to open the URL (because the client fails to open the browser on my desktop machine) brings this"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "![](immagine.png)"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "lol, what is \"decently\"? There is a dot at the end, I guess that's not good, but is that it?"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Lowering the prio as the log is just there for logs, not workaround for your modified client."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1602766234288
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "natan.abolafya",
                    "text": "@natan.abolafya",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " no it's not the . at the end, i tried also without that. I don't know what is the issue there. By decently i mean that it should work if i copy paste it into a browser :)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1602767204454
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "obsolete because we removed the log due to security concerns."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1614003422070
      }
    ]
  },
  {
    "key": "SA-15201",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "PAC Enforcement is not supported on Multi-User client but the client still shows the Device Proxy field as Activated in the UI and also the driver try to configure according to the logs. "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2020-10-16T17:14:14.650Z] Info : Applying PAC: "
            },
            {
              "type": "text",
              "text": "http://mycompany.com/proxy.pac"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": " ![](image.png)"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ah, I can remove the log entry there: "
                },
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/stratus-client-shared/pull/5911",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-client-shared/pull/5911"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1603090641585
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "yeah, need to add code for the UI also."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1603092860801
      }
    ]
  },
  {
    "key": "SA-15246",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "To start with, it can just add a flag to code so it can be used (and then replaced) and add two nginx entries to peer (so no need to disable SPA and stuff for now)."
            }
          ]
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  add client nginx entries to client port without SPA "
                    }
                  ]
                },
                {
                  "type": "codeBlock",
                  "attrs": {},
                  "content": [
                    {
                      "type": "text",
                      "text": "    location /client {\n\n        alias /var/www/html/cz-client-ui/;\n\n        try\\_files $uri index.html $uri;\n\n    }\n\n    location /client-ws {\n\n        proxy\\_http\\_version 1.1;\n\n        proxy\\_read\\_timeout 86400;\n\n        proxy\\_send\\_timeout 86400;\n\n        proxy\\_set\\_header X-Forwarded-For $remote\\_addr;\n\n        proxy\\_set\\_header Upgrade $http\\_upgrade;\n\n        proxy\\_set\\_header Connection \"upgrade\";\n\n        proxy\\_pass ["
                    },
                    {
                      "type": "text",
                      "text": "http://127.0.0.1:29000/live](http://127.0.0.1:29000/live)"
                    },
                    {
                      "type": "text",
                      "text": ";"
                    },
                    {
                      "type": "text",
                      "text": "\n\n    }"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  add nginx entry for the routing (both port 443 and 80?)"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  start the client at "
                    },
                    {
                      "type": "text",
                      "text": "/opt/appgate-webclient/service/appgateservice",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": " and "
                    },
                    {
                      "type": "text",
                      "text": "/opt/appgate-webclient/appgate-driver",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": " in a namespace"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  start the new websessiond"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "makes sense, will do."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1603378864161
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "using unix socket for websocket now at "
                },
                {
                  "type": "text",
                  "text": "/run/user/appgate.service.sock",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1603453076067
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ok I implemented the bare minimum, but at least we can build on top of that."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1603454046605
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Blocked by "
                },
                {
                  "type": "text",
                  "text": "https://got-youtrack.agi.appgate.com/issue/SA-15271",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://got-youtrack.agi.appgate.com/issue/SA-15271"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1603785639275
      }
    ]
  },
  {
    "key": "SA-15253",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  An endpoint on "
                    },
                    {
                      "type": "text",
                      "text": "appliance.hostname:443",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": " where it sets the cookie."
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  An endpoint for all the other endpoint hostnames which checks if there is a cookie or not. If there is not, redirect back to "
                    },
                    {
                      "type": "text",
                      "text": "appliance.hostname:443",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": " with the info of the attempted URL. This redirection will lead to the next point."
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  An endpoint on "
                    },
                    {
                      "type": "text",
                      "text": "appliance.hostname:443",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": " where it takes the cookie and redirects back to the endpoint with the said cookie."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So.. there is the user"
                },
                {
                  "type": "text",
                  "text": "id module. ",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "http://nginx.org/en/docs/http/ngx",
                  "marks": [
                    {
                      "type": "em"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://nginx.org/en/docs/http/ngx"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "http"
                },
                {
                  "type": "text",
                  "text": "userid",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "module.html"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603803545947
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "so .. to enable it.. you add it to the \"server\" of nginx like:"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603803589552
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "userid         on;  <-- Enable the thing userid"
                },
                {
                  "type": "text",
                  "text": "name    ag",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "uid;  <-- give it a name"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603803622472
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "so using the following \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " server { listen 127.0.0.1:9201; listen [::1]:9201; resolver 127.0.0.1:9253; #proxy\\_set\\_header X-Forwarded-For $proxy\\_add\\_x\\_forwarded\\_for; # Necessary for streaming of request body using chunked encoding proxy\\_http\\_version 1.1; proxy\\_buffering off; proxy\\_request\\_buffering off; client\\_max\\_body\\_size 0; userid on; # enable the cookie userid\\_name ag\\_uid; # give it a name userid\\_domain none; # optional domain appgate.com? userid\\_expires off; # date/max/off off means end of browser. max means \u201c31 Dec 2037 23:55:55 GMT\u201d userid\\_mark off; # makrin off userid\\_path / ; # define a path for which the cookie is set. location / { proxy\\_pass ",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "http://unix:/tmp/tunservice1.socket",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://unix:/tmp/tunservice1.socket"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ";",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " } } \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and do a verbose curl.. you see: \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "502 Bad Gateway"
                }
              ],
              "attrs": {
                "level": 1
              }
            },
            {
              "type": "rule"
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "nginx"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " Connection #0 to host 127.0.0.1 left intact \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603808343306
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So.. you can see that the cookie gets set there anyway."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603808361893
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "map $cookie_ag_uid $new_session {\n    default 0;\n    \"\"  1;\n}\n\nupstream tunservice1 {\n        server unix:/tmp/tunservice1.socket;\n}\nupstream tunservice2 {\n        server unix:/tmp/tunservice2.socket;\n}\n# map to different upstream backends based on header\nmap $http_x_server_select $pool {\n        tunservice1 \"tunservice1\";\n        tunservice2 \"tunservice2\";\n}\nserver {\n    listen 127.0.0.1:9201;\n    listen [::1]:9201;\n    resolver 127.0.0.1:9253;\n    #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    # Necessary for streaming of request body using chunked encoding\n    proxy_http_version 1.1;\n    proxy_buffering off;\n    proxy_request_buffering off;\n    client_max_body_size 0;\n    userid         on;     # enable the cookie\n    userid_name    ag_uid; # give it a name\n    userid_domain  none;   # optional domain appgate.com?\n    userid_expires off;    # date/max/off off means end of browser. max means \u201c31 Dec 2037 23:55:55 GMT\u201d\n    userid_mark    off;    # makrin off\n    userid_path    / ;     # define a path for which the cookie is set. \n    location / {\n\tif ($new_session) {\n\t\treturn 302 $request_uri;\n\t}\n\treturn 200 \"OK uid_set=$uid_set uid_got=$uid_got\\n\";\n        #proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://unix:/tmp/tunservice1.socket"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n    }\n}\n"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " curl -b -L -v -XGET "
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9201/testers",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://127.0.0.1:9201/testers"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603813680137
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "OK..  so the following works: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "map $cookie_ag_uid $new_session {\n    default 0;\n    \"\"  1;\n}\n\nupstream tunservice1 {\n        server unix:/tmp/tunservice1.socket;\n}\n\nserver {\n    listen 127.0.0.1:9201;\n    listen [::1]:9201;\n    resolver 127.0.0.1:9253;\n    proxy_http_version 1.1;\n    proxy_buffering off;\n    proxy_request_buffering off;\n    client_max_body_size 0;\n    userid         on;     # enable the cookie\n    userid_name    ag_uid; # give it a name\n    userid_domain  none;   # optional domain appgate.com?\n    userid_expires off;    # date/max/off off means end of browser. max means \u201c31 Dec 2037 23:55:55 GMT\u201d\n    userid_mark    off;    # makrin off\n    userid_path    / ;     # define a path for which the cookie is set. \n    location / {\n\tif ($new_session) {\n\t\treturn 302 $uri;\n\t}\n\t#return 200 \"OK uid_set=$uid_set uid_got=$uid_got\\n\";\n        proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://unix:/tmp/tunservice1.socket"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n    }\n}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And using a domain socket to listen.."
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "nc -l -U /tmp/tunservice1.socket"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The with the following request. "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "curl -L -b cookies.txt "
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9201/testersdsfsd"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Then you in the domain socket get:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-172-17-100-1:/tmp# nc -l -U /tmp/tunservice1.socket\nGET /testersdsfsd HTTP/1.1\nHost: localhost\nConnection: close\nUser-Agent: curl/7.58.0\nAccept: */*\nCookie: ag_uid=fwAAAV+ZK3iDJlReAwMDAg=="
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603873788388
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So the follow is pretty intresting "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "map $cookie_ag_uid $new_session {\n    default 0;\n    \"\"  1;\n}\n\nserver {\n    listen 127.0.0.1:9201;\n    listen [::1]:9201;\n    resolver 127.0.0.1:9253;\n    proxy_http_version 1.1;\n    proxy_buffering off;\n    proxy_request_buffering off;\n    client_max_body_size 0;\n    userid         on;     # enable the cookie\n    userid_name    ag_uid; # give it a name\n    userid_domain  none;   # optional domain appgate.com?\n    userid_expires off;    # date/max/off off means end of browser. max means \u201c31 Dec 2037 23:55:55 GMT\u201d\n    userid_mark    off;    # makrin off\n    userid_path    / ;     # define a path for which the cookie is set. \n    location / {\n\tif ($new_session) {\n\t\treturn 302 $uri;\n\t}\n\tproxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9999"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n\tproxy_set_header Host $host;\n    }\n}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " And having a {{CODEBLOCK1}} And requesting with {{CODEBLOCK2}} you get the following:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-172-17-100-1:/tmp# nc -l 127.0.0.1 9999\nGET /issue/SA-15253 HTTP/1.1\nHost: youtrack.com\nConnection: close\nUser-Agent: curl/7.58.0\nAccept: */*\nCookie: ag_uid=fwAAAV+ZQgMvdVAEAwMFAg=="
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603879446471
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "and the following "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "curl -v -L -b cookies.txt --resolve testrail.com:9201:127.0.0.1 "
                },
                {
                  "type": "text",
                  "text": "http://testrail.com:9201/test/test"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " You get {{CODEBLOCK1}} so seems like we always get the same cookie there.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603879653244
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So.. if i connected from another computer with the following instead: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "curl -v -L -b cookies.txt --resolve testrail.com:444:172.17.100.1 "
                },
                {
                  "type": "text",
                  "text": "http://testrail.com:444/test/test"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "we get: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "GET /test/test HTTP/1.1\nHost: testrail.com\nConnection: close\nUser-Agent: curl/7.58.0\nAccept: */*\nCookie: ag_uid=rBFkAV+ZQ5VBGVdCAwMEAg=="
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603879875102
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "and if we do youtrack instead:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "curl -v -L -b cookies.txt --resolve youtrack.com:444:172.17.100.1 "
                },
                {
                  "type": "text",
                  "text": "http://youtrack.com:444/test/test"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Then we get:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "GET /test/test HTTP/1.1\nHost: youtrack.com\nConnection: close\nUser-Agent: curl/7.58.0\nAccept: */*\nCookie: ag_uid=rBFkAV+ZQ+VBGVdCAwMGAg=="
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603879962218
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And if we compare the cookies.. they are slightly different: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "ag_uid=rBFkAV+ZQ5VBGVdCAwMEAg==\nag_uid=rBFkAV+ZQ+VBGVdCAwMGAg=="
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603880048977
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ok.. so that is since they are not based on host.. ok so this is why we need the single sign on page"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603881795171
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So. at this point..  it feels like we actualy need a client in the browser.  since its hard to transfer cookies between domains."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603891486728
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So based on that.."
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "server {\n    listen 443 http2 ssl;\n    server_name envy-172-17-126-1.devops;\n    ssl_certificate /mnt/state/pki/appliance-cert.pem;\n    ssl_certificate_key /mnt/state/pki/appliance-priv.pem;\n    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256;\n    ssl_client_certificate /mnt/state/pki/ca-cert.pem;\n    ssl_prefer_server_ciphers on;\n    ssl_protocols TLSv1.2;\n    userid         on;     # enable the cookie\n    userid_name    ag_uid; # give it a name\n    userid_domain  envy-172-17-126-1.devops;\n    userid_expires off;    # date/max/off off means end of browser. max means \u201c31 Dec 2037 23:55:55 GMT\u201d\n    userid_mark    off;    # makrin off\n    userid_path    / ;     # define a path for which the cookie is set. \n    location /client {\n        alias /var/www/html/cz-client-ui/;\n        try_files $uri index.html $uri;\n    }\n    location /client-ws {\n        proxy_http_version 1.1;\n        proxy_read_timeout 86400;\n        proxy_send_timeout 86400;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://unix:/run/user/appgate.service.sock:/live"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n    }\n}\n\nmap $cookie_ag_uid $new_session {\n    default 0;\n    \"\"  1;\n}\n\nserver {\n    listen 127.0.0.1:9201;\n    listen [::1]:9201;\n    resolver 127.0.0.1:9253;\n    proxy_http_version 1.1;\n    proxy_buffering off;\n    proxy_request_buffering off;\n    client_max_body_size 0;\n\n    #We will probably need this sso thing. \n    #Since its they way we can transfer the \n    #cookie to make the request\n    location ~ ^/agsid/(.*)$ {\n        root             /var/www/html/cz-client-ui/;\n        try_files        /sso.html =404;\n    }\n\n\n    location / {\n\tif ($new_session) {\n\t\treturn 302 envy-172-17-126-1.devops:443/client;\n\t}\n        #this session has s cookie.. so transfer it to the page.\n\tproxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9999"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n\tproxy_set_header Host $host;\n    }\n} "
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1603891593247
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yeah, we need to have a meeting :D."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Tomorrow?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1603891891200
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "OK.. so this kind of works.. The following nginx: \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " map $cookie\\_ag\\_uid $new\\_session { default 0; \"\" 1; } server { listen 0.0.0.0:443; server\\_name envy-172-17-130-2.devops; userid on; userid\\_name agsid; location /client/ { root /usr/html/; try\\_files /client.html =404; } } server { listen 0.0.0.0:443 default\\_server; listen [::1]:443; server\\_name something; resolver 127.0.0.1:9253; proxy\\_http\\_version 1.1; proxy\\_buffering off; proxy\\_request\\_buffering off; client\\_max\\_body\\_size 0; location / { if ($new\\_session) { return 302 /proxy-set-cookie/aguid/None/host/$host/$uri; } proxy\\_pass ",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9999",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://127.0.0.1:9999"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ";",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " proxy\\_set\\_header Host $host; } location /proxy-set-cookie/ { root /usr/html; try\\_files /copyCookie.html =404; } } \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and the copyCookie.html page: \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "function setCookie(name, value, days) { const d = new Date; d.setTime(d.getTime() + 24 \\"
                },
                {
                  "type": "text",
                  "text": " 60 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " 60 \\"
                },
                {
                  "type": "text",
                  "text": " 1000 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " days); document.cookie = \\"
                },
                {
                  "type": "text",
                  "text": "${name}=${value};path=/;expires=${d.toGMTString()}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "; } document.addEventListener(\"DOMContentLoaded\", () => { setTimeout(() => { const match = location.href.match(new RegExp(\"/aguid/(.+)/host/(.+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); const cookie = match[1] const host = match[2] const url = match[3] console.log(cookie); console.log(host); console.log(url); const server = \"172.17.130.2:443\" if (cookie === \"None\"){ location.replace(\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "http://envy-172-17-130-2.devops:443/client/host/${host}/${url}\\",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://envy-172-17-130-2.devops:443/client/host/${host}/${url}\\"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") } else { setCookie(\"agsid\", cookie); location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${location.protocol}//${host}/${url}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "); } }, 500); });"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " And a dummy client page: \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "This is the client"
                }
              ],
              "attrs": {
                "level": 1
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " SO.. If i add a hostfile where \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " 172.17.130.2 someservice.com \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " And direct my browser to \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " "
                },
                {
                  "type": "text",
                  "text": "http://someservice.com:443/blabla",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://someservice.com:443/blabla"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " Then.. first thing that happens is that nginx see that there is no cookie.. so it redirects the user to: (todo maybe we need the port here also) \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " "
                },
                {
                  "type": "text",
                  "text": "http://someservice.com:443/proxy-set-cookie/aguid/None/host/someservice.com/blabla",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://someservice.com:443/proxy-set-cookie/aguid/None/host/someservice.com/blabla"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " The copyCookie.html page will then load. It will parse out from the url that the cookie is set to None.. So then it redirects the user to client download, and preserves the url in the url: \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " "
                },
                {
                  "type": "text",
                  "text": "http://envy-172-17-130-2.devops:443/client/host/someservice.com//blabla",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://envy-172-17-130-2.devops:443/client/host/someservice.com//blabla"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604044594793
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ok.. so now even more automatic.. nginx configuration. \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " map $cookie\\_aguid $new\\_session { default 0; \"\" 1; } server { listen 0.0.0.0:443; server\\_name envy-172-17-130-2.devops; userid on; userid\\_name aguid; userid\\_domain envy-172-17-130-2.devops; location /client/ { root /usr/html/; try\\_files /client.html =404; } } server { listen 0.0.0.0:443-555 default\\_server; listen [::1]:443-555; server\\_name something; resolver 127.0.0.1:9253; proxy\\_http\\_version 1.1; proxy\\_buffering off; proxy\\_request\\_buffering off; client\\_max\\_body\\_size 0; location ~ ^/aguid/(.\\*)$ { root /usr/html; try\\_files /copyCookie.html =404; } location / { if ($new\\_session) { return 302 /proxy-set-cookie/aguid/None/host/$host/port/$server\\_port/$uri; } proxy\\_pass ",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9999",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://127.0.0.1:9999"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ";",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " proxy\\_set\\_header Host $host; } location /proxy-set-cookie/ { root /usr/html; try\\_files /copyCookie.html =404; } } \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " /usr/html/copyCookie.html \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "function setCookie(name, value, days) { const d = new Date; d.setTime(d.getTime() + 24 \\"
                },
                {
                  "type": "text",
                  "text": " 60 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " 60 \\"
                },
                {
                  "type": "text",
                  "text": " 1000 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " days); document.cookie = \\"
                },
                {
                  "type": "text",
                  "text": "${name}=${value};path=/;expires=${d.toGMTString()}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "; } document.addEventListener(\"DOMContentLoaded\", () => { setTimeout(() => { //var match = location.href.match(new RegExp(\"/aguid/(.+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); //const cookie = match[1] //console.log(cookie); match = location.href.match(new RegExp(\"/aguid/(.+)/host/(.+)/port/([0-9]+)/(.\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ")\")); if (match && match[1] === \"None\"){ match = location.href.match(new RegExp(\"/aguid/(.+)/host/(.+)/port/([0-9]+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); const cookie = match[1] const host = match[2] const port = match[3] const url = match[4] console.log(cookie); console.log(host); console.log(port) console.log(url); const server = \"172.17.130.2:443\" location.replace(\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "http://envy-172-17-130-2.devops:443/client/host/${host}/port/${port}/${url}\\",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://envy-172-17-130-2.devops:443/client/host/${host}/port/${port}/${url}\\"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") } else { match = location.href.match(new RegExp(\"/aguid/(.+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); const cookie = match[1] const url = match[2] setCookie(\"aguid\", cookie); const redirect = \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "${location.protocol}//${location.host}/${url}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${redirect}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "); console.log(redirect) } }, 500); });"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " /usr/html/client.html \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "This is the client"
                }
              ],
              "attrs": {
                "level": 1
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "function getCookie(cname) { var name = cname + \"=\"; var decodedCookie = decodeURIComponent(document.cookie); var ca = decodedCookie.split(';'); for(var i = 0; i <ca.length; i++) { var c = ca[i]; while (c.charAt(0) == ' ') { c = c.substring(1); } if (c.indexOf(name) == 0) { return c.substring(name.length, c.length); } } return \"\"; } document.addEventListener(\"DOMContentLoaded\", () => { setTimeout(() => { const match = location.href.match(new RegExp(\"/host/(.+)/port/([0-9]+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); const host = match[1] const port = match[2] const url = match[3] var cookie = getCookie(\"aguid\") console.log(host); console.log(port) console.log(url); console.log(cookie); var redirect = \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "${location.protocol}//${host}:${port}/aguid/${cookie}/${url}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " console.log(redirect) location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${redirect}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "); }, 500); });"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604053543765
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ok.. so strange urls are still a issue here.. and localstorage/sessionStorage"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604312043835
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "New version Nginx: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "map $cookie_aguid $new_session {\n    default 0;\n    \"\"  1;\n}\n\nserver {\n    listen               0.0.0.0:443;\n    server_name          envy-172-17-130-2.devops;\n    userid               on;\n    userid_name          aguid;\n    userid_domain        envy-172-17-130-2.devops;\n\n    location /client/ {\n        root             /usr/html/;\n        try_files        /client.html =404;\n    }\n}\n\n\n\nserver {\n    listen 0.0.0.0:443-555 default_server;\n    listen [::1]:443-555;\n    server_name something;\n    resolver 127.0.0.1:9253;\n    proxy_http_version 1.1;\n    proxy_buffering off;\n    proxy_request_buffering off;\n    client_max_body_size 0;\n    location ~ ^/aguid/(.*)$ {\n        root /usr/html;\n        try_files /copyCookie.html =404;\n    }\n    location / {\n\tif ($new_session = 1) {\n\t\trewrite ^ $request_uri;\n\t\treturn 302 /proxy-set-cookie/aguid/None/host/$host/port/$server_port/$uri;\n\t}\n\t#proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9999"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n\t#proxy_set_header Host $host;\n\t\n\troot /usr/html;\n\ttry_files /endpoint.html =404;\n    }\n\n    location /proxy-set-cookie/ {\n    \troot /usr/html;\n        try_files /copyCookie.html =404;\n    }\n}"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604321635280
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "CopyCookie \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "function setCookie(name, value, days) { const d = new Date; d.setTime(d.getTime() + 24 \\"
                },
                {
                  "type": "text",
                  "text": " 60 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " 60 \\"
                },
                {
                  "type": "text",
                  "text": " 1000 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " days); document.cookie = \\"
                },
                {
                  "type": "text",
                  "text": "${name}=${value};path=/;expires=${d.toGMTString()}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "; } document.addEventListener(\"DOMContentLoaded\", () => { setTimeout(() => { match = location.href.match(new RegExp(\"/aguid/(.+)/host/(.+)/port/([0-9]+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); if (match && match[1] === \"None\"){ match = location.href.match(new RegExp(\"/aguid/(.+)/host/(.+)/port/([0-9]+)/(.\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ")\")); const cookie = match[1] const host = match[2] const port = match[3] const url = match[4] console.log(cookie); console.log(host); console.log(port) console.log(url); const server = \"172.17.130.2:443\" encoded = decodeURIComponent(url) complete = \\"
                },
                {
                  "type": "text",
                  "text": "http://envy-172-17-130-2.devops:443/client/host/${host}/port/${port}/${encoded}\\",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://envy-172-17-130-2.devops:443/client/host/${host}/port/${port}/${encoded}\\"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " console.log(complete) location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${complete}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") } else { match = location.href.match(new RegExp(\\"
                },
                {
                  "type": "text",
                  "text": "/aguid/(.\\*)\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ")) if(match) { separator = (match[1]).indexOf(\"/\") if(separator != -1) { cookie = (match[1]).substring(0, separator) console.log(cookie) rest = (match[1]).substring(separator+1) console.log(rest) encoded = decodeURIComponent(rest) setCookie(\"aguid\", cookie); const redirect = \\"
                },
                {
                  "type": "text",
                  "text": "${location.protocol}//${location.host}${encoded}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " console.log(redirect) location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${redirect}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") } } } }, 500); });"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604321664030
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Client: \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Appgate Client 5.4"
                }
              ],
              "attrs": {
                "level": 1
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Auto login button function getCookie(cname) { var name = cname + \"=\"; var decodedCookie = decodeURIComponent(document.cookie); var ca = decodedCookie.split(';'); for(var i = 0; i <ca.length; i++) { var c = ca[i]; while (c.charAt(0) == ' ') { c = c.substring(1); } if (c.indexOf(name) == 0) { return c.substring(name.length, c.length); } } return \"\"; } function forward() { const match = location.href.match(new RegExp(\"/host/(.+)/port/([0-9]+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); const host = match[1] const port = match[2] const url = match[3] var cookie = getCookie(\"aguid\") console.log(host); console.log(port) console.log(url); console.log(cookie); var redirect = \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "${location.protocol}//${host}:${port}/aguid/${cookie}/${url}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " console.log(redirect) encoded = decodeURIComponent(redirect) location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${encoded}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "); }"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604321688811
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "lets see.. latest version:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "nginx: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": " \nmap $cookie_aguid $new_session {\n    default 0;\n    \"\"  1;\n}\n\nserver {\n    listen               0.0.0.0:443;\n    server_name          envy-172-17-130-2.devops;\n    userid               on;\n    userid_name          aguid;\n    userid_domain        envy-172-17-130-2.devops;\n\n    location /client/ {\n        root             /usr/html/;\n        try_files        /client.html =404;\n    }\n}\n\n\n\nserver {\n    listen 0.0.0.0:443-555 default_server;\n    listen [::1]:443-555;\n    server_name something;\n    resolver 127.0.0.1:9253;\n    proxy_http_version 1.1;\n    proxy_buffering off;\n    proxy_request_buffering off;\n    client_max_body_size 0;\n    location ~ ^/aguid/(.*)$ {\n        root /usr/html;\n        try_files /copyCookie.html =404;\n    }\n    location / {\n\tif ($new_session = 1) {\n\t\trewrite ^ $request_uri;\n\t\treturn 302 proxy-set-cookie/aguid/None/host/$host/port/$server_port/$uri;\n\t}\n\t#proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9999"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n\t#proxy_set_header Host $host;\n\t\n\troot /usr/html;\n\ttry_files /endpoint.html =404;\n    }\n    location /proxy-set-cookie/ {\n    \troot /usr/html;\n        try_files /copyCookie.html =404;\n    }\n}"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604394531520
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "copyCookie \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "function setCookie(name, value, days) { const d = new Date; d.setTime(d.getTime() + 24 \\"
                },
                {
                  "type": "text",
                  "text": " 60 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " 60 \\"
                },
                {
                  "type": "text",
                  "text": " 1000 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " days); document.cookie = \\"
                },
                {
                  "type": "text",
                  "text": "${name}=${value};path=/;expires=${d.toGMTString()}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "; } document.addEventListener(\"DOMContentLoaded\", () => { setTimeout(() => { match = location.href.match(new RegExp(\"/aguid/(.+)/host/(.+)/port/([0-9]+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); localStorageCookie = localStorage.getItem(\"aguid\"); cookie = \"None\" if (localStorageCookie) { cookie = localStorageCookie console.log(\"Found cookie in localstorage: \" + cookie) setCookie(\"aguid\", cookie); location.reload(); } else if (match && match[1] === \"None\") { console.log(\"Cookie hardcoded to None in URL\") match = location.href.match(new RegExp(\"/aguid/(.+)/host/(.+)/port/([0-9]+)/(.\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ")\")); const host = match[2] const port = match[3] const url = match[4] console.log(host); console.log(port) console.log(url); const server = \"172.17.130.2:443\" encoded = decodeURIComponent(url) complete = \\"
                },
                {
                  "type": "text",
                  "text": "http://envy-172-17-130-2.devops:443/client/host/${host}/port/${port}/${encoded}\\",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://envy-172-17-130-2.devops:443/client/host/${host}/port/${port}/${encoded}\\"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " console.log(complete) location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${complete}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") } else { match = location.href.match(new RegExp(\\"
                },
                {
                  "type": "text",
                  "text": "/aguid/(.\\*)\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ")) if(match) { separator = (match[1]).indexOf(\"/\") cookie = (match[1]).substring(0, separator) console.log(\"Cookie found in Url: \" + cookie) rest = (match[1]).substring(separator+1) console.log(rest) encoded = decodeURIComponent(rest) setCookie(\"aguid\", cookie); const redirect = \\"
                },
                {
                  "type": "text",
                  "text": "${location.protocol}//${location.host}${encoded}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " console.log(redirect) location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${redirect}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") } } }, 500); });"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604394585982
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "client: \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Appgate Client 5.4"
                }
              ],
              "attrs": {
                "level": 1
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Auto login button var cookie = localStorage.getItem(\"aguid\"); console.log(\"Local storage cookie:\" + cookie) if (cookie) { //We already have a cookie in local storage.. so //just go to proxyCookie and set the cookie for the //domain forward() } else { //cookie = getCookie(\"aguid\") //console.log(\"Setting cookie to : \" + cookie) //localStorage.setItem(\"aguid\", cookie); } function getCookie(cname) { var name = cname + \"=\"; var decodedCookie = decodeURIComponent(document.cookie); var ca = decodedCookie.split(';'); for(var i = 0; i <ca.length; i++) { var c = ca[i]; while (c.charAt(0) == ' ') { c = c.substring(1); } if (c.indexOf(name) == 0) { return c.substring(name.length, c.length); } } return \"\"; } function forward() { const match = location.href.match(new RegExp(\"/host/(.+)/port/([0-9]+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); const host = match[1] const port = match[2] const url = match[3] console.log(host); console.log(port) console.log(url); var cookie = getCookie(\"aguid\") localStorage.setItem(\"aguid\", cookie); var redirect = \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "${location.protocol}//${host}:${port}/aguid/${cookie}/${url}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " console.log(redirect) encoded = decodeURIComponent(redirect) location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${encoded}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "); cookie = localStorage.getItem(\"aguid\"); console.log(\"2 Local storage cookie:\" + cookie) }"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604394625478
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Per Leino",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/per.leino",
                        "title": "per.leino"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " maybe use github for tracking instead of youtrack :D"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1604395007582
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "its on the way..   Above is just hacks..   im actually adding it to configd right now."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604400437561
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "You need to POC before you can code.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604400465793
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Pr is already done.. but just for refeerence lets put it here also: nginx: \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " map $cookie\\_aguid $new\\_session { default 0; \"\" 1; } server { listen 0.0.0.0:443; server\\_name envy-172-17-114-1.devops; userid on; userid\\_name aguid; userid\\_domain envy-172-17-114-1.devops; location /client/ { root /usr/html/; try\\_files /client.html =404; } } server { listen 0.0.0.0:443-555 default\\_server; listen [::1]:443-555; server\\_name something; resolver 127.0.0.1:9253; proxy\\_http\\_version 1.1; proxy\\_buffering off; proxy\\_request\\_buffering off; client\\_max\\_body\\_size 0; location ~ ^/16872eb861894a7e9e787f6355e95d3b/(.\\*)$ { root /usr/html; try\\_files /copyCookie.html =404; } location / { if ($new\\_session = 1) { rewrite ^ $request\\_uri; return 302 ",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "http://envy-172-17-114-1.devops:443/client/host/$host/port/$server\\_port/$uri",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://envy-172-17-114-1.devops:443/client/host/$host/port/$server\\_port/$uri"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ";",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " } #proxy\\_pass ",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9999",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://127.0.0.1:9999"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ";",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " #proxy\\_set\\_header Host $host; root /usr/html; try\\_files /endpoint.html =404; } } \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " copyCookie \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "function setCookie(name, value, days) { const d = new Date; d.setTime(d.getTime() + 24 \\"
                },
                {
                  "type": "text",
                  "text": " 60 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " 60 \\"
                },
                {
                  "type": "text",
                  "text": " 1000 \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " days); document.cookie = \\"
                },
                {
                  "type": "text",
                  "text": "${name}=${value};path=/;expires=${d.toGMTString()}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "; } console.log(\"initial\") document.addEventListener(\"DOMContentLoaded\", () => { console.log(\"dom\") setTimeout(() => { console.log(\"timeout\") localStorageCookie = localStorage.getItem(\"aguid\"); cookie = \"None\" if (localStorageCookie) { cookie = localStorageCookie console.log(\"Found cookie in localstorage: \" + cookie) setCookie(\"aguid\", cookie); location.reload(); } else { match = location.href.match(new RegExp(\"/16872eb861894a7e9e787f6355e95d3b/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")) if(match) { separator = (match[1]).indexOf(\"/\") cookieB64 = (match[1]).substring(0, separator) cookie = atob(cookieB64) console.log(\"Cookie found in Url: \" + cookie) rest = (match[1]).substring(separator+1) console.log(rest) encoded = decodeURIComponent(rest) setCookie(\"aguid\", cookie); const redirect = \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "${location.protocol}//${location.host}${encoded}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " console.log(redirect) location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${redirect}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") } else { console.log(\"NoMatch\") } } }, 500); });"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " client \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Appgate Client 5.4"
                }
              ],
              "attrs": {
                "level": 1
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Auto login button var cookie = localStorage.getItem(\"aguid\"); console.log(\"Local storage cookie:\" + cookie) if (cookie) { //We already have a cookie in local storage.. so //just go to proxyCookie and set the cookie for the //domain forward() } function getCookie(cname) { var name = cname + \"=\"; var decodedCookie = decodeURIComponent(document.cookie); var ca = decodedCookie.split(';'); for(var i = 0; i <ca.length; i++) { var c = ca[i]; while (c.charAt(0) == ' ') { c = c.substring(1); } if (c.indexOf(name) == 0) { return c.substring(name.length, c.length); } } return \"\"; } function forward() { const match = location.href.match(new RegExp(\"/host/(.+)/port/([0-9]+)/(.\\"
                },
                {
                  "type": "text",
                  "text": ")\")); const host = match[1] const port = match[2] const url = match[3] console.log(host); console.log(port) console.log(url); var cookie = getCookie(\"aguid\") localStorage.setItem(\"aguid\", cookie); var encodedCookie = btoa(cookie) var redirect = \\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "${location.protocol}//${host}:${port}/16872eb861894a7e9e787f6355e95d3b/${encodedCookie}/${url}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " console.log(redirect) encoded = decodeURIComponent(redirect) location.replace(\\"
                },
                {
                  "type": "text",
                  "text": "${encoded}\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "); cookie = localStorage.getItem(\"aguid\"); console.log(\"2 Local storage cookie:\" + cookie) }"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1604649845437
      }
    ]
  },
  {
    "key": "SA-15277",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Doing the PoC according to the findings/results of SA-15250"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Alright so the proxying is piece of cake with that approach but has 1 major problem. Nginx will make a new connection with that socket and not with the real endpoint thus there will be no connection, through the tunnel, with the endpoint. This is the case no matter if we use real sockets or unix domain sockets"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Nginx's configuration: According to header nginx does proxy"
                },
                {
                  "type": "text",
                  "text": "pass to a specific unix domain sockets",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-172-17-102-2:/home/cz# cat /etc/nginx/sites-enabled-urlaccess/http \n# This file is autogenerated by cz-configd\nupstream tunservice1 {\n\tserver unix:/tmp/tunservice1.socket;\n}\n\nupstream tunservice2 {\n\tserver unix:/tmp/tunservice2.socket;\n}\n\n# map to different upstream backends based on header\nmap $http_x_server_select $pool {\n        tunservice1 \"tunservice1\";\n        tunservice2 \"tunservice2\";\n}\n\n\nserver {\n    listen 127.0.0.1:9201;\n    listen [::1]:9201;\n    resolver 127.0.0.1:9253;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n    # Necessary for streaming of request body using chunked encoding\n    proxy_http_version 1.1;\n    proxy_buffering off;\n    proxy_request_buffering off;\n    client_max_body_size 0;\n\n    # Jump to different locations based on the \"Upgrade\" header\n    location / {\n        try_files /\u03bc\u03b1\u03bb\u03b1\u03ba\u03af\u03b5\u03c2 @$http_upgrade;\n    }\n\n    location @websocket {\n        # websocket related stuff\n        url_access on;\n        proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://$pool"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n    }\n\n    location @ {\n        # web related stuff\n        url_access on;\n        proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://$pool"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n    }\n}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "netcat simulating tun-service. A simple unix domain socket Here it won't even be IP packets as it's a unix domain socket so for sure it cannot be used "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-172-17-102-2:/home/cz# nc -l -U /tmp/tunservice1.socket\nGET / HTTP/1.1\nX-Forwarded-For: 192.168.100.2\nHost: tunservice1\nConnection: close\nUser-Agent: curl/7.68.0\nAccept: */*\nX-Server-Select: tunservice1"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " With a real socket like 127.0.0.1:8080 The socket gets IP packets but nginx has now a TCP connection with that socket and not with the real endpoint {{CODEBLOCK2}}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Client doing an HTTP request with a specific header "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "curl "
                },
                {
                  "type": "text",
                  "text": "http://172.17.103.2"
                },
                {
                  "type": "text",
                  "text": " -H \"X-Server-Select: tunservice1\""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1603814145860
      }
    ]
  },
  {
    "key": "SA-15293",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Controller can connect directly to configd instead, we already have a web server listening on localhost for the sessiond proxy. "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "# This file is autogenerated by cz-configdserver {{\n    listen 127.0.0.1:{port};\n    location /ip_allocation {{\n        proxy_pass "
            },
            {
              "type": "text",
              "text": "http://unix:/{DEFAULT_UNIX_DOMAIN_SOCKET}:/ip_allocation?node_name={node_name}&is_prefix=1"
            },
            {
              "type": "text",
              "text": ";"
            },
            {
              "type": "text",
              "text": "\n    }}\n}}"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-15323",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "https://github.com/appgate-sdp-int/stratus-appliance/blob/master/webd/src/internal/http/http_server.go"
            },
            {
              "type": "text",
              "text": "  <-- rename towards server..\n"
            },
            {
              "type": "text",
              "text": "https://github.com/appgate-sdp-int/stratus-appliance/blob/master/webd/src/internal/socket/server.go"
            },
            {
              "type": "text",
              "text": " <-- rename towards clienthandler. \n"
            },
            {
              "type": "text",
              "text": "https://github.com/appgate-sdp-int/stratus-appliance/blob/master/webd/src/internal/socket/server.go"
            },
            {
              "type": "text",
              "text": " <-- maybe even rename the package to clienthandler. \n"
            },
            {
              "type": "text",
              "text": "https://github.com/appgate-sdp-int/stratus-appliance/blob/master/webd/src/internal/session/collection.go"
            },
            {
              "type": "text",
              "text": " <- rename towards sessionCollection\n"
            },
            {
              "type": "text",
              "text": "https://github.com/appgate-sdp-int/stratus-appliance/blob/master/webd/src/internal/session/handler.go"
            },
            {
              "type": "text",
              "text": " <-- rename towards session\n"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-15381",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "20-11-05T10:30:02.869Z\\] Info : CA certificate found in the storage for 'purple.appgate.com'.\n\n\\[2020-11-05T10:30:03.143Z\\] Info : Resolving hostname 'purple.appgate.com'\n\n\\[2020-11-05T10:30:03.405Z\\] Info : Resolved IPs: \\[35.177.27.1, 35.157.235.196, 35.157.222.129\\]\n\n\\[2020-11-05T10:30:03.407Z\\] Info : Trying to connect 'purple.appgate.com/35.177.27.1' with SPA key name 'CryptZone'.\n\n\\[2020-11-05T10:30:04.345Z\\] Info : Changing profile.\n\n\\[2020-11-05T10:30:04.989Z\\] Info : Identity Provider AppGate Azure AD SAML Client found.\n\n\\[2020-11-05T10:30:04.989Z\\] Info : Logging in using 'AppGate Azure AD SAML Client'.\n\n\\[2020-11-05T10:30:04.989Z\\] Info : Authenticating for the first time. AppGate Azure AD SAML Client\n\n\\[2020-11-05T10:30:04.989Z\\] Info : Retrieving claims token.\n\n\\[2020-11-05T10:30:05.030Z\\] Info : Redirection to an external identity provider is received. URL: ["
            },
            {
              "type": "text",
              "text": "https://login.microsoftonline.com/b93e809a-49c5-4a0f-a606-82b846acc30d/saml2?SAMLRequest=fZBNa4QwEIb%2FisxdO8ZYNajLgi0stHSpu3voRUI2toImNhNLf36l3cL20uPL%2BzEPU24%2BpzH40I4GayqII4RAG2XPg3mt4Hi4D3PY1CXJaWSz2C7%2BzTzr90WTD9aiIfHjVLA4I6ykgYSRkybhlWi3jw%2BCRShmZ71VdoRg11TQ3XKdcS5RMpZmOU%2F7opdnlXOlkqRHLNYY0aJ3hrw0vgKGDMM4DjE9xCgSFMijIsteIDj9cq9X4EIpvsvuGu9%2FOkmknV9noG6bfXN36vaLm0fdte1Td1y98uZ6uL7Iv9%2BovwA%3D](https://login.microsoftonline.com/b93e809a-49c5-4a0f-a606-82b846acc30d/saml2?SAMLRequest=fZBNa4QwEIb%2FisxdO8ZYNajLgi0stHSpu3voRUI2toImNhNLf36l3cL20uPL%2BzEPU24%2BpzH40I4GayqII4RAG2XPg3mt4Hi4D3PY1CXJaWSz2C7%2BzTzr90WTD9aiIfHjVLA4I6ykgYSRkybhlWi3jw%2BCRShmZ71VdoRg11TQ3XKdcS5RMpZmOU%2F7opdnlXOlkqRHLNYY0aJ3hrw0vgKGDMM4DjE9xCgSFMijIsteIDj9cq9X4EIpvsvuGu9%2FOkmknV9noG6bfXN36vaLm0fdte1Td1y98uZ6uL7Iv9%2BovwA%3D)"
            },
            {
              "type": "text",
              "text": "\n\n\\[2020-11-05T10:30:05.031Z\\] Info : Starting HTTP Server to receive SAML token.\n\n\\[2020-11-05T10:30:05.034Z\\] Info : Starting the browser to ["
            },
            {
              "type": "text",
              "text": "https://login.microsoftonline.com/b93e809a-49c5-4a0f-a606-82b846acc30d/saml2?SAMLRequest=fZBNa4QwEIb%2FisxdO8ZYNajLgi0stHSpu3voRUI2toImNhNLf36l3cL20uPL%2BzEPU24%2BpzH40I4GayqII4RAG2XPg3mt4Hi4D3PY1CXJaWSz2C7%2BzTzr90WTD9aiIfHjVLA4I6ykgYSRkybhlWi3jw%2BCRShmZ71VdoRg11TQ3XKdcS5RMpZmOU%2F7opdnlXOlkqRHLNYY0aJ3hrw0vgKGDMM4DjE9xCgSFMijIsteIDj9cq9X4EIpvsvuGu9%2FOkmknV9noG6bfXN36vaLm0fdte1Td1y98uZ6uL7Iv9%2BovwA%3D](https://login.microsoftonline.com/b93e809a-49c5-4a0f-a606-82b846acc30d/saml2?SAMLRequest=fZBNa4QwEIb%2FisxdO8ZYNajLgi0stHSpu3voRUI2toImNhNLf36l3cL20uPL%2BzEPU24%2BpzH40I4GayqII4RAG2XPg3mt4Hi4D3PY1CXJaWSz2C7%2BzTzr90WTD9aiIfHjVLA4I6ykgYSRkybhlWi3jw%2BCRShmZ71VdoRg11TQ3XKdcS5RMpZmOU%2F7opdnlXOlkqRHLNYY0aJ3hrw0vgKGDMM4DjE9xCgSFMijIsteIDj9cq9X4EIpvsvuGu9%2FOkmknV9noG6bfXN36vaLm0fdte1Td1y98uZ6uL7Iv9%2BovwA%3D)"
            },
            {
              "type": "text",
              "text": "."
            },
            {
              "type": "text",
              "text": "\n\n\\[2020-11-05T10:30:06.031Z\\] Info : Profile changed to ASdemo-AD\n\n\\[2020-11-05T10:30:06.162Z\\] Info : Changing profile.\n\n\\[2020-11-05T10:30:06.262Z\\] Info : Profile changed to AGI\\_Users\n\n\\[2020-11-05T10:30:06.414Z\\] Info : User input required for 'ConnectCredentialsLoginHandler'.\n\n\\[2020-11-05T10:30:08.057Z\\] Info : A new HTTP connection has been opened to the client.\n\n\\[2020-11-05T10:30:08.057Z\\] Info : Parsed HTTP header. Waiting for payload.\n\n\\[2020-11-05T10:30:08.060Z\\] Info : Received SAML token. Will send it to controller."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The HTTP server is being closed already but in this case it probably wasn't fast enough. Will make sure to ignore the incoming token."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1605003019122
      }
    ]
  },
  {
    "key": "SA-15452",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "location @ {\n    # web related stuff\n    auth_request /memcverify;\n    proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://$host:$server_port$request_uri"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n}\n\nlocation = /memcverify {\n    # memcached authorization\n    internal;\n    set  $memcached_key $cookie_aguid;\n    memcached_pass unix:/run/cz-memcached/memcached.socket;\n    error_page        404 = @error;\n}\n\nlocation @error  {\n    # Do something on error\n    return 401;\n}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "There is a way looks like it to use the build-in memcached of nginx by attaching it into an authentication location thus not interfering with the proxy"
                },
                {
                  "type": "text",
                  "text": "pass. Reminder the problem was that both modules memcached and proxy",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "pass hook to upstream callbacks so we couldn't put order i.e. first upstream to query to get the value and then proxy"
                },
                {
                  "type": "text",
                  "text": "pass to the app. It was solved by proxy",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "pass \"calling\" our custom variable whose handler it was querying the memcached. That had the drawback that the proxy"
                },
                {
                  "type": "text",
                  "text": "pass would have to do blocking I/O (localhost negligible but still not nice)",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So the above works in the following steps:"
                }
              ]
            },
            {
              "type": "orderedList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "HTTP request goes to the generic location @"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "internal \"redirect\" to  /memcverify  where memcached db is queried with key the aguid from the Cookie"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "If value exists for that key THEN proxy"
                        },
                        {
                          "type": "text",
                          "text": "pass to the app",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "If value does not exist return 404 So the flow is async following the nginx cycle"
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "What we need though is an addition in the proxy"
                        },
                        {
                          "type": "text",
                          "text": "pass patch to get the value that memcached auth retrieved to pass it to our marking code",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1605606439857
      }
    ]
  },
  {
    "key": "SA-15492",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "  if job_running('postgresql', instance=postgres.pg_version):\n            subprocess.call([\n                'sudo',\n                '-u',\n                'czd-ca',\n                'java',\n                '-jar',\n                '/usr/cz-controllerd/cz-controllerd.jar',\n                'disable-other-controllers',\n                '/etc/cz-controllerd/config.yaml',\n            ])\n            break"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "We have this code in configd, to force to single controller."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "After I do the force to single controller, I get error that the 2nd controller is offline in the status, so it seems that it is not working."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It seems it is disabling the Controller role "
                },
                {
                  "type": "text",
                  "text": "Salvatore Tomaselli",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/salvatore.tomaselli",
                        "title": "salvatore.tomaselli"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". It is not deactivating the Appliance. If that was your expectation, it wasn't part of the initial design at least."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1606148625137
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "But after a restore, the 1st controller, instead of being green, goes like: "
                },
                {
                  "type": "text",
                  "text": "            \"details\": \"Not connected to 1 controller out of 2: envy-172-17-142-2.devops\", ",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1606228354379
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "(and that is why the latest e2e i did failed, because it expects it just needs to enable the 2nd controller with the api, not to fix the state as well)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1606228820761
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "that could be for various reasons. like configd not pulling the configuration changes when it starts? I can take a look if you have an environment where it's reproduced."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1606230669646
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It's a test env where i ran the e2e "
                },
                {
                  "type": "text",
                  "text": "b6a329ff-e3f0-49ee-9b33-0c4d80fb0740",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": " controller\n                                roles:   controller, logserver\n                                web ui:  "
                },
                {
                  "type": "text",
                  "text": "https://envy-172-17-142-1.devops:444"
                },
                {
                  "type": "text",
                  "text": "\n                                status:  Running\n                                ip:      172.17.142.1\n                                network: 172.17.142.0/24\n                                hostname: envy-172-17-142-1.devops\n                                admin username: admin\n                                admin password: admin\n                        controller2\n                                roles:   controller\n                                web ui:  "
                },
                {
                  "type": "text",
                  "text": "https://envy-172-17-142-2.devops:444"
                },
                {
                  "type": "text",
                  "text": "\n                                status:  Running\n                                ip:      172.17.142.2\n                                network: 172.17.142.0/24\n                                hostname: envy-172-17-142-2.devops\n                                admin username: admin\n                                admin password: admin"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1606231491557
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "By the way, why does that code need to be run in a loop with several retries and a sleep? It is just locally accessing the db, it shouldn't be anything special\u2026"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1606920971690
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "maybe db isn't up in some cases? Should check git history or ask "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "thomas.cellerier",
                    "text": "@thomas.cellerier",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " probably."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1606921725999
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It is up, that's just after we told the db to re-create bdr if it wasn't there\u2026 so it most certainly did reply."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1606979975550
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "is this still a thing?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1607517282971
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yes?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1607520417668
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ok. all you're saying is it isn't working without providing any data whatsoever about it. I can't go around dig evidence for something that hasn't changed and works fine locally."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1607520708397
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "What information more information do you need?"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The fact that is behind retries is already not indicative of something so reliable."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1607521134086
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "You should find out why those retries are there in the first place. I did not get any reports of the command itself being unreliable before. I don't see any reason besides database or controller not being ready yet which is very common with the configd code."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "What you're reporting is basically a conspiracy theory."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1607521447550
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "the first line here was wrong: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "  if job_running('postgresql', instance=postgres.pg_version):"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " it was using 9.4 as the instance instead of 9.4-main."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1610634392690
      }
    ]
  },
  {
    "key": "SA-15578",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "This is the copyright file."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Format: "
            },
            {
              "type": "text",
              "text": "https://www.debian.org/doc/packaging-manuals/copyright-format/1.0/"
            },
            {
              "type": "text",
              "text": "\n\nFiles: *\nCopyright: (C) 2019 Cyxtera Cybersecurity, Inc. d/b/a AppGate\nLicense: Proprietary\nUpstream-Name: sessiond"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Those are some files contained within the package:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "/usr/src/cz-sessiond/\n/usr/src/cz-sessiond/jackson-jaxrs-json-provider-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/jersey-common-2.31-sources.jar.zip\n/usr/src/cz-sessiond/jackson-databind-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/jackson-datatype-jsr310-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/logback-core.sources.zip\n/usr/src/cz-sessiond/jetty-servlet-9.4.31.v20200723-sources.jar.zip\n/usr/src/cz-sessiond/javax.servlet-api-3.1.0-sources.jar.zip\n/usr/src/cz-sessiond/hk2-api-2.6.1-sources.jar.zip\n/usr/src/cz-sessiond/httpcore-4.4.13-sources.jar.zip\n/usr/src/cz-sessiond/javax.servlet.sources.zip\n/usr/src/cz-sessiond/jackson-datatype-jdk8-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/jersey-media-json-jackson-2.31-sources.jar.zip\n/usr/src/cz-sessiond/jakarta.annotation-api-1.3.5-sources.jar.zip\n/usr/src/cz-sessiond/jetty-security-9.4.31.v20200723-sources.jar.zip\n/usr/src/cz-sessiond/bcpkix-jdk15on-1.66-sources.jar.zip\n/usr/src/cz-sessiond/jakarta.inject-2.6.1-sources.jar.zip\n/usr/src/cz-sessiond/jakarta.activation-api-1.2.1-sources.jar.zip\n/usr/src/cz-sessiond/json-smart-1.3.1-sources.jar.zip\n/usr/src/cz-sessiond/junixsocket-native-common-1.0.2-sources.jar.zip\n/usr/src/cz-sessiond/jna.sources.zip\n/usr/src/cz-sessiond/logback-classic-1.2.3-sources.jar.zip\n/usr/src/cz-sessiond/javax.annotation-api-1.2-sources.zip\n/usr/src/cz-sessiond/hk2-locator-2.6.1-sources.jar.zip\n/usr/src/cz-sessiond/jersey-entity-filtering-2.31-sources.jar.zip\n/usr/src/cz-sessiond/jetty-util-9.4.31.v20200723-sources.jar.zip\n/usr/src/cz-sessiond/boss-logging.sources.zip\n/usr/src/cz-sessiond/jaxb-api-2.3.1-sources.jar.zip\n/usr/src/cz-sessiond/geoip2-2.14.0-sources.jar.zip\n/usr/src/cz-sessiond/jackson-jaxrs-base.sources.zip\n/usr/src/cz-sessiond/bcprov-jdk15on-1.66-sources.jar.zip\n/usr/src/cz-sessiond/jakarta.ws.rs-api-2.1.6-sources.jar.zip\n/usr/src/cz-sessiond/commons-logging-1.2-sources.jar.zip\n/usr/src/cz-sessiond/jackson-datatype-guava-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/jaxb-api.sources.zip\n/usr/src/cz-sessiond/jackson-datatype-joda-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/args4j-2.33-sources.jar.zip\n/usr/src/cz-sessiond/commons-codec-1.15-sources.jar.zip\n/usr/src/cz-sessiond/junixsocket-common-1.0.2-sources.jar.zip\n/usr/src/cz-sessiond/aopalliance-repackaged-2.6.1-sources.jar.zip\n/usr/src/cz-sessiond/javax.el.sources.zip\n/usr/src/cz-sessiond/checker-qual-2.10.0-sources.jar.zip\n/usr/src/cz-sessiond/jnagmp-3.0.0-sources.jar.zip\n/usr/src/cz-sessiond/jersey-client-2.31-sources.jar.zip\n/usr/src/cz-sessiond/logback-core-1.2.3-sources.jar.zip\n/usr/src/cz-sessiond/javassist-3.25.0-GA-sources.jar.zip\n/usr/src/cz-sessiond/controller-common-library-5.4.0-201106.0903-sources.jar.zip\n/usr/src/cz-sessiond/jsonrpc2-base-1.38.1-sources.jar.zip\n/usr/src/cz-sessiond/commons-lang3-3.11-sources.jar.zip\n/usr/src/cz-sessiond/snakeyaml-1.27-sources.jar.zip\n/usr/src/cz-sessiond/jackson-annotations-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/jackson-core-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/jackson-module-afterburner-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/osgi-resource-locator-1.0.3-sources.jar.zip\n/usr/src/cz-sessiond/guava-28.2-jre-sources.jar.zip\n/usr/src/cz-sessiond/jakarta.xml.bind-api-2.3.2-sources.jar.zip\n/usr/src/cz-sessiond/javax.activation-api-1.2.0-sources.jar.zip\n/usr/src/cz-sessiond/slf4j-api-1.7.25-sources.jar.zip\n/usr/src/cz-sessiond/jackson-module-parameter-names-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/jetty-server-9.4.31.v20200723-sources.jar.zip\n/usr/src/cz-sessiond/hk2-locator.sources.zip\n/usr/src/cz-sessiond/hk2-utils.sources.zip\n/usr/src/cz-sessiond/jackson-jaxrs-base-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/hk2-api.sources.zip\n/usr/src/cz-sessiond/hk2-utils-2.6.1-sources.jar.zip\n/usr/src/cz-sessiond/jetty-http-9.4.31.v20200723-sources.jar.zip\n/usr/src/cz-sessiond/jsr305-3.0.2-sources.jar.zip\n/usr/src/cz-sessiond/j2objc-annotations-1.3-sources.jar.zip\n/usr/src/cz-sessiond/failureaccess-1.0.1-sources.jar.zip\n/usr/src/cz-sessiond/jna-5.5.0-sources.jar.zip\n/usr/src/cz-sessiond/httpclient-4.5.12-sources.jar.zip\n/usr/src/cz-sessiond/jersey-hk2-2.31-sources.jar.zip\n/usr/src/cz-sessiond/native-lib-loader-2.2.0-sources.jar.zip\n/usr/src/cz-sessiond/joda-time-2.9.9-sources.jar.zip\n/usr/src/cz-sessiond/error_prone_annotations-2.3.4-sources.jar.zip\n/usr/src/cz-sessiond/SDNotify-1.3-sources.jar.zip\n/usr/src/cz-sessiond/jetty-jmx-9.4.31.v20200723-sources.jar.zip\n/usr/src/cz-sessiond/maxmind-db-1.4.0-sources.jar.zip\n/usr/src/cz-sessiond/jackson-module-jaxb-annotations-2.11.2-sources.jar.zip\n/usr/src/cz-sessiond/jetty-io-9.4.31.v20200723-sources.jar.zip\n/usr/src/cz-sessiond/policy-evaluator-5.4.0-201021.1154-sources.jar.zip"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "So it seems somehow pretty unrealistic that the copyright file is accurate."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Please make it accurate."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "We only need to include sources of LGPL dependencies (to make gcp happy), and we can't use AGPL and GPL."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "In the case that there actually LGPL libraries in there, I am not sure of what the legal status of using a fat jar would be, since the license of LGPL libraries says that the user must be able to replace them, so they can't be statically linked (unless object files are provided to relink the final binary)."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I guess we should update the dependency plugin .. "
                },
                {
                  "type": "text",
                  "text": "https://github.com/hierynomus/license-gradle-plugin",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/hierynomus/license-gradle-plugin"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " <-- this could be something to check.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1606739481106
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This is probably a good task for you anton.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1606739512057
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "salvatore.tomaselli",
                    "text": "@salvatore.tomaselli",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": "  "
                },
                {
                  "type": "text",
                  "text": "https://got-youtrack.agi.appgate.com/issue/SA-10604",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://got-youtrack.agi.appgate.com/issue/SA-10604"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "  according to you   CDDL, GPL, LGPL, EPL and MPL should be included..  what do you want? only LGPL or CDDL, GPL, LGPL, EPL and MPL"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1606740297974
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Well thing is, if there is GPL, sessiond is now free software :)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1606745036306
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "There is no GPL but there are pretty many CDDL license libraries.. so should we include them or not"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1606745233300
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Most of the libraries there have a MIT license, so we don't need to ship the sources. That would save time and space on every build."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Plus the copyright file needs to include the correct information anyway."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I'm not sure about LGPL, since we run the thingy as a fat jar."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "If instead of using those, the versions that are packaged in ubuntu already would work, it'd be better, then we don't need to worry about LGPL or shipping sources, if they are already part of the base distribution. But that can be explored later I guess."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This task is strictly about:"
                }
              ]
            },
            {
              "type": "orderedList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Having actual information on license of all the files that are installed by sessiond"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Do not include sources for libraries that have MIT/BSD/Apache license."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1606745302584
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ok..  then we will still continue to include the CDDL .."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1606746107182
      }
    ]
  },
  {
    "key": "SA-15632",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[1] Error: Warning: Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in "
            },
            {
              "type": "text",
              "text": "https://fb.me/setstate-in-render%s"
            },
            {
              "type": "text",
              "text": " App StatusView StatusVie\nw\n[1]     in StatusView (created by Context.Consumer)\n[1]     in Route (created by AppRouting)\n[1]     in Router (created by AppRouting)\n[1]     in AppRouting (created by AppWrapper)\n[1]     in div (created by AppWrapper)\n[1]     in ToastProvider (created by AppWrapper)\n[1]     in AppWrapper (created by App)\n[1]     in App"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": " and {{CODEBLOCK1}}"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-15677",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "For this kind of error: "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Nov 14 04:04:36.703529 ec2-3-137-17-216.us-east-2.compute.amazonaws.com cz-named[23848]: [INFO] [STSCredentials] Renewing sts credentials arn:aws:iam::738846512696:role/AppGateRole with master credentials instance credentials with current access key id ASIA2YBVPCY4LY5G6LNG\nNov 14 04:04:36.765906 ec2-3-137-17-216.us-east-2.compute.amazonaws.com cz-named[23848]: [ERROR] [STSClient] Action AssumeRole using POST "
            },
            {
              "type": "text",
              "text": "https://sts.amazonaws.com"
            },
            {
              "type": "text",
              "text": " returned with HTTP 403 Forbidden\nNov 14 04:04:36.766200 ec2-3-137-17-216.us-east-2.compute.amazonaws.com cz-named[23848]: [ERROR] [STSClient] Got error response of type Sender and code AccessDenied: User: arn:aws:sts::065840544940:assumed-role/appgate-gateway-role/i-0713e75dee8d00722 is not authorized to perform: sts:AssumeRole on resource: arn:aws:iam::738846512696:role/AppGateRole\nNov 14 04:04:36.766279 ec2-3-137-17-216.us-east-2.compute.amazonaws.com cz-named[23848]: [ERROR] Failed to get credentials for the assumed role: AssumedRole(role_session_name='AppGateAWSResolver-0b77e34f-b130-48aa-9fa7-8a3e7f76d9b0', account_id='738846512696', role_name='AppGateRole', duration=900, regions={'us-east-2'}, external_id=None)\nNov 14 04:04:36.766449 ec2-3-137-17-216.us-east-2.compute.amazonaws.com cz-named[23848]: [ERROR] [STSCredentials] Failed to get new credentials for sts credentials arn:aws:iam::738846512696:role/AppGateRole with master credentials instance credentials with current access key id ASIA2YBVPCY4LY5G6LNG"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-15713",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "This is the copyright file of the controller package."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "$ cat /usr/share/doc/cz-controllerd/copyright\nFormat: "
            },
            {
              "type": "text",
              "text": "https://www.debian.org/doc/packaging-manuals/copyright-format/1.0/"
            },
            {
              "type": "text",
              "text": "\n\nFiles: *\nUpstream-Name: cz-controllerd\nCopyright: (C) 2020 Cyxtera Technologies, Inc.\nLicense: Proprietary"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Now, controller package actually ships a number of dependencies within the same package."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "At the moment the copyright and license of all the dependencies is wrongly attributed to appgate."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "mention",
              "attrs": {
                "id": "anton.lundgren",
                "text": "@anton.lundgren",
                "accessLevel": ""
              }
            },
            {
              "type": "text",
              "text": " is working on a similar issue for sessiond, so perhaps his solution could be applied to both repositories once he is done?"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The 3rd party dependencies are installed on a separate path, so the copyright info is also on a separate path. See the screenshots. It's a remnant of the old way of having multiple controller services. It should be cleaned up at some point probably so everything is installed at the same spot, but that's not part of this task."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "![](image1608030734135.png)![](image1608030795976.png)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1608030797120
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "natan.abolafya",
                    "text": "@natan.abolafya",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " nop, it needs to be a valid copyright file in that precise path for it to be scanned, because the scanner finds \"non ubuntu packages\""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1608031612215
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "If there is no such package with that name it won't be picked up."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1608031639196
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ok, I thought it was the directory of the installation that's relevant, not the package. I'll merge them."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1608032005175
      }
    ]
  },
  {
    "key": "SA-15790",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "It will need update on the frontend part to to update the links to the mains parts (update of "
            },
            {
              "type": "text",
              "text": "tabGuideMap",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " under "
            },
            {
              "type": "text",
              "text": "appliances/Contsants.js",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": ")"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The new URLs are "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "https://sdphelp.appgate.com/adminguide/v5.4/appliance-system-configure.html"
                },
                {
                  "type": "text",
                  "text": "\n"
                },
                {
                  "type": "text",
                  "text": "https://sdphelp.appgate.com/adminguide/v5.4/appliance-function-configure.html"
                },
                {
                  "type": "text",
                  "text": "\n"
                },
                {
                  "type": "text",
                  "text": "https://sdphelp.appgate.com/adminguide/v5.4/appliance-miscellaneous-configure.html"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "hadrien.luttiau",
        "created": 1615197893618
      }
    ]
  },
  {
    "key": "SA-15860",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "After the 5 mins of token revocation, the lite client is not informing immediately to the upper layer that a site is down. In consequence the C# code part doesn't dispose the driver and proxy settings are not cleared, hence the browser is not able to access the SAML login page due to a proxy error."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2021-01-14T23:01:14.014Z] Info : Token revocation for [5b40efcb-881a-4733-ab73-2a01f2d725d6] is received by 'ES-APPGATE02_labspace_com'. Will update the token.\n[2021-01-14T23:01:14.014Z] Info : Token revocation for [71c06d2a-8d86-4e98-be52-e7a16de84c93] is received by 'ES-APPGATE02_labspace_com'. Will update the token.\n[2021-01-14T23:01:24.369Z] Info : Starting HTTP Server to receive SAML token.\n[2021-01-14T23:01:24.369Z] Info : Starting the browser to "
            },
            {
              "type": "text",
              "text": "https://login.microsoftonline.com/7733d4d4-91f3-4dea-b063-9263633dbd9b/saml2?SAMLRequest=fY%2FNTsMwEIRfxdp7gn8SmqziVJEqUCW4QOHABVmOSyMldvA6iMcngiKVC8fV7Mx802w%2Fp5F9uEhD8BpEzoE5b0M%2F%2BDcNT4ebrIJt25CZRjljt6STf3Dvi6PEVqMn%2FFE0LNFjMDQQejM5wmTxsbu%2FQ5lznGNIwYYR2H6n4dUVtbJK1Gpz7GtxvVHH0pqqVFYo1du%2BWt%2BIFrf3lIxPGiSXIuMiE8VBSiwr5FVeKP4C7PmXe22BMyV%2Bm%2BMl3v90hsjFtMZA283zrUmuubpMas%2Fn3%2FntFw%3D%3D"
            },
            {
              "type": "text",
              "text": "."
            },
            {
              "type": "text",
              "text": "\n[2021-01-14T23:03:22.789Z] Info : Processing on-demand Claims: [Command: processRunning, ClaimName: AMP_Running, Parameters: [[name, sfc]], Command: processRunning, ClaimName: SEP_Running, Parameters: [[name, sepWscSvc64]], Command: processRunning, ClaimName: FireEye_Agent_Running, Parameters: [[name, xagt]]]\n[2021-01-14T23:06:14.811Z] Error : 'VPN Proxy Device': Error: Error when trying to check events on shim device. Error: 10038\n[2021-01-14T23:06:14.867Z] Error : 'VPN Proxy Device': Error: Error when trying to check events on shim device. Error: 10038\n[2021-01-14T23:06:14.868Z] Error : 'VPN Proxy Device': Error: Error when trying to check if site is ready to write. Invalid SOCKET.\n[2021-01-14T23:08:23.020Z] Info : Processing on-demand Claims: [Command: processRunning, ClaimName: AMP_Running, Parameters: [[name, sfc]], Command: processRunning, ClaimName: SEP_Running, Parameters: [[name, sepWscSvc64]], Command: processRunning, ClaimName: FireEye_Agent_Running, Parameters: [[name, xagt]]]\n[2021-01-14T23:12:24.336Z] Info : Starting HTTP Server to receive SAML token.\n[2021-01-14T23:12:24.337Z] Info : Starting the browser to "
            },
            {
              "type": "text",
              "text": "https://login.microsoftonline.com/7733d4d4-91f3-4dea-b063-9263633dbd9b/saml2?SAMLRequest=fY%2FNTsMwEIRfxdp7gn8SmqziVJEqUCW4QOHABVmOSyMldvA6iMcngiKVC8fV7Mx802w%2Fp5F9uEhD8BpEzoE5b0M%2F%2BDcNT4ebrIJt25CZRjljt6STf3Dvi6PEVqMn%2FFE0LNFjMDQQejM5wmTxsbu%2FQ5lznGNIwYYR2H6n4dUVtbJK1Gpz7GtxvVHH0pqqVFYo1du%2BWt%2BIFrf3lIxPGiSXIuMiE8VBSiwr5FVeKP4C7PmXe22BMyV%2Bm%2BMl3v90hsjFtMZA283zrUmuubpMas%2Fn3%2FntFw%3D%3D"
            },
            {
              "type": "text",
              "text": "."
            },
            {
              "type": "text",
              "text": "\n[2021-01-14T23:13:16.691Z] Info : Starting HTTP Server to receive SAML token."
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-15963",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The build agents will soon lose access to remote resource on the internet. so we need to setup a proxy for sum.golang.org to be able to authenticate the package we install and download."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Setup a direct raw proxy to sum.golang.org"
            }
          ]
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "https://got-nexus01.agi.appgate.com",
                      "marks": [
                        {
                          "type": "link",
                          "attrs": {
                            "href": "https://got-nexus01.agi.appgate.com"
                          }
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": ":8443/#admin/repository/repositories:"
                    },
                    {
                      "type": "text",
                      "text": "gosum"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "https://got-nexus01.agi.appgate.com",
                      "marks": [
                        {
                          "type": "link",
                          "attrs": {
                            "href": "https://got-nexus01.agi.appgate.com"
                          }
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": ":8443/#browse/browse:"
                    },
                    {
                      "type": "text",
                      "text": "gosum"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "how to use it:"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "export environment variable "
                    }
                  ]
                },
                {
                  "type": "codeBlock",
                  "attrs": {},
                  "content": [
                    {
                      "type": "text",
                      "text": "GOSUMDB=\"sum.golang.org "
                    },
                    {
                      "type": "text",
                      "text": "https://got-nexus01.agi.appgate.com:8443/repository/gosum\""
                    },
                    {
                      "type": "text",
                      "text": "\n "
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-15976",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I had left my portal env/setup for 2 days. Today I went to got-youtrack and got redirected to the portal, that's fine. I didn't logged in and I closed the tab. I went again to got-youtrack and instead of getting the page to log in I get \"bad gateway 502\" and the URL in browser stays "
            },
            {
              "type": "text",
              "text": "https://got-youtrack.agi.appgate.com/",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://got-youtrack.agi.appgate.com/"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": " i.e. no redirection"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I checked logs and cz-dnsproxyd say "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Feb 01 09:33:31 envy-172-17-198-1.devops cz-dnsproxyd[2475]: WARNING [cz-dnsproxyd] Can't get cookie info (2v767jgyy7) from memcache. memcache: cache miss\nFeb 01 09:33:36 envy-172-17-198-1.devops cz-dnsproxyd[2475]: WARNING [cz-dnsproxyd] Can't get cookie info (2v767jgyy7) from memcache. memcache: cache miss\nFeb 01 09:33:41 envy-172-17-198-1.devops cz-dnsproxyd[2475]: WARNING [cz-dnsproxyd] Can't get cookie info (2v767jgyy7) from memcache. memcache: cache miss\nFeb 01 09:33:46 envy-172-17-198-1.devops cz-dnsproxyd[2475]: WARNING [cz-dnsproxyd] Can't get cookie info (2v767jgyy7) from memcache. memcache: cache miss"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The problem is that that cookie is old/expored/doesn't exist in the memcache but no redirection is happening to renew it"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This is  untrue. Based on the following logs "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": " 01 09:32:39 envy-172-17-198-1.devops cz-webd[2564]: WARNING [router][192.168.100.190][1azk7uhr4l] Invalid or old cookie No such session, creating a new cookie and session\nFeb 01 09:32:39 envy-172-17-198-1.devops cz-webd[2564]: INFO    [allocationLogic] Allocated: 1, Free: 32, Suggestion: 1, CurrentOutSignal : 0\nFeb 01 09:32:39 envy-172-17-198-1.devops cz-webd[2564]: INFO    [allocationLogic] Calling clientd to add a client\nFeb 01 09:32:40 envy-172-17-198-1.devops cz-webd[2564]: INFO    [unauthenticated][192.168.100.190][2v767jgyy7][router] New Session created\nFeb 01 09:32:40 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] First connection started\nFeb 01 09:32:40 envy-172-17-198-1.devops cz-webd[2564]: INFO    [unauthenticated][2v767jgyy7][9005][session] Session idle timer canceled\nFeb 01 09:32:40 envy-172-17-198-1.devops cz-webd[2564]: INFO    [allocationLogic] Client allocated: 9000 /run/appgate/portal9000/appgate.service.socket\nFeb 01 09:32:40 envy-172-17-198-1.devops cz-webd[2564]: INFO    [allocationLogic] Allocated: 1, Free: 33, Suggestion: 0, CurrentOutSignal : 0\nFeb 01 09:32:47 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Last connection closed\nFeb 01 09:32:47 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Session idle timer started\nFeb 01 09:32:47 envy-172-17-198-1.devops cz-webd[2564]: INFO    [router][192.168.100.190][2v767jgyy7][postCookie][unauthenticated] postCookieOK "
                },
                {
                  "type": "text",
                  "text": "https://got-youtrack.agi.appgate.com:443/clientless-16872eb8"
                },
                {
                  "type": "text",
                  "text": "\nFeb 01 09:32:47 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Session idle timer started\nFeb 01 09:32:48 envy-172-17-198-1.devops cz-webd[2564]: INFO    [router][192.168.100.190][2v767jgyy7][storeCookie][unauthenticated] Redirecting to /, copy cookie for host localhost\nFeb 01 09:33:00 envy-172-17-198-1.devops cz-webd[2564]: INFO    [router][192.168.100.190][2v767jgyy7][postCookie][unauthenticated] postCookieOK "
                },
                {
                  "type": "text",
                  "text": "https://got-youtrack.agi.appgate.com:443/clientless-16872eb8"
                },
                {
                  "type": "text",
                  "text": "\nFeb 01 09:33:00 envy-172-17-198-1.devops cz-webd[2564]: INFO    [9005][2v767jgyy7][session][unauthenticated] Session idle timer started\nFeb 01 09:33:00 envy-172-17-198-1.devops cz-webd[2564]: INFO    [192.168.100.190][2v767jgyy7][router][storeCookie][unauthenticated] Redirecting to /, copy cookie for host localhost\nFeb 01 09:33:43 envy-172-17-198-1.devops cz-webd[2564]: INFO    [9005][2v767jgyy7][session][unauthenticated] Banner connected\nFeb 01 09:33:43 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] First connection started\nFeb 01 09:33:43 envy-172-17-198-1.devops cz-webd[2564]: INFO    [session][2v767jgyy7][9005][unauthenticated] Session idle timer canceled\nFeb 01 09:34:21 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Banner connection closed, by: Browser , why: websocket: close 1001 (going away)\nFeb 01 09:34:21 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Last connection closed\nFeb 01 09:34:21 envy-172-17-198-1.devops cz-webd[2564]: INFO    [unauthenticated][2v767jgyy7][9005][session] Session idle timer started\nFeb 01 09:34:51 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Banner connected\nFeb 01 09:34:51 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] First connection started\nFeb 01 09:34:51 envy-172-17-198-1.devops cz-webd[2564]: INFO    [unauthenticated][2v767jgyy7][9005][session] Session idle timer canceled\nFeb 01 09:35:39 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Banner connected\nFeb 01 09:39:49 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Banner connected\nFeb 01 09:39:53 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Banner connection closed, by: Browser , why: websocket: close 1001 (going away)\nFeb 01 09:39:55 envy-172-17-198-1.devops cz-webd[2564]: INFO    [9005][2v767jgyy7][session][unauthenticated] Banner connected\nFeb 01 09:40:23 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Banner connection closed, by: Browser , why: websocket: close 1001 (going away)\nFeb 01 09:40:24 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Banner connected\nFeb 01 09:43:32 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Banner connection closed, by: Browser , why: websocket: close 1001 (going away)\nFeb 01 09:56:02 envy-172-17-198-1.devops cz-webd[2564]: INFO    [2v767jgyy7][9005][session][unauthenticated] Banner connection closed, by: Browser , why: websocket: close 1006 (abnormal closure): unexpect"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "   The session was created a \"Feb 01 09{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "32}}40\"   The session never logged in..  And the dns information is recieved by the webd when the session is logged in."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So before you login you will ofcourse get cz-dnsproxyd trace errors."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1612182090542
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Its also good to include a bit more logs. Fortunately i was able to get them from the enviroment"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1612182137342
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "What is untrue? I never logged in and I never get redirected. That's the problem here not the dnsproxyd"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1612182439204
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ok.. so we should redirect to client, if the session does not exist.. or if the session is not logged in.."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Where shall we fix that..   nginx or webd?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1612184854850
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Nginx could ask some memcache which webd populates: \"Does this aguid have a valid session? If yes then continue as normal else redirect to login page\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "In slack "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "natan.abolafya",
                    "text": "@natan.abolafya",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " and you have discussed another approach though"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1612185256898
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "yep. one could actually use the same key as dnsproxyd uses.. and that information is available when the session has logged in"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1612185801997
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "yep looks like we are doing with that.. so i guess this needs to happen in nginx"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1612186552428
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "this is done, no?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1613574790066
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "must be"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1613576655261
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Obsolete? Didn't my nginx fix work? The code was linked to this task"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1613758179888
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It is merged "
                },
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/stratus-appliance/commit/a3461053f7a251156e28f36948f11275064b1ab0",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-appliance/commit/a3461053f7a251156e28f36948f11275064b1ab0"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " I move it to verify then"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1613758364907
      }
    ]
  },
  {
    "key": "SA-15992",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I'll copy paste what Norwegian reported:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Backspace handling in new OTP remediation prompt\nA new UI for entering OTPs was introduced in 5.3 with individual boxes for each of the 6 OTP digits.\nWhen entering an OTP this functions as expected with each digit advancing to the following box. No loss of functionality over the old method for this part.\nWhen using backspace to make a correction however, it does not behave as expected and requires two presses. It seems the first establishes focus and the following deletes the digit.\nI am not sure if I have explained this well, so please let me know if you can reproduce it and if it makes sense.\nI just had a look if there was something that showed how I believe it is expected to behave, and I found this:\n"
            },
            {
              "type": "text",
              "text": "https://midhunmonachan.github.io/otp_html_input.html"
            },
            {
              "type": "text",
              "text": "\nI believe that this behaves as users expect, in both directions. I share the link solely for the behaviour, not the code. I have not looked at the code and it may not be the \"right\" way to do this, just wanted to show the expected UX."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So the current behaviour is after discussions with "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "per.svensson",
                    "text": "@per.svensson",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " . We shouldn't just change the behaviour just because a customer wants it unless we actually agree on it. So leaving the decision to svensson here, as the behaviour Norwegian wants has other drawbacks."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "manuel.moraga",
        "created": 1612261815415
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I find the current behavior annoying too. And some others in slack mentioned some irritation also. What are the drawbacks?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1612262119268
      }
    ]
  },
  {
    "key": "SA-16064",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Configure two profiles for portal"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Try to choose another profile"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "It doesn't do much"
                    }
                  ]
                },
                {
                  "type": "blockquote",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Feb 10 14{{COLON"
                        },
                        {
                          "type": "text",
                          "text": "NUM",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "37}}59 envy-172-17-134-1.devops cz-webclient"
                        },
                        {
                          "type": "mention",
                          "attrs": {
                            "id": "9001",
                            "text": "@9001",
                            "accessLevel": ""
                          }
                        },
                        {
                          "type": "text",
                          "text": "[6028]: [2021-02-10T14{{COLON"
                        },
                        {
                          "type": "text",
                          "text": "NUM",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "37}}59.062Z] Warn : Web Client attempted an API that is not allowed."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-16125",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "If I don't have an entitlement on portal and I attempt to go there, the browser hangs for like 60 seconds and then fails with HTTP 503 (I think) Gateway Timeout. This HTTP code implies there is something wrong with the server which is not the case."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "This is afaik the default behavior of proxy"
            },
            {
              "type": "text",
              "text": "pass. From it's purpose perspective, it's natural it returns 503. But let's see if we can change that. To 401 or 403 I guess. Something that matches the URL access responses.",
              "marks": [
                {
                  "type": "em"
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Related: SA-16028"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Something like this should do the trick ` proxy"
                },
                {
                  "type": "text",
                  "text": "intercept",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "errors on; error"
                },
                {
                  "type": "text",
                  "text": "page 404 =302 /your",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "html"
                },
                {
                  "type": "text",
                  "text": "file",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1614679644907
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Fixed with the below: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "        proxy_pass "
                },
                {
                  "type": "text",
                  "text": "https://$cookie_aguid_label.$host:$server_port$request_uri"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n        proxy_intercept_errors on;\n        error_page 500 502 503 504 = @fallback;\n    }\n\n    location @fallback {\n        return 403;\n    }"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "!"
                },
                {
                  "type": "text",
                  "text": "Text",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "403.png"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1614682705035
      }
    ]
  },
  {
    "key": "SA-16247",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[11:00:18][appgate-image] Adding administrative user account...\n[11:00:18][appgate-image] + touch root/home/cz/.sudo_as_admin_successful\n[11:00:18][appgate-image] + ../run-in-chroot root chown -R cz:cz /home/cz/\n[11:00:18][appgate-image] + chmod 750 root/home/cz/\n[11:00:18][appgate-image] + sed 's/^RANDFILE.*//g' -i root/etc/ssl/openssl.cnf\n[11:00:18][appgate-image] + ../unsetup_apt_in_chroot root\n[11:00:18][appgate-image] + DIR=root\n[11:00:18][appgate-image] + dirname ../unsetup_apt_in_chroot\n[11:00:18][appgate-image] + MYPATH=..\n........\n[11:00:19][appgate-image] + rm root/etc/apt/sources.list.d/localrepo.list\n[11:00:19][appgate-image] + rm -f root/etc/apt/trusted.gpg.d/apt-mirror-keyring-8FBD2738.gpg root/etc/apt/trusted.gpg\n[11:00:19][appgate-image] + cat\n[11:00:19][appgate-image] + ../run-in-chroot root apt-get update\n[11:00:19][appgate-image] Get:1 <"
            },
            {
              "type": "text",
              "text": "http://archive.ubuntu.com/ubuntu>"
            },
            {
              "type": "text",
              "text": " bionic InRelease [242 kB]\n[11:00:19][appgate-image] Get:2 <"
            },
            {
              "type": "text",
              "text": "http://archive.ubuntu.com/ubuntu>"
            },
            {
              "type": "text",
              "text": " bionic-updates InRelease [88.7 kB]\n[11:00:19][appgate-image] Get:3 <"
            },
            {
              "type": "text",
              "text": "http://security.ubuntu.com/ubuntu>"
            },
            {
              "type": "text",
              "text": " bionic-security InRelease [88.7 kB]\n[11:00:19][appgate-image] Get:4 <"
            },
            {
              "type": "text",
              "text": "http://archive.ubuntu.com/ubuntu>"
            },
            {
              "type": "text",
              "text": " bionic/main amd64 Packages [1019 kB]\n...."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Towards the end of the image creation, mirrors are changed to point to the public ones, apt update is ran so that the license collector knows which packages do not exist on apt."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Do this using the internal clean mirror instead, and then change the mirrors to the public ones without running the update, so that we don't connect out."
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-16260",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "We should set up proper public repos for the linux clients, so that linux users could get updates through their normal update process. Repos should be separate per minor version so that users to not start running ahead of server versions."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Here I list some technologies that could be used and a mockup of what the installation instructions would be for the user."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "For Ubuntu, we could use PPA "
            },
            {
              "type": "text",
              "text": "https://help.launchpad.net/Packaging/PPA",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://help.launchpad.net/Packaging/PPA"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": " "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "sudo add-apt-repository ppa:appgate/sdpclient53\nsudo apt update \nsudo apt install appgate-sdp"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "For Fedora & RHEL, there's COPR "
            },
            {
              "type": "text",
              "text": "https://copr.fedorainfracloud.org/coprs/",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://copr.fedorainfracloud.org/coprs/"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": " "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "sudo dnf install epel-release\nsudo dnf copr enable appgate/sdpclient53\nsudo dnf install appgate-sdp"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "For Arch, the work has already been done. "
            },
            {
              "type": "text",
              "text": "https://aur.archlinux.org/packages/appgate-sdp/",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://aur.archlinux.org/packages/appgate-sdp/"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": " "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "git clone "
            },
            {
              "type": "text",
              "text": "https://aur.archlinux.org/appgate-sdp.git"
            },
            {
              "type": "text",
              "text": "\ncd appgate-sdp\nmakepkg -si"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "kasper.gustavsson",
                    "text": "@kasper.gustavsson",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " I guess these are easy to manage and not like Azure :-). I assume there is just some sort of repository where we upload these. I guess they do need 'approving'. I imagine you cold script all this when we do a release. So if we do this what steps are there to get it going?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1625555326813
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "If you think that this feature request is still valid. Please add it to "
                },
                {
                  "type": "text",
                  "text": "https://ztna.ideas.craft.io",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://ztna.ideas.craft.io"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "christoffer.karlsson",
        "created": 1749718081443
      }
    ]
  },
  {
    "key": "SA-16346",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Connect with u:p on headless"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Blacklist user"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "See that the connection is gone"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Unblacklist user"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Connection is not back"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "That's because we trigger a \"password renewal\" user action in that case which needs to be specially handled by headless. See these relevant logs:"
                    }
                  ]
                },
                {
                  "type": "codeBlock",
                  "attrs": {},
                  "content": [
                    {
                      "type": "text",
                      "text": "[2021-03-23T14:27:16.185Z] Warn : Authentication to '"
                    },
                    {
                      "type": "text",
                      "text": "https://appgate.sullcrom.com/'"
                    },
                    {
                      "type": "text",
                      "text": " failed while renewing claims token. Prompting user to re-authenticate.\n[2021-03-23T14:33:29.735Z] Info : 'VPN Driver': Closing connection.\n... and then nothing until you restart the service."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-16375",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "At the moment cz-webd verifies that the domain really belongs to what the certificate is made for. For example it checks that "
            },
            {
              "type": "text",
              "text": "got-teamcity.agi.appgate.com",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " is indeed covered by the certificate "
            },
            {
              "type": "text",
              "text": "*.appgate.com",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": ". This check is redundant as SSL handshake between browser and nginx will fail instantly in case there is no match"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Curl to access google.com through portal where nginx is set with \\"
            },
            {
              "type": "text",
              "text": ".appgate.com certificate "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "kosmas@kosmas-VirtualBox:/media/kosmas/Data/git/stratus-appliance$ curl -v "
            },
            {
              "type": "text",
              "text": "https://google.com/post-cookie"
            },
            {
              "type": "text",
              "text": "\n*   Trying 35.181.145.75:443...\n* TCP_NODELAY set\n* Connected to google.com (35.181.145.75) port 443 (#0)\n* ALPN, offering h2\n* ALPN, offering http/1.1\n* successfully set certificate verify locations:\n*   CAfile: /etc/ssl/certs/ca-certificates.crt\n  CApath: /etc/ssl/certs\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\n* TLSv1.2 (IN), TLS handshake, Certificate (11):\n* TLSv1.2 (IN), TLS handshake, Server key exchange (12):\n* TLSv1.2 (IN), TLS handshake, Server finished (14):\n* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\n* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\n* TLSv1.2 (IN), TLS handshake, Finished (20):\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384\n* ALPN, server accepted to use h2\n* Server certificate:\n*  subject: C=US; ST=Florida; L=Coral Gables; O=Cyxtera Cybersecurity, Inc.; CN=*.purple.appgate.com\n*  start date: Jan 14 00:00:00 2021 GMT\n*  expire date: Jan 18 23:59:59 2022 GMT\n*  subjectAltName does not match google.com\n* SSL: no alternative certificate subject name matches target host name 'google.com'\n* Closing connection 0\n* TLSv1.2 (OUT), TLS alert, close notify (256):\ncurl: (60) SSL: no alternative certificate subject name matches target host name 'google.com'\nMore details here: "
            },
            {
              "type": "text",
              "text": "https://curl.haxx.se/docs/sslcerts.html"
            },
            {
              "type": "text",
              "text": "\n\ncurl failed to verify the legitimacy of the server and therefore could not\nestablish a secure connection to it. To learn more about this situation and\nhow to fix it, please visit the web page mentioned above."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "It would make sense in case of HTTP but as the portal will only be HTTPs then nginx/SSL is making sure of the match"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "this is now obsolete.. we only have domain verification in copy-cookie and store-cookie left.. and since we can not validate that in nginx, we will validate it in webd"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617875505399
      }
    ]
  },
  {
    "key": "SA-16473",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Seems like elasticsearch is complaining on the version field. "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Apr 08 14:10:25 envy-10-97-254-2.devops cz-logd[8803]: WARNING [Elasticsearch] Errors during insert: {\"took\":1,\"errors\":true,\"items\":[{\"create\":{\"_index\":\"logstash-2021-04-08\",\"_type\":\"logs\",\"_id\":\"c1ngtk9dt3ce3rtejllg\",\"status\":400,\"error\":{\"type\":\"mapper_parsing_exception\",\"reason\":\"failed to parse field [version] of type [long] in document with id 'c1ngtk9dt3ce3rtejllg'\",\"caused_by\":{\"type\":\"illegal_argument_exception\",\"reason\":\"For input string: \\\"5.4.0-24336\\\"\"}}}}]}\nApr 08 14:10:29 envy-10-97-254-2.devops cz-logd[8803]: WARNING [Elasticsearch] Errors during insert: {\"took\":1,\"errors\":true,\"items\":[{\"create\":{\"_index\":\"logstash-2021-04-08\",\"_type\":\"logs\",\"_id\":\"c1ngtl9dt3ce3rtejlm0\",\"status\":400,\"error\":{\"type\":\"mapper_parsing_exception\",\"reason\":\"failed to parse field [version] of type [long] in document with id 'c1ngtl9dt3ce3rtejlm0'\",\"caused_by\":{\"type\":\"illegal_argument_exception\",\"reason\":\"For input string: \\\"5.4.0-24336\\\"\"}}}}]}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "normally the version fields there is the api-version not a string.. that will cause mapping conflicts"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "But i wonder if we also are missing important fields, like id, daemon "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Apr 08 13:47:17 envy-10-97-254-2.devops cz-configd[843]: INFO {'event_type': 'appliance_status_changed', 'version': '5.4.0-24336', 'cpu': {'percent': 5.4}, 'disk': {'free': 19292483584, 'percent': 0.6, 'total': 20470939648, 'used': 114991104}, 'memory': {'free': 5818290176, 'percent': 49.1, 'total': 20993622016, 'used': 10299920384}, 'network': {'busiestNic': 'eth0', 'details': {'eth0': {'txSpeed': '43.2 bps', 'rxSpeed': '48.0 bps', 'dropin': 5, 'dropout': 0, 'ips': ['10.97.254.2']}}}, 'roles': {'appliance': {'status': 'healthy'}, 'controller': {'status': 'healthy', 'details': 'Database size is 12 MB'}, 'logServer': {'status': 'healthy', 'details': '100% of shards are active.'}}, 'state': 'controller_ready', 'status': 'healthy', 'upgrade': {'status': 'idle'}, 'appliance_version': '5.4.0-24336', 'volumeNumber': 1}"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617892218705
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "There is also a problem with the \"appliance"
                },
                {
                  "type": "text",
                  "text": "status",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "changed\" audit log which passes the appliance version as the audit log version instead of the API version (now 15)."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1617892359954
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "the missing fields are not a problem the client adds them afterwards, configd logs them before that I think: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "        if 'timestamp' not in log:\n            log['timestamp'] = iso_date()\n        if 'event_type' not in log:\n            raise ValueError('Missing field \"event_type\"')\n        if 'daemon' in log:\n            raise ValueError('Value \"daemon\" is strictly forbidden')\n        if 'id' not in log:\n            log['id'] = str(uuid.uuid4())"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1617892688345
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I traced back the file."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Since day one (in 2018) "
                },
                {
                  "type": "text",
                  "text": "caa1a4770390d2505db34a2ce1af472b4553fb00",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " the "
                },
                {
                  "type": "text",
                  "text": "version",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " field was something like "
                },
                {
                  "type": "text",
                  "text": "4.x.x",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " so it has always been a string. The only recent change (6 months) is about having also the build number in there."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The change was made because the version file was just a string that was containing the an out of date non-numeric value."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1617952132621
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So if elastic search has always wanted a numeric field there, this code has never worked."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Or, there has been some later change in elasticsearch configuration (such as "
                },
                {
                  "type": "text",
                  "text": "63c900b6",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " in jun2019 on logging repository, defining a mapping for version as integer)."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1617952916828
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "In any event, not a problem to change it to peer api version."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1617952943622
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Question is this is a problem on the release branch right now.. maybe its "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "thomas.cellerier",
                    "text": "@thomas.cellerier",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " trolling ous..  because i just made a relase env.. and there is working.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617953593709
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "yeah i just made another one.. here it looks good"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617954144909
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I think your special build was somehow strange "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "thomas.cellerier",
                    "text": "@thomas.cellerier",
                    "accessLevel": ""
                  }
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617954177872
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "this is however another issue..  there are log-drops from configd during the statup phase.. when logd is restarting "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Apr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: WARNING [status] System status changed from warning to error\nApr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: INFO {'event_type': 'appliance_status_changed', 'version': '5.4.0-24337-release', 'cpu': {'percent': 72.7}, 'disk': {'free': 19300872192, 'percent'\n: 0.5, 'total': 20470939648, 'used': 106602496}, 'memory': {'free': 15492907008, 'percent': 3.8, 'total': 20993622016, 'used': 806526976}, 'network': {'busiestNic': 'eth0', 'details': {'eth0': {'txSpeed':\n '0.0 Bps', 'rxSpeed': '0.0 Bps', 'dropin': 1, 'dropout': 0, 'ips': ['10.97.180.2']}}}, 'roles': {'appliance': {'status': 'error', 'details': 'The following service is not running: cz-logd\\nThe following \nservice should not be running: ssh\\nno ntp servers configured\\ncz-logd: Failed to perform healthcheck for cz-logd'}}, 'state': 'waiting_config', 'status': 'error', 'upgrade': {'status': 'idle'}, 'applianc\ne_version': '5.4.0-24337-release', 'volumeNumber': 1}\nApr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: ERROR [status] Failed to write appliance_status_changed audit log! {'cpu': {'percent': 72.7}, 'disk': {'free': 19300872192, 'percent': 0.5, 'total': 20470939648, 'used': 106602496}, 'memory': {'free': 15492907008, 'percent': 3.8, 'total': 20993622016, 'used': 806526976}, 'network': {'busiestNic': 'eth0', 'details': {'eth0': {'txSpeed': '0.0 Bps', 'rxSpeed': '0.0 Bps', 'dropin': 1, 'dropout': 0, 'ips': ['10.97.180.2']}}}, 'roles': {'appliance': {'status': 'error', 'details': 'The following service is not running: cz-logd\\nThe following service should not be running: ssh\\nno ntp servers configured\\ncz-logd: Failed to perform healthcheck for cz-logd'}}, 'state': 'waiting_config', 'status': 'error', 'upgrade': {'status': 'idle'}, 'appliance_version': '5.4.0-24337-release', 'volumeNumber': 1}\nApr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: INFO [status] Appliance ips change from no ips to 10.97.180.2\nApr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: INFO [change] Change 667e151c-1b5a-42d4-a7ef-f9d8936e18e3 submitted\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: cz-logd.service: Service hold-off time over, scheduling restart.\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: cz-logd.service: Scheduled restart job, restart counter is at 1.\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: Stopped Appliance Logd, application for reliable logging.\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: Starting Appliance Logd, application for reliable logging...\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [ServerLogic] Starting server logic, role is: server\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [console] Console listening at /run/cz-logd/cz-logd-admin.socket\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [esLogRetention] Checking retention(initial)\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [ServerLogic] Setting up relp server\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [RelpServer] RelpServer starting @ 127.0.0.1:9320 idleTimeout:true/1h0m0s\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: Started Appliance Logd, application for reliable logging.\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: WARNING [esLogRetention] Was unable to get index list: Get \""
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9300/_cat/indices?format=json\""
                },
                {
                  "type": "text",
                  "text": ":"
                },
                {
                  "type": "text",
                  "text": " dial tcp 127.0.0.1:9300: connect: connection refused\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: WARNING [esLogRetention] Could not run log-retention, got err: Get \""
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9300/_cat/indices?format=json\""
                },
                {
                  "type": "text",
                  "text": ":"
                },
                {
                  "type": "text",
                  "text": " dial tcp 127.0.0.1:9300: connect: connection refused\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: WARNING [Status] Service status changed to: warning/Unable to perform log-retention, check access or elasticsearch status. Details: Get \""
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9300/_cat/indices?format=json\""
                },
                {
                  "type": "text",
                  "text": ":"
                },
                {
                  "type": "text",
                  "text": " dial tcp 127.0.0.1:9300: connect: connection refused\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [esLogRetention] Next check at latest at : 2021-04-09T07:41:16Z\nAp"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " But i will create another issue for that"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617954410632
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "aha. there was a merge.. that why..  well ok then its verified working now instead"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617958920351
      }
    ]
  },
  {
    "key": "SA-16484",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Apr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: WARNING [status] System status changed from warning to error\nApr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: INFO {'event_type': 'appliance_status_changed', 'version': '5.4.0-24337-release', 'cpu': {'percent': 72.7}, 'disk': {'free': 19300872192, 'percent'\n: 0.5, 'total': 20470939648, 'used': 106602496}, 'memory': {'free': 15492907008, 'percent': 3.8, 'total': 20993622016, 'used': 806526976}, 'network': {'busiestNic': 'eth0', 'details': {'eth0': {'txSpeed':\n '0.0 Bps', 'rxSpeed': '0.0 Bps', 'dropin': 1, 'dropout': 0, 'ips': ['10.97.180.2']}}}, 'roles': {'appliance': {'status': 'error', 'details': 'The following service is not running: cz-logd\\nThe following \nservice should not be running: ssh\\nno ntp servers configured\\ncz-logd: Failed to perform healthcheck for cz-logd'}}, 'state': 'waiting_config', 'status': 'error', 'upgrade': {'status': 'idle'}, 'applianc\ne_version': '5.4.0-24337-release', 'volumeNumber': 1}\nApr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: ERROR [status] Failed to write appliance_status_changed audit log! {'cpu': {'percent': 72.7}, 'disk': {'free': 19300872192, 'percent': 0.5, 'total': 20470939648, 'used': 106602496}, 'memory': {'free': 15492907008, 'percent': 3.8, 'total': 20993622016, 'used': 806526976}, 'network': {'busiestNic': 'eth0', 'details': {'eth0': {'txSpeed': '0.0 Bps', 'rxSpeed': '0.0 Bps', 'dropin': 1, 'dropout': 0, 'ips': ['10.97.180.2']}}}, 'roles': {'appliance': {'status': 'error', 'details': 'The following service is not running: cz-logd\\nThe following service should not be running: ssh\\nno ntp servers configured\\ncz-logd: Failed to perform healthcheck for cz-logd'}}, 'state': 'waiting_config', 'status': 'error', 'upgrade': {'status': 'idle'}, 'appliance_version': '5.4.0-24337-release', 'volumeNumber': 1}\nApr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: INFO [status] Appliance ips change from no ips to 10.97.180.2\nApr 09 07:40:15 envy-10-97-180-2.devops cz-configd[868]: INFO [change] Change 667e151c-1b5a-42d4-a7ef-f9d8936e18e3 submitted\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: cz-logd.service: Service hold-off time over, scheduling restart.\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: cz-logd.service: Scheduled restart job, restart counter is at 1.\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: Stopped Appliance Logd, application for reliable logging.\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: Starting Appliance Logd, application for reliable logging...\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [ServerLogic] Starting server logic, role is: server\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [console] Console listening at /run/cz-logd/cz-logd-admin.socket\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [esLogRetention] Checking retention(initial)\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [ServerLogic] Setting up relp server\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [RelpServer] RelpServer starting @ 127.0.0.1:9320 idleTimeout:true/1h0m0s\nApr 09 07:40:16 envy-10-97-180-2.devops systemd[1]: Started Appliance Logd, application for reliable logging.\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: WARNING [esLogRetention] Was unable to get index list: Get \""
            },
            {
              "type": "text",
              "text": "http://127.0.0.1:9300/_cat/indices?format=json\""
            },
            {
              "type": "text",
              "text": ":"
            },
            {
              "type": "text",
              "text": " dial tcp 127.0.0.1:9300: connect: connection refused\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: WARNING [esLogRetention] Could not run log-retention, got err: Get \""
            },
            {
              "type": "text",
              "text": "http://127.0.0.1:9300/_cat/indices?format=json\""
            },
            {
              "type": "text",
              "text": ":"
            },
            {
              "type": "text",
              "text": " dial tcp 127.0.0.1:9300: connect: connection refused\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: WARNING [Status] Service status changed to: warning/Unable to perform log-retention, check access or elasticsearch status. Details: Get \""
            },
            {
              "type": "text",
              "text": "http://127.0.0.1:9300/_cat/indices?format=json\""
            },
            {
              "type": "text",
              "text": ":"
            },
            {
              "type": "text",
              "text": " dial tcp 127.0.0.1:9300: connect: connection refused\nApr 09 07:40:16 envy-10-97-180-2.devops cz-logd[2576]: INFO    [esLogRetention] Next check at latest at : 2021-04-09T07:41:16Z\nAp"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So.. Seems like the configd audit log client is not doing retries to send audit logs..  so it probably does 1 try and then drops the logs."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The c-version does several retries.. to prevent log drops, for example when the logd is restarted"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617954540039
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "blockquote",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "The c-version does several retries.. to prevent log drops, for example when the logd is restarted"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The retries are done in the same thread so since it is configd itself starting logd, all that would happen here using the C library is that this would hang the appliance for a while before moving on."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "You are very welcome to implement socket activation in logd and support configuration reload, so that when logs arrive before it is started, systemd will start it, and logd itself can retain the logs in memory until some configuration is written, logd is reloaded and can do whatever it needs to do with the logs."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1617959125993
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Also consider that those audit logs are not called with the guaranteed thing."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The python library also does retries when using guaranteed logs, but not in this case since they are not guaranteed logs."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1617959243657
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "But.. why did this work in 5.3 and not in 5.4?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617959814709
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "normal mode does not mean its ok to drop logs =)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617959942988
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "guaranteed also means, to wait for the audit log to be written to disc before continuing, but doing retries is a step on the way"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617960051272
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I still think this is a new problem in 5.4..  we did not have any drops of configd audit logs in 5.3"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617960963914
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "blockquote",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "But.. why did this work in 5.3 and not in 5.4?"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Did it?"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I can't reproduce, so there must be some precise sequence of events to be triggered to make this happen. Maybe the same sequence of events on 5.3 caused the same error."
                }
              ]
            },
            {
              "type": "blockquote",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "normal mode does not mean its ok to drop logs"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Why was logd not running? The logs don't show that. How should the library deal with the logging daemon not running? Considering that blocking will likely result in the logging daemon keeping on not running."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The C library has nothing to buffer messages when logd is not running, and then start a thread to send them later on\u2026"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1617960997614
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "logd was not running since configd re-configured it.. some re-configuration requires a restart.. some we are able to reload"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617961103037
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "When creating 5.3 env.. i dont see any log drops from configd.. but almost always on 5.4 release envs"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617961148089
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "In configd, appliance"
                },
                {
                  "type": "text",
                  "text": "status",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "changed always had non-guaranteed logging since the error can be logd being down and you still want to see the status updates in that case."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1617961729008
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "For example if you stop logd: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-10-97-240-2:~# journalctl -u cz-configd.service -f\n-- Logs begin at Thu 2021-04-08 13:19:04 UTC. --\nApr 09 09:02:02 envy-10-97-240-2.devops cz-configd[833]: INFO [ApplyServicesAction] Applying services configuration with current configuration /mnt/state/config/20210409-090202-fj26sjdu and previous configuration /mnt/state/config/20210409-090034-ufdkzjlr\nApr 09 09:02:03 envy-10-97-240-2.devops cz-configd[833]: INFO [service] cz-nginx@main reload (reason: base system, service is enabled, required files are present, files changed)\nApr 09 09:02:03 envy-10-97-240-2.devops cz-configd[833]: INFO [ActionsRunner] ApplyServicesAction done\nApr 09 09:02:03 envy-10-97-240-2.devops cz-configd[833]: INFO [change] Change 101d4f45-cba0-483f-9629-58f1cbb3817b completed with result success after 1.088 seconds\nApr 09 09:02:03 envy-10-97-240-2.devops cz-configd[833]: INFO [jsonrpcapp] internal 1 \"get_changes\" success 4\nApr 09 09:50:45 envy-10-97-240-2.devops cz-configd[833]: INFO [jsonrpcapp] internal 1 \"status\" success 0\nApr 09 09:50:51 envy-10-97-240-2.devops cz-configd[833]: WARNING [status] System status changed from healthy to error\nApr 09 09:50:51 envy-10-97-240-2.devops cz-configd[833]: INFO {'event_type': 'appliance_status_changed', 'version': '5.4.0-24332-release', 'cpu': {'percent': 0.3}, 'disk': {'free': 886038528, 'percent': 5.3, 'total': 1006526464, 'used': 50024448}, 'memory': {'free': 9793556480, 'percent': 49.2, 'total': 20993622016, 'used': 10333298688}, 'network': {'busiestNic': 'eth0', 'details': {'eth0': {'txSpeed': '10.0 Kbps', 'rxSpeed': '8.98 Kbps', 'dropin': 15, 'dropout': 0, 'ips': ['10.97.240.2']}}}, 'roles': {'appliance': {'status': 'error', 'details': 'The following service is not running: cz-logd'}, 'controller': {'status': 'healthy', 'details': 'Database size is 23 MB'}, 'logServer': {'status': 'error', 'details': '100% of shards are active.\\ncz-logd: Failed to perform healthcheck for cz-logd'}}, 'state': 'controller_ready', 'status': 'error', 'upgrade': {'status': 'idle'}, 'appliance_version': '5.4.0-24332-release', 'volumeNumber': 1}\nApr 09 09:50:51 envy-10-97-240-2.devops cz-configd[833]: ERROR [status] Failed to write appliance_status_changed audit log! {'cpu': {'percent': 0.3}, 'disk': {'free': 886038528, 'percent': 5.3, 'total': 1006526464, 'used': 50024448}, 'memory': {'free': 9793556480, 'percent': 49.2, 'total': 20993622016, 'used': 10333298688}, 'network': {'busiestNic': 'eth0', 'details': {'eth0': {'txSpeed': '10.0 Kbps', 'rxSpeed': '8.98 Kbps', 'dropin': 15, 'dropout': 0, 'ips': ['10.97.240.2']}}}, 'roles': {'appliance': {'status': 'error', 'details': 'The following service is not running: cz-logd'}, 'controller': {'status': 'healthy', 'details': 'Database size is 23 MB'}, 'logServer': {'status': 'error', 'details': '100% of shards are active.\\ncz-logd: Failed to perform healthcheck for cz-logd'}}, 'state': 'controller_ready', 'status': 'error', 'upgrade': {'status': 'idle'}, 'appliance_version': '5.4.0-24332-release', 'volumeNumber': 1}\nApr 09 09:50:51 envy-10-97-240-2.devops cz-configd[833]: INFO [jsonrpcapp] internal 1 \"status\" success 0"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "![](image1617961931719.png)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1617961959335
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yeah im not saying re-try forever..  there needs to be a reasonable amount of reties..  enough to handle a logd restart anyway"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617963100270
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "You could also make configd a special case. and do some kind of queue of logs there.  its not the end of the world if appliance"
                },
                {
                  "type": "text",
                  "text": "status",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "changed is dropped.. but for example ssh-access logs and ip-access logs are for example way more important"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617963347130
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "but it still feels like we should make a effort not to try to drop logs"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617963376865
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Im fine with putting this as a known issue for 5.4"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617964743708
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "but i think the ssh-access log thing is using this client? right.. so i think those are more sad to drop, if you just reconfigure or restart logd for some reason"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1617964875459
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yes, i'm making a pr for that case"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1617964894346
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "To summarize, I made the ssh thingy to wait for 3s for logd, i made no changes to configd because I don't want to slow it down."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1617971321243
      }
    ]
  },
  {
    "key": "SA-16564",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "since we released the terraform provider  to hashicorp terraform registery, we notice that it did not like the kebab-case in the name it is unable to use dashes (-) in provider {}, data {}, and resource {} blocks, so we need to rename it. the suggestion is to rename it to  "
            },
            {
              "type": "text",
              "text": "appgatesdp",
              "marks": [
                {
                  "type": "code"
                }
              ]
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "terraform {\n  required_providers {\n    appgate-sdp = {\n      source  = \"appgate/appgate-sdp\"\n      version = \"0.4.0\"\n    }\n  }\n}\nprovider \"appgate-sdp\" {\n  username = \"admin\"\n  password = \"admin\"\n  url      = \""
            },
            {
              "type": "text",
              "text": "https://ec2-52-202-108-111.compute-1.amazonaws.com:8443/admin\""
            },
            {
              "type": "text",
              "text": "\n  provider = \"local\"\n  insecure = true\n}# the resource/data prefix must match provider name,\n# provider local name: must contain only letters, digits, and dashes, and may not use leading or trailing dashes\n# resource/data name must be snake_case only.\n# So even though they accept a provider name with kebab case, we cant use it without an alias\n# or using the bultin attribute provider. as shown in the example below.\ndata \"appgate_certificate_authority\" \"ca\" {\n  provider = appgate-sdp # this needs to be appended to all resources/data sources.\n  pem = true\n}\n\n "
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-16581",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Seems to be very apparent on headless "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "aitorbot ['headless_windows', 'headless'] | 2021-04-21 04:00:05\n        id:   045a3774-e829-44bc-a170-e35fdbfe4284\n        url:  "
            },
            {
              "type": "text",
              "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/861044"
            },
            {
              "type": "text",
              "text": "\n        passed: 7/7\naitorbot ['headless_windows', 'headless'] | 2021-04-22 04:00:06\n        id:   45bb6fe5-b2dc-4bc2-a307-1227230e25ef\n        url:  "
            },
            {
              "type": "text",
              "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/861447"
            },
            {
              "type": "text",
              "text": "\n        passed: 6/7"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Summary of the underlying issue:"
            }
          ]
        },
        {
          "type": "blockquote",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "looks like a timing issue as usual. not sure why it affects only Windows. Maybe it keeps connections alive shorter. When the test passes, client manages to get a new VPN cert with the already existing Controller connection. Then the driver complains about CA being unknown instead of client cert not working. This is handled properly by the client. but if the Controller connection needs to be reestablished to get a VPN cert, which fails because Controller cert isn't trusted, it doesn't go ahead and try the next CA."
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-16644",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "According to E2E "
            },
            {
              "type": "text",
              "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/866147",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://got-testrail.agi.appgate.com/index.php?/plans/view/866147"
                  }
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Seems it's broken some time between recently and December 3 when it succeeded last time.  After December 3, the test started failing due to a test code issue."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "hmm, the test passed tonight.. I'll close it if it passes tomorrow also."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1620139302407
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/867177",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://got-testrail.agi.appgate.com/index.php?/plans/view/867177"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " weird that this time TCP was blocked fine but not the UDP.. Maybe Windows is just slower on ipv6?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1620201702547
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "time.sleep(10) ?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1620207913476
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "nowadays it's fifty fifty. Yesterday it was block"
                },
                {
                  "type": "text",
                  "text": "out that was broken. 3 days ago it was block",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "in. Ringfence ipv6 is maybe messing with the gateway connections?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1621263935329
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Right, didn't I update the ticket... yes it seems to be something like that -  the appgate-driver says it gets a dead connection in the middle of the tests - which is a bit random due to timing."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1621270094860
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "do you see any other random failures? or does it look like ringfence is interfering with the connection?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1621324481298
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "looks like RF (=Windows FW rules) interfer with the established TLS connections even though they are explicitly whitelisted"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1621333604829
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Works perfectly on a local setup. :/"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1624958750155
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "haha of course."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1624959951899
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It's rarer and rarer but still happens "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Test case 101967222 failed at 2021-07-17 02:45:06.565348. "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/894295"
                },
                {
                  "type": "text",
                  "text": "\nTest case 101967222 failed at 2021-07-18 02:45:06.776492. "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/894654"
                },
                {
                  "type": "text",
                  "text": "\nTest case 101967222 failed at 2021-07-19 02:45:07.352854. "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/895013"
                },
                {
                  "type": "text",
                  "text": "\nTest case 101967222 failed at 2021-08-06 02:45:06.801619. "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/901903"
                },
                {
                  "type": "text",
                  "text": "\nTest case 101967222 failed at 2021-08-14 02:45:06.735433. "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/905080"
                },
                {
                  "type": "text",
                  "text": "\nTest case 101967222 failed at 2021-08-15 02:45:06.714644. "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/905445"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1629279325377
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Every run was broken when I checked the logs last time, but it's often saved by a client reconnect"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1629280517653
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Seems like it's working now :)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1634296769633
      }
    ]
  },
  {
    "key": "SA-16703",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[12:21:51]\n[ui] \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n[12:21:51]\n[ui] \u2502 high          \u2502 Regular Expression Denial of Service                         \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[ui] \u2502 Package       \u2502 ua-parser-js                                                 \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[ui] \u2502 Patched in    \u2502 >=0.7.24                                                     \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[ui] \u2502 Dependency of \u2502 ua-parser-js                                                 \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[ui] \u2502 Path          \u2502 ua-parser-js                                                 \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[ui] \u2502 More info     \u2502 "
            },
            {
              "type": "text",
              "text": "https://www.npmjs.com/advisories/1679"
            },
            {
              "type": "text",
              "text": "                        \u2502\n[12:21:51]\n[ui] \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n[12:21:51]\n[ui] \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n[12:21:51]\n[ui] \u2502 high          \u2502 Command Injection                                            \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[ui] \u2502 Package       \u2502 lodash                                                       \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[ui] \u2502 Patched in    \u2502 >=4.17.21                                                    \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[ui] \u2502 Dependency of \u2502 react-loading-skeleton                                       \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[12:21:51]\n[ui] \u2502 Path          \u2502 react-loading-skeleton > @emotion/core > @emotion/css >      \u2502\n[12:21:51]\n[12:21:51]\n[ui] \u2502               \u2502 babel-plugin-emotion > @babel/helper-module-imports >        \u2502\n[12:21:51]\n[12:21:51]\n[ui] \u2502               \u2502 @babel/types > lodash                                        \u2502\n[12:21:51]\n[ui] \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n[12:21:51]\n[ui] \u2502 More info     \u2502 "
            },
            {
              "type": "text",
              "text": "https://www.npmjs.com/advisories/1673"
            },
            {
              "type": "text",
              "text": "                        \u2502\n[12:21:51]\n[12:21:51]\n[ui] \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-16773",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "-May 18 02:37:47 envy envy[13543]: [envy.providers.azure] Welcome to a world of Azure pain!\n97639:May 18 02:37:47 envy envy[13543]: [envy.providers.azure] Parsing /var/opt/envy/storage/b2fe4662-75b0-4acb-9df0-3d46b003e316/b2fe4662-75b0-4acb-9df0-3d46b003e316-site1/credentials.json\n97640:May 18 02:37:47 envy envy[13543]: [envy.providers.azure] Deleting resource group resgrp-b2fe4662-75b0-4acb-9df0-3d46b003e316-site1...\n97641-May 18 02:37:47 envy envy[13543]: Traceback (most recent call last):\n97642-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/msrestazure/azure_active_directory.py\", line 478, in set_token\n97643-May 18 02:37:47 envy envy[13543]:     proxies=self.proxies)\n97644-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/requests_oauthlib/oauth2_session.py\", line 307, in fetch_token\n97645-May 18 02:37:47 envy envy[13543]:     self._client.parse_request_body_response(r.text, scope=self.scope)\n97646-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/oauthlib/oauth2/rfc6749/clients/base.py\", line 415, in parse_request_body_response\n97647-May 18 02:37:47 envy envy[13543]:     self.token = parse_token_response(body, scope=scope)\n97648-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/oauthlib/oauth2/rfc6749/parameters.py\", line 425, in parse_token_response\n97649-May 18 02:37:47 envy envy[13543]:     validate_token_parameters(params)\n97650-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/oauthlib/oauth2/rfc6749/parameters.py\", line 432, in validate_token_parameters\n97651-May 18 02:37:47 envy envy[13543]:     raise_from_error(params.get('error'), params)\n97652-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/oauthlib/oauth2/rfc6749/errors.py\", line 405, in raise_from_error\n97653-May 18 02:37:47 envy envy[13543]:     raise cls(**kwargs)\n97654-May 18 02:37:47 envy envy[13543]: oauthlib.oauth2.rfc6749.errors.InvalidClientError: (invalid_client) AADSTS7000222: The provided client secret keys are expired. Visit the Azure Portal to create new keys for your app, or consider using certificate credentials for added security: "
            },
            {
              "type": "text",
              "text": "https://docs.microsoft.com/azure/active-directory/develop/active-directory-certificate-credentials"
            },
            {
              "type": "text",
              "text": "\n97655-May 18 02:37:47 envy envy[13543]: Trace ID: 7d092290-c5d2-445e-9cfc-6b32ec828701\n--\n97683-May 18 02:37:47 envy envy[13543]:     proxies=self.proxies)\n97684-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/requests_oauthlib/oauth2_session.py\", line 307, in fetch_token\n97685-May 18 02:37:47 envy envy[13543]:     self._client.parse_request_body_response(r.text, scope=self.scope)\n97686-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/oauthlib/oauth2/rfc6749/clients/base.py\", line 415, in parse_request_body_response\n97687-May 18 02:37:47 envy envy[13543]:     self.token = parse_token_response(body, scope=scope)\n97688-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/oauthlib/oauth2/rfc6749/parameters.py\", line 425, in parse_token_response\n97689-May 18 02:37:47 envy envy[13543]:     validate_token_parameters(params)\n97690-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/oauthlib/oauth2/rfc6749/parameters.py\", line 432, in validate_token_parameters\n97691-May 18 02:37:47 envy envy[13543]:     raise_from_error(params.get('error'), params)\n97692-May 18 02:37:47 envy envy[13543]:   File \"/opt/envy/envy-virtualenv/lib/python3.6/site-packages/oauthlib/oauth2/rfc6749/errors.py\", line 405, in raise_from_error\n97693-May 18 02:37:47 envy envy[13543]:     raise cls(**kwargs)\n97694-May 18 02:37:47 envy envy[13543]: msrest.exceptions.AuthenticationError: , InvalidClientError: (invalid_client) AADSTS7000222: The provided client secret keys are expired. Visit the Azure Portal to create new keys for your app, or consider using certificate credentials for added security: "
            },
            {
              "type": "text",
              "text": "https://docs.microsoft.com/azure/active-directory/develop/active-directory-certificate-credentials"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-16826",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "A new special server, basically clone of the client server of cz-nginx"
            },
            {
              "type": "mention",
              "attrs": {
                "id": "main",
                "text": "@main",
                "accessLevel": ""
              }
            },
            {
              "type": "text",
              "text": " with the only difference that it listens at another unix domain socket and adds the special HTTP header at the proxy request towards the controller"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The special server ends up as below: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "server {\n    listen unix:/run/czd/cz-nginx-main-webclient.socket fd_passing ssl;\n    server_name _;\n    include /etc/nginx/sites-enabled-main/client_ssl.conf;\n    location / {\n        proxy_pass "
                },
                {
                  "type": "text",
                  "text": "http://client_upstream/client/"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\n        proxy_set_header AG-SPA-Key-Type webclient;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n        proxy_set_header Host $host;\n    }\n}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " AG-SPA-Key-Type webclient;",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is the important for controller "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "natan.abolafya",
                    "text": "@natan.abolafya",
                    "accessLevel": ""
                  }
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1621856893537
      }
    ]
  },
  {
    "key": "SA-16988",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Client auto-upgrade is failing with:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2021-06-28T09:17:32.456Z] Info : Starting package download to '/Users/teo/.appgatesdp/updates/Appgate SDP 5.5.0-26650-master Installer.dmg' from '"
            },
            {
              "type": "text",
              "text": "http://127.0.0.1:8000/Appgate%20SDP%205.5.0-26650-master%20Installer.dmg'"
            },
            {
              "type": "text",
              "text": "."
            },
            {
              "type": "text",
              "text": "\n[2021-06-28T09:17:32.550Z] Error : Error during file download. Cannot write more bytes to the buffer than the configured maximum buffer size: 150000000."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I made a quick fix here: "
            },
            {
              "type": "text",
              "text": "https://github.com/appgate-sdp-int/stratus-tests/pull/2569",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://github.com/appgate-sdp-int/stratus-tests/pull/2569"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": " but the long term solution is to switch the artifact downloader to streaming reads and writes."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Fixed in 5.4.x with "
                },
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/stratus-client-shared/pull/6575",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-client-shared/pull/6575"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and 5.5 with SA-16989"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "manuel.moraga",
        "created": 1624975873964
      }
    ]
  },
  {
    "key": "SA-16993",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "![](image1624956330030.png)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1624956331756
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://www.elastic.co/guide/en/elasticsearch/reference/current/http-clients.html",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.elastic.co/guide/en/elasticsearch/reference/current/http-clients.html"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Basic auth.. example (added the extraHeaders paramter in the elasticsearch section."
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "{\n    \"geoIpDbPath\": \"/etc/cz-geoip/GeoLite2-City.mmdb\",\n    \"logLevel\": \"INFO\",\n    \"role\": \"server\",\n    \"hostname\": \"envy-10-97-138-2.devops\",\n    \"collectiveId\": \"31f65e5c-2630-4350-b8f4-92a63631c2c0\",\n    \"persistenceMode\": \"default\",\n    \"relpClients\": [\n        {\n            \"host\": \"127.0.0.1\",\n            \"port\": 20514,\n            \"format\": \"syslog\",\n            \"name\": \"rsyslog\"\n        }\n    ],\n    \"logdClientMaxPoolSize\": 200,\n    \"maxNrOfLogs\": 100000,\n    \"relpServer\": {\n        \"bindHost\": \"127.0.0.1\",\n        \"bindPort\": 9320,\n        \"idleTimeout\": \"1h\"\n    },\n    \"elasticsearch\": {\n        \"url\": \""
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9300\""
                },
                {
                  "type": "text",
                  "text": ","
                },
                {
                  "type": "text",
                  "text": "\n        \"retentionDays\": 30,\n        \"nrOfFields\": 3000,\n        \"compabilityMode\": 7,\n\t\"extraHeaders\": {\n\t\t\"Authorization\": \"Basic yada yada yada\"\n\t}\n    }\n}"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1624956865344
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "There are also token based: "
                },
                {
                  "type": "text",
                  "text": "https://www.elastic.co/guide/en/elasticsearch/reference/current/token-authentication-services.html",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.elastic.co/guide/en/elasticsearch/reference/current/token-authentication-services.html"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "so..  in same way: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "\t\"extraHeaders\": {\n\t\t\"Authorization\": \"Bearer yada yada yada\"\n\t}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "or"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "\t\"extraHeaders\": {\n\t\t\"Authorization\": \"ApiKey yada yada yada\"\n\t}"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1624956973170
      }
    ]
  },
  {
    "key": "SA-17122",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Aug 03 14:32:18 purple10.appgate.com cz-controllerd[99394]: 127.0.0.1 - - [03/Aug/2021:14:32:18 +0000] \"GET /admin/appliances HTTP/1.0\" 200 9587166 \""
            },
            {
              "type": "text",
              "text": "https://purple10.agi.appgate.com:8443/ui/sites\""
            },
            {
              "type": "text",
              "text": " \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:90.0) Gecko/20100101 Firefox/90.0\" 14002"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-17190",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "CDP exist in our client certificates and it works fine but it has been noticed that when checking with openssl cmd it doesn't print the CDP extension. Something to look at as it might bite in the future."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Example:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "-----BEGIN CERTIFICATE-----\nMIIFKjCCAxKgAwIBAgIGAXt32X7oMA0GCSqGSIb3DQEBDQUAMBkxFzAVBgNVBAMM\nDkFwcGdhdGUgU0RQIENBMCIYDzIwMjEwODIzMTIyNDE5WhgPMjAyMzAxMDYxMjI0\nMTlaMEsxDjAMBgNVBAsMBWxvY2FsMQ4wDAYDVQQDDAVhZG1pbjEpMCcGA1UEAwwg\nNzQ4NzRlZTc3ZjAzNDljMzkyNmQzZTYzODJlZmZhZWUwggIiMA0GCSqGSIb3DQEB\nAQUAA4ICDwAwggIKAoICAQCjn5Nr9ucNZpYx76kGF61hazyH9vBPQXgO1Ugsc6Fy\nxviJT5Hgxyat7PGj3v+V0k6M1cewwrMlQjeClkD6pwE/m5h6Z6kH0cBf2l23Kpp3\n/IdKSZrNZDj9Ewtsn9w2yqob7kCqGv+7pUVAnX2f7OgggbOEjfjmA2e50ONgmkMu\nzsnCE8akT8dh/guRWSPQz73FUcgFHGaq1fAX/VtFF4RWq8W8hjkagZrOo38Bt/Gv\n+N9lpajTJrxqyy3bZhKDGvAtAFkiEOJlsRgWtWeqolLuSBTKySOJnnWUkm15sVBT\nCWeP/uLrTkp5A22BGQQXOqedRNWIV1keYlynIXvf1NL37dwyKikA0sUUwiGWDvOE\nebOwnwdkaOZDjTcEtpOkF5Ajbi7x7u6BOpDuZ2p0BYAGj/NsDwEeqUqB0dnp1RjK\n5+WtDOsF4RS3Ix1T+Dt+bAmLb/b6DfFFZUs3/X9JqbFuFYsGUFG//rZktqi+UTfp\noqxcd8P2VUql7VhyjtJfFBcpV4QG8bytu1gpeiDKbjHYrFW7UIeKA6Hc1+3ShMF6\nPAWn2ML27rY07YwWSnvPgNjKO5qislI0vU5XBZ6lfEDkzi73yMBSRyZgE4tjpc4X\nnA4faOD12aUHk1gk3HrXY71gEe54K+GV6n0s9ro6oMueIY95fGeRmRBfgmARwp6E\nlwIDAQABo0IwQDAdBgNVHQ4EFgQUUEoFRKa3zBtLjnvPeQmY2fQ0uGwwHwYDVR0j\nBBgwFoAUDdCpCdETQd1Ihe/m9FxoH+D8JBYwDQYJKoZIhvcNAQENBQADggIBAHYN\nqNdOiI9UZ8SR43wjBEWMeVahe5cL6VZR6encORDyj9vB1tACYYJNmUJN6HcppNwL\nI+8MviLRbs7k4EbPY0xdTLDC5ub/ZpGpPj4qqkxY4Brbm3dLQB1i2lkPAqytFmOI\n5lcD/wguJ2p9ZSlKB8Z9VZJDDX+SgylnpDngJyG+k/7hLFHb32mRo6RBcaBww5nG\nb5fakJoRaVEgRD5hxli07L2TVMVNftpyK25KQCruEYo+yPlttNLDhLHOktFwIoSU\nZMTQfh+5twsjF9c8jnogd7dPOqRVm41R1puZHR4zMGWzfPGszAZcWzeDkJNekcrH\nt22+kal5dvmdxg4VA4CI5huW1dyz8sN1oWD1PLi/bA8c0GSz2gkA2O6gQSRkLxtQ\nVQt5fdwH3FQIRCA1uYDfYLfneAgQgl7oLRtWp7Zljl21dL8LFhJwzipIGZRhRCHU\n7kDfsI8tBxfpkuCyNvUgIbhcLM+Hp8Ms6TV7FwMIC4J21NS2fLlWBnzYndja2e4A\nYYT6JRhHEe0hVtA/V1AbjJmUsQs8u4xupLbVbd377ViZN2PHLFJhTbwzYzdyQ4aE\nSXKCrh1YrGTRvDrhJ1p3QL3UqOK2JVW4sYzBs1bkp5mjTso4Nr/i8c1gHB2Sta/n\nalymJaFF+IhDOjpk6+4nBNT5q2iob6klf1NsFhOb\n-----END CERTIFICATE-----"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "kosmas@kosmas-VirtualBox:~/Desktop$ openssl x509 -noout -text -in natan.pem | grep -A 4 'X509v3 CRL Distribution Points'\nkosmas@kosmas-VirtualBox:~/Desktop$ "
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "kosmas.valianos",
                    "text": "@kosmas.valianos",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " any ideas here?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1632150130224
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Except that the cert there has no CRL distribution point inside?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1632151538402
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "openssl asn1parse -in natancertwithoutcrl.pem -inform pem",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1632151629317
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "no it doesn't. probably a bad example. But we have seen certs which showed CDP on Windows and KeyStoreExplorer but openssl disagreed."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1632152565089
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It looks like the certificate extracted from vpnd is different from what the adminUI says it is. They both have the same serial number etc but the one from vpnd does not show the CDP"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Client certificate downloaded from "
                },
                {
                  "type": "text",
                  "text": "https://envy-10-97-160-2.devops:8443/ui/issued-certificates",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://envy-10-97-160-2.devops:8443/ui/issued-certificates"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "kosmas@kosmas-CELSIUS-W530-Power:~/Desktop$ openssl x509 -in client.pem -text\nCertificate:\n    Data:\n        Version: 3 (0x2)\n        Serial Number: 1632920287060 (0x17c31a23754)\n        Signature Algorithm: sha512WithRSAEncryption\n        Issuer: C = SE, ST = Goteborg, L = Goteborg, postalCode = 40032, street = Kungsgatan, O = appgate, OU = devops, CN = devops.appgate.com, emailAddress = no-reply@appgate.com\n        Validity\n            Not Before: Sep 29 12:57:07 2021 GMT\n            Not After : Sep 29 12:57:07 2022 GMT\n        Subject: OU = local, CN = admin, CN = 515ea82d3493470bbf181dae820d7056\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                RSA Public-Key: (4096 bit)\n                Modulus:\n                    00:ba:ef:41:75:de:56:90:93:e0:e3:55:c6:29:76:\n                    56:40:b1:8c:14:1c:03:03:99:10:b6:e4:ac:bb:28:\n                    11:e6:ad:2c:27:5f:5e:28:a5:69:c3:23:72:75:82:\n                    d9:fd:19:81:69:8a:be:45:ce:3d:80:d2:f4:38:9d:\n                    59:21:7d:21:ac:7c:c0:cb:d5:df:b2:69:31:4c:48:\n                    68:72:34:90:b1:cf:da:5c:d6:71:b2:59:b2:87:0a:\n                    38:af:2d:3a:1c:25:90:d0:89:fa:76:73:e6:fd:fe:\n                    61:57:2b:79:3f:fe:1a:07:e4:d4:34:7e:d7:25:60:\n                    35:d2:dc:b7:ac:93:94:21:e2:34:d1:4b:4e:38:c4:\n                    c2:82:99:bb:c8:d4:e9:6f:2b:fc:97:ea:19:53:e8:\n                    d4:87:a2:09:19:94:4e:3b:cd:da:85:7f:48:2f:85:\n                    d2:fd:98:14:86:64:86:1e:68:ef:01:c7:77:51:5b:\n                    58:fc:1c:40:5c:d5:0a:ef:95:ff:d3:8a:d0:7b:e7:\n                    94:50:61:75:fb:a7:8c:7a:5d:9b:3a:fe:4b:79:99:\n                    a6:ac:b7:8b:a6:8a:43:c4:0c:56:bb:b2:01:be:d5:\n                    b7:00:df:be:0e:aa:29:e1:77:45:e9:a0:28:9a:e9:\n                    8a:6d:f2:01:4a:d2:fa:2c:fc:65:fa:94:56:60:c2:\n                    01:70:13:5b:32:11:b3:75:fa:55:e2:75:57:44:ae:\n                    bb:d7:09:d5:3b:b0:f2:fe:ca:e5:72:45:ed:95:41:\n                    39:3d:ab:90:81:bb:ee:4b:ed:8e:00:ef:cb:c7:55:\n                    c7:28:17:57:5c:7d:02:f5:8f:53:5f:50:9a:5d:f2:\n                    ba:53:94:7c:17:a9:f7:bc:50:84:ab:ae:2e:47:cc:\n                    9d:4e:f8:dd:74:26:9e:9b:ae:d0:ee:dc:c8:6c:01:\n                    4d:08:25:4f:5a:47:e0:b9:97:3e:4f:01:b3:14:e9:\n                    d3:9a:5a:60:f6:eb:b4:bf:56:00:64:9f:5a:76:f5:\n                    3a:1c:b5:05:56:30:ea:62:c2:38:65:95:ad:e7:8b:\n                    21:c6:4b:cc:f4:8c:21:c3:9b:8e:09:60:0a:cc:4e:\n                    c7:d9:ac:89:b7:94:e1:8f:0e:d1:4c:8f:9c:67:96:\n                    d4:76:c1:ab:fa:76:22:41:af:e0:c7:b1:04:16:4f:\n                    06:8b:1b:ed:16:2c:90:36:23:81:6b:28:34:9b:df:\n                    ae:eb:6c:67:17:25:f9:f6:27:2f:3c:13:ff:73:2e:\n                    ca:d9:77:75:11:b8:3e:3a:58:08:b1:66:3c:81:32:\n                    ee:a7:fd:ba:fe:25:7e:d8:13:09:f5:17:8c:21:75:\n                    20:70:23:9a:db:71:8c:87:25:8e:e8:09:8c:1a:cd:\n                    9d:b7:73\n                Exponent: 65537 (0x10001)\n        X509v3 extensions:\n            X509v3 Extended Key Usage: \n                TLS Web Client Authentication\n            Netscape Cert Type: \n                SSL Client\n            X509v3 Subject Key Identifier: \n                0E:20:FC:A5:ED:67:36:55:6C:95:B2:5C:9D:D2:E6:17:9E:AD:92:5B\n            X509v3 Authority Key Identifier: \n                keyid:27:0F:FC:51:0E:B2:F9:D2:3E:29:16:2E:76:5D:44:B6:1C:8B:83:D9\n                DirName:/C=SE/ST=Goteborg/L=Goteborg/postalCode=40032/street=Kungsgatan/O=appgate/OU=devops/CN=devops.appgate.com/emailAddress=no-reply@appgate.com\n                serial:0B:D1:DF:A9:86:B8:F0:33:8F:83:A3:C8:F0:FD:9D:62:8D:0C:A1:CB\n\n            X509v3 CRL Distribution Points: \n\n                Full Name:\n                  URI:"
                },
                {
                  "type": "text",
                  "text": "http://ec2-52-56-222-134.eu-west-2.compute.amazonaws.com/kosmas.crl"
                },
                {
                  "type": "text",
                  "text": "\n\n    Signature Algorithm: sha512WithRSAEncryption\n         bf:ec:a6:57:90:6c:72:65:a8:c7:71:9c:c8:ff:4e:d4:65:17:\n         b1:0d:56:15:e0:a7:a1:38:a3:07:da:91:e0:22:e5:c5:a9:82:\n         68:83:61:71:0a:f9:15:43:7f:2b:6c:08:4a:a4:63:bd:de:4d:\n         0a:53:88:8c:99:b4:92:f8:47:d6:74:e1:6f:4a:a2:6c:7e:c6:\n         91:1b:5d:4b:ee:7d:cc:de:ea:c5:3e:f2:8b:cd:b4:e0:ca:63:\n         47:75:57:cd:f1:b8:31:54:9c:80:e7:bb:6d:48:05:06:24:b0:\n         34:29:23:53:d5:2f:31:7d:54:d0:c3:41:3c:f9:d4:27:2a:29:\n         e5:ea:28:36:89:f4:09:3a:ca:0a:14:fa:5f:bd:c6:a5:e0:fa:\n         19:22:99:84:6d:4d:60:11:8b:df:82:cb:19:88:7e:16:6c:dd:\n         54:84:48:c9:93:3a:29:3b:eb:89:71:9c:13:9d:28:ee:c5:3f:\n         03:ab:d4:c4:17:86:85:9e:3f:77:5a:82:e3:77:76:e6:3b:52:\n         af:6a:76:53:5e:ba:f3:1c:81:86:16:f7:59:61:e1:7c:68:4f:\n         80:e5:a6:4c:1f:9d:18:7a:17:77:20:73:b7:ac:8a:87:65:76:\n         50:4d:97:e3:53:ec:11:80:dc:fd:f1:07:83:2b:5c:b9:0c:f0:\n         b8:0a:15:6c:99:84:bf:72:05:30:94:44:70:28:0b:df:48:11:\n         6b:1a:6c:8f:f9:cd:67:1e:98:e5:13:97:fb:b2:3b:6e:fc:ee:\n         2f:60:9d:98:52:cf:03:d1:78:16:6d:70:d0:9d:ac:72:4c:50:\n         1e:c8:f7:ae:fc:20:c4:c2:31:d1:bd:f4:52:bb:f1:0b:81:59:\n         fa:49:0a:c5:25:76:63:4b:0c:c7:4d:56:86:f5:d8:fc:84:01:\n         05:dd:1e:6f:e2:00:b6:a8:0e:60:61:7f:c6:51:46:be:c7:c4:\n         6f:73:6f:55:d5:c6:dc:82:cf:d6:ad:35:1e:f0:0b:22:53:ff:\n         f0:84:05:18:03:c2:c3:ff:8b:5e:a5:c6:39:a9:b4:62:fb:4d:\n         14:89:b4:b5:af:dd:03:db:e2:a9:67:b7:52:7f:82:17:52:93:\n         88:92:16:b8:98:50:fe:ae:4f:3f:ee:4d:ab:e9:26:31:a1:6e:\n         bb:06:cb:8e:cd:2d:e2:ec:2d:ad:cb:63:11:5c:52:8a:69:49:\n         16:3d:9e:56:26:6f:2d:92:2f:ec:4f:20:f8:42:ac:e1:6e:c0:\n         68:72:42:1c:ab:54:a8:1b:ff:18:a3:ff:d5:aa:1f:24:a9:61:\n         b8:12:a5:02:18:69:06:0e:29:14:3c:d7:a5:bf:7a:84:7f:79:\n         58:1c:49:e2:ce:f3:95:f1\n-----BEGIN CERTIFICATE-----\nMIIHLDCCBRSgAwIBAgIGAXwxojdUMA0GCSqGSIb3DQEBDQUAMIG9MQswCQYDVQQG\nEwJTRTERMA8GA1UECAwIR290ZWJvcmcxETAPBgNVBAcMCEdvdGVib3JnMQ4wDAYD\nVQQRDAU0MDAzMjETMBEGA1UECQwKS3VuZ3NnYXRhbjEQMA4GA1UECgwHYXBwZ2F0\nZTEPMA0GA1UECwwGZGV2b3BzMRswGQYDVQQDDBJkZXZvcHMuYXBwZ2F0ZS5jb20x\nIzAhBgkqhkiG9w0BCQEWFG5vLXJlcGx5QGFwcGdhdGUuY29tMB4XDTIxMDkyOTEy\nNTcwN1oXDTIyMDkyOTEyNTcwN1owSzEOMAwGA1UECwwFbG9jYWwxDjAMBgNVBAMM\nBWFkbWluMSkwJwYDVQQDDCA1MTVlYTgyZDM0OTM0NzBiYmYxODFkYWU4MjBkNzA1\nNjCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBALrvQXXeVpCT4ONVxil2\nVkCxjBQcAwOZELbkrLsoEeatLCdfXiilacMjcnWC2f0ZgWmKvkXOPYDS9DidWSF9\nIax8wMvV37JpMUxIaHI0kLHP2lzWcbJZsocKOK8tOhwlkNCJ+nZz5v3+YVcreT/+\nGgfk1DR+1yVgNdLct6yTlCHiNNFLTjjEwoKZu8jU6W8r/JfqGVPo1IeiCRmUTjvN\n2oV/SC+F0v2YFIZkhh5o7wHHd1FbWPwcQFzVCu+V/9OK0HvnlFBhdfunjHpdmzr+\nS3mZpqy3i6aKQ8QMVruyAb7VtwDfvg6qKeF3RemgKJrpim3yAUrS+iz8ZfqUVmDC\nAXATWzIRs3X6VeJ1V0Suu9cJ1Tuw8v7K5XJF7ZVBOT2rkIG77kvtjgDvy8dVxygX\nV1x9AvWPU19Qml3yulOUfBep97xQhKuuLkfMnU743XQmnpuu0O7cyGwBTQglT1pH\n4LmXPk8BsxTp05paYPbrtL9WAGSfWnb1Ohy1BVYw6mLCOGWVreeLIcZLzPSMIcOb\njglgCsxOx9msibeU4Y8O0UyPnGeW1HbBq/p2IkGv4MexBBZPBosb7RYskDYjgWso\nNJvfrutsZxcl+fYnLzwT/3Muytl3dRG4PjpYCLFmPIEy7qf9uv4lftgTCfUXjCF1\nIHAjmttxjIcljugJjBrNnbdzAgMBAAGjggGhMIIBnTATBgNVHSUEDDAKBggrBgEF\nBQcDAjARBglghkgBhvhCAQEEBAMCB4AwHQYDVR0OBBYEFA4g/KXtZzZVbJWyXJ3S\n5heerZJbMIH9BgNVHSMEgfUwgfKAFCcP/FEOsvnSPikWLnZdRLYci4PZoYHDpIHA\nMIG9MQswCQYDVQQGEwJTRTERMA8GA1UECAwIR290ZWJvcmcxETAPBgNVBAcMCEdv\ndGVib3JnMQ4wDAYDVQQRDAU0MDAzMjETMBEGA1UECQwKS3VuZ3NnYXRhbjEQMA4G\nA1UECgwHYXBwZ2F0ZTEPMA0GA1UECwwGZGV2b3BzMRswGQYDVQQDDBJkZXZvcHMu\nYXBwZ2F0ZS5jb20xIzAhBgkqhkiG9w0BCQEWFG5vLXJlcGx5QGFwcGdhdGUuY29t\nghQL0d+phrjwM4+Do8jw/Z1ijQyhyzBUBgNVHR8ETTBLMEmgR6BFhkNodHRwOi8v\nZWMyLTUyLTU2LTIyMi0xMzQuZXUtd2VzdC0yLmNvbXB1dGUuYW1hem9uYXdzLmNv\nbS9rb3NtYXMuY3JsMA0GCSqGSIb3DQEBDQUAA4ICAQC/7KZXkGxyZajHcZzI/07U\nZRexDVYV4KehOKMH2pHgIuXFqYJog2FxCvkVQ38rbAhKpGO93k0KU4iMmbSS+EfW\ndOFvSqJsfsaRG11L7n3M3urFPvKLzbTgymNHdVfN8bgxVJyA57ttSAUGJLA0KSNT\n1S8xfVTQw0E8+dQnKinl6ig2ifQJOsoKFPpfvcal4PoZIpmEbU1gEYvfgssZiH4W\nbN1UhEjJkzopO+uJcZwTnSjuxT8Dq9TEF4aFnj93WoLjd3bmO1KvanZTXrrzHIGG\nFvdZYeF8aE+A5aZMH50Yehd3IHO3rIqHZXZQTZfjU+wRgNz98QeDK1y5DPC4ChVs\nmYS/cgUwlERwKAvfSBFrGmyP+c1nHpjlE5f7sjtu/O4vYJ2YUs8D0XgWbXDQnaxy\nTFAeyPeu/CDEwjHRvfRSu/ELgVn6SQrFJXZjSwzHTVaG9dj8hAEF3R5v4gC2qA5g\nYX/GUUa+x8Rvc29V1cbcgs/WrTUe8AsiU//whAUYA8LD/4tepcY5qbRi+00UibS1\nr90D2+KpZ7dSf4IXUpOIkha4mFD+rk8/7k2r6SYxoW67BsuOzS3i7C2ty2MRXFKK\naUkWPZ5WJm8tki/sTyD4QqzhbsBockIcq1SoG/8Yo//Vqh8kqWG4EqUCGGkGDikU\nPNelv3qEf3lYHEnizvOV8Q==\n-----END CERTIFICATE-----"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Client certificate extracted from vpnd"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "kosmas@kosmas-CELSIUS-W530-Power:~/Desktop$ openssl x509 -in vpnclient.pem -text\nCertificate:\n    Data:\n        Version: 3 (0x2)\n        Serial Number: 1632920287060 (0x17c31a23754)\n        Signature Algorithm: sha512WithRSAEncryption\n        Issuer: C = SE, ST = Goteborg, L = Goteborg, O = appgate, OU = devops, CN = devops.appgate.com, emailAddress = no-reply@appgate.com\n        Validity\n            Not Before: Sep 28 14:00:15 2021 GMT\n            Not After : Feb 11 14:00:15 2023 GMT\n        Subject: OU = local, CN = admin, CN = 515ea82d3493470bbf181dae820d7056\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                RSA Public-Key: (4096 bit)\n                Modulus:\n                    00:ba:ef:41:75:de:56:90:93:e0:e3:55:c6:29:76:\n                    56:40:b1:8c:14:1c:03:03:99:10:b6:e4:ac:bb:28:\n                    11:e6:ad:2c:27:5f:5e:28:a5:69:c3:23:72:75:82:\n                    d9:fd:19:81:69:8a:be:45:ce:3d:80:d2:f4:38:9d:\n                    59:21:7d:21:ac:7c:c0:cb:d5:df:b2:69:31:4c:48:\n                    68:72:34:90:b1:cf:da:5c:d6:71:b2:59:b2:87:0a:\n                    38:af:2d:3a:1c:25:90:d0:89:fa:76:73:e6:fd:fe:\n                    61:57:2b:79:3f:fe:1a:07:e4:d4:34:7e:d7:25:60:\n                    35:d2:dc:b7:ac:93:94:21:e2:34:d1:4b:4e:38:c4:\n                    c2:82:99:bb:c8:d4:e9:6f:2b:fc:97:ea:19:53:e8:\n                    d4:87:a2:09:19:94:4e:3b:cd:da:85:7f:48:2f:85:\n                    d2:fd:98:14:86:64:86:1e:68:ef:01:c7:77:51:5b:\n                    58:fc:1c:40:5c:d5:0a:ef:95:ff:d3:8a:d0:7b:e7:\n                    94:50:61:75:fb:a7:8c:7a:5d:9b:3a:fe:4b:79:99:\n                    a6:ac:b7:8b:a6:8a:43:c4:0c:56:bb:b2:01:be:d5:\n                    b7:00:df:be:0e:aa:29:e1:77:45:e9:a0:28:9a:e9:\n                    8a:6d:f2:01:4a:d2:fa:2c:fc:65:fa:94:56:60:c2:\n                    01:70:13:5b:32:11:b3:75:fa:55:e2:75:57:44:ae:\n                    bb:d7:09:d5:3b:b0:f2:fe:ca:e5:72:45:ed:95:41:\n                    39:3d:ab:90:81:bb:ee:4b:ed:8e:00:ef:cb:c7:55:\n                    c7:28:17:57:5c:7d:02:f5:8f:53:5f:50:9a:5d:f2:\n                    ba:53:94:7c:17:a9:f7:bc:50:84:ab:ae:2e:47:cc:\n                    9d:4e:f8:dd:74:26:9e:9b:ae:d0:ee:dc:c8:6c:01:\n                    4d:08:25:4f:5a:47:e0:b9:97:3e:4f:01:b3:14:e9:\n                    d3:9a:5a:60:f6:eb:b4:bf:56:00:64:9f:5a:76:f5:\n                    3a:1c:b5:05:56:30:ea:62:c2:38:65:95:ad:e7:8b:\n                    21:c6:4b:cc:f4:8c:21:c3:9b:8e:09:60:0a:cc:4e:\n                    c7:d9:ac:89:b7:94:e1:8f:0e:d1:4c:8f:9c:67:96:\n                    d4:76:c1:ab:fa:76:22:41:af:e0:c7:b1:04:16:4f:\n                    06:8b:1b:ed:16:2c:90:36:23:81:6b:28:34:9b:df:\n                    ae:eb:6c:67:17:25:f9:f6:27:2f:3c:13:ff:73:2e:\n                    ca:d9:77:75:11:b8:3e:3a:58:08:b1:66:3c:81:32:\n                    ee:a7:fd:ba:fe:25:7e:d8:13:09:f5:17:8c:21:75:\n                    20:70:23:9a:db:71:8c:87:25:8e:e8:09:8c:1a:cd:\n                    9d:b7:73\n                Exponent: 65537 (0x10001)\n        X509v3 extensions:\n            X509v3 Subject Key Identifier: \n                0E:20:FC:A5:ED:67:36:55:6C:95:B2:5C:9D:D2:E6:17:9E:AD:92:5B\n            X509v3 Authority Key Identifier: \n                keyid:27:0F:FC:51:0E:B2:F9:D2:3E:29:16:2E:76:5D:44:B6:1C:8B:83:D9\n\n    Signature Algorithm: sha512WithRSAEncryption\n         bf:ec:a6:57:90:6c:72:65:a8:c7:71:9c:c8:ff:4e:d4:65:17:\n         b1:0d:56:15:e0:a7:a1:38:a3:07:da:91:e0:22:e5:c5:a9:82:\n         68:83:61:71:0a:f9:15:43:7f:2b:6c:08:4a:a4:63:bd:de:4d:\n         0a:53:88:8c:99:b4:92:f8:47:d6:74:e1:6f:4a:a2:6c:7e:c6:\n         91:1b:5d:4b:ee:7d:cc:de:ea:c5:3e:f2:8b:cd:b4:e0:ca:63:\n         47:75:57:cd:f1:b8:31:54:9c:80:e7:bb:6d:48:05:06:24:b0:\n         34:29:23:53:d5:2f:31:7d:54:d0:c3:41:3c:f9:d4:27:2a:29:\n         e5:ea:28:36:89:f4:09:3a:ca:0a:14:fa:5f:bd:c6:a5:e0:fa:\n         19:22:99:84:6d:4d:60:11:8b:df:82:cb:19:88:7e:16:6c:dd:\n         54:84:48:c9:93:3a:29:3b:eb:89:71:9c:13:9d:28:ee:c5:3f:\n         03:ab:d4:c4:17:86:85:9e:3f:77:5a:82:e3:77:76:e6:3b:52:\n         af:6a:76:53:5e:ba:f3:1c:81:86:16:f7:59:61:e1:7c:68:4f:\n         80:e5:a6:4c:1f:9d:18:7a:17:77:20:73:b7:ac:8a:87:65:76:\n         50:4d:97:e3:53:ec:11:80:dc:fd:f1:07:83:2b:5c:b9:0c:f0:\n         b8:0a:15:6c:99:84:bf:72:05:30:94:44:70:28:0b:df:48:11:\n         6b:1a:6c:8f:f9:cd:67:1e:98:e5:13:97:fb:b2:3b:6e:fc:ee:\n         2f:60:9d:98:52:cf:03:d1:78:16:6d:70:d0:9d:ac:72:4c:50:\n         1e:c8:f7:ae:fc:20:c4:c2:31:d1:bd:f4:52:bb:f1:0b:81:59:\n         fa:49:0a:c5:25:76:63:4b:0c:c7:4d:56:86:f5:d8:fc:84:01:\n         05:dd:1e:6f:e2:00:b6:a8:0e:60:61:7f:c6:51:46:be:c7:c4:\n         6f:73:6f:55:d5:c6:dc:82:cf:d6:ad:35:1e:f0:0b:22:53:ff:\n         f0:84:05:18:03:c2:c3:ff:8b:5e:a5:c6:39:a9:b4:62:fb:4d:\n         14:89:b4:b5:af:dd:03:db:e2:a9:67:b7:52:7f:82:17:52:93:\n         88:92:16:b8:98:50:fe:ae:4f:3f:ee:4d:ab:e9:26:31:a1:6e:\n         bb:06:cb:8e:cd:2d:e2:ec:2d:ad:cb:63:11:5c:52:8a:69:49:\n         16:3d:9e:56:26:6f:2d:92:2f:ec:4f:20:f8:42:ac:e1:6e:c0:\n         68:72:42:1c:ab:54:a8:1b:ff:18:a3:ff:d5:aa:1f:24:a9:61:\n         b8:12:a5:02:18:69:06:0e:29:14:3c:d7:a5:bf:7a:84:7f:79:\n         58:1c:49:e2:ce:f3:95:f1\n-----BEGIN CERTIFICATE-----\nMIIFqjCCA5KgAwIBAgIGAXwxojdUMA0GCSqGSIb3DQEBDQUAMIGYMQswCQYDVQQG\nEwJTRTERMA8GA1UECAwIR290ZWJvcmcxETAPBgNVBAcMCEdvdGVib3JnMRAwDgYD\nVQQKDAdhcHBnYXRlMQ8wDQYDVQQLDAZkZXZvcHMxGzAZBgNVBAMMEmRldm9wcy5h\ncHBnYXRlLmNvbTEjMCEGCSqGSIb3DQEJARYUbm8tcmVwbHlAYXBwZ2F0ZS5jb20w\nIhgPMjAyMTA5MjgxNDAwMTVaGA8yMDIzMDIxMTE0MDAxNVowSzEOMAwGA1UECwwF\nbG9jYWwxDjAMBgNVBAMMBWFkbWluMSkwJwYDVQQDDCA1MTVlYTgyZDM0OTM0NzBi\nYmYxODFkYWU4MjBkNzA1NjCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIB\nALrvQXXeVpCT4ONVxil2VkCxjBQcAwOZELbkrLsoEeatLCdfXiilacMjcnWC2f0Z\ngWmKvkXOPYDS9DidWSF9Iax8wMvV37JpMUxIaHI0kLHP2lzWcbJZsocKOK8tOhwl\nkNCJ+nZz5v3+YVcreT/+Ggfk1DR+1yVgNdLct6yTlCHiNNFLTjjEwoKZu8jU6W8r\n/JfqGVPo1IeiCRmUTjvN2oV/SC+F0v2YFIZkhh5o7wHHd1FbWPwcQFzVCu+V/9OK\n0HvnlFBhdfunjHpdmzr+S3mZpqy3i6aKQ8QMVruyAb7VtwDfvg6qKeF3RemgKJrp\nim3yAUrS+iz8ZfqUVmDCAXATWzIRs3X6VeJ1V0Suu9cJ1Tuw8v7K5XJF7ZVBOT2r\nkIG77kvtjgDvy8dVxygXV1x9AvWPU19Qml3yulOUfBep97xQhKuuLkfMnU743XQm\nnpuu0O7cyGwBTQglT1pH4LmXPk8BsxTp05paYPbrtL9WAGSfWnb1Ohy1BVYw6mLC\nOGWVreeLIcZLzPSMIcObjglgCsxOx9msibeU4Y8O0UyPnGeW1HbBq/p2IkGv4Mex\nBBZPBosb7RYskDYjgWsoNJvfrutsZxcl+fYnLzwT/3Muytl3dRG4PjpYCLFmPIEy\n7qf9uv4lftgTCfUXjCF1IHAjmttxjIcljugJjBrNnbdzAgMBAAGjQjBAMB0GA1Ud\nDgQWBBQOIPyl7Wc2VWyVslyd0uYXnq2SWzAfBgNVHSMEGDAWgBQnD/xRDrL50j4p\nFi52XUS2HIuD2TANBgkqhkiG9w0BAQ0FAAOCAgEAv+ymV5BscmWox3GcyP9O1GUX\nsQ1WFeCnoTijB9qR4CLlxamCaINhcQr5FUN/K2wISqRjvd5NClOIjJm0kvhH1nTh\nb0qibH7GkRtdS+59zN7qxT7yi8204MpjR3VXzfG4MVScgOe7bUgFBiSwNCkjU9Uv\nMX1U0MNBPPnUJyop5eooNon0CTrKChT6X73GpeD6GSKZhG1NYBGL34LLGYh+Fmzd\nVIRIyZM6KTvriXGcE50o7sU/A6vUxBeGhZ4/d1qC43d25jtSr2p2U1668xyBhhb3\nWWHhfGhPgOWmTB+dGHoXdyBzt6yKh2V2UE2X41PsEYDc/fEHgytcuQzwuAoVbJmE\nv3IFMJREcCgL30gRaxpsj/nNZx6Y5ROX+7I7bvzuL2CdmFLPA9F4Fm1w0J2sckxQ\nHsj3rvwgxMIx0b30UrvxC4FZ+kkKxSV2Y0sMx01WhvXY/IQBBd0eb+IAtqgOYGF/\nxlFGvsfEb3NvVdXG3ILP1q01HvALIlP/8IQFGAPCw/+LXqXGOam0YvtNFIm0ta/d\nA9viqWe3Un+CF1KTiJIWuJhQ/q5PP+5Nq+kmMaFuuwbLjs0t4uwtrctjEVxSimlJ\nFj2eViZvLZIv7E8g+EKs4W7AaHJCHKtUqBv/GKP/1aofJKlhuBKlAhhpBg4pFDzX\npb96hH95WBxJ4s7zlfE=\n-----END CERTIFICATE-----"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1632924702316
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Looks like a wolfssl bug to me. It looks it doesn't understand some ASN to print them properly. By taking a closer look in the above 2 outputs it can be seen that lots of extensions have problems"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "WolfSSL (cz-vpnd)"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "X509v3 extensions:\n            X509v3 Subject Key Identifier: \n                0E:20:FC:A5:ED:67:36:55:6C:95:B2:5C:9D:D2:E6:17:9E:AD:92:5B\n            X509v3 Authority Key Identifier: \n                keyid:27:0F:FC:51:0E:B2:F9:D2:3E:29:16:2E:76:5D:44:B6:1C:8B:83:D9"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "OpenSSL"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "X509v3 extensions:\n            X509v3 Extended Key Usage: \n                TLS Web Client Authentication\n            Netscape Cert Type: \n                SSL Client\n            X509v3 Subject Key Identifier: \n                0E:20:FC:A5:ED:67:36:55:6C:95:B2:5C:9D:D2:E6:17:9E:AD:92:5B\n            X509v3 Authority Key Identifier: \n                keyid:27:0F:FC:51:0E:B2:F9:D2:3E:29:16:2E:76:5D:44:B6:1C:8B:83:D9\n                DirName:/C=SE/ST=Goteborg/L=Goteborg/postalCode=40032/street=Kungsgatan/O=appgate/OU=devops/CN=devops.appgate.com/emailAddress=no-reply@appgate.com\n                serial:0B:D1:DF:A9:86:B8:F0:33:8F:83:A3:C8:F0:FD:9D:62:8D:0C:A1:CB\n\n            X509v3 CRL Distribution Points: \n\n                Full Name:\n                  URI:"
                },
                {
                  "type": "text",
                  "text": "http://ec2-52-56-222-134.eu-west-2.compute.amazonaws.com/kosmas.crl"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": ""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1632925723295
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I opened a ticket with wolfSSL to verify it is a \"print support\" for some extensions that is missing. Closing for now and will open it again if it turns out there is something we can do on our end"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1632987271193
      }
    ]
  },
  {
    "key": "SA-17211",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "It's slow and Console is full of errors:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Uncaught Invariant Violation: A state mutation was detected between dispatches, in the path `applianceForm.appliance.logForwarder.elasticsearch.useInstanceCredentials`. This may cause incorrect behavior. ("
            },
            {
              "type": "text",
              "text": "http://redux.js.org/docs/Troubleshooting.html#never-mutate-reducer-arguments)"
            },
            {
              "type": "text",
              "text": "\n    invariant browser.js:38"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Similar issue in the "
                },
                {
                  "type": "text",
                  "text": "Active Users",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " page when blacklisting user (from the header button) "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Uncaught Invariant Violation: A state mutation was detected inside a dispatch, in the path: `activeUsers.selection.distinguishedName`. Take a look at the reducer(s) handling the action undefined. "
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "hadrien.luttiau",
        "created": 1630599103859
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "mikael.harsjo",
                    "text": "@mikael.harsjo",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " Hadrien will look in to this one (it's a 400 after all). The plan is to try to fix the issue first, rather than to make the tests first this time. I could create a separate ticket for creating tests for this functionality if that makes sense?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "filip.dalvag",
        "created": 1631172586679
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Nice, and i think we know that parts needs testing."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "mikael.harsjo",
        "created": 1631180931063
      }
    ]
  },
  {
    "key": "SA-17222",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "(on all pages) it says:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "GET"
            },
            {
              "type": "text",
              "text": "http://localhost:8080/ui/assets/images/manifest/icon-180x180.png"
            },
            {
              "type": "text",
              "text": "\n[HTTP/1.1 404 Not Found 0ms]"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "There seems to be a "
            },
            {
              "type": "text",
              "text": "manifest.json",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " as well that reference non existing icons too. There are two options:"
            }
          ]
        },
        {
          "type": "orderedList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Remove icon references (makes this a bug ticket)"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Add icons (makes this a feature-ticket)"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "natan.abolafya",
                    "text": "@natan.abolafya",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " FYI"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "filip.dalvag",
        "created": 1630410645839
      }
    ]
  },
  {
    "key": "SA-17255",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The report string is build with "
            },
            {
              "type": "text",
              "text": "\\n",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " but then it's not printed like that An example: "
            },
            {
              "type": "text",
              "text": "https://got-teamcity.agi.appgate.com/viewLog.html?buildTypeId=StratusGateway",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://got-teamcity.agi.appgate.com/viewLog.html?buildTypeId=StratusGateway"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": "Build&buildId=597995&tab=buildLog&logTab=tree&filter=debug&expand=all&",
              "marks": [
                {
                  "type": "em"
                }
              ]
            },
            {
              "type": "text",
              "text": "focus=77399 "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "cz-vpnd\t('Licenses\\n========\\n\\nThis document contains license information about software installed on this\\nimage that is not included in the Ubuntu repositories.\\n#### debian/copyright\\nLicense information for the package and embedded software\\n\\nFiles | License name\\n--- | ---\\n* | Proprietary \\nLicense information for the package and embedded software\\n\\nFiles | License name\\n--- | ---\\n/usr/sbin/cz-vpnd | Proprietary \\nLicense information for the package and embedded software\\n\\nFiles | License name\\n--- | ---\\n/usr/sbin/cz-vpnd | \u039c\u0399\u03a4 \\n\\n\\n### Detailed information\\n\\n#### debian/copyright\\nMissing copyright information\\n\\n', [['Upstream-Name', 'License', 'X-License-Url', 'X-Source-Included', 'X-Binaries-List', 'X-Original-License-Available', 'Package-Name'], ['cz-vpnd', 'Proprietary', '', '', '', '', 'debian/copyright'], ['wolfssl', 'Proprietary', '"
            },
            {
              "type": "text",
              "text": "https://github.com/wolfSSL/wolfssl/blob/master/LICENSING'"
            },
            {
              "type": "text",
              "text": ","
            },
            {
              "type": "text",
              "text": " 'false', '', 'false', 'debian/copyright'], ['cJSON', '\u039c\u0399\u03a4', '"
            },
            {
              "type": "text",
              "text": "https://github.com/DaveGamble/cJSON/blob/master/LICENSE'"
            },
            {
              "type": "text",
              "text": ","
            },
            {
              "type": "text",
              "text": " 'false', '', 'false', 'debian/copyright']])"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "If it is intended for the print just close the task "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "salvatore.tomaselli",
                    "text": "@salvatore.tomaselli",
                    "accessLevel": ""
                  }
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1630933527836
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Intended. It's python code I can copy paste to debug what the parsed data is."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1630939406302
      }
    ]
  },
  {
    "key": "SA-17335",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Sep 16 17:01:04.859103 sdpgw-014.appgate.com cz-named[2836]: [ERROR] [ELBv1Client] Got error response of type Sender and code LoadBalancerNotFound: Cannot find Load Balancer gabriel-ferrari\nSep 16 17:01:05.853055 sdpgw-014.appgate.com cz-named[2836]: [ERROR] [ELBv1Client] Action DescribeTags using POST "
            },
            {
              "type": "text",
              "text": "https://elasticloadbalancing.us-east-1.amazonaws.com"
            },
            {
              "type": "text",
              "text": " returned with HTTP 400 Bad Request"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "False alarm, this is already handled by the AWS resolver."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1632230924842
      }
    ]
  },
  {
    "key": "SA-17352",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Which can result in this funny error when trying to activate an appliance:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "root@appgate:~# openssl verify -CAfile ca-cert.pem -crl_check -CRLfile my.crl  < cert.pem\nCN = envy-10-97-128-3.devops\nerror 47 at 0 depth lookup: permitted subtree violation\nerror stdin: verification failed"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "It probably also affects the websocket connection etc\u2026"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Example constraints:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "            X509v3 Name Constraints: \n                Permitted:\n                  DNS:.devops\n                  IP:10.97.128.0/255.255.255.0"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Appliance IPs: ![](image1.png)"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The CA openssl config I used:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ cat ca_config.txt \n[ req ]\ndefault_bits       = 2048\ndefault_md         = sha512\nprompt             = no\nencrypt_key        = yes\n\n# base request\ndistinguished_name = req_distinguished_name\n\n# extensions\nreq_extensions     = v3_req\nx509_extensions     = v3_req\n\n[ req_distinguished_name ]\ncountryName            = \"SE\"\nstateOrProvinceName    = \"Goteborg\"\nlocalityName           = \"Goteborg\"\npostalCode             = \"\"\nstreetAddress          = \"Majorna\"\norganizationName       = \"appgate\"\norganizationalUnitName = \"devops\"\ncommonName             = \"devops.appgate.com\" \nemailAddress           = \"no-reply@appgate.com\"\n\n[ v3_req ]\nsubjectAltName  = DNS:appgate.com # multidomain certificate\nbasicConstraints = CA:TRUE,pathlen:0\nkeyUsage = digitalSignature,keyCertSign,cRLSign\nextendedKeyUsage = clientAuth,serverAuth,OCSPSigning\nnameConstraints=permitted;DNS:.devops,permitted;IP:10.97.128.0/255.255.255.0\ncrlDistributionPoints=URI:"
                },
                {
                  "type": "text",
                  "text": "http://testyd.devops/my.crl"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1632319856156
      }
    ]
  },
  {
    "key": "SA-17424",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Running 5.5 upgrade"
            },
            {
              "type": "text",
              "text": "script with 5.4.3 appliance:",
              "marks": [
                {
                  "type": "em"
                }
              ]
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "python3 appgate-upgrade.pyz prepare "
            },
            {
              "type": "text",
              "text": "https://envy-10-97-222-2.devops"
            },
            {
              "type": "text",
              "text": " ./appgate-5.5.0-26077-beta.img.zip --cacert Appgate_SDP_envy-10-97-222-2.devops_CA.pem\n11:14:27 Discovering API version for "
            },
            {
              "type": "text",
              "text": "https://envy-10-97-222-2.devops:8443"
            },
            {
              "type": "text",
              "text": "..."
            },
            {
              "type": "text",
              "text": "\n11:14:27 API version is 15\nEnter password for username admin and provider name local:\n11:14:31 Authenticating to "
            },
            {
              "type": "text",
              "text": "https://envy-10-97-222-2.devops:8443"
            },
            {
              "type": "text",
              "text": "..."
            },
            {
              "type": "text",
              "text": "\n11:14:32 Invalid username or password!\nEnter password for username admin and provider name local:\n11:14:33 Authenticating to "
            },
            {
              "type": "text",
              "text": "https://envy-10-97-222-2.devops:8443"
            },
            {
              "type": "text",
              "text": "..."
            },
            {
              "type": "text",
              "text": "\n11:14:33 Authentication succeeded\n11:14:33 Authorizing...\n11:14:54 Upgrade failed: Appliance controller-c9b5058e-a2a3-4043-a666-62fde01e71cf-site1 never reached expected status: expected state single_controller_ready, got controller_ready"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "env id:"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "c9b5058e-a2a3-4043-a666-62fde01e71cf"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I can repeat this: 5.5 upgrade script, 5.4 to 5.5 fails. 5.3 to 5.5 works."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1633696095423
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "this is basically when not passing the --dev flag right? The upgrade fails but the message is confusing."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "aitor.iturri",
        "created": 1634030582967
      }
    ]
  },
  {
    "key": "SA-17573",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Restarting named fixes it. It sounds like it related to token renewal/re-authentication."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "root@purple81:~# cz-names resolve esx://tag:*\nResolving 1 name: esx://tag:*\nesx://tag:*: {challenge : Basic realm=\"VAPI endpoint\",SIGN realm=3f0ca3f198ceb1c5bc268bf4ed5a3398ef029d3a,service=\"VAPI endpoint\",sts=\""
            },
            {
              "type": "text",
              "text": "https://lhr-nuvc01.agi.appgate.com/sts/STSService/lhrdevops.local\""
            },
            {
              "type": "text",
              "text": ","
            },
            {
              "type": "text",
              "text": " messages : [LocalizableMessage(id='com.vmware.vapi.endpoint.method.authentication.required', default_message='Authentication required.', args=[], params=None, localized=None)], data : None, error_type : UNAUTHENTICATED}\nroot@purple81:~# systemctl restart cz-named\nroot@purple81:~# cz-names resolve esx://tag:*\nResolving 1 name: esx://tag:*\nesx://tag:*: 10.97.154.1, 10.97.168.129, 10.97.185.129, 10.97.186.1, 10.97.200.129, 10.97.202.1, 10.97.218.1, 10.97.228.1, 10.97.231.1, 10.97.235.129, 10.97.243.129, 10.97.253.129, 10.97.3.254, fd00:ffff:a:3::254, fd00:ffff:d:154::1, fd00:ffff:d:186::1, fd00:ffff:d:202::1, fd00:ffff:d:2168::1, fd00:ffff:d:2185::1, fd00:ffff:d:218::1, fd00:ffff:d:2200::1, fd00:ffff:d:2235::1, fd00:ffff:d:2243::1, fd00:ffff:d:2253::1, fd00:ffff:d:228::1, fd00:ffff:d:231::1"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-17650",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Disallow http redirects"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Disallow http (only https)"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Add a local config"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Add a deprecation check"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Controller: "
                },
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/stratus-controller/pull/2671",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-controller/pull/2671"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " Gateway: "
                },
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/stratus-gateway/pull/3106",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-gateway/pull/3106"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Passing to appliance for"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "local config"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "deprecation check "
                        }
                      ]
                    },
                    {
                      "type": "codeBlock",
                      "attrs": {},
                      "content": [
                        {
                          "type": "text",
                          "text": "SELECT name FROM policy WHERE expression ILIKE '%"
                        },
                        {
                          "type": "text",
                          "text": "http://%'"
                        },
                        {
                          "type": "text",
                          "text": ";"
                        },
                        {
                          "type": "text",
                          "text": "\nSELECT name FROM filter WHERE expression ILIKE '%"
                        },
                        {
                          "type": "text",
                          "text": "http://%'"
                        },
                        {
                          "type": "text",
                          "text": ";"
                        },
                        {
                          "type": "text",
                          "text": "\nSELECT name FROM condition WHERE expression ILIKE '%"
                        },
                        {
                          "type": "text",
                          "text": "http://%'"
                        },
                        {
                          "type": "text",
                          "text": ";"
                        },
                        {
                          "type": "text",
                          "text": "\nSELECT name FROM entitlement_script WHERE expression ILIKE '%"
                        },
                        {
                          "type": "text",
                          "text": "http://%'"
                        },
                        {
                          "type": "text",
                          "text": ";"
                        },
                        {
                          "type": "text",
                          "text": "\nSELECT name FROM user_script WHERE expression ILIKE '%"
                        },
                        {
                          "type": "text",
                          "text": "http://%'"
                        },
                        {
                          "type": "text",
                          "text": ";"
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": " Notes:"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "user"
                        },
                        {
                          "type": "text",
                          "text": "script appeared on 5.4. 5.3 will not have the table.",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "user"
                        },
                        {
                          "type": "text",
                          "text": "script is called \"User Claim Script\".",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "filter is called \"Criteria Script\""
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1635520395549
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The local settings are "
                },
                {
                  "type": "text",
                  "text": "policyEvaluator/allowUnsafeHttp",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "text",
                  "text": "policyEvaluator/allowUnsafeHttpRedirection",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Example setting both settings to true: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ sudo cz-config set -j policyEvaluator/allowUnsafeHttp true\n$ sudo cz-config set -j policyEvaluator/allowUnsafeHttpRedirection true"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "To reset to default settings (both false): "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ sudo cz-config del policyEvaluator"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1635753379974
      }
    ]
  },
  {
    "key": "SA-17671",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Shall use nginx's API instead i.e "
            },
            {
              "type": "text",
              "text": "ngx_vsnprintf",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " instead of "
            },
            {
              "type": "text",
              "text": "vsnprintf",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " as only nginx understands specifier "
            },
            {
              "type": "text",
              "text": "%V",
              "marks": [
                {
                  "type": "code"
                }
              ]
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "portal_access: aguid_label %V has corresponding session. User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:93.0) Gecko/20100101 Firefox/93.0, client: 212.16.176.132, server: *.agi.appgate.com, request: \"GET /hub/api/rest/settings/public?fields=id HTTP/2.0\", host: \"got-youtrack.agi.appgate.com\", referrer: \""
            },
            {
              "type": "text",
              "text": "https://got-youtrack.agi.appgate.com/issue/SA-17431\""
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-17813",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Implement a command for listing all appliances in an Appgate SDP collective. List should be presented as a tabbed list of appliances or as json output depending on the an option provided by the command itself."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Should also have filter functionality for getting more specific lists of appliances, such as only controllers or gateways."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Examples:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "# List command with no arguments or flags should list all appliances in the collective\n$>appgatectl appliance list\nID                                      NAME                                                    ROLES                   HOST                                   IP\n6ac3fe2c-29b1-4bb9-81f2-938fe92ef922    controller-9fcdee05-5275-45a3-b5c1-21be024bba37-site1   controller,logserver    "
            },
            {
              "type": "text",
              "text": "https://envy-10-97-132-2.devops:444"
            },
            {
              "type": "text",
              "text": "    10.97.132.2\na2f3df30-c003-4da6-b8b0-7f52f4a93858    gateway-9fcdee05-5275-45a3-b5c1-21be024bba37-site1      gateway                                                        10.97.132.3"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "# Example of filter implementation\n$>appgatectl appliance list --filter=roles=controller\nID                                      NAME                                                    ROLES                   HOST                                   IP\n6ac3fe2c-29b1-4bb9-81f2-938fe92ef922    controller-9fcdee05-5275-45a3-b5c1-21be024bba37-site1   controller,logserver    "
            },
            {
              "type": "text",
              "text": "https://envy-10-97-132-2.devops:444"
            },
            {
              "type": "text",
              "text": "    10.97.132.2"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-17835",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Either 1 test per command or all in one depending on what makes sense."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Test cases for appliance centric features go here "
                },
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/stratus-tests/tree/master/cases/appliance",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-tests/tree/master/cases/appliance"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " The test runner "
                },
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/testy",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/testy"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " Bootstrapping the test environment "
                },
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/stratus-tests/blob/master/bootstrap.py",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-tests/blob/master/bootstrap.py"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Not sure how well all this works on mac m1 though :)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1637051757184
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "e2e test cases in testrail "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/suites/view/199&group",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://got-testrail.agi.appgate.com/index.php?/suites/view/199&group"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "by=cases:section",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "id&group"
                },
                {
                  "type": "text",
                  "text": "order=asc",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1637051808979
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So the test did run in the latest nightly run, see "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/946173",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://got-testrail.agi.appgate.com/index.php?/plans/view/946173"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "You can get it like this btw: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ aitorbot test get -t nightly_linux\naitorbot ['nightly_linux'] | 2021-12-01 22:00:03\n\tid:   1f527efb-9efc-4fec-a38a-b247ff7b76e1\n\turl:  "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/946173"
                },
                {
                  "type": "text",
                  "text": "\n\tpassed: 95/100"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "However 2 of them failed: ![](image1.png)"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "With the following errors: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Test case failed with:\nAssertion (\"tcpdump: can't parse filter expression: syntax error\" in 'tcpdump: syntax error in filter expression: syntax error\\nCommand exited with code 1\\n') failed: Expected failed tcpdump command\nFile \"/tmp/cz-stratus-tests/cases/appliance/remote_commands/tcpdump.py\", line 43, in run\ntest_tcpdump(appliance[\"id\"], admin, node)\nFile \"/tmp/cz-stratus-tests/cases/appliance/remote_commands/tcpdump.py\", line 24, in test_tcpdump\nasserts.contains(expected_failure, actual, \"Expected failed tcpdump command\")\nFile \"/tmp/virtualenv_0f788de5-4aad-4ae3-aa13-1624b1d9073a/lib/python3.8/site-packages/testy/assertions.py\", line 94, in contains\nraise_error(\"{} in {}\", a, b, message, args) File \"/tmp/virtualenv_0f788de5-4aad-4ae3-aa13-1624b1d9073a/lib/python3.8/site-packages/testy/assertions.py\", line 8, in raise_error raise AssertionError(f\"Assertion ({assertion}) failed: {message.format(args)}\")"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Test case failed with:\nAssertion ('ping: SO_BINDTODEVICE foo: No such device' in 'ping: SO_BINDTODEVICE: Invalid argument\\nCommand exited with code 2\\n') failed: Expected failed ping command\nFile \"/tmp/cz-stratus-tests/cases/appliance/remote_commands/ping.py\", line 42, in run\ntest_ping(appliance[\"id\"], admin, node)\nFile \"/tmp/cz-stratus-tests/cases/appliance/remote_commands/ping.py\", line 28, in test_ping\nasserts.contains(expected_failure, actual, \"Expected failed ping command\")\nFile \"/tmp/virtualenv_0f788de5-4aad-4ae3-aa13-1624b1d9073a/lib/python3.8/site-packages/testy/assertions.py\", line 94, in contains\nraise_error(\"{} in {}\", a, b, message, args) File \"/tmp/virtualenv_0f788de5-4aad-4ae3-aa13-1624b1d9073a/lib/python3.8/site-packages/testy/assertions.py\", line 8, in raise_error raise AssertionError(f\"Assertion ({assertion}) failed: {message.format(args)}\")"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The same 2 tests fail with ipv6, see "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/946206",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://got-testrail.agi.appgate.com/index.php?/plans/view/946206"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ aitorbot test get -t nightly_linux_ipv6\naitorbot ['nightly_linux_ipv6'] | 2021-12-02 00:30:06\n\tid:   b89ec6a6-7ff6-49f8-bbaa-545f9ac98185\n\turl:  "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/946206"
                },
                {
                  "type": "text",
                  "text": "\n\tpassed: 132/134"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Test case failed with:\nAssertion ('PING fd00:ffff:d:128::2 (fd00:ffff:d:128::2) from fd00:ffff:d:128::2 eth0: 56(84) bytes of data.\\n64 bytes from fd00:ffff:d:128::2' in 'PING fd00:ffff:d:128::2(fd00:ffff:d:128::2) from fd00:ffff:d:128::2 eth0: 56 data bytes\\n64 bytes from fd00:ffff:d:128::2: icmp_seq=1 ttl=64 time=0.033 ms\\n64 bytes from fd00:ffff:d:128::2: icmp_seq=2 ttl=64 time=0.055 ms\\n64 bytes from fd00:ffff:d:128::2: icmp_seq=3 ttl=64 time=0.085 ms\\n\\n--- fd00:ffff:d:128::2 ping statistics ---\\n3 packets transmitted, 3 received, 0% packet loss, time 2043ms\\nrtt min/avg/max/mdev = 0.033/0.057/0.085/0.023 ms\\nCommand exited with code 0\\n') failed: Expected successful ping command\nFile \"/tmp/cz-stratus-tests/cases/appliance/remote_commands/ping.py\", line 42, in run\ntest_ping(appliance[\"id\"], admin, node)\nFile \"/tmp/cz-stratus-tests/cases/appliance/remote_commands/ping.py\", line 18, in test_ping\nasserts.contains(expected, actual, \"Expected successful ping command\")\nFile \"/tmp/virtualenv_dabacd6b-c1de-4fd3-bf42-232361babfe7/lib/python3.8/site-packages/testy/assertions.py\", line 94, in contains\nraise_error(\"{} in {}\", a, b, message, args) File \"/tmp/virtualenv_dabacd6b-c1de-4fd3-bf42-232361babfe7/lib/python3.8/site-packages/testy/assertions.py\", line 8, in raise_error raise AssertionError(f\"Assertion ({assertion}) failed: {message.format(args)}\")"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1638435561004
      }
    ]
  },
  {
    "key": "SA-17880",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Using SA-17621"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Will update as I go. Currently 6.0 allows all but that probably is a focal problem. Testing on 5.5.0 env."
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "console.log(httpGet('"
                },
                {
                  "type": "text",
                  "text": "http://nghttp2.org/httpbin/redirect-to?url=http%3A%2F%2F127.0.0.1%3A9200'))"
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": "\nreturn true;"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Elasticsearch & kibana (9300, 9301, 9310): reachable."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "configd (9230): reachable."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "ffwd"
                        },
                        {
                          "type": "text",
                          "text": "logs",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "client"
                        },
                        {
                          "type": "text",
                          "text": "input (9010):",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "ffwd"
                        },
                        {
                          "type": "text",
                          "text": "server (9011):",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "logd"
                        },
                        {
                          "type": "text",
                          "text": "input (9320):",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "controllerd (9130, 9131): Not reachable"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "sessiond (9200): reachable"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "nginx"
                        },
                        {
                          "type": "text",
                          "text": "url",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "access"
                        },
                        {
                          "type": "text",
                          "text": "http (9201):",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "nginx"
                        },
                        {
                          "type": "text",
                          "text": "url",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "access"
                        },
                        {
                          "type": "text",
                          "text": "ctrl",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "channel (9202):"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "nginx"
                        },
                        {
                          "type": "text",
                          "text": "url",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "access"
                        },
                        {
                          "type": "text",
                          "text": "https (9203):",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "dnsfwd (9204): Portal doesn't have policy evaluator"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "controller"
                        },
                        {
                          "type": "text",
                          "text": "proxy (9230): reachable",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "rsyslog"
                        },
                        {
                          "type": "text",
                          "text": "relp",
                          "marks": [
                            {
                              "type": "em"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "input (20514):"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1637599415359
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "On 5.5.1: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "cz@envy-10-97-186-2:~$ sudo nc -vz -w1 127.0.0.1 9130\nConnection to 127.0.0.1 9130 port [tcp/*] succeeded!\ncz@envy-10-97-186-2:~$ nc -vz -w1 127.0.0.1 9130\nnc: connect to 127.0.0.1 port 9130 (tcp) timed out: Operation now in progress"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1637680421430
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "In the end we only use this capability for controller, controller proxy & named-dns. So we could extend it to much more."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1637680507336
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "On an actual 5.5.1 controller (not a logserver): "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-10-97-186-2:~# ss -lnp -t\nState Recv-Q Send-Q       Local Address:Port   Peer Address:Port                                                                                                                                           \nLISTEN0      128              127.0.0.1:9230        0.0.0.0:*     users:((\"cz-configd\",pid=78924,fd=23))                                                                                                   \nLISTEN0      1024             127.0.0.1:9010        0.0.0.0:*     users:((\"cz-ffwd\",pid=68823,fd=10))                                                                                                      \nLISTEN0      128                0.0.0.0:22          0.0.0.0:*     users:((\"sshd\",pid=2530,fd=3))                                                                                                           \nLISTEN0      1024               0.0.0.0:443         0.0.0.0:*     users:((\"cz-proxyd\",pid=3039,fd=3))                                                                                                      \nLISTEN0      511                0.0.0.0:8443        0.0.0.0:*     users:((\"nginx\",pid=68816,fd=3),(\"nginx\",pid=68815,fd=3),(\"nginx\",pid=68814,fd=3),(\"nginx\",pid=68813,fd=3),(\"nginx\",pid=3107,fd=3))      \nLISTEN0      511                0.0.0.0:444         0.0.0.0:*     users:((\"nginx\",pid=68126,fd=9),(\"nginx\",pid=68125,fd=9),(\"nginx\",pid=68124,fd=9),(\"nginx\",pid=68122,fd=9),(\"nginx\",pid=3090,fd=9))      \nLISTEN0      55                 0.0.0.0:20514       0.0.0.0:*     users:((\"rsyslogd\",pid=2492,fd=6))                                                                                                       \nLISTEN0      256     [::ffff:127.0.0.1]:9130              *:*     users:((\"java\",pid=2659,fd=209))                                                                                                         \nLISTEN0      1024    [::ffff:127.0.0.1]:9131              *:*     users:((\"java\",pid=2659,fd=211))                                                                                                         \nLISTEN0      128                   [::]:22             [::]:*     users:((\"sshd\",pid=2530,fd=4))                                                                                                           \nLISTEN0      511                   [::]:8443           [::]:*     users:((\"nginx\",pid=68816,fd=6),(\"nginx\",pid=68815,fd=6),(\"nginx\",pid=68814,fd=6),(\"nginx\",pid=68813,fd=6),(\"nginx\",pid=3107,fd=6))      \nLISTEN0      1024                  [::]:443            [::]:*     users:((\"cz-proxyd\",pid=3039,fd=7))                                                                                                      \nLISTEN0      511                   [::]:444            [::]:*     users:((\"nginx\",pid=68126,fd=10),(\"nginx\",pid=68125,fd=10),(\"nginx\",pid=68124,fd=10),(\"nginx\",pid=68122,fd=10),(\"nginx\",pid=3090,fd=10)) \nLISTEN0      55                    [::]:20514          [::]:*     users:((\"rsyslogd\",pid=2492,fd=7))    "
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1637680560454
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "For example sessiond is open bar: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "cz@envy-10-97-186-3:~$ nc -vz 127.0.0.1 9200\nConnection to 127.0.0.1 9200 port [tcp/*] succeeded!"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1637680650082
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "BTW the behavior is the same on 6.0 as far as I can tell: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "cz@envy-10-97-202-2:~$ nc -vz -w1 127.0.0.1 9130\nnc: connect to 127.0.0.1 port 9130 (tcp) timed out: Operation now in progress\ncz@envy-10-97-202-2:~$ sudo nc -vz -w1 127.0.0.1 9130\nConnection to 127.0.0.1 9130 port [tcp/*] succeeded!"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1637681431284
      }
    ]
  },
  {
    "key": "SA-17975",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "\t\t\tvar isAlwaysOnClient = RegistryManager.ReadRegValueInt(RegistryQueries.RegistryApplicationAlwaysOn) != 0;\n\t\t\tif (isAlwaysOnClient)\n\t\t\t{\n\t\t\t\t"
            },
            {
              "type": "text",
              "text": "http://Log.Info(\"Running"
            },
            {
              "type": "text",
              "text": " in Always-On mode.\");\n\t\t\t\tappConfig.PlatformTools = new AlwaysOnHeadlessPlatformTools();\n\t\t\t\tupdateLogic = new WindowsAlwaysOnVersionUpdateLogic();\n\t\t\t}"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Client (I think both headless and full) needs to be aware of always-on as it has slight effects on the logic."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "a flag in user defaults could work, but perhaps even better would be to check for service running as service "
                },
                {
                  "type": "text",
                  "text": "ps -ef | grep -i \"Appgate Service -s\"",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". There is also "
                },
                {
                  "type": "text",
                  "text": "launchtl list",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " but to list system services sudo is needed."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "manuel.moraga",
        "created": 1638955539254
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "hmm tricky. Just to be clear, in windows case, it's both headless and the full which knows it. But I'm not sure if the full client really needs to know that."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "user defaults should be fine, and matches the windows approach but might be problematic since headless isn't the same user perhaps? "
                },
                {
                  "type": "text",
                  "text": "ps | grep",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " feels a bit hacky to me but less state management, so it's a good idea. But I'm afraid it might cause timing issues."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1638965247254
      }
    ]
  },
  {
    "key": "SA-18046",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Perhaps by adding this extension? "
            },
            {
              "type": "text",
              "text": "https://chrome.google.com/webstore/detail/windows-10-accounts/ppnbnpeolgkicgegkbkbjmhlideopiji?hl=en",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://chrome.google.com/webstore/detail/windows-10-accounts/ppnbnpeolgkicgegkbkbjmhlideopiji?hl=en"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": " "
            },
            {
              "type": "text",
              "text": "https://stackoverflow.com/questions/53341132/how-can-i-add-a-custom-chrome-extension-to-my-electron-app",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://stackoverflow.com/questions/53341132/how-can-i-add-a-custom-chrome-extension-to-my-electron-app"
                  }
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "extension_1_0_5_0.crx",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "extension_1_0_5_0.crx"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I unzipped the extension and loaded into electron. Tried hundred things but no luck. I don't get any error logs or anything, so that's quite annoying. Here is the last code I had on Electron Fiddle:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "// Modules to control application life and create native browser window\nconst {app, BrowserWindow, session } = require('electron')\nconst path = require('path')\n\n\n\nasync function createWindow () {\n  // Create the browser window.\n  const result = await session.defaultSession.loadExtension('C:\\\\Users\\\\natan.abolafya\\\\Downloads\\\\win10-chrome', { allowFileAccess: true });\n  // const result = await mainWindow.webContents.session.loadExtension('C:\\\\Users\\\\natan.abolafya\\\\Downloads\\\\win10-chrome', { allowFileAccess: true });\n  console.log(result);\n  \n  const mainWindow = new BrowserWindow({\n    width: 1600,\n    height: 900,\n    webPreferences: {\n      preload: path.join(__dirname, 'preload.js'),\n      nodeIntegration: true,\n      contextIsolation: false,\n    },\n  })\n\n  mainWindow.webContents.session.on('extension-loaded', () => console.log('extension-loaded'));\n  mainWindow.webContents.session.on('extension-unloaded', () => console.log('extension-unloaded'));\n  mainWindow.webContents.session.on('extension-ready', () => console.log('extension-ready'));\n\n  // and load the index.html of the app.\n  console.log('loading')\n  mainWindow.webContents.openDevTools();\n  //mainWindow.loadFile('index.html');\n  setTimeout(() => mainWindow.loadURL('"
                },
                {
                  "type": "text",
                  "text": "https://outlook.office.com/')"
                },
                {
                  "type": "text",
                  "text": ","
                },
                {
                  "type": "text",
                  "text": " 1000);\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.whenReady().then(async () => {\n//  const result = await session.defaultSession.loadExtension('C:\\\\Users\\\\natan.abolafya\\\\Downloads\\\\win10-chrome', { allowFileAccess: true });\n//  console.log(result);\n  createWindow();\n  \n  app.on('activate', function () {\n    // On macOS it's common to re-create a window in the app when the\n    // dock icon is clicked and there are no other windows open.\n    if (BrowserWindow.getAllWindows().length === 0) createWindow()\n  })\n})\n\n// Quit when all windows are closed, except on macOS. There, it's common\n// for applications and their menu bar to stay active until the user quits\n// explicitly with Cmd + Q.\napp.on('window-all-closed', function () {\n  if (process.platform !== 'darwin') app.quit()\n})\n\n// In this file you can include the rest of your app's specific main process\n// code. You can also put them in separate files and require them here."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1641834712501
      }
    ]
  },
  {
    "key": "SA-18067",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "So it just defaults to bionic "
            },
            {
              "type": "text",
              "text": "https://github.com/appgate-sdp-int/appgate-docker/blob/master/assets/appgate-build.sh#L167",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://github.com/appgate-sdp-int/appgate-docker/blob/master/assets/appgate-build.sh#L167"
                  }
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "We could read it from /etc/os-release directly"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1639751994863
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Example output on focal: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@e6c23b0676d2:/build/project# cat /etc/os-release \nNAME=\"Ubuntu\"\nVERSION=\"20.04.3 LTS (Focal Fossa)\"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=\"Ubuntu 20.04.3 LTS\"\nVERSION_ID=\"20.04\"\nHOME_URL=\""
                },
                {
                  "type": "text",
                  "text": "https://www.ubuntu.com/\""
                },
                {
                  "type": "text",
                  "text": "\nSUPPORT_URL=\""
                },
                {
                  "type": "text",
                  "text": "https://help.ubuntu.com/\""
                },
                {
                  "type": "text",
                  "text": "\nBUG_REPORT_URL=\""
                },
                {
                  "type": "text",
                  "text": "https://bugs.launchpad.net/ubuntu/\""
                },
                {
                  "type": "text",
                  "text": "\nPRIVACY_POLICY_URL=\""
                },
                {
                  "type": "text",
                  "text": "https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\""
                },
                {
                  "type": "text",
                  "text": "\nVERSION_CODENAME=focal\nUBUNTU_CODENAME=focal"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1639752033309
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Example output on bionic: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ docker run --rm -it lhr-nexus01.agi.appgate.com:5001/appgate-builder /bin/bash\nroot@a54f0ad6a78e:/build/project# cat /etc/os-release\nNAME=\"Ubuntu\"\nVERSION=\"18.04.6 LTS (Bionic Beaver)\"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=\"Ubuntu 18.04.6 LTS\"\nVERSION_ID=\"18.04\"\nHOME_URL=\""
                },
                {
                  "type": "text",
                  "text": "https://www.ubuntu.com/\""
                },
                {
                  "type": "text",
                  "text": "\nSUPPORT_URL=\""
                },
                {
                  "type": "text",
                  "text": "https://help.ubuntu.com/\""
                },
                {
                  "type": "text",
                  "text": "\nBUG_REPORT_URL=\""
                },
                {
                  "type": "text",
                  "text": "https://bugs.launchpad.net/ubuntu/\""
                },
                {
                  "type": "text",
                  "text": "\nPRIVACY_POLICY_URL=\""
                },
                {
                  "type": "text",
                  "text": "https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\""
                },
                {
                  "type": "text",
                  "text": "\nVERSION_CODENAME=bionic\nUBUNTU_CODENAME=bionic"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1639752095227
      }
    ]
  },
  {
    "key": "SA-18091",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Traceback (most recent call last):\n  File \"/usr/share/helvetest/clients/teamcity.py\", line 275, in _cancel_build\n    await self.request(method='POST', path=method,\n  File \"/usr/share/helvetest/clients/base_client.py\", line 150, in request\n    return await self._request(method, path, data, json_, headers, params, raise_for_status=raise_for_status)\n  File \"/usr/share/helvetest/clients/base_client.py\", line 129, in _request\n    await self.raise_for_status(resp)\n  File \"/usr/share/helvetest/clients/base_client.py\", line 106, in raise_for_status\n    raise ClientResponseError(\nclients.base_client.ClientResponseError: HTTP 404: b\"Responding with error, status code: 404 (Not Found).\\nDetails: jetbrains.buildServer.server.rest.errors.NotFoundException: No queued build with id '625954' can be found (build already started or finished?).\\nCould not find the entity requested. Check the reference is correct and the user has permissions to access the entity.\"\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/share/helvetest/clients/teamcity.py\", line 299, in cancel_build\n    await self.cancel_queued_build(build_id=build_id, reason=reason)\n  File \"/usr/share/helvetest/clients/teamcity.py\", line 291, in cancel_queued_build\n    await self._cancel_build(build_id, reason, 'buildQueue')\n  File \"/usr/share/helvetest/clients/teamcity.py\", line 286, in _cancel_build\n    raise BuildNotFoundError(f'Build {build_id} not found')\nclients.teamcity.BuildNotFoundError: Build 625954 not found\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/share/helvetest/clients/teamcity.py\", line 275, in _cancel_build\n    await self.request(method='POST', path=method,\n  File \"/usr/share/helvetest/clients/base_client.py\", line 150, in request\n    return await self._request(method, path, data, json_, headers, params, raise_for_status=raise_for_status)\n  File \"/usr/share/helvetest/clients/base_client.py\", line 129, in _request\n    await self.raise_for_status(resp)\n  File \"/usr/share/helvetest/clients/base_client.py\", line 106, in raise_for_status\n    raise ClientResponseError(\nclients.base_client.ClientResponseError: HTTP 403: b'403 Forbidden: Responding with 403 status code due to failed CSRF check: authenticated POST request is made, but neither tc-csrf-token parameter nor X-TC-CSRF-Token header are provided.. For a temporary workaround, you can set internal property teamcity.csrf.paranoid=false  and provide valid Origin="
            },
            {
              "type": "text",
              "text": "https://got-teamcity.agi.appgate.com"
            },
            {
              "type": "text",
              "text": " header with your request\\n'\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/usr/lib/python3/dist-packages/themachine/action_runner.py\", line 152, in arun\n    action_result = action_task.result()\n  File \"/usr/share/helvetest/helvetest/services/testsd/actions.py\", line 141, in arun\n    await teamcity_client.cancel_build(build_id=self.queued_build.id, reason=self.reason)\n  File \"/usr/share/helvetest/clients/teamcity.py\", line 302, in cancel_build\n    await self.cancel_running_build(build_id=build_id, reason=reason)\n  File \"/usr/share/helvetest/clients/teamcity.py\", line 294, in cancel_running_build\n    await self._cancel_build(build_id, reason, 'builds')\n  File \"/usr/share/helvetest/clients/teamcity.py\", line 288, in _cancel_build\n    raise TeamCityError(f'Failed to cancel build {build_id} with reason {reason}') from e\nclients.teamcity.TeamCityError: Failed to cancel build 625954 with reason Deleted by owner thomascellerier"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://www.jetbrains.com/help/teamcity/csrf-protection.html",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.jetbrains.com/help/teamcity/csrf-protection.html"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1640102610959
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "masaya.ando",
                    "text": "@masaya.ando",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " this could be a good intro task for helvetest when you are done with your current set of tasks."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/helvetest/",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/helvetest/"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1640253771475
      }
    ]
  },
  {
    "key": "SA-18094",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Not sure what exactly but: "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Dec 22 06:42:43.045439 envy-10-97-228-2.devops cz-webclient@9000[4221]: [2021-12-22T06:42:43.045Z] Error : Device claim update failed 'Only the invariant culture is supported in globalization-invariant mode. See "
            },
            {
              "type": "text",
              "text": "https://aka.ms/GlobalizationInvariantMode"
            },
            {
              "type": "text",
              "text": " for more information. (Parameter 'name')\nDec 22 06:42:43.046280 envy-10-97-228-2.devops cz-webclient@9000[4221]: en-us is an invalid culture identifier.'\nDec 22 06:42:43.046601 envy-10-97-228-2.devops cz-webclient@9000[4221]: [2021-12-22T06:42:43.046Z] Error :    at System.Globalization.CultureInfo.GetCultureInfo(String )\nDec 22 06:42:43.046681 envy-10-97-228-2.devops cz-webclient@9000[4221]:    at Shared.Client.DeviceClaims.Os..ctor(String name, String family, String version, String type, String platform, String hostname, String parent, String locale)\nDec 22 06:42:43.046681 envy-10-97-228-2.devops cz-webclient@9000[4221]:    at Shared.Client.DeviceClaims.Implementations.WebSystemInformationProvider.get_OsInformation()\nDec 22 06:42:43.046753 envy-10-97-228-2.devops cz-webclient@9000[4221]:    at Shared.Client.DeviceClaims.DeviceClaimCollector.GetSystemClaims(ISystemInformationProvider systemInformationProvider, ClientType clientType, Boolean isService)\nDec 22 06:42:43.046753 envy-10-97-228-2.devops cz-webclient@9000[4221]:    at Shared.Client.DeviceClaims.DeviceClaimCollector.RenewAndMigrateClaims(ISystemInformationProvider systemInformationProvider, UntrustedClaimsToken oldToken, ClientType clientType, Boolean isService)\nDec 22 06:42:43.046926 envy-10-97-228-2.devops cz-webclient@9000[4221]:    at Shared.Client.DeviceClaims.UntrustedClaimsHandler.UpdateDeviceClaims(UntrustedClaimsToken oldUntrustedClaimsToken, List`1 onDemandClaims, List`1 deviceScriptChecksums, Func`2 downloadFunction)\nDec 22 06:42:43.046978 envy-10-97-228-2.devops cz-webclient@9000[4221]:    at Shared.Client.DeviceClaims.UntrustedClaimsHandler.StartDeviceClaimsUpdate(List`1 onDemandClaims, List`1 deviceScriptChecksums, Func`2 downloadFunction)"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I don't see this in 5.5 so I imagine .net 6 with \\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": " true \\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\\"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is causing this."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1640702916096
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "blockquote",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "On .NET 6 and later versions, a CultureNotFoundException is thrown if the app is running in an environment where globalization-invariant mode is enabled, for example, some Docker containers, and a culture other than the invariant culture is specified."
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "yep. "
                },
                {
                  "type": "text",
                  "text": "https://docs.microsoft.com/en-us/dotnet/api/System.Globalization.CultureInfo.GetCultureInfo?view=netstandard-2.1",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://docs.microsoft.com/en-us/dotnet/api/System.Globalization.CultureInfo.GetCultureInfo?view=netstandard-2.1"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1640703125303
      }
    ]
  },
  {
    "key": "SA-18129",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2022-01-09T05:29:41.581Z] Info : Trying to connect 'sdp.remoteaccess.dxc.com/15.176.112.148' with SPA key name 'UserSPAKey'.\n[2022-01-09T05:29:51.687Z] Info : REST  (sdp.remoteaccess.dxc.com:443) H0 [[18]] : Connection failed. ERR_CONNECT_GENERIC_ERROR - Failed to connect TLS socket: The operation completed successfully. (0)\n[2022-01-09T05:29:51.688Z] Info : Trying to connect 'sdp.remoteaccess.dxc.com/15.176.64.136' with SPA key name 'UserSPAKey'.\n[2022-01-09T05:30:01.763Z] Info : REST  (sdp.remoteaccess.dxc.com:443) H0 [[18]] : Connection failed. ERR_CONNECT_GENERIC_ERROR - Failed to connect TLS socket: The operation completed successfully. (0)\n[2022-01-09T05:30:01.768Z] Error : First connection to controller '"
            },
            {
              "type": "text",
              "text": "https://sdp.remoteaccess.dxc.com/'"
            },
            {
              "type": "text",
              "text": " has failed. Details: Connection failed."
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-18144",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "In Breadcrumbs, the "
            },
            {
              "type": "text",
              "text": "aria-current=\"page\"",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " is incorrectly added."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "On an edit/create page, the aria-current is on the breadcrumb link for the page \"above\" (screen shot from Edit Identity Provider page):"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "![](Screenshot 2022-01-12 at 10.31.40.png)"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "To fix this, there are two options:"
            }
          ]
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Put aria-current on the last item (in this case \"Edit\")"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Remove aria-current altogether"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "According to Mozilla (MDN Web Docs):"
                    }
                  ]
                },
                {
                  "type": "blockquote",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "If the element representing the current page in the breadcrumb was not a link, the\u00a0"
                        },
                        {
                          "type": "text",
                          "text": "aria-current",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "\u00a0is optional."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-current",
                      "marks": [
                        {
                          "type": "link",
                          "attrs": {
                            "href": "https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-current"
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-18292",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "It looks that sometimes after the "
            },
            {
              "type": "text",
              "text": "block_report",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " =\\> remedy =\\> OTP provides =\\> new ACL rules from cz-sessiond, cz-vpnd is not applying the new rules"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "an 31 11:19:27.047105 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [C 7f81672f6700 CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] 860 bytes read from ITC\nJan 31 11:19:29.584985 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] ipc_add_write(): 0x7f8160001960 251\nJan 31 11:19:29.584985 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [C 7f81672f6700 CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] block_report: UP 15.0.0.0 TO 10.97.201.67 TCP 37382 TO 80 SEQ 3043480912 ACK 0 WIN 65377 SYN SIZE 60 (ACL rule name \"stratus1000_tcp-0\")\nJan 31 11:19:29.585681 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [ReportMessageHandler] [CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] remedy report\nJan 31 11:19:29.587225 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [ClientCommandHandler] [CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] ->client remedy action: OtpAuthentication name:Optional[stratus1000_tcp]\nJan 31 11:19:29.587502 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 325 IPC bytes read: F Q049NGM0MjAwYTFiMzg2NDZhMWE1NjI0MTBkMjJiNTAyYmMsQ049c3RyYXR1czEwMDAsT1U9cmFkaXVz {\"method\":\"otp-authentication\",\"params\":{\"providerId\":\"64cda0c3-567a-4292-9a0d-efebc33147e3\",\"displayName\":\"stratus1000_tcp\",\"name\":\"stratus1000_tcp\",\"message\":\"test otp\",\"claimSuffix\":\"test\",\"actionIdentifier\":\"2063920332\"},\"jsonrpc\":\"2.0\"}\nJan 31 11:19:29.587502 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 325 bytes in IPC read buffer: F Q049NGM0MjAwYTFiMzg2NDZhMWE1NjI0MTBkMjJiNTAyYmMsQ049c3RyYXR1czEwMDAsT1U9cmFkaXVz {\"method\":\"otp-authentication\",\"params\":{\"providerId\":\"64cda0c3-567a-4292-9a0d-efebc33147e3\",\"displayName\":\"stratus1000_tcp\",\"name\":\"stratus1000_tcp\",\"message\":\"test otp\",\"claimSuffix\":\"test\",\"actionIdentifier\":\"2063920332\"},\"jsonrpc\":\"2.0\"}\nJan 31 11:19:29.587630 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 1 IPC messages have been extracted from the read buffer\nJan 31 11:19:29.587630 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [14] itc_add_write(): 0x7f8160001c00 354\nJan 31 11:19:29.587630 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] ipc_add_read()\nJan 31 11:19:29.587630 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [14] ITC bytes written: 354\nJan 31 11:19:29.587630 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] itc_erase_bytes_written(): 0x7f8160001c00 354 bytes\nJan 31 11:19:29.587630 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [C 7f81672f6700 CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] 354 bytes read from ITC\nJan 31 11:19:29.587972 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [AuditJsonEventLogger] {\"id\":\"a5ce2203-630b-40bd-b722-db729e64dc28\",\"timestamp\":\"2022-01-31T11:19:29.587457Z\",\"version\":17,\"distinguished_name\":\"CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius\",\"session_id\":\"1111ee46-882c-46c4-860c-93947db054bd\",\"remedy_types\":[\"OtpAuthentication\"],\"hosts\":[\"10.97.201.67\"],\"protocol\":\"tcp_up\",\"entitlement_name\":\"stratus1000_tcp\",\"ports\":[\"80\"],\"remedy_logic\":\"and\",\"event_type\":\"remedy_action_triggered\"}\nJan 31 11:19:29.588475 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [Session] [CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] Prepared client app-update: c23ea37c2f64cc8558619ad301ce321f6ab9d8fd [ available: 0 remedy: 1 blocking: 0 ] remedys( active: 1 inactive: 0 )\nJan 31 11:19:34.706676 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] ipc_add_write(): 0x7f8160001960 6029\nJan 31 11:19:34.711082 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [ClientCommandHandler] client->update-tokens\nJan 31 11:19:34.730776 envy-10-97-140-3.devops cz-sessiond[58463]: 11:19:34.730 [EventDispatcher] INFO com.appgate.controller.common.library.util.ClaimsUtil - GeoIP service could not find any record for Ip: 10.97.2.135. The address 10.97.2.135 is not in the database.\nJan 31 11:19:34.731163 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [AuditJsonEventLogger] {\"id\":\"d7c0c03d-7e0e-46cb-b75d-2a449f13a15d\",\"timestamp\":\"2022-01-31T11:19:34.730997Z\",\"version\":17,\"expiration_time\":\"2022-02-01T11:19:24.644879Z\",\"distinguished_name\":\"CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius\",\"session_id\":\"1111ee46-882c-46c4-860c-93947db054bd\",\"claims_token_id\":\"4cfe7e41-9a83-4e4f-bc6f-70f9c34724b0\",\"event_type\":\"claims_token_accepted\"}\nJan 31 11:19:34.731544 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [TimerCollection] Doing cancel on timer: f5b09006-42c2-48ba-81a2-c70285849b7c\nJan 31 11:19:34.731696 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [TimerCollection] Doing cancel on timer: 5bde117c-c989-4b2b-86cd-659173345647\nJan 31 11:19:34.731789 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [TimerCollection] Got a new timer to act oncom.appgate.gateway.sessiondaemon.timers.TimerCollection$CancelTimerEvent@29a8019b\nJan 31 11:19:34.731962 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [TimerCollection] Got a new timer to act oncom.appgate.gateway.sessiondaemon.timers.TimerCollection$CancelTimerEvent@378eecb6\nJan 31 11:19:34.732127 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [TimerCollection] Got a new timer to act oncom.appgate.gateway.sessiondaemon.timers.TimerCollection$AddTimerEvent@6fc5d9e3\nJan 31 11:19:34.732214 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [TimerCollection] Got a new timer to act oncom.appgate.gateway.sessiondaemon.timers.TimerCollection$AddTimerEvent@7b91a477\nJan 31 11:19:34.732305 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [AuditJsonEventLogger] {\"id\":\"5bdb7638-7814-47df-8185-9ee149f86890\",\"timestamp\":\"2022-01-31T11:19:34.732044Z\",\"version\":17,\"distinguished_name\":\"CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius\",\"session_id\":\"1111ee46-882c-46c4-860c-93947db054bd\",\"device_claims\":{\"isUserAdmin\":false,\"clientVersion\":\"6.0.0-27686-master\",\"os\":{\"name\":\"Ubuntu 20.04.3 LTS\",\"family\":\"linux\",\"version\":\"20.04\",\"type\":\"desktop\",\"platform\":\"x64\",\"hostname\":\"TestAgentUbuntu\",\"lcid\":\"1033\",\"parent\":\"debian\"},\"language\":\"en-us\",\"isFirewallEnabled\":true,\"macAddresses\":[\"005056A8F6B2\"],\"isMultiUser\":false,\"clientIPs\":[\"10.97.2.135\",\"fd00:ffff:a:2:10:97:3:114\"],\"clientType\":\"full\",\"spaKey\":\"test\",\"profileName\":\"test\"},\"event_type\":\"device_claims_accepted\"}\nJan 31 11:19:34.733999 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [Session] setting evaluation results: 2\nJan 31 11:19:34.734227 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 940 IPC bytes read: P Q049NGM0MjAwYTFiMzg2NDZhMWE1NjI0MTBkMjJiNTAyYmMsQ049c3RyYXR1czEwMDAsT1U9cmFkaXVz {\"method\":\"access-control-list\",\"params\":{\"sign-key\":\"3da889b883da7cc76e36f5acf9de5d2d7156005335484f2e4e31551667a6768bfde680f8ab9be14906a4832968163ce1d7a80678f179691711bc8ceefb295cd96406e52e4b0951e00eb3d9ac61180335977412a15d8529d6c165f9a452a5ce29475dcfac3844c2e65278c18d310864634558bf0a74afaff10812ed63368ad131\",\"entitlement-based-routing\":false,\"dn\":\"CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius\",\"token-id\":\"8c045661-00c7-4224-9433-7d8f19e74ace\",\"acl-rules\":[{\"protocol\":0,\"types\":[\"0-255\"],\"action-id\":\"stratus1000_ping#b9b1d17b-9315-34ac-a874-96ceccb0ca27\",\"name\":\"stratus1000_ping-0\",\"rule\":0,\"subnets\":[\"10.97.201.67\\/32\"],\"direction\":0},{\"protocol\":2,\"action-id\":\"stratus1000_tcp#815b2a93-0283-3fa5-82a5-601022a77bee\",\"name\":\"stratus1000_tcp-0\",\"rule\":0,\"subnets\":[\"10.97.201.67\\/32\"],\"ports\":[\"80\"],\"direction\":0}]},\"jsonrpc\":\"2.0\"}\nJan 31 11:19:34.734227 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 940 bytes in IPC read buffer: P Q049NGM0MjAwYTFiMzg2NDZhMWE1NjI0MTBkMjJiNTAyYmMsQ049c3RyYXR1czEwMDAsT1U9cmFkaXVz {\"method\":\"access-control-list\",\"params\":{\"sign-key\":\"3da889b883da7cc76e36f5acf9de5d2d7156005335484f2e4e31551667a6768bfde680f8ab9be14906a4832968163ce1d7a80678f179691711bc8ceefb295cd96406e52e4b0951e00eb3d9ac61180335977412a15d8529d6c165f9a452a5ce29475dcfac3844c2e65278c18d310864634558bf0a74afaff10812ed63368ad131\",\"entitlement-based-routing\":false,\"dn\":\"CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius\",\"token-id\":\"8c045661-00c7-4224-9433-7d8f19e74ace\",\"acl-rules\":[{\"protocol\":0,\"types\":[\"0-255\"],\"action-id\":\"stratus1000_ping#b9b1d17b-9315-34ac-a874-96ceccb0ca27\",\"name\":\"stratus1000_ping-0\",\"rule\":0,\"subnets\":[\"10.97.201.67\\/32\"],\"direction\":0},{\"protocol\":2,\"action-id\":\"stratus1000_tcp#815b2a93-0283-3fa5-82a5-601022a77bee\",\"name\":\"stratus1000_tcp-0\",\"rule\":0,\"subnets\":[\"10.97.201.67\\/32\"],\"ports\":[\"80\"],\"direction\":0}]},\"jsonrpc\":\"2.0\"}\nJan 31 11:19:34.734356 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 1 IPC messages have been extracted from the read buffer\nJan 31 11:19:34.734356 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [14] itc_add_write(): 0x7f8160001c00 1003\nJan 31 11:19:34.734356 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] ipc_add_read()\nJan 31 11:19:34.734486 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [VpndMessageSender] [CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] sent:{\"method\":\"access-control-list\",\"params\":{\"sign-key\":\"3da889b883da7cc76e36f5acf9de5d2d7156005335484f2e4e31551667a6768bfde680f8ab9be14906a4832968163ce1d7a80678f179691711bc8ceefb295cd96406e52e4b0951e00eb3d9ac61180335977412a15d8529d6c165f9a452a5ce29475dcfac3844c2e65278c18d310864634558bf0a74afaff10812ed63368ad131\",\"entitlement-based-routing\":false,\"dn\":\"CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius\",\"token-id\":\"8c045661-00c7-4224-9433-7d8f19e74ace\",\"acl-rules\":[{\"protocol\":0,\"types\":[\"0-255\"],\"action-id\":\"stratus1000_ping#b9b1d17b-9315-34ac-a874-96ceccb0ca27\",\"name\":\"stratus1000_ping-0\",\"rule\":0,\"subnets\":[\"10.97.201.67\\/32\"],\"direction\":0},{\"protocol\":2,\"action-id\":\"stratus1000_tcp#815b2a93-0283-3fa5-82a5-601022a77bee\",\"name\":\"stratus1000_tcp-0\",\"rule\":0,\"subnets\":[\"10.97.201.67\\/32\"],\"ports\":[\"80\"],\"direction\":0}]},\"jsonrpc\":\"2.0\"}\nJan 31 11:19:34.734580 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [VpndMessageSender] [CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] ->vpnd sent new acl, nr of rules: 2 vpnd id:57717\nJan 31 11:19:34.734660 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [AuditJsonEventLogger] {\"id\":\"8be79a06-d7c9-4e5f-a4d3-26b48adf00cf\",\"timestamp\":\"2022-01-31T11:19:34.733559Z\",\"version\":17,\"distinguished_name\":\"CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius\",\"session_id\":\"1111ee46-882c-46c4-860c-93947db054bd\",\"successful_condition_names\":[\"stratus1000_condition\"],\"entitlement_token_id\":\"8c045661-00c7-4224-9433-7d8f19e74ace\",\"successful_entitlement_names\":[\"stratus1000_ping\",\"stratus1000_tcp\"],\"app_shortcuts\":{\"stratus1000_https\":\"Available\"},\"execution_ms\":2,\"cached_values_used\":false,\"event_type\":\"entitlement_token_evaluated\",\"entitlement_token_available\":true}\nJan 31 11:19:34.734707 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 122 IPC bytes read: F Q049NGM0MjAwYTFiMzg2NDZhMWE1NjI0MTBkMjJiNTAyYmMsQ049c3RyYXR1czEwMDAsT1U9cmFkaXVz {\"result\":true,\"id\":3,\"jsonrpc\":\"2.0\"}\nJan 31 11:19:34.734707 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 122 bytes in IPC read buffer: F Q049NGM0MjAwYTFiMzg2NDZhMWE1NjI0MTBkMjJiNTAyYmMsQ049c3RyYXR1czEwMDAsT1U9cmFkaXVz {\"result\":true,\"id\":3,\"jsonrpc\":\"2.0\"}\nJan 31 11:19:34.734707 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 1 IPC messages have been extracted from the read buffer\nJan 31 11:19:34.734707 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [14] itc_add_write(): Skipping 0 1128 1\nJan 31 11:19:34.734707 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] ipc_add_read()\nJan 31 11:19:34.734901 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 771 IPC bytes read: F Q049NGM0MjAwYTFiMzg2NDZhMWE1NjI0MTBkMjJiNTAyYmMsQ049c3RyYXR1czEwMDAsT1U9cmFkaXVz {\"method\":\"app-update\",\"params\":{\"apps\":{\"stratus1000_tcp\":{\"remedies\":[{\"method\":\"OtpAuthentication\",\"params\":{\"providerId\":\"64cda0c3-567a-4292-9a0d-efebc33147e3\",\"message\":\"test otp\",\"claimSuffix\":\"test\",\"actionIdentifier\":\"2063920332\"},\"active\":false}],\"status\":\"Available\",\"appData\":{\"name\":\"stratus1000_https\",\"description\":\"Endpoint HTTPS\",\"url\":\""
                },
                {
                  "type": "text",
                  "text": "https://10.97.201.67\",\"colorCode\":2},\"appDatas\":[{\"name\":\"stratus1000_https\",\"description\":\"Endpoint"
                },
                {
                  "type": "text",
                  "text": " HTTPS\",\"url\":\""
                },
                {
                  "type": "text",
                  "text": "https://10.97.201.67\",\"colorCode\":2},{\"name\":\"stratus1000_http\",\"description\":\"Endpoint"
                },
                {
                  "type": "text",
                  "text": " HTTP\",\"url\":\""
                },
                {
                  "type": "text",
                  "text": "http://10.97.201.67\",\"colorCode\":14}],\"displayName\":\"stratus1000_https\",\"name\":\"stratus1000_https\"}}},\"jsonrpc\":\"2.0\"}"
                },
                {
                  "type": "text",
                  "text": "\nJan 31 11:19:34.734949 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 771 bytes in IPC read buffer: F Q049NGM0MjAwYTFiMzg2NDZhMWE1NjI0MTBkMjJiNTAyYmMsQ049c3RyYXR1czEwMDAsT1U9cmFkaXVz {\"method\":\"app-update\",\"params\":{\"apps\":{\"stratus1000_tcp\":{\"remedies\":[{\"method\":\"OtpAuthentication\",\"params\":{\"providerId\":\"64cda0c3-567a-4292-9a0d-efebc33147e3\",\"message\":\"test otp\",\"claimSuffix\":\"test\",\"actionIdentifier\":\"2063920332\"},\"active\":false}],\"status\":\"Available\",\"appData\":{\"name\":\"stratus1000_https\",\"description\":\"Endpoint HTTPS\",\"url\":\""
                },
                {
                  "type": "text",
                  "text": "https://10.97.201.67\",\"colorCode\":2},\"appDatas\":[{\"name\":\"stratus1000_https\",\"description\":\"Endpoint"
                },
                {
                  "type": "text",
                  "text": " HTTPS\",\"url\":\""
                },
                {
                  "type": "text",
                  "text": "https://10.97.201.67\",\"colorCode\":2},{\"name\":\"stratus1000_http\",\"description\":\"Endpoint"
                },
                {
                  "type": "text",
                  "text": " HTTP\",\"url\":\""
                },
                {
                  "type": "text",
                  "text": "http://10.97.201.67\",\"colorCode\":14}],\"displayName\":\"stratus1000_https\",\"name\":\"stratus1000_https\"}}},\"jsonrpc\":\"2.0\"}"
                },
                {
                  "type": "text",
                  "text": "\nJan 31 11:19:34.734949 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] 1 IPC messages have been extracted from the read buffer\nJan 31 11:19:34.734949 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [14] itc_add_write(): Skipping 0 1992 1\nJan 31 11:19:34.734949 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] ipc_add_read()\nJan 31 11:19:34.735078 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [Session] [CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] Prepared client app-update: f9da405fb9fccace317eeb86767773997807e1e9 [ available: 1 remedy: 0 blocking: 0 ] remedys( active: 0 inactive: 1 )\nJan 31 11:19:34.735163 envy-10-97-140-3.devops cz-sessiond[58463]: INFO [Session] [CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] ->client : app-update (f9da405fb9fccace317eeb86767773997807e1e9)\nJan 31 11:19:36.713743 envy-10-97-140-3.devops systemd[1]: systemd-hostnamed.service: Succeeded.\nJan 31 11:19:47.536983 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] Forwarding unsubscription of \"CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius\" to sessiond from [C 7f81672f6700]\nJan 31 11:19:47.536983 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [8] ipc_add_write(): 0x7f8160001960 139\nJan 31 11:19:47.536983 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] [14] ITC bytes written: 1003\nJan 31 11:19:47.536983 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] itc_erase_bytes_written(): 0x7f8160001c00 1003 bytes\nJan 31 11:19:47.536983 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [R 7f81683c1700] Cleaning up value of connection thread [C 7f81672f6700]\nJan 31 11:19:47.536983 envy-10-97-140-3.devops cz-vpnd@1[57717]: INFO    [C 7f81672f6700 CN=4c4200a1b38646a1a562410d22b502bc,CN=stratus1000,OU=radius] Connection closed by client"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1643629995457
      }
    ]
  },
  {
    "key": "SA-18361",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "discriminator:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0propertyName: type\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mapping:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# The mapped providers need to be on the root document. "
            },
            {
              "type": "text",
              "text": "https://github.com/Rebilly/ReDoc/issues/556"
            },
            {
              "type": "text",
              "text": "\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Saml: '#/components/schemas/SamlProvider'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Radius: '#/components/schemas/RadiusProvider'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Ldap: '#/components/schemas/LdapProvider'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LdapCertificate: '#/components/schemas/LdapCertificateProvider'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LocalDatabase: '#/components/schemas/LocalDatabaseProvider'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Connector: '#/components/schemas/ConnectorProvider"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Right now we miss the fields defined in those mappings"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-18410",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Mapping is defined as"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "        discriminator:\n          propertyName: type\n          mapping:\n            # The mapped providers need to be on the root document. "
            },
            {
              "type": "text",
              "text": "https://github.com/Rebilly/ReDoc/issues/556"
            },
            {
              "type": "text",
              "text": "\n            Saml: '#/components/schemas/SamlProvider'\n            Radius: '#/components/schemas/RadiusProvider'\n            Ldap: '#/components/schemas/LdapProvider'\n            LdapCertificate: '#/components/schemas/LdapCertificateProvider'\n            LocalDatabase: '#/components/schemas/LocalDatabaseProvider'\n            IotConnector: '#/components/schemas/IoTConnectorProvider'"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "but the type is missing from the enum:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "            enum:\n              - LocalDatabase\n              - Ldap\n              - LdapCertificate\n              - Radius\n              - Saml"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-18463",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "heading",
          "content": [
            {
              "type": "text",
              "text": "Description"
            }
          ],
          "attrs": {
            "level": 3
          }
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "We need to add "
                    },
                    {
                      "type": "text",
                      "text": "X-pkgmgr: npm",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": "  to each copyright entry like so "
                    }
                  ]
                },
                {
                  "type": "codeBlock",
                  "attrs": {},
                  "content": [
                    {
                      "type": "text",
                      "text": "Files: /var/www/html/cz-ui/\nUpstream-Name: estraverse\nX-pkgmgr: npm\nSources: "
                    },
                    {
                      "type": "text",
                      "text": "http://github.com/estools/estraverse.git"
                    },
                    {
                      "type": "text",
                      "text": "\nLicense: BSD-2-Clause (original text)"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": " I guess we can update the script to ad this line"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "It looks like we are missing dompurify license too, so we should make sure it's included"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-18495",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "cz-backup does some funky output with BDR3.7: "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "cellsons@cellsons ~/Projects/purple-pants master $ ./thomas_backup.sh                                                                                                                                                                                   \n15:49:01 Discovering API version for "
            },
            {
              "type": "text",
              "text": "https://purple10.agi.appgate.com:8443"
            },
            {
              "type": "text",
              "text": "..."
            },
            {
              "type": "text",
              "text": "\n15:49:01 API version is 17\n15:49:01 Authenticating to "
            },
            {
              "type": "text",
              "text": "https://purple10.agi.appgate.com:8443"
            },
            {
              "type": "text",
              "text": "..."
            },
            {
              "type": "text",
              "text": "\n15:49:02 Authentication succeeded\n15:49:02 Authorizing...\n15:49:03 Starting backup on 1 appliances:\n15:49:03 All files will be stored in backups/appgate_backup_1645541341.8418746/\n15:49:03 Starting backup creation on aws - purple10\n15:49:03 Backup creation started on aws - purple10\n15:49:03 Backup in progress on appliance: aws - purple10\n15:49:06 Backup in progress on appliance: aws - purple10\n15:49:09 Backup in progress on appliance: aws - purple10\n15:49:13 Backup in progress on appliance: aws - purple10\n15:49:16 Backup in progress on appliance: aws - purple10\n15:49:19 Backup in progress on appliance: aws - purple10\n15:49:22 Backup complete on appliance: aws - purple10\n15:49:22 Appliance 801db367-58d0-4876-84ae-f6d1fdab6c0d reported the following issues:\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\npg_dump: NOTICE:  skipped replication for captured DDL command \"LOCK TABLE\" in replication sets (appgatecollective): this statement type is not replicated by BDR\n15:49:22 Downloading backup from aws - purple10 in backups/appgate_backup_1645541341.8418746/aws - purple10.bkp\n15:49:24 Download complete for appliance: aws - purple10\n15:49:24 Removed remote download for appliance: aws - purple10\n15:49:24 Some issues were encountered during the backup process. The downloaded files might not work or contain incomplete data."
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-18509",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Should be mostly a presentation of how it works with some practical examples using dbs."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://docs.google.com/presentation/d/1-fqbzKkvpapfSMjlDtRJv2cmyPCEpQnzG8",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://docs.google.com/presentation/d/1-fqbzKkvpapfSMjlDtRJv2cmyPCEpQnzG8"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "mgoZKZ2I/edit#slide=id.g123dd7154b4",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0"
                },
                {
                  "type": "text",
                  "text": "222",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1649682098900
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "mkdir /mnt/data/democd /mnt/data/demowget ",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "["
                },
                {
                  "type": "text",
                  "text": "https://lhr-artifacts.agi.appgate.com/project/7/StratusImage_Build/release-6.0/artifact/appgate-6.0.0-29005-beta.img.zip?is-build-type-id=true",
                  "marks": [
                    {
                      "type": "code"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://lhr-artifacts.agi.appgate.com/project/7/StratusImage_Build/release-6.0/artifact/appgate-6.0.0-29005-beta.img.zip?is-build-type-id=true"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "]("
                },
                {
                  "type": "text",
                  "text": "https://lhr-artifacts.agi.appgate.com/project/7/StratusImage",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://lhr-artifacts.agi.appgate.com/project/7/StratusImage"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "Build/release-6.0/artifact/appgate-6.0.0-29005-beta.img.zip?is-build-type-id=true)",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " -O appgate.img.zipunzip appgate.img.zipmkdir imagemount -o loop appgate-*.img /mnt/data/demo/imagecp -r /etc/dbd/current /etc/dbd/mydbmkdir -p /mnt/data/postgresql/state2/12/mainchown postgres:postgres /mnt/data/postgresql/state2/12/mainmkdir /run/cz-dbd/dbd-mydbdchown postgres:postgres /run/cz-dbd/dbd-mydbdcat > /etc/dbd/mydb/dbd.conf << EOFDBD_IMAGE=/mnt/data/demo/imageDBD_PKI=mnt/state/pkiDBD_RUN=run/cz-dbd/dbd-mydbDBD_DATA=mnt/data/postgresql/state2/12/mainDBD_POSTGRES_VERSION=12DBD_LOG_LEVEL=INFODBD_ENABLE_IP_ALLOCATION_INDEX_UPDATE=TrueDBD_ENABLE_BDR=trueDBD_PG_SYSLOG_IDENT=mydbEOFsystemctl start cz-dbd",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "mydbcz",
                    "text": "@mydbcz",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": "-dbs -i mydb statuscz-dbs -i current statuscz-dbs -i mydb pg configure --port 8444 --listen-address 127.0.0.1 --hba-entry \"host all all 127.0.0.1/32 trust\"/usr/bin/sudo -i -u postgres pgcli -p 8444 -h 127.0.0.1 controller# Do the join!",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " NODE"
                },
                {
                  "type": "text",
                  "text": "NAME=\"",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "cz-dbs node get -j |jq -r .[0].name",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\" && echo \"Node name is: ${NODE"
                },
                {
                  "type": "text",
                  "text": "NAME}\"",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "NODE"
                },
                {
                  "type": "text",
                  "text": "DSN=\"",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "cz-dbs node get -j |jq -r .[0].dsn",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "\" && echo \"Node DSN is: \"${NODE"
                },
                {
                  "type": "text",
                  "text": "DSN}\"\"",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "cz-dbs -i mydb node join --local foo --node foo \"host=127.0.0.1 port=8444 dbname=controller sslmode=disable\" --node \"${NODE_NAME}\" \"${NODE_DSN}\"cz-dbs node part \"${NODE_NAME}\"# Go to the UI, the data is still herecz-dbs node wipe# Go to the UI, its broken!vi /etc/cz-controllerd/config.yamlsystemctl restart cz-controllerd"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1649682113781
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I will make this into an interactive script for the demo so we don't need to copy paste all commands 1 by 1. "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "#!/usr/bin/env python3\nimport io\nimport os\nimport re\nimport subprocess\n\nimport xtermcolor\n\ncommands = \"\"\"\\\n# Let's download an appliance image and mount it somewhere\nmkdir /mnt/data/demo\nwget "
                },
                {
                  "type": "text",
                  "text": "https://lhr-artifacts.agi.appgate.com/project/7/StratusImage_Build/release-6.0/artifact/appgate-6.0.0-29172-beta.img.zip?is-build-type-id=true"
                },
                {
                  "type": "text",
                  "text": " -O /mnt/data/demo/appgate.img.zip\nunzip -d /mnt/data/demo /mnt/data/demo/appgate.img.zip\nmkdir /mnt/data/demo/image\nmount -o loop /mnt/data/demo/appgate-*.img /mnt/data/demo/image\n\n# OK, now time to setup another instance of dbd!\ncp -r /etc/dbd/current /etc/dbd/mydb\nmkdir -p /mnt/data/postgresql/state2/12/main\nchown postgres:postgres /mnt/data/postgresql/state2/12/main\nmkdir /run/cz-dbd/dbd-mydb\nchown postgres:postgres /run/cz-dbd/dbd-mydb\n\ncat > /etc/dbd/mydb/dbd.conf << EOF\nDBD_IMAGE=/mnt/data/demo/image\nDBD_PKI=mnt/state/pki\nDBD_RUN=run/cz-dbd/dbd-mydb\nDBD_DATA=mnt/data/postgresql/state2/12/main\nDBD_POSTGRES_VERSION=12\nDBD_LOG_LEVEL=INFO\nDBD_ENABLE_IP_ALLOCATION_INDEX_UPDATE=True\nDBD_ENABLE_BDR=true\nDBD_PG_SYSLOG_IDENT=mydb\nEOF\n\nsystemctl start cz-dbd@mydb\ncz-dbs -i mydb status\ncz-dbs -i current status\ncz-dbs -i mydb pg configure --port 8444 --listen-address 127.0.0.1 --hba-entry \"host all all 127.0.0.1/32 trust\"\n/usr/bin/sudo -i -u postgres pgcli -p 8444 -h 127.0.0.1 controller\n\n# Do the join!\nNODE_NAME=\"`cz-dbs node get -j |jq -r .[0].name`\"\nNODE_DSN=\"`cz-dbs node get -j |jq -r .[0].dsn`\"\ncz-dbs -i mydb node join --local foo --node foo \"host=127.0.0.1 port=8444 dbname=controller sslmode=disable\" --node \"${NODE_NAME}\" \"${NODE_DSN}\"\ncz-dbs -i mydb node del \"${NODE_NAME}\"\n\n# Go to the UI, the data is still here\ncz-dbs node wipe\n\n# Go to the UI, its broken!\n# Let's just point the controller to our new database.\nsed -i 's/socketFactoryArg: \\/run\\/cz-dbd\\/dbd-current\\/.s.PGSQL.443/socketFactoryArg: \\/run\\/cz-dbd\\/dbd-mydb\\/.s.PGSQL.8444/' /etc/cz-controllerd/config.yaml\nsystemctl restart cz-controllerd\n\n# And back again!!!\ncz-dbs node join --local \"${NODE_NAME}\" --node foo \"host=127.0.0.1 port=8444 dbname=controller sslmode=disable\" --node \"${NODE_NAME}\" \"${NODE_DSN}\"\ncz-dbs node del foo\ncz-dbs -i mydb node wipe\nsed -i 's/socketFactoryArg: \\/run\\/cz-dbd\\/dbd-mydb\\/.s.PGSQL.8444/socketFactoryArg: \\/run\\/cz-dbd\\/dbd-current\\/.s.PGSQL.443/' /etc/cz-controllerd/config.yaml\nsystemctl restart cz-controllerd\n\n# All back to normal now :)\ncz-dbs status\n\"\"\"\n\n\nlines = enumerate(iter(io.StringIO(commands)))\nenv = os.environ.copy()\nwhile True:\n    try:\n        lineno, line = next(lines)\n    except StopIteration:\n        break\n\n    line = line.rstrip()\n    if not line:\n        continue\n\n    if line.startswith(\"#\"):\n        print(xtermcolor.colorize(line, ansi=2))\n        continue\n\n    cmd_input = None\n    name = None\n\n    # Handle multi-line input\n    if m := re.match(r\"^.* << (\\w+)$\", line):\n        marker = m.group(1)\n        cmd = line[:-len(f\" << {marker}\")]\n        cmd_input = b\"\"\n        while True:\n            _, line = next(lines)\n            if line.startswith(marker):\n                break\n            cmd_input += line.encode(\"utf-8\")\n    # Handle variable assignment\n    elif m := re.match(r'^(\\w+)=\"`(.*)`\"$', line):\n        name = m.group(1)\n        cmd = m.group(2)\n    # Regular command\n    else:\n        cmd = line\n\n    # Command prompt\n    question = f\"Do you want to run (line {lineno}): {cmd}\"\n    if cmd_input:\n        question += f\"\\n{cmd_input.decode('utf-8')}\\nWith the given input\"\n    if name:\n        question += f\"\\nAssigning the result to {name!r}\"\n    question += \" [y/N]\"\n    y = input(question)\n    if y != \"y\":\n        cmd_input = None\n        continue \n\n    # Run command\n    if name:\n        output = subprocess.check_output(cmd, shell=True, env=env).decode('utf-8').rstrip()\n        print(f\"Setting {name} to {output}\")\n        env[name] = output\n    else:\n        subprocess.run(cmd, check=True, shell=True, input=cmd_input, env=env)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1651828387975
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "sdp-dbd.pdf",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "sdp-dbd.pdf"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1652965354530
      }
    ]
  },
  {
    "key": "SA-18559",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "WARNING Missing Copyright information on cz-logging from cz-logging\nWARNING Missing Copyright information on rc from cz-kibana\nWARNING Missing Copyright information on cz-auditgen from cz-auditgen\nWARNING Missing Copyright information on logd-client from python3-logd\nWARNING Missing Copyright information on mustache.js for Java from cz-elasticsearch\nWARNING Missing Copyright information on yaml from cz-logd"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Since we did a release to master just. is this still valid?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646061614926
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I guess so, it's not about the url but about the copyright field"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1646062263350
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So.. Is this something that should be done on release-5.5?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646062447991
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "What is missing from the rc library?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646063649057
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "WARNING Missing Copyright information on cz-auditgen from cz-auditgen\nWARNING Missing Copyright information on logd-client from python3-logd"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " there i almost see as your area"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646063945379
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.com/appgate-sdp-int/stratus-logging/pull/446",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-logging/pull/446"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "  here is some shit"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646064220181
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I also dont see whats wrong with the mustach "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Files: /usr/cz-elasticsearch/modules/lang-mustache/lang-mustache-client-6.8.6.jar\nX-pkgmgr: maven\nX-License-Url: "
                },
                {
                  "type": "text",
                  "text": "https://github.com/elastic/elasticsearch/blob/master/LICENSE.txt"
                },
                {
                  "type": "text",
                  "text": "\nSources: "
                },
                {
                  "type": "text",
                  "text": "https://github.com/elastic/elasticsearch"
                },
                {
                  "type": "text",
                  "text": "\nUpstream-Name: elasticsearch mustache client\nLicense: Apache License 2.0\n\nFiles: /usr/cz-elasticsearch/modules/lang-mustache/compiler-0.9.3.jar\nX-pkgmgr: maven\nX-License-Url: "
                },
                {
                  "type": "text",
                  "text": "https://github.com/spullara/mustache.java/blob/main/LICENSE"
                },
                {
                  "type": "text",
                  "text": "\nSources: "
                },
                {
                  "type": "text",
                  "text": "https://github.com/spullara/mustache.java"
                },
                {
                  "type": "text",
                  "text": "\nUpstream-Name: mustache.js for Java\nLicense: Apache License 2.0"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646064306250
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Please comment in the top story to avoid the same discussion on every task."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1646120695450
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I honestly do not know why it complains about rc in kibana..  in theory since its npm also.. its should not be a requirement for GCP."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646128242031
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "![](image.png)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646130053779
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So..  For now we should skip the elasticsearch/kibana parts."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646130075734
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So. that leaves the logd."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646130103816
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Haha good to make it external download :D"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I guess logd doesn't have such a crazy amount."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I've seen that sessiond does have the copyright fields"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1646136261080
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "yeah.. different persons implemented them.. so logd/had etc is created by Daniel..   and sessiond has been done by Anton"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646142974427
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Since Daniel is out off office. i will try to make a fix there"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1646143001205
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "this must be obsolute"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1649233849046
      }
    ]
  },
  {
    "key": "SA-18576",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "DELETE\n\t"
            },
            {
              "type": "text",
              "text": "https://purple10.agi.appgate.com:8443/admin/admin-messages?message=API"
            },
            {
              "type": "text",
              "text": " version \"application/vnd.appgate.peer-v13 json\" is still in use by \"Appgate Policy Evaluator/1.0 - 212.16.176.132\" (current version is \"application/vnd.appgate.peer-v17 json\"). Please update any external scripts as support for this version will be removed."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": " the message needs to be URL encoded."
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-18640",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "All explained in this commit: "
            },
            {
              "type": "text",
              "text": "https://github.com/Nexus-Mods/Vortex/commit/5ac245bf5af9931901e529df3106596b51fd7766",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://github.com/Nexus-Mods/Vortex/commit/5ac245bf5af9931901e529df3106596b51fd7766"
                  }
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "First sketchy thing with this is how you add the dependency "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "\"winapi-bindings\": \"Nexus-Mods/node-winapi-bindings\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " as oppose to assigning a version like a decent dependency."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Then, it depends on "
                },
                {
                  "type": "text",
                  "text": "node-gyp",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to do native integration and it's the worst native integration tool ever. It requires both python and visual studio installation. "
                },
                {
                  "type": "text",
                  "text": "npm install",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " failed with this on my machine: "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "npm ERR! git dep preparation failed\nnpm ERR! command C:\\Program Files\\nodejs\\node.exe C:\\Users\\natan.abolafya\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js install --force --cache=C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache --prefer-offline=false --prefer-online=false --off\nline=false --no-progress --no-save --no-audit --include=dev --include=peer --include=optional --no-package-lock-only --no-dry-run\nnpm ERR! > winapi-bindings@2.4.0 install\nnpm ERR! > autogypi && node-gyp configure build\nnpm ERR! npm WARN using --force Recommended protections disabled.\nnpm ERR! npm WARN deprecated har-validator@5.1.3: this library is no longer supported\nnpm ERR! npm WARN deprecated uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See "
                },
                {
                  "type": "text",
                  "text": "https://v8.dev/blog/math-random"
                },
                {
                  "type": "text",
                  "text": " for details.\nnpm ERR! npm WARN deprecated request@2.88.2: request has been deprecated, see "
                },
                {
                  "type": "text",
                  "text": "https://github.com/request/request/issues/3142"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp info it worked if it ends with ok\nnpm ERR! gyp info using node-gyp@6.1.0\nnpm ERR! gyp info using node@16.13.0 | win32 | x64\nnpm ERR! gyp info find Python using Python version 3.8.10 found at \"C:\\Users\\natan.abolafya\\AppData\\Local\\Programs\\Python\\Python38\\python.exe\"\nnpm ERR! gyp http GET "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/node-v16.13.0-headers.tar.gz"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp http 200 "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/node-v16.13.0-headers.tar.gz"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp http GET "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/SHASUMS256.txt"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp http GET "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/win-x86/node.lib"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp http GET "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/win-arm64/node.lib"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp http GET "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/win-x64/node.lib"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp http 200 "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/win-x86/node.lib"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp http 200 "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/SHASUMS256.txt"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp http 404 "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/win-arm64/node.lib"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp http 200 "
                },
                {
                  "type": "text",
                  "text": "https://nodejs.org/download/release/v16.13.0/win-x64/node.lib"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp ERR! find VS\nnpm ERR! gyp ERR! find VS msvs_version not set from command line or npm config\nnpm ERR! gyp ERR! find VS VCINSTALLDIR not set, not running in VS Command Prompt\nnpm ERR! gyp ERR! find VS unknown version \"undefined\" found at \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Professional\"\nnpm ERR! gyp ERR! find VS checking VS2019 (16.11.32002.261) found at:\nnpm ERR! gyp ERR! find VS \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Professional\"\nnpm ERR! gyp ERR! find VS - \"Visual Studio C++ core features\" missing\nnpm ERR! gyp ERR! find VS could not find a version of Visual Studio 2017 or newer to use\nnpm ERR! gyp ERR! find VS looking for Visual Studio 2015\nnpm ERR! gyp ERR! find VS - not found\nnpm ERR! gyp ERR! find VS not looking for VS2013 as it is only supported up to Node.js 8\nnpm ERR! gyp ERR! find VS\nnpm ERR! gyp ERR! find VS **************************************************************\nnpm ERR! gyp ERR! find VS You need to install the latest version of Visual Studio\nnpm ERR! gyp ERR! find VS including the \"Desktop development with C++\" workload.\nnpm ERR! gyp ERR! find VS For more information consult the documentation at:\nnpm ERR! gyp ERR! find VS "
                },
                {
                  "type": "text",
                  "text": "https://github.com/nodejs/node-gyp#on-windows"
                },
                {
                  "type": "text",
                  "text": "\nnpm ERR! gyp ERR! find VS **************************************************************\nnpm ERR! gyp ERR! find VS\nnpm ERR! gyp ERR! configure error\nnpm ERR! gyp ERR! stack Error: Could not find any Visual Studio installation to use\nnpm ERR! gyp ERR! stack     at VisualStudioFinder.fail (C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache\\_cacache\\tmp\\git-cloneDjuIPT\\node_modules\\node-gyp\\lib\\find-visualstudio.js:121:47)\nnpm ERR! gyp ERR! stack     at C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache\\_cacache\\tmp\\git-cloneDjuIPT\\node_modules\\node-gyp\\lib\\find-visualstudio.js:74:16\nnpm ERR! gyp ERR! stack     at VisualStudioFinder.findVisualStudio2013 (C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache\\_cacache\\tmp\\git-cloneDjuIPT\\node_modules\\node-gyp\\lib\\find-visualstudio.js:351:14)\nnpm ERR! gyp ERR! stack     at C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache\\_cacache\\tmp\\git-cloneDjuIPT\\node_modules\\node-gyp\\lib\\find-visualstudio.js:70:14\nnpm ERR! gyp ERR! stack     at C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache\\_cacache\\tmp\\git-cloneDjuIPT\\node_modules\\node-gyp\\lib\\find-visualstudio.js:372:16\nnpm ERR! gyp ERR! stack     at C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache\\_cacache\\tmp\\git-cloneDjuIPT\\node_modules\\node-gyp\\lib\\util.js:54:7\nnpm ERR! gyp ERR! stack     at C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache\\_cacache\\tmp\\git-cloneDjuIPT\\node_modules\\node-gyp\\lib\\util.js:33:16\nnpm ERR! gyp ERR! stack     at ChildProcess.exithandler (node:child_process:404:5)\nnpm ERR! gyp ERR! stack     at ChildProcess.emit (node:events:390:28)\nnpm ERR! gyp ERR! stack     at maybeClose (node:internal/child_process:1064:16)\nnpm ERR! gyp ERR! System Windows_NT 10.0.19044\nnpm ERR! gyp ERR! command \"C:\\\\Program Files\\\\nodejs\\\\node.exe\" \"C:\\\\Users\\\\natan.abolafya\\\\AppData\\\\Local\\\\npm-cache\\\\_cacache\\\\tmp\\\\git-cloneDjuIPT\\\\node_modules\\\\node-gyp\\\\bin\\\\node-gyp.js\" \"configure\" \"build\"\nnpm ERR! gyp ERR! cwd C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache\\_cacache\\tmp\\git-cloneDjuIPT\nnpm ERR! gyp ERR! node -v v16.13.0\nnpm ERR! gyp ERR! node-gyp -v v6.1.0\nnpm ERR! gyp ERR! not ok\nnpm ERR! npm ERR! code 1\nnpm ERR! npm ERR! path C:\\Users\\natan.abolafya\\AppData\\Local\\npm-cache\\_cacache\\tmp\\git-cloneDjuIPT\nnpm ERR! npm ERR! command failed\nnpm ERR! npm ERR! command C:\\WINDOWS\\system32\\cmd.exe /d /s /c autogypi && node-gyp configure build"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I would not bother with this. But in case you want to, I'm assigning this to you "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "per.allansson",
                    "text": "@per.allansson",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " :). Feel free to close it."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1647966337100
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Oh that looks nasty...."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1647970114066
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Well, the combination of needing to update node-gyp to support newer VS releases, together with a bad versioning scheme in node-gyp and/or referring to the soon-to-be-obsolete version of node-gyp in the project dependencies makes the use of native compilation a bit \"interesting\". Oh, and it's not possible to override the node-gyp version dependency of dependency. Lots of great fallout from how npm \"works\"..."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Anyhow, using a different native registry module (like a true JS ninja does) works."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1648119751299
      }
    ]
  },
  {
    "key": "SA-18742",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Currently we always have to select the IdentityProvider we want to login in the AdminUI. In order to have a seamless experience in ASC we want to have the ability to pass the IdentityProvider in the URL so the user is automatically redirected to the external IdP instead of having to select it and click \"Sign in with browser\"."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "https://mydomain.com:8443/ui/?idp=AzureAD&login=true"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Assign this to me if you like. I'm used to messing up Frontend login page :D"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1648050686645
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "well, I meant that for the "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "Frontend",
                    "text": "@Frontend",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " Team :D. I can talk to them I guess."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1648109626762
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "All I can add is that from a UX pov this would be awesome!"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.svensson",
        "created": 1648110124876
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I'm trying to test this feature but the UI never loads:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "![](image.png)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "arturo.garcia",
        "created": 1651088979706
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "do you have anything in the Console?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1651140140979
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "also try "
                },
                {
                  "type": "text",
                  "text": "ui/index.html?idp....",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1651140171188
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "dismiss this... it works!"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "arturo.garcia",
        "created": 1651192624985
      }
    ]
  },
  {
    "key": "SA-18894",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Still one thing to fix, it seems like its not passing with multiple controllers, using this scenario "
                },
                {
                  "type": "text",
                  "text": "lhr-controller-ha",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "v4"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ aitorbot test get -t nightly_backup_restore\naitorbot ['nightly_backup_restore'] | 2022-04-13 22:45:04\n\tid:   b034e267-c686-46a1-a899-1974d6d197cf\n\turl:  "
                },
                {
                  "type": "text",
                  "text": "https://got-testrail.agi.appgate.com/index.php?/plans/view/995284"
                },
                {
                  "type": "text",
                  "text": "\n\tpassed: 0/3"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1649919756016
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Reopening"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1650543292613
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And its green, well done!"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1651214980001
      }
    ]
  },
  {
    "key": "SA-18914",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "heading",
          "content": [
            {
              "type": "text",
              "text": "What happened?"
            }
          ],
          "attrs": {
            "level": 2
          }
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I renewed my client token on purple I couldn't reach purple admin UI anymore but it looks like I am still connected"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "![](Selection"
            },
            {
              "type": "text",
              "text": "1663.png) Submitting the OTP actually reconnects to GCP",
              "marks": [
                {
                  "type": "em"
                }
              ]
            }
          ]
        },
        {
          "type": "heading",
          "content": [
            {
              "type": "text",
              "text": "Can you reproduce it at will?"
            }
          ],
          "attrs": {
            "level": 2
          }
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "appgate_logs-2022-04-13.zip",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "appgate_logs-2022-04-13.zip"
                  }
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "When trying to reproduce I got the expected behavior, connected for 5 min and then losing access to all sites"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "hadrien.luttiau",
        "created": 1649853025116
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[2022-04-13T11:56:19.982Z] Info : Token revocation for [0e6bd65d-368a-4511-a469-232cb2c35d56] is received by 'aws - purple10'. Will update the token.\n[2022-04-13T11:56:19.982Z] Info : Token revocation for [683c1571-5606-4905-8fc0-e049500817be] is received by 'got - purple2'. Will update the token.\n[2022-04-13T11:56:19.982Z] Info : Token revocation for [abf04f06-62d5-47aa-bd8b-586ce3e6e43b] is received by 'got - purple2'. Will update the token.\n[2022-04-13T11:56:19.983Z] Info : Token revocation for [abf04f06-62d5-47aa-bd8b-586ce3e6e43b] is received by 'aws - purple10'. Will update the token.\n[2022-04-13T11:56:19.989Z] Info : Token revocation for [855d1db0-8022-49d5-b1bf-37dbc00d4e23] is received by 'aws - purple40'. Will update the token.\n[2022-04-13T11:56:19.989Z] Info : Token revocation for [abf04f06-62d5-47aa-bd8b-586ce3e6e43b] is received by 'aws - purple40'. Will update the token.\n[2022-04-13T11:56:19.992Z] Info : Token revocation for [591a3eba-7308-4142-a439-763c01e4ea4b] is received by 'gcp - purple31'. Will update the token.\n[2022-04-13T11:56:19.996Z] Info : Token revocation for [a2c299dc-ad23-4db6-8de6-a266352e2957] is received by 'lhr - purple80'. Will update the token.\n[2022-04-13T11:56:19.996Z] Info : Token revocation for [abf04f06-62d5-47aa-bd8b-586ce3e6e43b] is received by 'gcp - purple31'. Will update the token.\n[2022-04-13T11:56:19.996Z] Info : Token revocation for [abf04f06-62d5-47aa-bd8b-586ce3e6e43b] is received by 'lhr - purple80'. Will update the token.\n[2022-04-13T11:56:20.000Z] Info : Token revocation for [e3287b0f-bcdd-4ee7-8178-1a6826b6b4d4] is received by 'azure - purple21'. Will update the token.\n[2022-04-13T11:56:20.001Z] Info : Token revocation for [abf04f06-62d5-47aa-bd8b-586ce3e6e43b] is received by 'azure - purple21'. Will update the token.\n[2022-04-13T11:56:20.048Z] Info : Retrieving claims token.\n[2022-04-13T11:56:20.050Z] Info : Resolving hostname 'purple.appgate.com'\n[2022-04-13T11:56:20.062Z] Info : Resolved IPs: [35.157.235.196, 35.177.27.1, 35.157.222.129]\n[2022-04-13T11:56:20.062Z] Info : Trying to connect 'purple.appgate.com/35.157.222.129' with SPA key name 'CryptZone'.\n[2022-04-13T11:56:20.198Z] Info : Token revocation for [c33d060e-b1ce-4356-ab33-8fb140640153] is received by 'aws - purple60'. Will update the token.\n[2022-04-13T11:56:20.198Z] Info : Token revocation for [abf04f06-62d5-47aa-bd8b-586ce3e6e43b] is received by 'aws - purple60'. Will update the token.\n[2022-04-13T11:56:20.483Z] Info : Authentication to '"
                },
                {
                  "type": "text",
                  "text": "https://purple.appgate.com/'"
                },
                {
                  "type": "text",
                  "text": " has been redirected to an external SAML provider while renewing claims token. Prompting user to re-authenticate.\n[2022-04-13T11:56:20.742Z] Info : Starting HTTP Server to receive SAML token.\n[2022-04-13T11:56:20.742Z] Info : 'WwwFormRestServer': Started listening on '[::ffff:127.0.0.1]:29001'.\n[2022-04-13T11:56:20.742Z] Info : Opening the URL on default browser.\n[2022-04-13T11:56:21.938Z] Info : A new HTTP connection has been opened to the client.\n[2022-04-13T11:56:21.938Z] Info : Parsed HTTP header. Waiting for payload.\n[2022-04-13T11:56:21.938Z] Info : Received SAML token. Will send it to controller.\n[2022-04-13T11:56:21.955Z] Info : Retrieving claims token.\n[2022-04-13T11:56:21.956Z] Info : Fetching on-boarding cookie for 'onboardingcookie-90:fb:88:e1:44:a8:a6:8f:8d:2b:e6:5c:5f:7b:5f:de:9a:ff:d7:62:82:6f:cd:e1:fc:03:eb:d4:22:a3:6c:7a-AppGate Azure AD SAML Client-hadrien.luttiau-f3d85c83-fd6e-458a-ba76-dbf56f683032' from secure storage.\n[2022-04-13T11:56:21.958Z] Info : On-boarding cookie available for 'onboardingcookie-90:fb:88:e1:44:a8:a6:8f:8d:2b:e6:5c:5f:7b:5f:de:9a:ff:d7:62:82:6f:cd:e1:fc:03:eb:d4:22:a3:6c:7a-AppGate Azure AD SAML Client-hadrien.luttiau-f3d85c83-fd6e-458a-ba76-dbf56f683032'.\n[2022-04-13T11:56:22.024Z] Info : 2FA required while updating claims token at '"
                },
                {
                  "type": "text",
                  "text": "https://purple.appgate.com/'"
                },
                {
                  "type": "text",
                  "text": "."
                },
                {
                  "type": "text",
                  "text": "\n[2022-04-13T11:56:22.043Z] Info : Initializing on-boarding OTP seed.\n[2022-04-13T11:56:22.088Z] Info : OTP seed is already initialized for this user."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "later followed by"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[2022-04-13T11:56:31.974Z] Info : Session removed for [abf04f06-62d5-47aa-bd8b-586ce3e6e43b] is received by 'gcp - purple31'. Will update the token if not logging out.\n[2022-04-13T11:56:32.076Z] Info : 'VPN Driver': Closing connection - waiting for prerequisites (re-authenticate || VPN certificate || Suspend).\n[2022-04-13T11:56:32.090Z] Info : 'GCP Europe West 3': VPN failure with status 'Disconnected'. Error 'Disconnected by gateway'.\n[2022-04-13T11:56:32.105Z] Info : 'GCP Europe West 3': Site connection lost\n[2022-04-13T11:56:32.109Z] Info : 'GCP Europe West 3': App source is offline with 1 client app."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ui logs only have this:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[2022-04-13T11:56:20.666Z] Info: Showing action 'renew-saml' immediately.\n[2022-04-13T11:56:22.123Z] Info: Showing action 'mfa-renewal' immediately.\n[2022-04-13T11:56:27.149Z] Info: Navigated to /. Cancelling app shortcut actions (if any).\n[2022-04-13T12:04:02.522Z] Info: Navigated to /. Cancelling app shortcut actions (if any)."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "otherwise client logs are just full of adapter crap:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[2022-04-13T11:56:23.021Z] Info : Checking adapter lo.\n[2022-04-13T11:56:23.022Z] Info : Processing address 127.0.0.1 for adapter lo.\n[2022-04-13T11:56:23.022Z] Info : Processing address ::1 for adapter lo.\n[2022-04-13T11:56:23.022Z] Info : Checking adapter enp0s31f6.\n[2022-04-13T11:56:23.022Z] Info : Checking adapter wlp61s0.\n[2022-04-13T11:56:23.022Z] Info : Processing address 10.101.2.19 for adapter wlp61s0.\n[2022-04-13T11:56:23.022Z] Info : Processing address fe80::a4d9:d625:461e:b53b%3 for adapter wlp61s0.\n[2022-04-13T11:56:23.022Z] Info : Checking adapter enx0050b6a4cca7.\n[2022-04-13T11:56:23.022Z] Info : Processing address 192.168.111.110 for adapter enx0050b6a4cca7.\n[2022-04-13T11:56:23.022Z] Info : Processing address 2a01:2b0:302c:60:192:168:111:110 for adapter enx0050b6a4cca7.\n[2022-04-13T11:56:23.022Z] Info : Processing address fe80::edc:d5a:a083:b24b%4 for adapter enx0050b6a4cca7.\n[2022-04-13T11:56:23.022Z] Info : Checking adapter docker0.\n[2022-04-13T11:56:23.022Z] Info : Adapter docker0 is ignored.\n[2022-04-13T11:56:23.022Z] Info : Checking adapter tun0.\n[2022-04-13T11:56:23.022Z] Info : Adapter tun0 is ignored."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "manuel.moraga",
        "created": 1649917439317
      }
    ]
  },
  {
    "key": "SA-18946",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "2022-04-14T08:09:18.537945+0000 cz-webd[8059]: WARNING [domain] No matcher found for mpower.mdcbms.ae\n2022-04-14T08:09:18.537945+0000 cz-webd[8059]: WARNING [router][cookie=0bc83d2dd2][dn=CN=4909da3c203d48f69730ddb46736f5b7,CN=test,OU=local][srcIP=91.75.87.6][url=postCookie] %v does not match allowed domains"
            },
            {
              "type": "text",
              "text": "https://mpower.mdcbms.ae:443/OA_HTML/AppsLogin"
            },
            {
              "type": "text",
              "text": "\n2022-04-14T08:10:16.892481+0000 cz-webd[8059]: WARNING [router][cookie=0bc83d2dd2][dn=CN=4909da3c203d48f69730ddb46736f5b7,CN=test,OU=local][srcIP=91.75.87.6][url=postCookie] URL doesn't have the proper host/port/uri format.\n2022-04-14T08:11:30.949357+0000 cz-webd[8059]: INFO    [session][clientID=9033][cookie=0bc83d2dd2][dn=CN=4909da3c203d48f69730ddb46736f5b7,CN=test,OU=local][loggedIn=true][srcIP=91.75.87.6] Memcache update 0bc83d2dd2 -> {\"blockLocalDnsRequests\":false,\"distinguishedName\":\"CN=4909da3c203d48f69730ddb46736f5b7,CN=test,OU=local\",\"dnsSearchDomains\":[],\"dnsServers\":[\"10.36.50.21\"],\"loggedIn\":true,\"clientId\": 9033}\n2022-04-14T08:11:30.950078+0000 cz-webd[8059]: INFO    [session][clientID=9033][cookie=0bc83d2dd2][dn=CN=4909da3c203d48f69730ddb46736f5b7,CN=test,OU=local][loggedIn=true][srcIP=91.75.87.6] Memcache update 0bc83d2dd2 -> {\"blockLocalDnsRequests\":false,\"distinguishedName\":\"CN=4909da3c203d48f69730ddb46736f5b7,CN=test,OU=local\",\"dnsSearchDomains\":[],\"dnsServers\":[\"10.36.50.21\"],\"loggedIn\":true,\"clientId\": 9033}\n2022-04-14T08:11:34.463681+0000 cz-webd[8059]: WARNING [domain] No matcher found for mpower.mdcbms.ae\n2022-04-14T08:11:34.463681+0000 cz-webd[8059]: WARNING [router][cookie=0bc83d2dd2][dn=CN=4909da3c203d48f69730ddb46736f5b7,CN=test,OU=local][srcIP=91.75.87.6][url=postCookie] %v does not match allowed domains"
            },
            {
              "type": "text",
              "text": "https://mpower.mdcbms.ae:443/OA_HTML/AppsLogin"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-5804",
    "description": {
      "version": 1,
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Else it can't download appliance upgrades from the cryptzone download center."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "See "
            },
            {
              "type": "text",
              "text": "https://askubuntu.com/questions/920156/curl-unable-to-obtain-local-certificate-on-ubuntu",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://askubuntu.com/questions/920156/curl-unable-to-obtain-local-certificate-on-ubuntu"
                  }
                }
              ]
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "  wget -P /tmp/ -nv https://www.digicert.com/CACerts/DigiCertSHA2SecureServerCA.crt\n  openssl x509 -in /tmp/DigiCertSHA2SecureServerCA.crt -inform DER \\\n               -out /tmp/DigiCertSHA2SecureServerCA.pem -outform PEM\n  sudo cp -uv /tmp/DigiCertSHA2SecureServerCA.pem /etc/ssl/certs\n  sudo c_rehash"
            }
          ]
        }
      ]
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And I assume this magic is being done to 3.2.1?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1502457581029
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "yes"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1502457681048
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "omg :D"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1502462459922
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1392",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1392"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1502695964433
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Thomas Cellerier",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/thomas.cellerier",
                        "title": "thomas.cellerier"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " Can you do this retrospectively to an existing appliance?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1502699600905
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "hmmm yeah by running the code in the link at the top. It will disappear after a reboot though."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1502701995355
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "As a reminder, here is why ubuntu doesn't want the cert in by default "
                },
                {
                  "type": "text",
                  "text": "https://bugs.launchpad.net/ubuntu/+source/ca-certificates/+bug/1700757",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://bugs.launchpad.net/ubuntu/+source/ca-certificates/+bug/1700757"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1502714407770
      }
    ]
  },
  {
    "key": "SA-5774",
    "description": {
      "version": 1,
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Sometimes teamcity build step fails before it can start with this:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[15:03:56][Step 1/1] ['C:\\\\Program Files\\\\Python35\\\\python.exe', '-m', 'testy', '-r', 'console', 'end2end', '--test-root', 'C:\\\\users\\\\admin\\\\artifacts\\\\cz-stratus-tests\\\\cases', '--scenario-root', 'C:\\\\users\\\\admin\\\\artifacts\\\\cz-stratus-tests\\\\scenarios', '--shared-settings', 'C:\\\\users\\\\admin\\\\artifacts\\\\cz-stratus-tests\\\\shared_settings', '--log-level', 'STREAM', '--scenario', 'simple', '-p', 'reporting.end2end.purpose=commit', 'reporting.end2end.test-plan-id=6666', 'reporting.end2end.cases-by-run=284993:16505594/41740281/42699718/10128/10129/10131/867625/10347;284994:867662/867663/27752253/6129266;284995:847076/847077', 'reporting.end2end.testyd-report-url=https://testyd.ad.cryptzone.com/testsd/', 'reporting.end2end.test-execution-uuid=13b8b3e2-8ddf-402b-bfcd-6844164d0722', '--tags', '16505594', '41740281', '42699718', '10128', '10129', '10131', '867625', '10347', '867662', '867663', '27752253', '6129266', '847076', '847077']\n[15:03:56][Step 1/1] Exception found: ¡Madre puta! testy exited with error code: 2"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I've seen it a few times already and not sure what error code 2 is, so.."
            }
          ]
        }
      ]
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://testrail.ad.cryptzone.com/index.php?/plans/view/284992",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://testrail.ad.cryptzone.com/index.php?/plans/view/284992"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1501858912505
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[15:03:56][Step 1/1] Running: net start W32Time\n[15:03:56][Step 1/1] The requested service has already been started.\n[15:03:56][Step 1/1]\n[15:03:56][Step 1/1] More help is available by typing NET HELPMSG 2182.\n[15:03:56][Step 1/1] "
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Could this be related?"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Do we have any more examples?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "aitor.iturri",
        "created": 1502717068966
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "no, I think that happens every time. probably should be cleaned, but not related."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1502717188505
      },
      {
        "body": {
          "type": "doc",
          "version": 1,
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "In that example (and seems that also in this one "
                },
                {
                  "type": "text",
                  "text": "https://teamcity.ad.cryptzone.com/viewLog.html?buildId=202968&buildTypeId=QaBuildConfigurations_EndToEnd_E2eTestyAndroidRunner&tab=buildLog&_focus=399",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://teamcity.ad.cryptzone.com/viewLog.html?buildId=202968&buildTypeId=QaBuildConfigurations_EndToEnd_E2eTestyAndroidRunner&tab=buildLog&_focus=399"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") "
                },
                {
                  "type": "text",
                  "text": "testy",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " tries to start a service that it's running and then it fails with error 2 (first problem). After that aitorbot tries to upload logs (maybe we should not try it there) and to finish the test which fails because testy did not report any change."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I think that we should fix 2 things:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "1 The reason why testy fails"
                },
                {
                  "type": "hardBreak"
                },
                {
                  "type": "text",
                  "text": "2 To destroy the test instead of finishing it in that case, then the environment/test will be destroyed/archived"
                }
              ]
            }
          ]
        },
        "author": "aitor.iturri",
        "created": 1502717629327
      }
    ]
  },
  {
    "key": "SA-5767",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Associated to the –image-url IMAGE\\"
            },
            {
              "type": "text",
              "text": "URL option we need to be able specify optional username:password so for instance we can upgrade from a secured source such as ",
              "marks": [
                {
                  "type": "em"
                }
              ]
            },
            {
              "type": "text",
              "text": "https://www.cryptzone.com/downloadcenter/appgate",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://www.cryptzone.com/downloadcenter/appgate"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Currently the script just times out with Upgrade Failed and leaves the Controllers in non HA and running the old version."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Tried using ["
            },
            {
              "type": "text",
              "text": "https://user",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://user"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": ":pass[@download]........]("
            },
            {
              "type": "text",
              "text": "https://user",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://user"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": ":"
            },
            {
              "type": "text",
              "text": "pass"
            },
            {
              "type": "mention",
              "attrs": {
                "id": "download",
                "text": "@download",
                "accessLevel": ""
              }
            },
            {
              "type": "text",
              "text": "........). and it failed the same way."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I will test against "
                },
                {
                  "type": "text",
                  "text": "https://download.cryptzone.com/files/download/AppGate-3.2.0/bin/AppGate-3.2.0.img.zip",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://download.cryptzone.com/files/download/AppGate-3.2.0/bin/AppGate-3.2.0.img.zip"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1502451138491
      },
      {
        "body": {
          "version": 1,
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Actually basic auth in the URL works, the issue is the certificate on our download website isn't valid according to the ubuntu CA store."
                },
                {
                  "type": "hardBreak"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "In [3]: requests.get('https://download.cryptzone.com/files/download/AppGate-3.2.0/bin/AppGate-3.2.0.img.zip')\nSSLError: (\"bad handshake: Error([('SSL routines', 'ssl3_get_server_certificate', 'certificate verify failed')],)\",)\n\nIn [4]: requests.get('https://download.cryptzone.com/files/download/AppGate-3.2.0/bin/AppGate-3.2.0.img.zip', verify=False)\nOut[4]: <Response [401]>\n\nIn [8]: requests.get('<https://cz-ag:<password> redacted>@download.cryptzone.com/files/download/AppGate-3.2.0/bin/AppGate-3.2.0.img.zip', verify=False)"
                }
              ]
            },
            {
              "type": "heading",
              "attrs": {
                "level": 1
              },
              "content": [
                {
                  "type": "text",
                  "text": "Works"
                }
              ]
            }
          ]
        },
        "author": "thomas.cellerier",
        "created": 1502451839159
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Cert is missing from the Appliance build............."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1502454735267
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And I guess we need to document this."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1502457743234
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Thomas Cellerier",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/thomas.cellerier",
                        "title": "thomas.cellerier"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " So will the syntax ["
                },
                {
                  "type": "text",
                  "text": "https://user",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://user"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":pass[@download].......]("
                },
                {
                  "type": "text",
                  "text": "https://user",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://user"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                },
                {
                  "type": "text",
                  "text": "pass"
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "download",
                    "text": "@download",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": ".......). now work? If so I should document this."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1502699505477
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yes it works."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1502702542911
      }
    ]
  },
  {
    "key": "SA-5681",
    "description": {
      "version": 1,
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I tried both with the built-in key and with a new key, giving the full URL to the client."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Proxyd showed this"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Jul 17 09:44:31 envy-172-17-122-1.devops cz-proxyd: [M 7f6a66e9bc00] spa_yaml_parse(): key with name \"Built-in-be85360895242\" will be used\nJul 17 09:44:31 envy-172-17-122-1.devops cz-proxyd: [M 7f6a66e9bc00] spa_yaml_parse(): key with name \"pinocammino\" will be used"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "(pinocammino is the other key I had created)."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "On the client I get"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "jul 17 12:03:34 salvo-VirtualBox Main[12566]: AppGate Service: Error - [ControllerLogic - SetControllerUrl] First connection to controller 'https://envy-172-17-122-1.devops/' has failed. Details: Connection failed."
            }
          ]
        }
      ]
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Known issue. We broke SPA compatibility on 3.2."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "3.1 client should work with 3.2 controller (TCP) though."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1500286194640
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Gah, change the test text accordingly then! :D"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1500286304730
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "What should this test be testing then? "
                },
                {
                  "type": "text",
                  "text": "https://testrail.ad.cryptzone.com/index.php?/tests/view/44216746",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://testrail.ad.cryptzone.com/index.php?/tests/view/44216746"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1500286340793
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "disable SPA, test the rest of the stuff."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "We don't have any process to update the texts as that would take huge time for us. Volunteers like you should ;)."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1500286534744
      }
    ]
  },
  {
    "key": "SA-5585",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Connecting to purple, with SPA. SPA passes but then nginx refuses the certificate apparently."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The UI, never shows the window to accept the certificate fingerprint, like it used to do last week."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "There is a known issue with corrupt gnome keyring, which we managed to fix by removing the login keyring file manually. but not installed shouldn't trigger that as libsecret should be able to figure that out."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499174252782
      },
      {
        "body": {
          "version": 1,
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "lug 04 14:13:20 mongibello AppGate[26483]: Debug - [ApplicationContext - LogFunction:66] SHIM: '0x7f4c1c2b50a0: SSL_connect, ssl_error=5, error:00000005:lib(0):func(0):DH lib verify_result=1'\nlug 04 14:13:20 mongibello AppGate[26483]: Debug - [ApplicationContext - LogFunction:66] SHIM: '0x7f4c1c2b50a0: write(connect) failed'\nlug 04 14:13:20 mongibello AppGate[26483]: Debug - [ApplicationContext - LogFunction:66] SHIM: '0x7f4c1c2a5040: failed to connect: 3'"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "According to the logs, it fails to verify the certificate. No CA certificate should be supplied to SHIM at this point."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Only happens Salvatore's machine atm."
                }
              ]
            }
          ]
        },
        "author": "natan.abolafya",
        "created": 1499176522573
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "you can bet some guy in rackspace doesn't have gnome-keyring, the guy even asked to support KDE's kwallet on that call…"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499176779544
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I don't believe this issue is related to gnome-keyring. The problem occurs before gnome-keyring is utilized."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499176914841
      },
      {
        "body": {
          "type": "doc",
          "version": 1,
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Having seen \"ssl_error=5\", thought it may be related to the 5 we receive when certificate doesn't match the hostname. That prints a different log, namely:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "2017-07-04T14:00:08.616Z Debug - [ApplicationContext - LogFunction:66] SHIM: '0538F020: certificate host/ip mismatch (test.envy/172.17.112.1)'\n2017-07-04T14:00:08.618Z Debug - [ApplicationContext - LogFunction:66] SHIM: '0591B440: failed to connect: 5'\n2017-07-04T14:00:08.618Z Debug - [ApplicationContext - LogFunction:66] SHIM: '0538F020: write(connect) failed'"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": []
            }
          ]
        },
        "author": "natan.abolafya",
        "created": 1499176979152
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "uninstalled my gnome-keyring. It works."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Though when I restart the client, it doesn't anymore because spa key is not stored anywhere. But that's a different issue."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499179789939
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "[Per Allansson]("
                },
                {
                  "type": "text",
                  "text": "http://got-youtrack.agi.appgate.com:8112/users/per.allansson",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/per.allansson"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " \"per.allansson\") what do you need from "
                },
                {
                  "type": "text",
                  "text": "Salvatore Tomaselli",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/salvatore.tomaselli",
                        "title": "salvatore.tomaselli"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " tcp dump again?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499243035352
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "one that includes all packets :)"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "tcpdump -s 0 -w packets.dump -i <ethX> host <gatewayip> and port 443"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1499244129290
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I have the same one i took yesterday."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499244346416
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "but the one from yesterday didn't contain the return traffic from the gateway"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1499244544954
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I had just set to capture \"any\" on wireshark… I can take it again"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499244594491
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "wireshark has issues sometimes capturing, especially when on any"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1499246938827
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "some text"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499249081531
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Thanks. There are a lot of SSL connects there that are closed down immediately after the client sends the first HELLO packet. Are we sure there are no interesting logs in nginx as to why this happens?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1499280651085
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Right that's what the ticket says..."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1499280683667
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The thing is, there is no certificate sent in first Client Hello so it doesn't make sense that server complains about it."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1499280972385
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I have no access to purple logs :)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499327979260
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "let me know when you want to watch live logs and we can gather somewhere."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499329242762
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "try with this client:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "["
                },
                {
                  "type": "text",
                  "text": "https://teamcity.ad.cryptzone.com/repository/download/StratusClient\\",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://teamcity.ad.cryptzone.com/repository/download/StratusClient\\"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "Linux/193712",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":id/appgate\\_3.2.0-7037-2067\\_amd64.deb]("
                },
                {
                  "type": "text",
                  "text": "https://teamcity.ad.cryptzone.com/repository/download/StratusClient_Linux/193712",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://teamcity.ad.cryptzone.com/repository/download/StratusClient_Linux/193712"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                },
                {
                  "type": "text",
                  "text": "id/appgate"
                },
                {
                  "type": "text",
                  "text": "3.2.0-7037-2067",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "amd64.deb)"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "and do touch /tmp/shimdebug2 before starting it - shim will then debug log to /tmp/shimdebug.log which you can copy to this support case"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1499331548997
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "By the way keyring is unrelated. I installed it and still had the same issue."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499345338536
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It works fine connecting to my own env."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499355035540
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hm, sooo some news, it works ONLY if my env allows the predefined SPA key, once I delete it, I am no longer able to login. Both TCP or UDP."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499356524990
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "We made some tests with "
                },
                {
                  "type": "text",
                  "text": "Natan Abolafya",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/natan.abolafya",
                        "title": "natan.abolafya"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". It seems that deleting the config+pasting the URL in the client seems to mostly work, while clicking on the link seems to always fail."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "After one of these failures, the client will ALWAYS fail to connect to an SPA with a custom key, whatever you do."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499432919561
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Another thing we saw is that, after failing with the built-in key, he copies the full url and presses sign in. What we see on proxyd is that SPA succeeds for the first time and then the client proceeds to reconnect (retrieve certificate and verify it), which fails with proxyd saying \"it's Built-in key, and I don't know anything about it\"."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This does not happen when we clear the config, start appgate and enter the full url using copy paste (something fishy with clicking the URL..)."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Which makes me think of this far fetch suspicion: Salvatore rebuilds stuff for Debian, missing some details, which leads to some memory problems in shim/spa implementation where it ends up reusing the old setting somehow."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499443415064
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "That's a build log from my machine."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499673004361
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Kosmas Valianos",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/kosmas.valianos",
                        "title": "kosmas.valianos"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " could you take a look at the last comments and make up theories? :D"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499673182067
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Post the logs allan requested as well."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "do touch /tmp/shimdebug2 before starting it - shim will then debug log to /tmp/shimdebug.log which you can copy to this support case"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It's the only way to get the shim logs"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "(latest client shall be enable to do this. No need to use the client PR)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1499675366017
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It causes the client to crash, there is a conversation on the client channel."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499675979161
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Try this. I tried right now and worked fine for me! While on beta branch:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "git pull\n\nsudo make clean\n\n./make-linux.sh ipt\n\nsudo chown -R kosmas:kosmas /opt/appgate/\n\ncp src/client/Lib/libcryptzone\\_ssl.so /opt/appgate/service/\n\ntouch /tmp/shimdebug2\n\nless +F /tmp/shimdebug.log"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Start AppGate client after that. I am able to see shim logs live like that (Ubuntu 16.04)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1499676882597
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "(This is very useful if you want to edit something in the cryptzone\\"
                },
                {
                  "type": "text",
                  "text": "ssl.c in the stupid debug\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "init() to make your OS log (in case it still crashes for X reason for your OS)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1499677193997
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "sudo chown -R kosmas:kosmas /opt/appgate/\n\ncp src/client/Lib/libcryptzone\\_ssl.so /opt/appgate/service/"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "or better yet, "
                },
                {
                  "type": "text",
                  "text": "sudo cp",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " :P"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499678695551
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hm how to put this… it's kinda working today. But only if I paste the link instead of clicking on it."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "If I click on it then it fails and after failure, pasting will never work."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Natan Abolafya",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/natan.abolafya",
                        "title": "natan.abolafya"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " could this be related to the fact that I change /etc/machine-id every day? (personal workaround to avoid the annoying onboarding failure)."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499679830633
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "or better yet, sudo cp :P"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "old remains when the log path was in that path which is root owned instead of the /tmp ;)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1499680231223
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "could this be related to the fact that I change /etc/machine-id every day? (personal workaround to avoid the annoying onboarding failure)."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "no, but"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "[^image.png]"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499680423306
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "That's the \"magic\" log"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "1499679628: spa\\_encrypt(): Setting the psk's name: \"CryptZone\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Some of them say build-in!!! Correlate which key is used when, depending to what you do. Clicking the link or copy paste or whatevah you do."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1499680426045
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Names should be self explicative."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499689797511
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The just paste has at the end 2 times:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "1499689581: spa\\"
                },
                {
                  "type": "text",
                  "text": "encrypt(): Setting the psk's name: \"CryptZone\"",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "the click on link NEVER has that. Only build in so click on link does not work then ?!"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The click on link plus paste bla the same"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1499690378805
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So it looks the proper params are not passed to the internals from the what the user is actually entering."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1499690670679
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Maybe some quoting is needed in the .desktop file? I can try :)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499690826483
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "there might be two issues here:"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  clicking the link only takes the hostname part not the whole thing (probably)"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  spa config getting lost at some point (this is what we should focus first I think)"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499691003284
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "clicking the link only takes the hostname part not the whole thing (probably)"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Nope. The process gets launched with the correct command line."
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "/opt/appgate/AppGate --url=appgate://purple.cryptzone.com/eyJzcGEiOnsibW9kZSI6IlVEUC1UQ1AiLCJuYW1lIjoiQ3J5cHRab25lIiwia2V5IjoiY2QzMzdiMmE1OTU1Yjg3OTk3YzlkYzRjNGRhZTM1ZDRmNTA1ZTE0ZmZhZWU3NWFlZjVhZDZhZjQ1M2M5ODgyOCJ9fQ=="
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499691335118
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ok. weird as there is nothing platform specific how we handle the url received. unless you have some buggy mono or something which would be a really buggy one."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499691494679
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2093",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2093"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "here is a PR with better logs with detailed SPA info, so we can isolate the issue better. "
                },
                {
                  "type": "text",
                  "text": "Salvatore Tomaselli",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/salvatore.tomaselli",
                        "title": "salvatore.tomaselli"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " please test with this and paste the logs."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499781358782
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This is what happened."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499784867129
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The logs posted are shim. I think natan wants the business logic logs as this is what the PR changed"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "btw the click link thing is definitely broken. This file has not a single custom key. All of them report \"Built-in-be85360895242\""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1499787119637
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "asd"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499787495567
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Well here for sure a crystal clear problem. Client C# part reverts back to the build-in... (after the warning issues?!)."
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Info - [OpenSslSocket - Connect] Trying to connect 'purple.cryptzone.com/35.157.235.196' with SPA UdpTcp and key name 'Built-in-be85360895242'.\nlug 11 16:50:46 mongibello AppGate[18774]: Info - [OpenSslSocket - Connect] Trying to connect 'purple.cryptzone.com/35.157.222.129' with SPA UdpTcp and key name 'Built-in-be85360895242'.\nlug 11 16:50:57 mongibello AppGate[18774]: Error - [ControllerLogic - SetControllerUrl] First connection to controller 'https://purple.cryptzone.com/' has failed. Details: Connection failed.\nlug 11 16:50:57 mongibello AppGate[18774]: Info - [LoginHandler - Start] User input required for 'ControllerUrlLoginHandler'.\nlug 11 16:51:13 mongibello AppGate[18774]: Info - [ControllerUrlLoginHandler - HandleInput] Received a new URL config from user. Parsing..\nlug 11 16:51:13 mongibello AppGate[18774]: Info - [UrlFormatter - ParseUrlConfig] URL config parsed. SPA mode: UdpTcp, Name: CryptZone\nlug 11 16:51:13 mongibello AppGate[18774]: Info - [ControllerUrlLoginHandler - HandleInput] Setting controller URL to 'https://purple.cryptzone.com/'.\nlug 11 16:51:13 mongibello AppGate[18774]: <warning> failed when retrieveing secret service: 'The name org.freedesktop.secrets was not provided by any .service files'\nlug 11 16:51:13 mongibello AppGate[18774]: Info - [CertificateConsumer - RetrieveCaCertificate] No CA certificate found in storage. Retrieving from controller.\nlug 11 16:51:13 mongibello AppGate[18774]: Info - [UrlLookup - Lookup] Resolving hostname 'purple.cryptzone.com'\nlug 11 16:51:13 mongibello AppGate[18774]: Info - [OpenSslSocket - Connect] Trying to connect 'purple.cryptzone.com/35.157.235.196' with SPA UdpTcp and key name 'CryptZone'.\nlug 11 16:51:15 mongibello AppGate[18774]: Info - [ControllerFetcherFactory - CreateControllerFetcher] Using Controller API V4\nlug 11 16:51:15 mongibello AppGate[18774]: Info - [UrlLookup - Lookup] Resolving hostname 'purple.cryptzone.com'\nlug 11 16:51:15 mongibello AppGate[18774]: Info - [OpenSslSocket - Connect] Trying to connect 'purple.cryptzone.com/35.157.235.196' with SPA UdpTcp and key name 'CryptZone'.\nlug 11 16:51:16 mongibello AppGate[18774]: Info - [ControllerFetcherFactory - CreateControllerFetcher] Using Controller API V4\nlug 11 16:51:16 mongibello AppGate[18774]: Info - [ControllerUrlLoginHandler - HandleInput] Storing new SPA config.\nlug 11 16:51:16 mongibello AppGate[18774]: <warning> failed when retrieveing secret service: 'The name org.freedesktop.secrets was not provided by any .service files'\nlug 11 16:51:16 mongibello AppGate[18774]: <warning> failed when retrieveing secret service: 'The name org.freedesktop.secrets was not provided by any .service files'\nlug 11 16:51:16 mongibello AppGate[18774]: Info - [ControllerUrlLoginHandler - HandleInput] Setting controller URL to 'https://purple.cryptzone.com/'.\nlug 11 16:51:16 mongibello AppGate[18774]: <warning> failed when retrieveing secret service: 'The name org.freedesktop.secrets was not provided by any .service files'\nlug 11 16:51:16 mongibello AppGate[18774]: Info - [CertificateConsumer - RetrieveCaCertificate] No CA certificate found in storage. Retrieving from controller.\nlug 11 16:51:16 mongibello AppGate[18774]: Info - [UrlLookup - Lookup] Resolving hostname 'purple.cryptzone.com'\nlug 11 16:51:16 mongibello AppGate[18774]: Info - [OpenSslSocket - Connect] Trying to connect 'purple.cryptzone.com/35.157.222.129' with SPA UdpTcp and key name 'Built-in-be85360895242'.\nlug 11 16:51:26 mongibello AppGate[18774]: Info - [OpenSslSocket - Connect] Trying to connect 'purple.cryptzone.com/35.157.235.196' with SPA UdpTcp and key name 'Built-in-be85360895242'."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "A second issue is that the click link looks definitely broken in the tomaselian logs. The latest click\\"
                },
                {
                  "type": "text",
                  "text": "link.bz2 file has not a single \"custom key\". All of them report \"Built-in-be85360895242\"",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1499845584621
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "yeah, if you continue, there are ones with 'Cryptzone' and they seemed to work. As I can't correlate the timestamps when you clicked, when you pasted to the logs; can't say much about that."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499847827201
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I made different files for when I just pasted, just clicked or both. When I did both, I tried once clicking, waited, then pasted. Shouldn't it be deterministic?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499850741182
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "those are only the shim logs. I need the service logs. Lemme know when I can watch you do it and check the logs at the same time."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499852415785
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "mind blowing.. After "
                },
                {
                  "type": "text",
                  "text": "\"Storing new SPA config.\"",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", it should just go to certificate trust stuff. But instead it goes back to setting url for some reason? what the hell."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499861865682
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "maybe your window system (and electron) is trolling us and somehow clicks \"Sign in\" twice which triggers this issue somehow.."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "could you enable debug logs and trigger the issue please?"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "~/.config/appgatexdp-service/user.settingsInfo -> Debug",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499862994535
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "asd"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1499873156617
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "wtf, I can see the full url reaches the mono service when you click actually. But disappears at some point? This is so weird."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "As for the other scenario, I can see this:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Debug - [LoginHandler - Finish:179] Finish handler with new state 'TrustCertificate'"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "but then it moves on to SetControllerUrl again for some reason. And I think it thinks it's in auto-login session:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Debug - [LoginHandler - AutoLogin:96] Task could not complete on autologin"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And this makes no sense whatsoever. Sounds like a super far-fetch bug triggered by only you. I'm off till Monday. Maybe "
                },
                {
                  "type": "text",
                  "text": "Petter Gustafsson",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/petter.gustafsson",
                        "title": "petter.gustafsson"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " can make some sense. Bug him if he has time, otherwise we can continue on Monday :)."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "P.S."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Another thing that's different on your env is locale btw. May be relevant."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1499876738331
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I will take a look :)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "petter.gustafsson",
        "created": 1499932408002
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2103",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2103"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "this may have fixed the problem. Salvatore, could you try again?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1500466613954
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "No difference."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1500471097774
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Issue is still there btw"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1507037041351
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Kosmas has the same issue on Ubuntu, so it's really not a magic thing that only happens for me. He uses ubuntu."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1511778282944
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yeah, last time I tried by clicking on appgate://hostname/base64\\"
                },
                {
                  "type": "text",
                  "text": "data the AppGate client indeed started but the base64 data were not used. I thought there is a task specifically for this problem but I cannot find it atm. Maybe I just whined in slack but didn't make a task",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1511778389011
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Kosmas, can you retry and post the logs?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1511778463216
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Actually it was in my laptop so will try again there and post the logs"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1511791280406
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ok, my problem is in Windows 10 actually when I click the link from the mail app. URL with base64 mess. Created a task for it [SA-6721](SA-6721). but "
                },
                {
                  "type": "text",
                  "text": "Salvatore Tomaselli",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/salvatore.tomaselli",
                        "title": "salvatore.tomaselli"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " check if it is actually similar/same issue"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[2017-11-27T21:27:26.284Z] Info : UI has connected to service.\n[2017-11-27T21:27:26.448Z] Info : UI is ready.\n[2017-11-27T21:27:26.449Z] Info : UI connected.\n[2017-11-27T21:27:26.457Z] Info : Connecting to TUN driver.\n[2017-11-27T21:27:26.461Z] Info : Setting log level of TUN driver to Info.\n[2017-11-27T21:27:26.477Z] Info : Setting locale to en-US.\n[2017-11-27T21:27:26.531Z] Info : Received a URL config from storage. Parsing..\n[2017-11-27T21:27:26.533Z] Warn : Invalid URL config received. Invalid length for a Base-64 char array or string.. config: eyJzcGEiOnsibW9kZSI6IlVEUC1UQ1AiLCJuYW1lIjoiQ3J5cHRab25lIiwia2V5IjoiY2QzMzdiMmE1OTU1Yjg3OTk3YzlkYzRjNGRhZTM1ZDRmNTA1ZTE0ZmZhZWU3NWFlZjVhZDZhZjQ1M2M5ODgyOCJ9fQ\n[2017-11-27T21:27:26.534Z] Info : Setting controller URL to 'https://purple.cryptzone.com/'.\n[2017-11-27T21:27:26.544Z] Info : CA certificate found in the storage for 'purple.cryptzone.com'.\n[2017-11-27T21:27:26.548Z] Info : Resolving hostname 'purple.cryptzone.com'\n[2017-11-27T21:27:26.634Z] Info : Trying to connect 'purple.cryptzone.com/35.157.222.129' with SPA UdpTcp and key name 'Built-in-be85360895242'.\n[2017-11-27T21:27:27.209Z] Info : Trying to connect 'purple.cryptzone.com/35.157.235.196' with SPA UdpTcp and key name 'Built-in-be85360895242'.\n[2017-11-27T21:27:27.519Z] Error : First connection to controller 'https://purple.cryptzone.com/' has failed. Details: Connection failed.\n[2017-11-27T21:27:27.523Z] Info : User input required for 'ControllerUrlLoginHandler'."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1511820014524
      }
    ]
  },
  {
    "key": "SA-5521",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Typical IPv6 environment creation with aitorbot"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Entering URL: "
            },
            {
              "type": "text",
              "text": "envy-fd00-ffff-a-300-172-17-300-1.devops",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " and clicking NEXT => Connection failed"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Logs from business logic",
              "marks": [
                {
                  "type": "strong"
                }
              ]
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "2017-06-28T11:27:58.931Z Info - [ControllerUrlLoginHandler - HandleInput] Setting controller URL to 'https://envy-fd00-ffff-a-300-172-17-300-1.devops/'.\n2017-06-28T11:27:58.931Z Info - [CertificateConsumer - RetrieveCaCertificate] No CA certificate found in storage. Retrieving from controller.\n2017-06-28T11:27:58.932Z Info - [OpenSslSocket - Connect] Trying to connect using IP address 'fd00:ffff:a:300::1'.\n2017-06-28T11:27:58.932Z Error - [ControllerLogic - SetControllerUrl] First connection to controller 'https://envy-fd00-ffff-a-300-172-17-300-1.devops/' has failed. Details: Connection failed."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "tun-service is not used as it is early in the flow. No logs there"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "sudo tcpdump -n ip6",
              "marks": [
                {
                  "type": "strong"
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "tcpdump does not show any DNS requests/SSL packets so it feels no packets are being send ?!"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "IPv6 settings on the Mac same as another machine [Windows 10 VM] which has been verified it can connect to the environment"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Gateway: fd00:ffff:a:60::254\n\nIPv6: fd00:ffff:a:60:192:168:111:153\n\nPrefix Length: 64\n\nDNS 1: fd00:ffff:a:40:172:17:40:9\n\nDNS 2: fd00:ffff:a:40:172:17:40:8"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": " nslookup can resolve the "
            },
            {
              "type": "text",
              "text": "envy-fd00-ffff-a-300-172-17-300-1.devops",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " in a proper IPv6 address and pinging a fellow IPv6 workstation and the office DNS servers/office Gateway worked fine so IPv6 settings are fine"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Per Allansson",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/per.allansson",
                        "title": "per.allansson"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " could you try locally with your mac some time?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1498650715084
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "2017-06-29T11:29:08.756Z Info - [ControllerUrlLoginHandler - HandleInput] Setting controller URL to 'https://envy-fd00-ffff-a-300-172-17-300-1.devops/'.\n2017-06-29T11:29:08.764Z Info - [CertificateConsumer - RetrieveCaCertificate] No CA certificate found in storage. Retrieving from controller.\n2017-06-29T11:29:08.770Z Info - [OpenSslSocket - Connect] Trying to connect using IP address 'fd00:ffff:a:300::1'.\n2017-06-29T11:29:08.771Z Error - [ControllerLogic - SetControllerUrl] First connection to controller 'https://envy-fd00-ffff-a-300-172-17-300-1.devops/' has failed. Details: Connection failed."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Accessing webui though at ["
                },
                {
                  "type": "text",
                  "text": "https://envy-fd00-ffff-a-300-172-17-300-1.devops",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://envy-fd00-ffff-a-300-172-17-300-1.devops"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":444]("
                },
                {
                  "type": "text",
                  "text": "https://envy-fd00-ffff-a-300-172-17-300-1.devops",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://envy-fd00-ffff-a-300-172-17-300-1.devops"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                },
                {
                  "type": "text",
                  "text": "444) through a browser works, so it is definitely a problem what we saw for IPv6"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1498736617428
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "shim logs:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "1498741507: Connecting to envy-fd00-ffff-a-300-172-17-300-1.devops/fd00:ffff:a:300::1 ...\n\n1498741507: connect() failed for UDP socket: 65/No route to host"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " so IPv6 + OS X + connect() in UDP socket = issue"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1498738163878
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2024",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2024"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1498747543439
      }
    ]
  },
  {
    "key": "SA-5383",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "For now there is only limited help:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "cz@envy-172-17-116-1:~$ which cz-upgrade\n/usr/sbin/cz-upgrade\ncz@envy-172-17-116-1:~$ cz-upgrade --help\nusage: cz-upgrade [-h] [--port PORT] [--device-id DEVICE_ID]\n                  [--username USERNAME] [--provider PROVIDER] [--no-verify]\n                  [--cacert CACERT] [--peer-api-version PEER_API_VERSION]\n                  --image-url IMAGE_URL [-y]\n                  hostname\n\npositional arguments:\n  hostname              AppGate Controller hostname or ip\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --port PORT           AppGate Controller admin port\n  --device-id DEVICE_ID\n  --username USERNAME\n  --provider PROVIDER\n  --no-verify           Do NOT verify the server certificate\n  --cacert CACERT       Path to CA cert file\n  --peer-api-version PEER_API_VERSION\n                        Controller Peer API version, will be auto-discovered\n                        if not set\n  --image-url IMAGE_URL\n                        Upgrade image url\n  -y, --yes             Batch mode, don't ask for confirmation"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "This should include some instructions and examples."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The file is in the appliance repo under "
            },
            {
              "type": "text",
              "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/tree/master/stratus/upgrader",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/tree/master/stratus/upgrader"
                  }
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Simple upgrade:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ ./cz-upgrade envy-172-17-134-1.devops --no-verify --image-url https://s3.eu-central-1.amazonaws.com/appgate-appliance-upgrade-images/appgate-3.1.1-5282-master.img.zip\nEnter password for username admin and provider name local:\nAuthenticating to https://envy-172-17-134-1.devops:444\nPeer API version is 5\nAuthorizing\n\nUpgrade plan:\n\nUpgrade controller(s): controller-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1\n\nUpgrade gateway(s): gateway-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1\n\nUpgrading controllers...\nStarting appliance upgrade for controller-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1\nWaiting for appliances to come back online: controller-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1 ...\nAppliance controller-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1 is online and in state single_controller_ready\n\nUpgrading gateways...\nStarting appliance upgrade for gateway-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1\nWaiting for appliances to come back online: gateway-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1 ...\nAppliance gateway-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1 is online and in state upgrading\nAppliance gateway-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1 is now offline\nAppliance gateway-06033153-73ca-49ff-b8e5-d1e4a20c6be6-site1 is now online and in state appliance_ready\n\nUpgrade done!\nAll appliances are now running version 3.1.1-5282-master"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Multi-controller upgrade:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Discovering peer API version for https://envy-172-17-130-2.devops:444...\nPeer API version is 5\nAuthenticating to https://envy-172-17-130-2.devops:444...\nAuthorizing...\n\nUpgrade plan:\n1. Disable controller role on the following appliance(s): controller-7e60c460-22c0-4281-8c25-9314747ba800-site1\n2. Upgrade first controller: controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1\n3. Upgrade additional controllers: controller-7e60c460-22c0-4281-8c25-9314747ba800-site1\n4. Enable controller role on the following appliance(s): controller-7e60c460-22c0-4281-8c25-9314747ba800-site1\n5. Upgrade gateway(s): gateway-7e60c460-22c0-4281-8c25-9314747ba800-site1\n\nWaiting for appliance(s) to come back online in state multi_controller_ready: controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1, controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 ...\nAppliance controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1 is online and in state multi_controller_ready\nAppliance controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 is online and in state multi_controller_ready\n\nDisabling controller on controller-7e60c460-22c0-4281-8c25-9314747ba800-site1...\nWaiting for appliance(s) to come back online in state single_controller_ready: controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1 ...\nAppliance controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1 is offline and in state unknown\nAppliance controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now online and in state single_controller_ready\nWaiting for appliance(s) to come back online in state appliance_ready: controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 ...\nAppliance controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 is online and in state appliance_ready\n\nUpgrading controllers...\nStarting appliance upgrade for controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1\nWaiting for appliance(s) to come back online in state single_controller_ready: controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1 ...\nAppliance controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1 is online and in state single_controller_ready\nStarting appliance upgrade for controller-7e60c460-22c0-4281-8c25-9314747ba800-site1\nWaiting for appliance(s) to come back online in state appliance_ready: controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 ...\nAppliance controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 is online and in state upgrading\nAppliance controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now offline\nAppliance controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now online and in state data_migration\nAppliance controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now in state appliance_ready\n\nEnabling controller on controller-7e60c460-22c0-4281-8c25-9314747ba800-site1...\nWaiting for appliance(s) to come back online in state multi_controller_ready: controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1, controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 ...\nAppliance controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1 is online and in state single_controller_ready\nAppliance controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 is online and in state appliance_ready\nAppliance controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now in state waiting_bdr_joining\nAppliance controller2-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now in state multi_controller_ready\nAppliance controller-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now in state multi_controller_ready\n\nUpgrading gateways...\nStarting appliance upgrade for gateway-7e60c460-22c0-4281-8c25-9314747ba800-site1\nWaiting for appliance(s) to come back online in state appliance_ready: gateway-7e60c460-22c0-4281-8c25-9314747ba800-site1 ...\nAppliance gateway-7e60c460-22c0-4281-8c25-9314747ba800-site1 is online and in state upgrading\nAppliance gateway-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now offline\nAppliance gateway-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now online and in state data_migration\nAppliance gateway-7e60c460-22c0-4281-8c25-9314747ba800-site1 is now in state appliance_ready\n\nUpgrade done!\nAll appliances are now running version 3.2.0-5439-master"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Example of setting password via env variable and user cancelling an upgrade:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ CZ_UPGRADE_PASSWORD=admin ./cz-upgrade --image-url http://blah:8080/thang envy-fd00-ffff-a-300-172-17-300-1.devops --no-verify\nDiscovering peer API version for https://envy-fd00-ffff-a-300-172-17-300-1.devops:444...\nPeer API version is 5\nAuthenticating to https://envy-fd00-ffff-a-300-172-17-300-1.devops:444...\nAuthorizing...\n\nUpgrade plan:\n\n1. Upgrade controller(s): envy-fd00-ffff-a-300-172-17-300-1_devops\n2. Upgrade gateway(s): gateway-151dbc56-feb7-421b-8004-ddff0be464d9-site1\n\nDo you want to continue [Y/n]? n\nUpgrade cancelled by user!"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1496313809529
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Example of a failed upgrade from upgrading purple:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ ./cz-upgrade purple10.cryptzone.com --cacert ca-cert-purple.pem --image-url https://s3.eu-central-1.amazonaws.com/appgate-appliance-upgrade-images/appgate-3.2.0-5447-master.img.zip\nDiscovering peer API version for https://purple10.cryptzone.com:444...\nPeer API version is 5\nEnter password for username admin and provider name local:\nAuthenticating to https://purple10.cryptzone.com:444...\nAuthorizing...\n\nUpgrade plan:\n\n1. Disable controller role on the following appliance(s): aws - purple11\n2. Upgrade first controller: aws - purple10\n3. Upgrade additional controllers: aws - purple11\n4. Enable controller role on the following appliance(s): aws - purple11\n5. Upgrade gateway(s): got - purple1\n6. Upgrade gateway(s): gce - purple30, azure - purple20, got - purple3, got - purplex, got - purple2\n\nDo you want to continue [y/N]? y\nWaiting for appliance(s) to come back online in state multi_controller_ready: aws - purple11, aws - purple10 ...\nAppliance aws - purple11 is online and in state multi_controller_ready\nAppliance aws - purple10 is online and in state multi_controller_ready\n\nDisabling controller on aws - purple11...\nWaiting for appliance(s) to come back online in state single_controller_ready: aws - purple10 ...\nAppliance aws - purple10 is offline and in state unknown\nAppliance aws - purple10 is now online and in state single_controller_ready\nWaiting for appliance(s) to come back online in state appliance_ready: aws - purple11 ...\nAppliance aws - purple11 is online and in state appliance_ready\n\nUpgrading controllers...\nStarting appliance upgrade for aws - purple10\nWaiting for appliance(s) to come back online in state single_controller_ready: aws - purple10 ...\nAppliance aws - purple10 is online and in state data_migration\nAppliance aws - purple10 is now in state cloud_initializing\nAppliance aws - purple10 is now in state single_controller_ready\nStarting appliance upgrade for aws - purple11\nWaiting for appliance(s) to come back online in state appliance_ready: aws - purple11 ...\nAppliance aws - purple11 is online and in state upgrading\nAppliance aws - purple11 is now offline\nUpgrade failed: Appliances [Appliance(name=\"aws - purple11\", peer_hostname=\"purple11.cryptzone.com\", role={'controller', 'gateway'}, site=06590afe-3eae-4437-aff6-523c06045103)] never came online in state appliance_ready!\n$ echo $?  # Script exit code is 0 on success, 1 on failure \n\n1"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1496396570157
      }
    ]
  },
  {
    "key": "SA-5348",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "May 26 12:33:46 envy-fd00-ffff-a-300-172-17-300-1.devops cz-configd[742]: [upgrade] Downloaded http://testyd.devops:6640/testyd/api/project/7/StratusAppliance_BuildStratusAppliance_2/master/artifact/appga\nMay 26 12:33:46 envy-fd00-ffff-a-300-172-17-300-1.devops cz-configd[742]: [upgrade] Deleting upgrade file: /mnt/data/download/appgate-3.2.0-5394-master.img.zip?is-build-type-id\nMay 26 12:33:46 envy-fd00-ffff-a-300-172-17-300-1.devops cz-configd[742]: [config-control] Failed to upgrade the appliance: Not an upgrade image file: /mnt/data/download/appgate-3.2.0-5394-master.img.zip?\nMay 26 12:33:46 envy-fd00-ffff-a-300-172-17-300-1.devops cz-configd[742]: Traceback (most recent call last):\nMay 26 12:33:46 envy-fd00-ffff-a-300-172-17-300-1.devops cz-configd[742]:   File \"/usr/cz-configd/configd/upgrade.py\", line 193, in upgrade_task\nMay 26 12:33:46 envy-fd00-ffff-a-300-172-17-300-1.devops cz-configd[742]:     upgrade(*args, next_state=next_state, **kwargs)\nMay 26 12:33:46 envy-fd00-ffff-a-300-172-17-300-1.devops cz-configd[742]:   File \"/usr/cz-configd/configd/upgrade.py\", line 144, in upgrade\nMay 26 12:33:46 envy-fd00-ffff-a-300-172-17-300-1.devops cz-configd[742]:     raise UpgradeError('Not an upgrade image file: {}'.format(image_path))\nMay 26 12:33:46 envy-fd00-ffff-a-300-172-17-300-1.devops cz-configd[742]: configd.upgrade.UpgradeError: Not an upgrade image file: /mnt/data/download/appgate-3.2.0-5394-master.img.zip?is-build-type-id"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1259",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1259"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495802732770
      }
    ]
  },
  {
    "key": "SA-5328",
    "comments": [
      {
        "body": {
          "version": 1,
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I had similar issues when initially testing xenial on virtualbox and added this hack:"
                },
                {
                  "type": "hardBreak"
                },
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/blob/master/initramfs/local-top/lvm2#L66-L68",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/blob/master/initramfs/local-top/lvm2#L66-L68"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Doesn't work without this for some reason\nSee https://bugs.launchpad.net/ubuntu/+source/lvm2/+bug/1573982\nvgchange -ay"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It never happened afterwards so forgot about it."
                },
                {
                  "type": "hardBreak"
                },
                {
                  "type": "text",
                  "text": "The current issue seems related."
                }
              ]
            }
          ]
        },
        "author": "thomas.cellerier",
        "created": 1495528147726
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I had taken the \"fix\" from that comment on the linked issue:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "My workaround is as I explained in the issue description: I added a script in /etc/initramfs-tools/scripts/local-top/ folder which performs "
                },
                {
                  "type": "text",
                  "text": "vgchange -ay",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495528193817
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Adding this to the boot command line fixes it for some weird reason:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "scsi\\"
                },
                {
                  "type": "text",
                  "text": "mod.scan=sync",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Found here "
                },
                {
                  "type": "text",
                  "text": "https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=616689",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=616689"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495533153205
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "With that fix our patched initramfs/local-top/lvm2 can be removed to use the default one."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495533662844
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "With that fix our patched initramfs/local-top/lvm2 can be removed to use the default one."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Taking that back, doesn't work now."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495533845737
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Added this in local-top/lvm2 before vgchange:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "lvm vgscan --mknodes"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And set this in etc/lvm/lvm.conf:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "use\\"
                },
                {
                  "type": "text",
                  "text": "lvmetad = 0",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495534819219
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1253",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1253"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495543931310
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The debian bug mentions that bug being fixed in initramfs-tools 0.119, however we are running 0.122:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\# dpkg --list|grep initramfs-tools ii initramfs-tools 0.122ubuntu8.8 all generic modular initramfs generator (automation) ii initramfs-tools-bin 0.122ubuntu8.8 amd64 binaries used by initramfs-tools ii initramfs-tools-core 0.122ubuntu8.8 all generic modular initramfs generator (core tools)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495552032116
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "maybe the actually problem is this with logic in the local-top/lvm script:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "    /dev/mapper/*)\n            eval $(dmsetup splitname --nameprefixes --noheadings --rows \"${dev#/dev/mapper/}\")\n            if [ \"$DM_VG_NAME\" ] && [ \"$DM_LV_NAME\" ]; then\n                    lvchange_activate \"$DM_VG_NAME/$DM_LV_NAME\"\n            fi\n            ;;\n    /dev/*/*)\n            # Could be /dev/VG/LV; use lvs to check\n            if lvm lvs -- \"$dev\" >/dev/null 2>&1; then\n                    lvchange_activate \"$dev\"\n            fi\n            ;;"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "for some reason its not matching our devices"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495552471818
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "root"
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "envy",
                    "text": "@envy",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": "-172-17-136-2:~# dmsetup splitname --nameprefixes --noheadings --rows \"${dev#/dev/mapper/}\" DM\\"
                },
                {
                  "type": "text",
                  "text": "VG\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "NAME='' DM\\"
                },
                {
                  "type": "text",
                  "text": "LV\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "NAME='' DM\\"
                },
                {
                  "type": "text",
                  "text": "LV\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "LAYER=''"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495552489862
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "root"
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "envy",
                    "text": "@envy",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": "-172-17-136-2:~# lvm lvs – \"/dev/mapper/czvg\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "data czvg -wi-ao—- 23.75g"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "image1 czvg -wi-ao—- 2.00g"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "state1 czvg -wi-ao—- 1.00g"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1495552668715
      }
    ]
  },
  {
    "key": "SA-5222",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "This means a client can impersonate an appliance and push audit logs."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "location /ffwd {\n    if ($ssl_client_verify = NONE) {\n        return 401;\n    }\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    proxy_pass <http://127.0.0.1:9011;>\n}"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "We need to go through all the appliance-appliance comms to make sure we always check DNs."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1494323331223
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Same for ffwd:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "location /ffwd {\n    if ($ssl_client_verify = NONE) {\n        return 401;\n    }\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    proxy_pass <http://127.0.0.1:%(ffwd_server)d;>\n}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Which means anybody can push AUDIT logs."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1494323628248
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "False alarm for sessiond:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "location /sessions { if ($ssl\\"
                },
                {
                  "type": "text",
                  "text": "client\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "verify = NONE) { return 401; } if ($ssl\\"
                },
                {
                  "type": "text",
                  "text": "client\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "s\\"
                },
                {
                  "type": "text",
                  "text": "dn != \"/CN=AppGate XDP CA\") { return 401; } proxy\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "pass "
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:%(sessiond\\",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://127.0.0.1:%(sessiond\\"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "port)d/sessions; }",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1494325293307
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "In [14]: requests.post('["
                },
                {
                  "type": "text",
                  "text": "https://envy-172-17-106-2.devops",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://envy-172-17-106-2.devops"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":444/sessions/revocations']("
                },
                {
                  "type": "text",
                  "text": "https://envy-172-17-106-2.devops",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://envy-172-17-106-2.devops"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                },
                {
                  "type": "text",
                  "text": "444/sessions/revocations'), cert=('cert.pem', 'key.pem'), verify='cacert.pem', data='LOL', headers={'Accept': 'application/vnd.cryptzone.peer-v4+json'}).text"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Out[14]: '<html>\\\\r\\\\n<head><title>401 Authorization Required</title></head>\\\\r\\\\n<body bgcolor=\"white\">\\\\r\\\\n<center><h1>401 Authorization Required</h1></center>\\\\r\\\\n<hr><center>nginx</center>\\\\r\\\\n</body>\\\\r\\\\n</html>\\\\r\\\\n'"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1494325427210
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Well that sucks..."
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "import websocket\nimport uuid\n\nserver = 'envy-172-17-106-1.devops'\nport = 514\nc = websocket.create_connection('wss://{}:444/ffwd/TCP/{}'.format(server, port), sslopt={'keyfile': 'key.pem', 'certfile': 'cert.pem', 'ca_certs': 'cacert.pem'}, header={'Accept': 'application/vnd.cryptzone.peer-v1+json'})\nc.send_binary('<%d>%s' % (0 + 3*8, 'testing testing!!! HACK ALERT!!! %s\\n' % str(uuid.uuid4())))\nc.close()"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1494332772442
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "May 9 12{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "26}}47 testing testing!!! HACK ALERT!!! 8f61f147-b2ca-46ba-8f40-fbdd9d74c239"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1494332818963
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1201",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1201"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1494337242470
      }
    ]
  },
  {
    "key": "SA-4948",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Then you can press it many times and this log happens:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "2017-03-30T07:25:02.419Z Info - [IdentitityProviderLoginHandler - HandleInput] provider 'Cryptzone Inc. SAML' selected.\n2017-03-30T07:25:02.528Z Info - [LoginHandler - Start] Starting handler 'ConnectSamlLoginHandler'\n2017-03-30T07:25:03.632Z Info - [ConnectLoginHandler - TryLogin] Try to login using 'OKTA'\n2017-03-30T07:25:03.636Z Info - [ControllerLogic - TryLogin] Getting the first claims token.\n2017-03-30T07:25:03.636Z Info - [ControllerLogic - UpdateClaimsToken] Retrieving claims token.\n2017-03-30T07:25:03.750Z Info - [ConnectLoginHandler - TryLogin] Redirection to an external identity provider is received. URL: https://dev-764072.oktapreview.com/app/cryptzonedev764072_cryptzonetest_1/exk67telgvNxuVCid0h7/sso/saml\n2017-03-30T07:25:03.754Z Info - [SamlHandler - ListenToken] Starting HTTP Server to receive SAML token.\n2017-03-30T07:25:03.754Z Info - [SamlHandler - ListenToken] Starting the browser to https://dev-764072.oktapreview.com/app/cryptzonedev764072_cryptzonetest_1/exk67telgvNxuVCid0h7/sso/saml.\n2017-03-30T07:25:05.070Z Info - [SamlHandler - ListenToken] Received SAML token. Will send it to controller.\n2017-03-30T07:25:05.070Z Info - [ConnectLoginHandler - TryLogin] Try to login using 'OKTA'\n2017-03-30T07:25:05.074Z Info - [ControllerLogic - TryLogin] Getting the first claims token.\n2017-03-30T07:25:05.074Z Info - [ControllerLogic - UpdateClaimsToken] Retrieving claims token.\n2017-03-30T07:25:05.294Z Info - [ControllerLogic - HandlePostAuthentication] Authentication succeeded. Claims Token: [TokenId: acf8e40b-1405-4b3e-a8ac-2f63d0412a02, DistinguishedName: CN=3ea4534c93444931a91289f6606e6422,CN=natan.abolafya,OU=OKTA, FirstName: Natan, LastName: Abolafya, ExpirationTime: 2017-03-30 22:25:04], On-demand Claims: [[]], Custom Scripts: [[]]\n2017-03-30T07:25:05.450Z Info - [UntrustedClaimsHandler - RetriveNewUntrustedClaimsToken] Processing on-demand Claims: []\n2017-03-30T07:25:05.454Z Info - [ConnectLoginHandler - RetrieveEntitlementToken] Getting entitlement tokens for the first time.\n2017-03-30T07:25:05.454Z Info - [ControllerLogic - UpdateEntitlementToken] Retrieving new entitlement tokens.\n2017-03-30T07:25:06.458Z Info - [ConnectLoginHandler - TryLogin] Try to login using 'OKTA'\n2017-03-30T07:25:06.458Z Info - [ControllerLogic - TryLogin] Getting the first claims token.\n2017-03-30T07:25:06.458Z Info - [ControllerLogic - UpdateClaimsToken] Retrieving claims token.\n2017-03-30T07:25:06.534Z Info - [ControllerLogic - UpdateEntitlementToken] New 4 entitlement tokens retrieved.\n2017-03-30T07:25:06.542Z Info - [ConnectLoginHandler - UpdateVpnToken] Updating vpn certificate\n2017-03-30T07:25:06.542Z Info - [ControllerLogic - RetrieveVpnCertificate] No VPN certificate found in secure storage for CN=3ea4534c93444931a91289f6606e6422,CN=natan.abolafya,OU=OKTA. Generating a key-pair for a new one.\n2017-03-30T07:25:06.590Z Info - [ConnectLoginHandler - TryLogin] Redirection to an external identity provider is received. URL: https://dev-764072.oktapreview.com/app/cryptzonedev764072_cryptzonetest_1/exk67telgvNxuVCid0h7/sso/saml\n2017-03-30T07:25:06.590Z Info - [SamlHandler - ListenToken] Starting HTTP Server to receive SAML token.\n2017-03-30T07:25:06.594Z Info - [SamlHandler - ListenToken] Starting the browser to https://dev-764072.oktapreview.com/app/cryptzonedev764072_cryptzonetest_1/exk67telgvNxuVCid0h7/sso/saml.\n2017-03-30T07:25:07.277Z Info - [SamlHandler - ListenToken] Received SAML token. Will send it to controller.\n2017-03-30T07:25:07.281Z Info - [ConnectLoginHandler - TryLogin] Try to login using 'OKTA'\n2017-03-30T07:25:07.281Z Info - [ControllerLogic - TryLogin] Getting the first claims token.\n2017-03-30T07:25:07.281Z Info - [ControllerLogic - UpdateClaimsToken] Retrieving claims token.\n2017-03-30T07:25:07.489Z Info - [ControllerLogic - HandlePostAuthentication] Authentication succeeded. Claims Token: [TokenId: 8bfa011d-ca6a-4fcf-a4db-c7b6970bcd7f, DistinguishedName: "
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-4781",
    "description": {
      "version": 1,
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "We get "
            },
            {
              "type": "text",
              "text": "err_spdy_protocol_error",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " on some pages at random times: "
            },
            {
              "type": "text",
              "text": "https://teamcity.ad.cryptzone.com/viewLog.html?buildId=157664&buildTypeId=QaBuildConfigurations_EndToEnd_E2eTestyWindowsRunner&tab=buildLog&state=33#_state=33&focus=5266",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://teamcity.ad.cryptzone.com/viewLog.html?buildId=157664&buildTypeId=QaBuildConfigurations_EndToEnd_E2eTestyWindowsRunner&tab=buildLog&state=33#_state=33&focus=5266"
                  }
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "[Step 1/1]     2017-03-09T06:42:48,835774Z [STREAM] [admin_ui\\basic_test] [Admin UI Browser] [2017-03-09 07:41:47.498000] https://envy-172-17-100-1.devops:444/ui/bower_components/angular/angular.js - Failed to load resource: net::ERR_SPDY_PROTOCOL_ERROR",
              "marks": [
                {
                  "type": "code"
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "According to article: "
            },
            {
              "type": "text",
              "text": "https://ma.ttias.be/nginx-spdy-error-neterr_spdy_protocol_error/",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://ma.ttias.be/nginx-spdy-error-neterr_spdy_protocol_error/"
                  }
                }
              ]
            }
          ]
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": " this can be due to "
                    },
                    {
                      "type": "text",
                      "text": "/usr/local/nginx/fastcgi_temp/",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": " not having proper permissions which can be fixed by: "
                    },
                    {
                      "type": "text",
                      "text": "chown nginx:nginx /usr/local/nginx/fastcgi_temp/ -R",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": " can also be a space issue on appliance so temp dir is not writeable (no solution for this)."
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": " we can disable spdy in chrome in e2e tests via starting chrome with options: "
                    },
                    {
                      "type": "text",
                      "text": "--use-spdy=npn-http",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": []
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Spotted by "
            },
            {
              "type": "text",
              "text": "Hadrien Luttiau",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "http://got-youtrack.agi.appgate.com:8112/users/hadrien.luttiau"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": " & "
            },
            {
              "type": "text",
              "text": "Natan Abolafya",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "http://got-youtrack.agi.appgate.com:8112/users/natan.abolafya"
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  },
  {
    "key": "SA-5988",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "good old "
            },
            {
              "type": "text",
              "text": "--extra-purposes",
              "marks": [
                {
                  "type": "code"
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "but I guess something like"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "aitorbot test create --purpose commit --purpose nightly",
              "marks": [
                {
                  "type": "code"
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "should be enough."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Use case: Nightly does not include commit tests because in most cases, commit tests are covered during the day; so no need to run them again."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "However, when I'm running Fedora nightly or IPv6 tests once a day, I want both nightly tests and commit tests at once, because there is no IPv6 hourly test."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I cannot seem to get this working.."
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "G:\\Code\\stratus-client-shared\\src\\ui>aitorbot test create --purpose runme --purpose commit\nCreating a multipurpose test, we will query aitorbot for the test case ids now\n¡Cojones! POST /executions HTTP 400: Errors on client input: Some of the tests cases provided could not be resolved.\n\nG:\\Code\\stratus-client-shared\\src\\ui>aitorbot test create --purpose nightly --purpose commit\nCreating a multipurpose test, we will query aitorbot for the test case ids now\n¡Joder! POST /executions HTTP 400: Errors on client input: Some of the tests cases provided could not be resolved.\n\nG:\\Code\\stratus-client-shared\\src\\ui>aitorbot test purposes\nusage: main.py test purposes [-h] [--project-id PROJECT_ID]\n                                 {list,cases} ...\nmain.py test purposes: error: the following arguments are required: purposescmd\n\nG:\\Code\\stratus-client-shared\\src\\ui>aitorbot test purposes list\namazon amazondebug ax-e ax-s azure backuprestore commit controllerha dont care esxi gce ha headless highavail lrt nightly nightly-candidate nousage physical physical-candidate runme template test-debug ui upgrade\n\nG:\\Code\\stratus-client-shared\\src\\ui>aitorbot test create --purpose nightly --purpose commit --client windows\nCreating a multipurpose test, we will query aitorbot for the test case ids now\n¡Madre puta! POST /executions HTTP 400: Errors on client input: Some of the tests cases provided could not be resolved.\n\nG:\\Code\\stratus-client-shared\\src\\ui>aitorbot version\n4.1.46"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Aitor Iturri",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/aitor.iturri",
                        "title": "aitor.iturri"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1507307667103
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/testyd/pull/422",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/testyd/pull/422"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "❯ ./scripts/aitorbot test create --purpose commit --purpose runme\nCreating a multipurpose test, we will query aitorbot for the test case ids now\neof:\n        id:   c7966b8e-61db-40e3-905e-9ba90ead1234\n        url:  https://testrail.ad.cryptzone.com:443/index.php?/plans/view/320642"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "aitor.iturri",
        "created": 1507635441653
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "works great"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1507798320898
      }
    ]
  },
  {
    "key": "SA-5917",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Example usage from tyron:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": " cz-upgrade --username tyronturner --provider local --cacert c:\\tmp\\AppGate_CA.der --image-url https://cz-ag:passwd@download.cryptzone.com/files/download/AppGate-3.2.1/bin/AppGate-3.2.1.img.zip hqxdpc01.cryptzone.com hqxdpc01.cryptzone.com"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "There seems to be a python stdlib function for that "
            },
            {
              "type": "text",
              "text": "https://docs.python.org/3/library/ssl.html#ssl.DER\\_cert\\_to\\_PEM\\_cert",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://docs.python.org/3/library/ssl.html#ssl.DER_cert_to_PEM_cert"
                  }
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "So we could support it without adding any additional requirements."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1429/files",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1429/files"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1503995583803
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "For docs: the –cacert argument now accepts either a DER format certificate or a PEM format ceritificate."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1504860033711
      }
    ]
  },
  {
    "key": "SA-5909",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The user may think OTP was actually accepted. Really weird."
            }
          ]
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Setup controller and initiate OTP remedy on the client."
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  ssh to controller, kill identityd "
                    },
                    {
                      "type": "text",
                      "text": "sudo service cz-identityd stop",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  enter OTP"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Remedy card disappears with the following logs:"
                    }
                  ]
                },
                {
                  "type": "codeBlock",
                  "attrs": {},
                  "content": [
                    {
                      "type": "text",
                      "text": "[2017-08-25T14:38:07.034Z] Info : Sending OTP pin to controller. [ClaimSuffix: 'a', ProviderId: '03542d1e-733c-4c43-a567-d28fbc4649a7', State: '']\n[2017-08-25T14:38:07.053Z] Info : Existing REST connection lost. Reconnecting.\n[2017-08-25T14:38:07.054Z] Info : Resolving hostname 'envy-172-17-102-1.devops'\n[2017-08-25T14:38:07.058Z] Info : Trying to connect 'envy-172-17-102-1.devops/172.17.102.1' with SPA UdpTcp and key name 'Built-in-be85360895242'.\n[2017-08-25T14:38:08.100Z] Info : REST connection could not be established. 'Internal Server Error'. Will try the next IP address.\n[2017-08-25T14:38:08.103Z] Info : Initializing OTP seed for 03542d1e-733c-4c43-a567-d28fbc4649a7\n[2017-08-25T14:38:08.106Z] Info : Resolving hostname 'envy-172-17-102-1.devops'\n[2017-08-25T14:38:08.109Z] Info : Trying to connect 'envy-172-17-102-1.devops/172.17.102.1' with SPA UdpTcp and key name 'Built-in-be85360895242'.\n[2017-08-25T14:38:09.139Z] Info : REST connection could not be established. 'Internal Server Error'. Will try the next IP address.\n[2017-08-25T14:38:09.142Z] Error : Request to controller 'https://envy-172-17-102-1.devops/' during OTP initialization has been rejected. Reason: (HTTP 500) Internal Server Error\n[2017-08-25T14:38:09.145Z] Info : Otp Action with message 'aa' has been cancelled by the user."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "not sure why we even try to initialize OTP again in this scenario."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1503672388258
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ok, initialization happens because of lack of parantheses on non-radius case. but for radius case, the problem persists."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1503673085164
      }
    ]
  },
  {
    "key": "SA-5860",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Be it envy, teamcity, testrail or github."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Right now teamcity down gives something like that:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "thomas@thomas:~$ aitorbot env create --scenario controller_ha\n¡Madre puta! POST /executions HTTP 502: <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.1//EN\" \"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd\">\n\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\">\n    <head>\n        <title>The page is temporarily unavailable</title>\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n        <style type=\"text/css\">\n            /<![CDATA[/\n            body {\n[...]"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-7484",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Occasional UI freezes"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  cant click it to see the status in ios"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  it messes up onboarding cookie somehow after failure(s)"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  on-boarding cookie issues."
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  saml screen doesn't show"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "does not support token renewals properly"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1520429537046
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "it messes up onboarding cookie somehow after failure(s)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1520440687581
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "saml screen doesn't show"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1520512073783
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Mar  8 13:26:45 Cryptzones-iPad iOSClient[560] <Notice>: [2018-03-08T12:26:45.401Z] Info : Starting HTTP Server to receive SAML token.\nMar  8 13:26:45 Cryptzones-iPad iOSClient[560] <Notice>: [2018-03-08T12:26:45.404Z] Info : Starting the browser to https://dev-764072.oktapreview.com/app/cryptzonedev764072_cryptzonetest_1/exk67telgvNxuVCid0h7/sso/saml.\nMar  8 13:26:45 Cryptzones-iPad iOSClient(WebKit)[560] <Notice>: 0x1c00deca0 - UIProcess is taking a background assertion because a page load started\nMar  8 13:26:45 Cryptzones-iPad iOSClient(WebKit)[560] <Notice>: 0x136d0de18 - UIProcess is taking a foreground assertion because the view is visible\nMar  8 13:26:45 Cryptzones-iPad iOSClient(UIKit)[560] <Error>: Unable to simultaneously satisfy constraints.\nMar  8 13:26:45 Cryptzones-iPad iOSClient(UIKit)[560] <Error>: Unable to simultaneously satisfy constraints.\nMar  8 13:27:15 Cryptzones-iPad mediaserverd(AudioToolbox)[25] <Notice>: 1171: pid 560(iOSClient)\nMar  8 13:27:20 Cryptzones-iPad iOSClient(UIKit)[560] <Notice>: XPC connection interrupted\nMar  8 13:27:31 Cryptzones-iPad ReportCrash[563] <Notice>: Formulating report for corpse[560] iOSClient"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1520512641251
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "3.3.3 client seems to work, still. A 4.0 client built with 3.3.3 shim+packettunnel is just as bad as the plain 4.0 version."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1520512784004
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Per Allansson [14:01]"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "client built from "
                },
                {
                  "type": "text",
                  "text": "3a7e6b70fb36519455b615617526020dfa764fa9",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/appgate-sdp-int/stratus-logging/commit/3a7e6b70fb36519455b615617526020dfa764fa9"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " (Jan 12) works"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Per Allansson [14:08]"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "client built from 7b8bed5 (PR 2729 ios autorotate) doesn't work "
                },
                {
                  "type": "text",
                  "text": ":slightly\\_smiling\\_face:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Silvercast Nguyen [14:09]"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "yup, the blocking mainthread is due to webview view manipulating"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1520515017252
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "client built from b875612a (PR 2675 iOS native nav) doesn't work (edited)"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "client built from 9a12f359f - PR merge before b875612a - works"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "so it's PR 2675 that is the breaker"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1520516889593
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Here is a fix/improvement for when we keep getting token renewals from GW, but UI is napping -"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "eventually the packettunnel extension will run out of memory: "
                },
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2790",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2790"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1520593015503
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2791",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2791"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " this is a fix for napping UI. Other UI issues will be solved in the same PR."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "silvercast.nguyen",
        "created": 1520594079323
      }
    ]
  },
  {
    "key": "SA-7402",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Client was happy sending SPA-UDP and using the custom key i.e. it was using the custom URL with the settings. After I upgraded to latest master I couldn't connect to controller anymore. I noticed in the logs that the client was trying to reach the controller using the default settings i.e. with the build-in key. It has lost the URL with the settings. I had to reseed it"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Platform, distribution etc."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1519652694189
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ubuntu LTS 16.04"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1519652845062
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Some logs after the upgrade and when the build-in key started being used"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "feb 26 13:42:19 kosmas-VirtualBox appgate-sdp[14568]: Info : Renaming key '$OnBoardingCookie-b3:38:b7:f3:e8:82:d9:37:63:3f:13:61:36:a0:ff:99:e8:81:ea:53:04:1d:28:75:b4\nfeb 26 13:42:19 kosmas-VirtualBox appgate-sdp[14568]: Info : Renaming key '$OnBoardingCookie-15:f9:bc:22:13:3e:ba:0a:91:b2:e0:8e:e9:0e:89:a4:e7:91:ff:b5:39:f5:fc:c1:7a\nfeb 26 13:42:19 kosmas-VirtualBox appgate-sdp[14568]: Info : Renaming key '$OnBoardingCookie-a7:3a:62:12:61:3f:f4:01:bd:5d:02:93:3f:36:6c:c8:e4:e3:46:8b:79:0a:9e:54:60\nfeb 26 13:42:20 kosmas-VirtualBox appgate-sdp[14568]: Info : Renaming key '$OnBoardingCookie-f3:85:48:6a:4a:08:37:30:85:1d:25:55:dc:24:bb:df:78:c5:ba:e4:67:75:95:fb:ac\nfeb 26 13:42:20 kosmas-VirtualBox appgate-sdp[14568]: Info : Running as user 'kosmas'.\nfeb 26 13:42:20 kosmas-VirtualBox appgate-sdp[14568]: Info : Process starting.\nfeb 26 13:42:20 kosmas-VirtualBox appgate-sdp[14568]: Info : ApplicationVersion: 4.0.0-10024-master\nfeb 26 13:42:21 kosmas-VirtualBox appgate-sdp[14568]: Info : UI has connected to service.\nfeb 26 13:42:21 kosmas-VirtualBox appgate-sdp[14568]: Info : UI is ready.\nfeb 26 13:42:21 kosmas-VirtualBox appgate-sdp[14568]: Info : UI connected.\nfeb 26 13:42:21 kosmas-VirtualBox appgate-sdp[14568]: Info : Connecting to TUN driver.\nfeb 26 13:42:21 kosmas-VirtualBox appgate-sdp[14568]: Info : Setting locale to en-US.\nfeb 26 13:42:21 kosmas-VirtualBox appgate-sdp[14568]: Info : Setting log level of TUN driver to Info.\nfeb 26 13:42:21 kosmas-VirtualBox appgate-sdp[14568]: Info : Setting controller URL to 'https://purple.cryptzone.com/'.\nfeb 26 13:42:21 kosmas-VirtualBox appgate-sdp[14568]: Info : CA certificate found in the storage for 'purple.cryptzone.com'.\nfeb 26 13:42:21 kosmas-VirtualBox appgate-sdp[14568]: Info : Resolving hostname 'purple.cryptzone.com'\nfeb 26 13:42:22 kosmas-VirtualBox appgate-sdp[14568]: Info : Trying to connect 'purple.cryptzone.com/35.157.235.196' with SPA UdpTcp and key name 'Built-in-be853608952\nfeb 26 13:42:32 kosmas-VirtualBox appgate-sdp[14568]: Info : Trying to connect 'purple.cryptzone.com/35.157.222.129' with SPA UdpTcp and key name 'Built-in-be853608952\nfeb 26 13:42:42 kosmas-VirtualBox appgate-sdp[14568]: Error : First connection to controller 'https://purple.cryptzone.com/' has failed. Details: Connection failed.\nfeb 26 13:42:42 kosmas-VirtualBox appgate-sdp[14568]: Info : User input required for 'ControllerUrlLoginHandler'.\nfeb 26 13:42:47 kosmas-VirtualBox appgate-sdp[14568]: Info : Setting controller URL to 'https://purple.cryptzone.com/'.\nfeb 26 13:42:47 kosmas-VirtualBox appgate-sdp[14568]: Info : CA certificate found in the storage for 'purple.cryptzone.com'.\nfeb 26 13:42:47 kosmas-VirtualBox appgate-sdp[14568]: Info : Resolving hostname 'purple.cryptzone.com'\nfeb 26 13:42:47 kosmas-VirtualBox appgate-sdp[14568]: Info : Trying to connect 'purple.cryptzone.com/35.157.235.196' with SPA UdpTcp and key name 'Built-in-be853608952\nfeb 26 13:42:58 kosmas-VirtualBox appgate-sdp[14568]: Info : Trying to connect 'purple.cryptzone.com/35.157.222.129' with SPA UdpTcp and key name 'Built-in-be853608952"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1519653438202
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2758",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2758"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "silvercast.nguyen",
        "created": 1519738461009
      }
    ]
  },
  {
    "key": "SA-7396",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "feb 23 10:42:57 envy envy[12019]: [Master][4ac34bc0-8b53-4d9e-8189-b1cf31df8253][DEBUG] Controller password update for controller : L5aURZIq15;I5:A\nfeb 23 10:42:57 envy envy[12019]: [Master][4ac34bc0-8b53-4d9e-8189-b1cf31df8253][DEBUG] Received a master channel communication: channels.Communication{Request:\"nodeStatusUpdate\", Payload:status.NodeStatu\nfeb 23 10:42:57 envy envy[12019]: [Master][4ac34bc0-8b53-4d9e-8189-b1cf31df8253][DEBUG] UUID update for gateway : 4ac34bc0-8b53-4d9e-8189-b1cf31df8253-site1\nfeb 23 10:42:57 envy envy[12019]: [Master][4ac34bc0-8b53-4d9e-8189-b1cf31df8253][DEBUG] Received a master channel communication: channels.Communication{Request:\"nodeStatusUpdate\", Payload:status.NodeStatu\nfeb 23 10:42:57 envy envy[12019]: [Master][4ac34bc0-8b53-4d9e-8189-b1cf31df8253][DEBUG] UUID update for endpoint : 4ac34bc0-8b53-4d9e-8189-b1cf31df8253-site1\nfeb 23 10:42:57 envy envy[12019]: [AwsHandler][4ac34bc0-8b53-4d9e-8189-b1cf31df8253-site1][DEBUG] Initializing Terraform: /opt/envy/terraform init\nfeb 23 10:42:57 envy envy[12019]: [AwsHandler][4ac34bc0-8b53-4d9e-8189-b1cf31df8253-site1][DEBUG] Exec, dir:/var/opt/envy/storage/4ac34bc0-8b53-4d9e-8189-b1cf31df8253/4ac34bc0-8b53-4d9e-8189-b1cf31df8253-\nfeb 23 10:42:57 envy envy[12019]: [golang-sh]$ /opt/envy/terraform init\nfeb 23 10:42:58 envy envy[12019]: [AwsHandler][4ac34bc0-8b53-4d9e-8189-b1cf31df8253-site1][DEBUG] Execute : /var/opt/envy/storage/4ac34bc0-8b53-4d9e-8189-b1cf31df8253/4ac34bc0-8b53-4d9e-8189-b1cf31df8253-\nfeb 23 10:42:58 envy envy[12019]: [AwsHandler][4ac34bc0-8b53-4d9e-8189-b1cf31df8253-site1][DEBUG] Exec, dir:/var/opt/envy/storage/4ac34bc0-8b53-4d9e-8189-b1cf31df8253/4ac34bc0-8b53-4d9e-8189-b1cf31df8253-\nfeb 23 10:42:58 envy envy[12019]: [golang-sh]$ /opt/envy/terraform apply\nfeb 23 10:43:12 envy envy[12019]: 23/Feb/2018:10:43:12 +0100 404 121μs \"GET /env/82c7c4ac-bada-4b6c-97cb-d5f9c4331540 HTTP/1.0\" - \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ch\nfeb 23 10:43:12 envy envy[12019]: 23/Feb/2018:10:43:12 +0100 404 45μs \"GET /favicon.ico HTTP/1.0\" - \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.3\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Received a master channel communication: channels.Communication{Request:\"nodeStatusUpdate\", Payload:status.NodeStatu\nfeb 23 10:44:01 envy envy[12019]: s:[]json.InterfaceJson(nil), Hostname:\"\", ApiUsername:\"\", ApiPassword:\"\", SshKey:\"\", SshKeyPath:\"\", LogLevels:map[string]interface {}(nil)}, Ips:[]string(nil), Healthchec\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][INFO] Status update for: controller status: Ready for provisioning\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][INFO] Starting to provision : controller\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][INFO] Status update for: gateway status: Ready for provisioning\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][INFO] Starting to provision : gateway\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][INFO] Status update for: endpoint status: Ready for provisioning\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][INFO] Starting to provision : endpoint\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Using default controller api username\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Using default controller api password\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Controller provisioning dispatched for controller\nfeb 23 10:44:01 envy envy[12019]: [Controller][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][WARNING] Could not establish a connection (SSH) to the controller. Unable to find the path to the private key: No priva\nfeb 23 10:44:01 envy envy[12019]: Will try connecting using password authentication.\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Provisioning dispatched for gateway\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Waiting for controller to be ready\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Controller status is Ready for provisioning\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Endpoint provisioning finished!\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Received a master channel communication: channels.Communication{Request:\"nodeStatusUpdate\", Payload:status.NodeStatu\nfeb 23 10:44:01 envy envy[12019]: ssword:\"\", SshKey:\"\", SshKeyPath:\"\", LogLevels:map[string]interface {}(nil)}, Ips:[]string{\"172.17.106.1\"}, Healthchecks:[]*status.NodeStatusInfoHealthcheck(nil), Provide\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Controller username update for controller : admin\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Controller password update for controller : admin\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Received a master channel communication: channels.Communication{Request:\"nodeStatusUpdate\", Payload:status.NodeStatu\nfeb 23 10:44:01 envy envy[12019]:  SshKey:\"\", SshKeyPath:\"\", LogLevels:map[string]interface {}(nil)}, Ips:[]string{\"172.17.106.1\"}, Healthchecks:[]*status.NodeStatusInfoHealthcheck(nil), Provider:\"vsphere\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][INFO] Status update for: controller status: Provisioning\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Received a master channel communication: channels.Communication{Request:\"nodeStatusUpdate\", Payload:status.NodeStatu\nfeb 23 10:44:01 envy envy[12019]:  SshKey:\"\", SshKeyPath:\"\", LogLevels:map[string]interface {}(nil)}, Ips:[]string{\"172.17.106.1\"}, Healthchecks:[]*status.NodeStatusInfoHealthcheck(nil), Provider:\"vsphere\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Received a master channel communication: channels.Communication{Request:\"nodeStatusUpdate\", Payload:status.NodeStatu\nfeb 23 10:44:01 envy envy[12019]: n{Ip:net.IP{0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xff, 0xff, 0xac, 0x11, 0x69, 0x0}, Network:(*net.IPNet)(0xc4219ee630), NetworkString:\"172.17.105.0/24\"}}},\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][INFO] Status update for: gateway status: Provisioning\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][DEBUG] Received a master channel communication: channels.Communication{Request:\"nodeStatusUpdate\", Payload:status.NodeStatu\nfeb 23 10:44:01 envy envy[12019]: [Master][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][INFO] Status update for: endpoint status: Running\nfeb 23 10:44:01 envy envy[12019]: Verification error: &url.Error{Op:\"Get\", URL:\"https://172.17.106.1:444/appliance/status\", Err:(*net.OpError)(0xc420472fa0)}\nfeb 23 10:44:01 envy envy[12019]: [Controller][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][WARNING] Controller is down\nfeb 23 10:44:01 envy envy[12019]: [Controller][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][WARNING] Verify service failed The controller service is down\nfeb 23 10:44:01 envy envy[12019]: [Controller][33e883a2-d802-4dcc-8cf3-faa6fa84b83d][WARNING] HealthCheck of controller failed The controller service is down\nfeb 23 10:44:07 envy envy[12019]: [Master][4ac34bc0-8b53-4d9e-8189-b1cf31df8253][DEBUG] Adding new status listener\nfeb 23 10:44:08 envy envy[12019]: [Restserver][WARNING] Unable to send on websocket\nfeb 23 10:44:08 envy envy[12019]: 23/Feb/2018:10:44:07 +0100 0 489512μs \"GET /env/ws/4ac34bc0-8b53-4d9e-8189-b1cf31df8253 HTTP/1.0\" - \"wCS/1.0\"\nfeb 23 10:44:08 envy envy[12019]: 23/Feb/2018:10:44:07 +0100 200 274μs \"GET /env/4ac34bc0-8b53-4d9e-8189-b1cf31df8253 HTTP/1.0\" - \"http4s-blaze/0.15.11a\"\nfeb 23 10:44:08 envy envy[12019]: [Restserver][INFO] Sending interrupt to masterHandler : 4ac34bc0-8b53-4d9e-8189-b1cf31df8253\nfeb 23 10:44:08 envy envy[12019]: 23/Feb/2018:10:44:08 +0100 0 72μs \"DELETE /env/4ac34bc0-8b53-4d9e-8189-b1cf31df8253 HTTP/1.0\" - \"http4s-blaze/0.15.11a\"\nfeb 23 10:44:08 envy envy[12019]: [AwsHandler][4ac34bc0-8b53-4d9e-8189-b1cf31df8253-site1][DEBUG] Trying to destroy an environment...\nfeb 23 10:44:08 envy envy[12019]: [AwsHandler][4ac34bc0-8b53-4d9e-8189-b1cf31df8253-site1][INFO] Executing the Terraform destroy command\nfeb 23 10:44:08 envy envy[12019]: [AwsHandler][4ac34bc0-8b53-4d9e-8189-b1cf31df8253-site1][DEBUG] Exec, dir:/var/opt/envy/storage/4ac34bc0-8b53-4d9e-8189-b1cf31df8253/4ac34bc0-8b53-4d9e-8189-b1cf31df8253-\nfeb 23 10:44:08 envy envy[12019]: [Master][4ac34bc0-8b53-4d9e-8189-b1cf31df8253][DEBUG] Received a master channel communication: channels.Communication{Request:\"nodeStatusUpdate\", Payload:status.NodeStatu\nfeb 23 10:44:08 envy envy[12019]: e:\"\", ApiUsername:\"\", ApiPassword:\"\", SshKey:\"\", SshKeyPath:\"\", LogLevels:map[string]interface {}(nil)}, Ips:[]string(nil), Healthchecks:[]*status.NodeStatusInfoHealthche\nfeb 23 10:44:08 envy envy[12019]: [Master][4ac34bc0-8b53-4d9e-8189-b1cf31df8253][INFO] Status update for: controller status: Destroying\nfeb 23 10:44:08 envy envy[12019]: [Master][4ac34bc0-8b53-4d9e-8189-b1cf31df8253][INFO] Status update for: gateway status: Destroying"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1519638964941
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I can’t reproduce the issue via create->destroy->create but.."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "My env ‘disappeared’ during weekend so I tried creating one first thing in the morning and started getting "
                },
                {
                  "type": "text",
                  "text": "Error occured",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " every time. Don't know what happened during the weekend."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Edit: can repro via create->destroy->create cycle again.. but my disappearing env during weekend remains a mystery.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "teoman.soygul",
        "created": 1519641665082
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/envy/pull/221",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/envy/pull/221"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " this should do it.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1519911636849
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "noice"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "teoman.soygul",
        "created": 1519915507319
      }
    ]
  },
  {
    "key": "SA-7380",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "For example to resize an AWS or Azure instance."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Adding support for extending an existing volume in cz-resize-data "
                },
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1894",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1894"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1519308827579
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Installing part probe in appliances "
                },
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1895",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1895"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1519308841779
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Here is a walk through on resizing an AWS instance:"
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "In the AWS console"
                }
              ],
              "attrs": {
                "level": 2
              }
            },
            {
              "type": "orderedList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Take a snapshot of the instance's volume."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Stop the instance."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Click on the instance, block devices, and click on the volume link, for example "
                        },
                        {
                          "type": "text",
                          "text": "vol-062fd64977435e526",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "From the volume page, right click modify volume and enter the desired disk space, for example 100 for 100 GiB."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Start the instance."
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "On the appliance"
                }
              ],
              "attrs": {
                "level": 2
              }
            },
            {
              "type": "orderedList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "SSH and get a root console on the appliance with "
                        },
                        {
                          "type": "text",
                          "text": "sudo -s",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Make sure the disk has been expanded by running "
                        },
                        {
                          "type": "text",
                          "text": "fdisk -l",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "The first line should show the new disk size, for example "
                        },
                        {
                          "type": "text",
                          "text": "100 GiB",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "."
                        }
                      ]
                    },
                    {
                      "type": "codeBlock",
                      "attrs": {},
                      "content": [
                        {
                          "type": "text",
                          "text": "fdisk -l\nDisk /dev/xvda: 100 GiB, 107374182400 bytes, 209715200 sectors\n[...]"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Find the name of the lvm partition on the appliance with pvdisplay in the PV Name column, here it is "
                        },
                        {
                          "type": "text",
                          "text": "/dev/xvda2",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ":"
                        }
                      ]
                    },
                    {
                      "type": "codeBlock",
                      "attrs": {},
                      "content": [
                        {
                          "type": "text",
                          "text": "#pvdisplay\n\n  --- Physical volume ---\n  PV Name               /dev/xvda2\n  VG Name               czvg\n  PV Size               199.75 GiB / not usable 2.00 MiB\n  Allocatable           yes\n  PE Size               4.00 MiB\n  Total PE              51135\n  Free PE               1280\n  Allocated PE          49855\n  PV UUID               N417eY-ZPMZ-fo5W-pmq9-Agmr-1BxP-5fAp8B"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Verify the size of the data partition before, here it is "
                        },
                        {
                          "type": "text",
                          "text": "13G",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ":"
                        }
                      ]
                    },
                    {
                      "type": "codeBlock",
                      "attrs": {},
                      "content": [
                        {
                          "type": "text",
                          "text": "\\# df -h /dev/czvg/data \n\nFilesystem      Size  Used Avail Use% Mounted on\n\n/dev/czvg/data     14G  197M   13G   2% /mnt/data"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Get the script, copy it to the appliance and make it executable."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "https://github.ad.cryptzone.com/raw/cryptzone/stratus-appliance/master/scripts/cz-resize-data?token=AAAAGZ76acwSMzhZ6eZYbqU4homc0mACks5amArxwA%3D%3D",
                          "marks": [
                            {
                              "type": "link",
                              "attrs": {
                                "href": "https://github.ad.cryptzone.com/raw/cryptzone/stratus-appliance/master/scripts/cz-resize-data?token=AAAAGZ76acwSMzhZ6eZYbqU4homc0mACks5amArxwA%3D%3D"
                              }
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "codeBlock",
                      "attrs": {},
                      "content": [
                        {
                          "type": "text",
                          "text": "wget https://s3.amazonaws.com/appgatedownload/cz-resize-data\nchmod +x cz-resize-data"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Run the script with the lvm partition as a parameter."
                        }
                      ]
                    },
                    {
                      "type": "codeBlock",
                      "attrs": {},
                      "content": [
                        {
                          "type": "text",
                          "text": "\\# ./cz-resize-data /dev/xvda2"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Verify that the data partition was expanded, here it's size was increased to "
                        },
                        {
                          "type": "text",
                          "text": "93G",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "."
                        }
                      ]
                    },
                    {
                      "type": "codeBlock",
                      "attrs": {},
                      "content": [
                        {
                          "type": "text",
                          "text": "\\# df -h /dev/czvg/data \n\nFilesystem      Size  Used Avail Use% Mounted on\n\n/dev/czvg/data     93G  215M   89G   1% /mnt/data"
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": " Note that the script will reserve 5 GiB for upgrades (image2 and state2 lvm logical volumes) since appliance versions lesser than 3.3 do not have the capability to resize the data partition on upgrade to make room for the image and state."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1519309412298
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This worked with datadog"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1519373661263
      }
    ]
  },
  {
    "key": "SA-7363",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "["
            },
            {
              "type": "text",
              "text": "https://testrail.ad.cryptzone.com/index.php?/tests/view/65222020&group\\",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://testrail.ad.cryptzone.com/index.php?/tests/view/65222020&group\\"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": "by=cases",
              "marks": [
                {
                  "type": "em"
                }
              ]
            },
            {
              "type": "text",
              "text": ":title&group\\_order=asc&group\\_id=-1]("
            },
            {
              "type": "text",
              "text": "https://testrail.ad.cryptzone.com/index.php?/tests/view/65222020&group_by=cases",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://testrail.ad.cryptzone.com/index.php?/tests/view/65222020&group_by=cases"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": ":"
            },
            {
              "type": "text",
              "text": "title&group"
            },
            {
              "type": "text",
              "text": "order=asc&group",
              "marks": [
                {
                  "type": "em"
                }
              ]
            },
            {
              "type": "text",
              "text": "id=-1)"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "not sure if its related but i see a lot of this in rsyslog's own logs"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Feb 20 10:35:34 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' resumed (module 'omprog') [v8.32.0 try http://www.rsyslog.com/e/2359 ]\nFeb 20 10:35:34 envy-172-17-122-1.devops rsyslogd[17654]: Child 19360 has terminated, reaped by main-loop. [v8.32.0 try http://www.rsyslog.com/e/0 ]\nFeb 20 10:35:34 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' suspended (module 'omprog'), retry 0. There should be messages before this one giving the reason for suspension. [v8.32.0 try http://www.rsyslog.com/e/2007 ]\nFeb 20 10:35:35 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' resumed (module 'omprog') [v8.32.0 try http://www.rsyslog.com/e/2359 ]\nFeb 20 10:35:35 envy-172-17-122-1.devops rsyslogd[17654]: Child 19368 has terminated, reaped by main-loop. [v8.32.0 try http://www.rsyslog.com/e/0 ]\nFeb 20 10:35:35 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' suspended (module 'omprog'), retry 0. There should be messages before this one giving the reason for suspension. [v8.32.0 try http://www.rsyslog.com/e/2007 ]\nFeb 20 10:35:36 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' resumed (module 'omprog') [v8.32.0 try http://www.rsyslog.com/e/2359 ]\nFeb 20 10:35:36 envy-172-17-122-1.devops rsyslogd[17654]: Child 19379 has terminated, reaped by main-loop. [v8.32.0 try http://www.rsyslog.com/e/0 ]\nFeb 20 10:35:36 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' suspended (module 'omprog'), retry 0. There should be messages before this one giving the reason for suspension. [v8.32.0 try http://www.rsyslog.com/e/2007 ]\nFeb 20 10:35:37 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' resumed (module 'omprog') [v8.32.0 try http://www.rsyslog.com/e/2359 ]\nFeb 20 10:35:37 envy-172-17-122-1.devops rsyslogd[17654]: Child 19387 has terminated, reaped by main-loop. [v8.32.0 try http://www.rsyslog.com/e/0 ]\nFeb 20 10:35:38 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' suspended (module 'omprog'), retry 0. There should be messages before this one giving the reason for suspension. [v8.32.0 try http://www.rsyslog.com/e/2007 ]\nFeb 20 10:35:39 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' resumed (module 'omprog') [v8.32.0 try http://www.rsyslog.com/e/2359 ]\nFeb 20 10:35:39 envy-172-17-122-1.devops rsyslogd[17654]: Child 19394 has terminated, reaped by main-loop. [v8.32.0 try http://www.rsyslog.com/e/0 ]\nFeb 20 10:35:39 envy-172-17-122-1.devops rsyslogd[17654]: action 'action 6' suspended (module 'omprog'), retry 0. There should be messages before this one giving the reason for suspension. [v8.32.0 try http://www.rsyslog.com/e/2007 ]"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1519122970316
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It didn't start failing with the new rsyslog actually but after that, weird "
                },
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1876",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1876"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1519124201238
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Seems related to log2audit which itself is related to the latest logd client update:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-172-17-122-1:~# cz-log2audit\nTraceback (most recent call last):\n File \"/usr/bin/cz-log2audit\", line 14, in <module>\n   import logdclient  # type: ignore\n File \"/usr/local/lib/python3.5/dist-packages/logdclient/init.py\", line 4, in <module>\n   from . import logc\n File \"/usr/local/lib/python3.5/dist-packages/logdclient/logc.py\", line 28, in <module>\n   _logc = swig_import_helper()\n File \"/usr/local/lib/python3.5/dist-packages/logdclient/logc.py\", line 24, in swig_import_helper\n   _mod = imp.load_module('_logc', fp, pathname, description)\n File \"/usr/lib/python3.5/imp.py\", line 242, in load_module\n   return load_dynamic(name, filename, file)\n File \"/usr/lib/python3.5/imp.py\", line 342, in load_dynamic\n   return _load(spec)\nImportError: /usr/local/lib/python3.5/dist-packages/logdclient/_logc.so: undefined symbol: logc_send_guaranteed_no_reconnect"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1519124763508
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Caused by updated the python library but not the underlying appliance library"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-contrib/pull/178",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-contrib/pull/178"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1882",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1882"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Fixed by per here:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1887",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1887"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1519125182514
      }
    ]
  },
  {
    "key": "SA-7213",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I guess the X should not be there - or should not create the new entry!"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "SA-7248",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "SA-7248"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "hadrien.luttiau",
        "created": 1518183452423
      }
    ]
  },
  {
    "key": "SA-7273",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "According to Thomas, controller returns 'Conflict' for filename after the file upload is complete. That means, the stream handling is not really as we want on the controller side."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I think this is fine (except possibly nginx caching?), eller "
                },
                {
                  "type": "text",
                  "text": "Thomas Cellerier",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/thomas.cellerier",
                        "title": "thomas.cellerier"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1518613603777
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I don't think it's nginx caching as it's the whole file. But yeah close it if you want."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1518616110016
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "didn't you say it was 20% when you got the conflict today?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1518616200435
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "No it was 20% when uploading against a 3.3 controller which doesn't even have the API. Which is why I made this PR "
                },
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1873",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1873"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I have to check, I might have increased the upload limit for 4.0 unnecessarily since it is disabled in particular for the file repository api."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "EDIT:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This is the location in 4.0:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "location /admin/files { proxy\\"
                },
                {
                  "type": "text",
                  "text": "set\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "header X-Forwarded-For $remote\\"
                },
                {
                  "type": "text",
                  "text": "addr; proxy\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "pass "
                },
                {
                  "type": "text",
                  "text": "http://127.0.0.1:9130/peer/files",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://127.0.0.1:9130/peer/files"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ";"
                },
                {
                  "type": "text",
                  "text": " proxy\\"
                },
                {
                  "type": "text",
                  "text": "request\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "buffering off; client\\"
                },
                {
                  "type": "text",
                  "text": "max\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "body\\"
                },
                {
                  "type": "text",
                  "text": "size 2g; }",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1518617005742
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ah, right. ok, so still a problem."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1518617101236
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Failed.. Jersey (the REST part of dropwizard) waits for full upload before starting the process. I tried a bunch of things but didn't help. It could very well be how HTTP works."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I was able to start processing right away with a change but failed to read the file this time. However, curl looks like this then:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "* Connected to localhost (127.0.0.1) port 9130 (#0)\nPUT /peer/files HTTP/1.1\nUser-Agent: curl/7.35.0\nHost: localhost:9130\nAccept: application/vnd.appgate.peer-v7+json\nContent-Length: 816884983\nExpect: 100-continue\nContent-Type: multipart/form-data; boundary=------------------------2e5e265bd20f44bc\n\n< HTTP/1.1 100 Continue\n< HTTP/1.1 204 No Content\n< Date: Fri, 23 Feb 2018 13:17:30 GMT\n<\n\n* Send failure: Broken pipe\n* Closing connection 0\ncurl: (55) Send failure: Broken pipe"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1519392932714
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Stackoverflow here I come."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1519393095216
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://stackoverflow.com/questions/10615410/jersey-multipart-streaming-without-disk-buffering-at-the-receiving-server",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://stackoverflow.com/questions/10615410/jersey-multipart-streaming-without-disk-buffering-at-the-receiving-server"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "for reference"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "curl -X PUT --header \"Accept: application/vnd.appgate.peer-v10+json\" --header \"Authorization: Bearer eyJjbGFpbXNUb2tl\nbiI6ImV5SmhiR2NpT2lKU1V6VXhNaUlzSW5wcGNDSTZJa1JGUmlJc0luUjVjQ0k2SWtwWFZDSjkuZUp5dGt0dHU0akFRaHQ4bHQ1RFd6c0Z4a0pDV0lLQlF\nvSlJ5WHZYQ3NSMXdTZUxnaEZNcTNyME9XMjMzQWZadVBQN0cvL2lmK1RRS3VlZHBueGtOZytEUVJoQkVwa1VCTXgwcjlFenN1Y0IwR1NRQSs2SHYyOUNvR3\nlMUGo3emlMUUI5RTJBVFdqUG9OQnk3NGFJSGhQMk5admdsRTRybi8wTDJEd1E4cDRLWXlBdVJibzhpMzNFMkpnblhlSHZjMUpMSWpTemsyYmJuUU0vR2JnZ\n2pSam5Bb1I5aUJ1dWFJU3dSYWYxbDNvd2xKWEVsbUZKMXpRck8yakVSaVJiK05ESnlqU1dwR3MyNmsyUGVrcWRhTWZmUHRjMEFyZWdZbjd0clhiZm4xenRN\nWlZvb0djZGNhVDdZalpQbFM4WlYvL1R4dEpvSG84VnNhOUhSZVRuSUxtdFlQRjdLYzN0MGNDWHR0Tk01UUtSUHl5eVlUdC9zVGJlZDJNT29WT3RUc2lnazV\n2NndIRVZ4TnluWHkrRUZBdEh1dlI2Z014Rnk4UHcyN1J4YWJMZFk5N0lXdnlhcmFQbzZMYk55T1ZidTRubWRnbGJ0TXJOMndhYjdrVXUyNzVEQlpIL2RQTD\nRFbzlmZEV3aDZNN2EwdHJOTzA3amQ2a2FtUDUzKy9Kd25STVE2K20zY2ZmcDFQejlRbVJqdmRTTVNLaSsrM1E2T0l0WWowRDdFNUcreVZkWG8wU2hTU0tXd\nnNwMU1xN3dPeWJaNi9uL09UVENlRnFLNFRwUTg2VmpkRnpGME9mRm9CRXpFUGRlRWtEdW1qNEd0MXdnQUN3RHFFNFNNVzFXc1laZmJTS2RZdGF2SWRHQ29Z\nZGYzVEFTZ0J5Mk1JWEdwRmpybVhLVi9lcjAzb1ZNRjJkNU5DcjlkZUwvZHZnQ0VzUEdkLlNVUG9XQUhrTlF5VWFnTytZNVZFVktzOHpHKzlSVzRxRmZEUGF\nOVXgvVmd5Q0JHa0Q4aEZadEdDbnZuOFhjRDVNdFhGaEE2b01wKzUvdDNSRUU1dGVWQVJxMzVXQ1huV3UvSllpVTNpTVhYdWhoUGRoWUdqSnQ1b0RpQXd3Sm\nRLekFWNFdwNThzTTZwdGlPTWpVOVBSV1hSSEhkODhtSXBwM3J2RFZoc3hyST0iLCJhZG1pbmlzdHJhdGlvblRva2VuIjoiZXlKaGJHY2lPaUpTVXpVeE1pS\nXNJbnBwY0NJNklrUkZSaUlzSW5SNWNDSTZJa3BYVkNKOS5lSnhOa0R0ckF6RVFoUDlLVUowMXE1Tk9qK3RjcG82ckJCZDZuUkc1RjVJY1lnNy85MGdoTVdH\nYlhlYWJHZGlkbFBVakxDK2VETVM1VVRLRkFvUWZGWERVQWl4YUNxTjNETDNodlJ3TmVTWXg1MnRvZklkVUF5cWczWW55Z2JPaGx3ZUIrRmFaOExYRkZQSi9\npUDFCNG9DU044aE5Kczc1OU9nM3lqSkJjWVRPb1FmZVdRbEs5Z2k5cHdhVnRsb3pXbTFwblZyeSswNWljMWswM2pxQklJUG5RR25nWUxscG5ZZ2RvdE5HaU\n9wYXpCd3EvWHJMSmN4UFJ6L0hKZWFTVEluclV1VXR4Yzg0aGN0dmNybHRqVDVPVTlXS1NaZFFIbWQyYXhOM1l1bzVsSFFOOVNlKytjNk52ZnhzOS91NXpqZ\nTR5V1RpLlBCYnNZeStSK21oOTNQekxRQzBmSG9GcE5HdGVHZFo3eGdWcG45MjhjaXhTREljWnl6dWhHbzBmQXVSTGdiSmM2ZC9jbngzcUZlQzl6RmdzRFpr\nUm5BeW95Mk93SG1MMDFTSXU3MXNBNFBCNUdVdWJjVGQySGFwOWVEQzcrdTdZWnlUbHlvRFNmUUdrZkRTTUxQVmk0Z2g4bSsycHJUYWIzejAzMlZ3cWt1bz0\nifQ==\" http://localhost:9130/admin/files -F \"file=@C:\\\\Users\\\\natan.abolafya\\\\Downloads\\\\appgate-5.0.0-14972-master.img\n.zip\""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1565621293840
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "In nginx it looks like we need set http 1.1 protocol too or else it doesn't proxy the chunked encoding. "
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "        proxy_http_version 1.1;"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1565793372519
      }
    ]
  },
  {
    "key": "SA-7095",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The passphrase remains set."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "could you tell me in which case?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "hadi.misagh",
        "created": 1516619084294
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This is what normally happens if I try to backup a newly created appliance:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": " $ python3 appgate-backup.pyz https://envy-172-17-116-1.devops:444 --no-verify\nEnter password for username admin and provider name local:\nAuthenticating to https://envy-172-17-116-1.devops:444...\nAuthentication succeeded\nAuthorizing...\nStarting backup on 1 appliances:\n\ncontroller2-4910c1be-a896-4889-b31b-f332ac4844ea-site1\nFailed to start backup creation.\nHTTP Error 500: {\"id\":\"internal server error\",\"message\":\"Internal server error. Backup passphrase is not set. Please contact your administrator.\"}\n\n"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "But if I do this:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ aitorbot test create --purpose backuprestore --scenario controller\\_ha --ex 4910c1be-a896-4889-b31b-f332ac4844ea "
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "After, this is what happens:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ python3 appgate-backup.pyz https://envy-172-17-116-1.devops:444 --no-verify\nEnter password for username admin and provider name local:\nAuthenticating to https://envy-172-17-116-1.devops:444...\nAuthentication succeeded\nAuthorizing...\nStarting backup on 1 appliances:\n\ncontroller2-4910c1be-a896-4889-b31b-f332ac4844ea-site1\nBackup creation started.\nAll files will be stored in /tmp/1517223805.21248/\nBackup complete on appliance: controller2-4910c1be-a896-4889-b31b-f332ac4844ea-site1\nDownloading backup from controller2-4910c1be-a896-4889-b31b-f332ac4844ea-site1 in /tmp/1517223805.21248/controller2-4910c1be-a896-4889-b31b-f332ac4844ea-site1\nDownload complete for appliance: controller2-4910c1be-a896-4889-b31b-f332ac4844ea-site1\nRemoved remote download for appliance: controller2-4910c1be-a896-4889-b31b-f332ac4844ea-site1"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So, as you can see, the state of the appliance after the test is not the same as before."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1517223971166
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-tests/pull/1452",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-tests/pull/1452"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1517392763237
      }
    ]
  },
  {
    "key": "SA-7057",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The upgrade API got expanded quite a lot during the 4.0.0 development cycle from a single API call POST /upgrade to a set of API calls."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The main functionality that was added was:"
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Upgrade status"
                }
              ],
              "attrs": {
                "level": 2
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The appliance now maintains an upgrade status that can be queries, allowing the upgrade script and command to get feedback on the progress of an upgrade. This allows discovering common errors like failing to download an upgrade file or a signature verification failure. The upgrade script now uses this functionality automatically if the controller and target appliance support it."
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Prepared upgrades"
                }
              ],
              "attrs": {
                "level": 2
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It is possible to prepare an upgrade before starting it's installation. That means downloading the upgrade file on an appliance and making sure it's signature is correct. This means errors can be discovered before the critical upgrade installation as well as time saved during the installation. To prepare an upgrade pass the "
                },
                {
                  "type": "text",
                  "text": "--prepare",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " flag to the upgrade script. Once the preparation is successful, run the script again with the "
                },
                {
                  "type": "text",
                  "text": "--install",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " flag."
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Hosting upgrade files on the controller"
                }
              ],
              "attrs": {
                "level": 2
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This allows appliances to download the upgrade image from a controller, not requiring extra ips and ports to be allowed in firewalls since all appliances already require access to the controller. If passing a local file to the controller using the "
                },
                {
                  "type": "text",
                  "text": "--image",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " flag the upgrade script will upload the file to the controller. If using an URL, the appliances will download from the URL directly. The controller can be instructed to download the file first using the "
                },
                {
                  "type": "text",
                  "text": "--host-image-on-controller",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " flag. The appliances will then download the file from the controller."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1516204614720
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Thomas Cellerier",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/thomas.cellerier",
                        "title": "thomas.cellerier"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " assume the parameter-options are changing; or at least you are adding new ones?"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Current ones are here: "
                },
                {
                  "type": "text",
                  "text": "https://help.cryptzone.com/adminguide/v3.3/upgrading-appliances.html?anchor=collective-upgrade",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://help.cryptzone.com/adminguide/v3.3/upgrading-appliances.html?anchor=collective-upgrade"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1516721544002
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yes they are changing quite a lot, I will add a comment here detailing the changes to the CLI."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1516723662291
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Changes to the command line interface"
                }
              ],
              "attrs": {
                "level": 2
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "These changes implied a bunch of changes on the command line interface."
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Script file name change"
                }
              ],
              "attrs": {
                "level": 4
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The script extension changed so the script name changed from "
                },
                {
                  "type": "text",
                  "text": "appgate-upgrade.py",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to "
                },
                {
                  "type": "text",
                  "text": "appgate-upgrade.pyz",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". It is still called in the same way, that is "
                },
                {
                  "type": "text",
                  "text": "python(3) appgate-upgrade.pyz <arguments>",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The technical reason for this is that we split the upgrade script code into several submodules and shared some with the backup script. In the future we will be able to share that code with any \"admin script\", for example that could be used for the autoscaling script as well."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Python allows you to package several scripts in a single zip file with the "
                },
                {
                  "type": "text",
                  "text": "pyz",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " extension and call it like you would call single "
                },
                {
                  "type": "text",
                  "text": "py",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " script."
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Actions"
                }
              ],
              "attrs": {
                "level": 4
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The upgrade script was fairly simple before, it only had one possible action which was to upgrade a collective. With the addition of prepared upgrades we need a lot more actions. The different actions available are now:"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  run: Perform a full upgrade. This is equivalent to what the upgrade script has been doing up to now."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  prepare: Prepare an upgrade but do NOT install it. This means the upgrade file will be downloaded/uploaded to all the appliances, the signature verified as well as any other preconditions applicable at this point."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  install: Install a prepared upgrade."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  cancel: Cancel a prepared upgrade."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Most of the command line flags are shared between all actions. Only a few differ like "
                        },
                        {
                          "type": "text",
                          "text": "--image",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " and "
                        },
                        {
                          "type": "text",
                          "text": "--host-on-controller",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "."
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Install"
                }
              ],
              "attrs": {
                "level": 4
              }
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ python3 appgate-upgrade.pyz run --help\nusage: appgate-upgrade.pyz run [-h] --image IMAGE [--host-on-controller]\n                               [-c CONTROLLER] [--cacert CACERT] [--port PORT]\n                               [--username USERNAME] [--provider PROVIDER]\n                               [-y] [-l {debug,error,info,warning}]\n                               [--peer-hostname PEER_HOSTNAME]\n                               [--target-version TARGET_VERSION]\n                               [--ignore-target-version] [--no-verify]\n                               [--device-id DEVICE_ID]\n                               [--peer-api-version PEER_API_VERSION] [--color]\n                               [--no-color]\n\nRun full upgrade.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --image IMAGE         Upgrade image file or URL\n  --host-on-controller  Host upgrade image file on controller\n  -c CONTROLLER, --controller CONTROLLER\n                        AppGate Controller peer hostname or ip The server\n                        should be specified in the following form:\n                        [https://]hostname[:port] If the port is specified\n                        here it takes precedence over the port argument.\n  --cacert CACERT       Path to the controller's CA cert file in PEM or DER\n                        format\n  --port PORT           AppGate Controller admin port\n  --username USERNAME   Admin username\n  --provider PROVIDER   Identity provider for the admin user\n  -y, --yes             Batch mode, don't ask for confirmation\n\nadvanced optional arguments:\n  -l {debug,error,info,warning}, --log-level {debug,error,info,warning}\n                        Log level\n  --peer-hostname PEER_HOSTNAME\n                        Specify the peer hostname of the AppGate controller\n                        you are connecting to. Use this if connecting via an\n                        ip or hostname that differs from the peer hostname\n  --target-version TARGET_VERSION\n                        Specify the target AppGate version in X.Y.Z format\n                        (e.g. 3.2.1). Alternatively the X.Y.Z-buildnumber-\n                        branch format (e.g. 3.2.1-6220-release) can also be\n                        used. The target version will be guessed from the\n                        image URL if it is unspecified\n  --ignore-target-version\n                        Do not try to guess the target version from the image\n                        URL. This takes precedence over --target-version if\n                        both are set\n  --no-verify           Do NOT verify the controller's certificate\n  --device-id DEVICE_ID\n                        Device id of the local machine, it will be generated\n                        at every run if not set\n  --peer-api-version PEER_API_VERSION\n                        Controller Peer API version, it will be auto-\n                        discovered if not set\n  --color               On Windows, force the use of colors\n  --no-color            Do not use colors"
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Prepare"
                }
              ],
              "attrs": {
                "level": 4
              }
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ python3 appgate-upgrade.pyz prepare --help\nusage: appgate-upgrade.pyz prepare [-h] --image IMAGE [--host-on-controller]\n                                   [-c CONTROLLER] [--cacert CACERT]\n                                   [--port PORT] [--username USERNAME]\n                                   [--provider PROVIDER] [-y]\n                                   [-l {debug,error,info,warning}]\n                                   [--peer-hostname PEER_HOSTNAME]\n                                   [--target-version TARGET_VERSION]\n                                   [--ignore-target-version] [--no-verify]\n                                   [--device-id DEVICE_ID]\n                                   [--peer-api-version PEER_API_VERSION]\n                                   [--color] [--no-color]\n\nPrepare an upgrade.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --image IMAGE         Upgrade image file or URL\n  --host-on-controller  Host upgrade image file on controller\n  -c CONTROLLER, --controller CONTROLLER\n                        AppGate Controller peer hostname or ip The server\n                        should be specified in the following form:\n                        [https://]hostname[:port] If the port is specified\n                        here it takes precedence over the port argument.\n  --cacert CACERT       Path to the controller's CA cert file in PEM or DER\n                        format\n  --port PORT           AppGate Controller admin port\n  --username USERNAME   Admin username\n  --provider PROVIDER   Identity provider for the admin user\n  -y, --yes             Batch mode, don't ask for confirmation\n\nadvanced optional arguments:\n  -l {debug,error,info,warning}, --log-level {debug,error,info,warning}\n                        Log level\n  --peer-hostname PEER_HOSTNAME\n                        Specify the peer hostname of the AppGate controller\n                        you are connecting to. Use this if connecting via an\n                        ip or hostname that differs from the peer hostname\n  --target-version TARGET_VERSION\n                        Specify the target AppGate version in X.Y.Z format\n                        (e.g. 3.2.1). Alternatively the X.Y.Z-buildnumber-\n                        branch format (e.g. 3.2.1-6220-release) can also be\n                        used. The target version will be guessed from the\n                        image URL if it is unspecified\n  --ignore-target-version\n                        Do not try to guess the target version from the image\n                        URL. This takes precedence over --target-version if\n                        both are set\n  --no-verify           Do NOT verify the controller's certificate\n  --device-id DEVICE_ID\n                        Device id of the local machine, it will be generated\n                        at every run if not set\n  --peer-api-version PEER_API_VERSION\n                        Controller Peer API version, it will be auto-\n                        discovered if not set\n  --color               On Windows, force the use of colors\n  --no-color            Do not use colors"
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Install"
                }
              ],
              "attrs": {
                "level": 4
              }
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ python3 appgate-upgrade.pyz install --help\nusage: appgate-upgrade.pyz install [-h] [-c CONTROLLER] [--cacert CACERT]\n                                   [--port PORT] [--username USERNAME]\n                                   [--provider PROVIDER] [-y]\n                                   [-l {debug,error,info,warning}]\n                                   [--peer-hostname PEER_HOSTNAME]\n                                   [--target-version TARGET_VERSION]\n                                   [--ignore-target-version] [--no-verify]\n                                   [--device-id DEVICE_ID]\n                                   [--peer-api-version PEER_API_VERSION]\n                                   [--color] [--no-color]\n\nInstall a prepared upgrade.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONTROLLER, --controller CONTROLLER\n                        AppGate Controller peer hostname or ip The server\n                        should be specified in the following form:\n                        [https://]hostname[:port] If the port is specified\n                        here it takes precedence over the port argument.\n  --cacert CACERT       Path to the controller's CA cert file in PEM or DER\n                        format\n  --port PORT           AppGate Controller admin port\n  --username USERNAME   Admin username\n  --provider PROVIDER   Identity provider for the admin user\n  -y, --yes             Batch mode, don't ask for confirmation\n\nadvanced optional arguments:\n  -l {debug,error,info,warning}, --log-level {debug,error,info,warning}\n                        Log level\n  --peer-hostname PEER_HOSTNAME\n                        Specify the peer hostname of the AppGate controller\n                        you are connecting to. Use this if connecting via an\n                        ip or hostname that differs from the peer hostname\n  --target-version TARGET_VERSION\n                        Specify the target AppGate version in X.Y.Z format\n                        (e.g. 3.2.1). Alternatively the X.Y.Z-buildnumber-\n                        branch format (e.g. 3.2.1-6220-release) can also be\n                        used. The target version will be guessed from the\n                        image URL if it is unspecified\n  --ignore-target-version\n                        Do not try to guess the target version from the image\n                        URL. This takes precedence over --target-version if\n                        both are set\n  --no-verify           Do NOT verify the controller's certificate\n  --device-id DEVICE_ID\n                        Device id of the local machine, it will be generated\n                        at every run if not set\n  --peer-api-version PEER_API_VERSION\n                        Controller Peer API version, it will be auto-\n                        discovered if not set\n  --color               On Windows, force the use of colors\n  --no-color            Do not use colors"
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "Cancel"
                }
              ],
              "attrs": {
                "level": 4
              }
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ python3 appgate-upgrade.pyz cancel --help\nusage: appgate-upgrade.pyz cancel [-h] [-c CONTROLLER] [--cacert CACERT]\n                                  [--port PORT] [--username USERNAME]\n                                  [--provider PROVIDER] [-y]\n                                  [-l {debug,error,info,warning}]\n                                  [--peer-hostname PEER_HOSTNAME]\n                                  [--target-version TARGET_VERSION]\n                                  [--ignore-target-version] [--no-verify]\n                                  [--device-id DEVICE_ID]\n                                  [--peer-api-version PEER_API_VERSION]\n                                  [--color] [--no-color]\n\nCancel a prepared upgrade\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONTROLLER, --controller CONTROLLER\n                        AppGate Controller peer hostname or ip The server\n                        should be specified in the following form:\n                        [https://]hostname[:port] If the port is specified\n                        here it takes precedence over the port argument.\n  --cacert CACERT       Path to the controller's CA cert file in PEM or DER\n                        format\n  --port PORT           AppGate Controller admin port\n  --username USERNAME   Admin username\n  --provider PROVIDER   Identity provider for the admin user\n  -y, --yes             Batch mode, don't ask for confirmation\n\nadvanced optional arguments:\n  -l {debug,error,info,warning}, --log-level {debug,error,info,warning}\n                        Log level\n  --peer-hostname PEER_HOSTNAME\n                        Specify the peer hostname of the AppGate controller\n                        you are connecting to. Use this if connecting via an\n                        ip or hostname that differs from the peer hostname\n  --target-version TARGET_VERSION\n                        Specify the target AppGate version in X.Y.Z format\n                        (e.g. 3.2.1). Alternatively the X.Y.Z-buildnumber-\n                        branch format (e.g. 3.2.1-6220-release) can also be\n                        used. The target version will be guessed from the\n                        image URL if it is unspecified\n  --ignore-target-version\n                        Do not try to guess the target version from the image\n                        URL. This takes precedence over --target-version if\n                        both are set\n  --no-verify           Do NOT verify the controller's certificate\n  --device-id DEVICE_ID\n                        Device id of the local machine, it will be generated\n                        at every run if not set\n  --peer-api-version PEER_API_VERSION\n                        Controller Peer API version, it will be auto-\n                        discovered if not set\n  --color               On Windows, force the use of colors\n  --no-color            Do not use colors"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1516873906876
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "cz-config upgrade"
                }
              ],
              "attrs": {
                "level": 2
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "cz-config upgrade also got updated to reflect the new capabilities"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ cz-config upgrade --help\nusage: cz-config upgrade [-h] [--no-delete] [--no-wait] [-n] [--force]\n                         [--prepare] [--install] [--finalize] [--cancel]\n                         [--status]\n                         [FILE]\n\npositional arguments:\n  FILE             Absolute URL to upgrade file, using the file://, http:// or\n                   https:// protocol, or absolute path to file\n\noptional arguments:\n  -h, --help       show this help message and exit\n  --no-delete      Do not delete the appliance upgrade image after upgrade\n  --no-wait        Don't wait for the upgrade to complete before returning\n  -n, --no-reboot  Do not reboot the appliance after upgrade\n  --force          Ignore peer API validation errors when installing the\n                   upgrade\n  --prepare        Prepare the upgrade but don't install the image\n  --install        Install a prepared upgrade\n  --finalize       Finalize a successful upgrade, this will trigger a reboot\n  --cancel         Cancel a prepared upgrade\n  --status         Print upgrade status"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1516875765309
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This is now done and available here "
                },
                {
                  "type": "text",
                  "text": "https://sdphelp.cyxtera.com/adminguide/v4.0/upgrading-appliances.html",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://sdphelp.cyxtera.com/adminguide/v4.0/upgrading-appliances.html"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "However the terminology used in cz-config and the upgrade script need changeing to match."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1517300242240
      }
    ]
  },
  {
    "key": "SA-7047",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "By default the upgrade script would still run a full upgrade."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "This would add two flags:"
            }
          ]
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  prepare"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  install"
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Prepare would make sure all appliances have the upgrade file downloaded and verified."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Install would actually install the previously prepared upgrade."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "There could also be a cancel flag to cancel a prepared upgrade."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "This would only be available if all appliances in the collective have peer API version >= 7."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "First shot:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "$ python3 -m appgate_upgrade --image-url https://testyd.ad.cryptzone.com:443/testsd/project/7/StratusAppliance_BuildStratusAppliance_2/master/artifact/appgate-4.0.0-8508-master.img.zip?is-build-type-id --username admin --no-verify envy-172-17-128-1.devops --prepare\nDiscovering peer API version for https://envy-172-17-128-1.devops:444...\nPeer API version is 7\nEnter password for username admin and provider name local:\nAuthenticating to https://envy-172-17-128-1.devops:444...\nAuthentication succeeded\nAuthorizing...\n\nPrepared upgrade plan:\n\nPrepare upgrade on the following appliances: controller-0ab18dbc-d3aa-4254-a834-cc963324e119-site1, gateway-0ab18dbc-d3aa-4254-a834-cc963324e119-site1\nAppliances will be prepared for upgrade to version 4.0.0-8508-master\n\nDo you want to continue [y/N]? y\n\nPrepare upgrade on the following appliances: controller-0ab18dbc-d3aa-4254-a834-cc963324e119-site1, gateway-0ab18dbc-d3aa-4254-a834-cc963324e119-site1\nUpgrade status for gateway-0ab18dbc-d3aa-4254-a834-cc963324e119-site1 changed to downloading: https://testyd.ad.cryptzone.com:443/testsd/project/7/StratusAppliance_BuildStratusAppliance_2/master/artifact/appgate-4.0.0-8508-master.img.zip?is-build-type-id\nUpgrade status for controller-0ab18dbc-d3aa-4254-a834-cc963324e119-site1 changed to downloading: https://testyd.ad.cryptzone.com:443/testsd/project/7/StratusAppliance_BuildStratusAppliance_2/master/artifact/appgate-4.0.0-8508-master.img.zip?is-build-type-id\nUpgrade status for controller-0ab18dbc-d3aa-4254-a834-cc963324e119-site1 changed to verifying: appgate-4.0.0-8508-master.img.zip\nUpgrade status for gateway-0ab18dbc-d3aa-4254-a834-cc963324e119-site1 changed to verifying: appgate-4.0.0-8508-master.img.zip\nUpgrade status for controller-0ab18dbc-d3aa-4254-a834-cc963324e119-site1 reached expected value ready: /mnt/data/download/appgate-4.0.0-8508-master.img.zip\nUpgrade status for gateway-0ab18dbc-d3aa-4254-a834-cc963324e119-site1 reached expected value ready: /mnt/data/download/appgate-4.0.0-8508-master.img.zip\n\nReady for upgrade!"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1516207078978
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1809",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1809"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1516283441595
      }
    ]
  },
  {
    "key": "SA-6934",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Renewed CA certificate:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "12-21 15:48:21.490  2400  2630 I Appgate : Info : SiteStatus {\"simple_setup Site\":{\"gw-id\":null,\"host\":null,\"ip\":null,\"status\":\"disconnected\",\"error\":null,\"code\":0,\"protocol-version\":0}}\n12-21 15:48:21.493  2400  2400 I Appgate : Info : TUN failure on site 'simple_setup Site'.\n12-21 15:48:21.494  2400  2400 I Appgate : Info : Site connection lost on 'simple_setup Site'.\n12-21 15:48:26.493  2400  2630 V Appgate : [simple_setup Site] Connect...\n12-21 15:48:26.496  2400  2630 V Appgate : [simple_setup Site] Connecting to envy-172-17-140-2.devops:443 (172.17.140.2) with tls.\n12-21 15:48:26.496  2400  2630 V Appgate : shim_connect(): Connecting to TLS://envy-172-17-140-2.devops|172.17.140.2:443 (tunnel: yes) ...\n12-21 15:48:26.497  2400  2707 V Appgate : Sending SPA data encapsulated in a DNS query\n12-21 15:48:26.497  2400  2707 V Appgate : Sending DTLS ClientHello with SPA extension\n12-21 15:48:27.299  2400  2630 V Appgate : shim_connect(): Connected to envy-172-17-140-2.devops/172.17.140.2\n12-21 15:48:27.306  2400  2708 V Appgate : shim_ssl_connect(): Verification enabled for host name: envy-172-17-140-2.devops\n12-21 15:48:27.559  2400  2630 V Appgate : [simple_setup Site] ResendCachedTokens\n12-21 15:48:27.565  2400  2630 I Appgate : Info : SiteStatus {\"simple_setup Site\":{\"gw-id\":\"gateway-7a56989e-5682-4917-9b3c-f0d8032e9a3a-site1\",\"host\":\"envy-172-17-140-2.devops\",\"ip\":\"172.17.140.2\",\"status\":\"connected\",\"error\":null,\"code\":0,\"protocol-version\":1}}\n12-21 15:48:27.566  2400  2400 I Appgate : Info : TUN connected on site 'simple_setup Site'.\n12-21 15:48:27.567  2400  2400 I Appgate : Info : Site connection recovered on 'simple_setup Site'.\n12-21 15:48:27.568  2400  2630 V Appgate : [simple_setup Site] RunPacketLoop\n12-21 15:48:27.703  2400  2630 V Appgate : [simple_setup Site] SENDTO\n12-21 15:48:27.703  2400  2630 V Appgate : [simple_setup Site] Compression: 0\n12-21 15:48:27.704  2400  2630 I Appgate : Info : SendTo reply {\"id\":null,\"site-id\":\"simple_setup Site\",\"message\":{\"error\":{\"code\":3,\"message\":\"claimstoken_invalid\"},\"id\":13377331,\"jsonrpc\":\"2.0\"}}\n12-21 15:48:27.904  2400  2699 I Appgate : Info : Logging in to gateway 'envy-172-17-140-2.devops'.\n12-21 15:48:27.907  2400  2400 I Appgate : Info : SendTo {\"id\":null,\"site-id\":\"simple_setup Site\",\"message\":{\"jsonrpc\":\"2.0\",\"method\":\"login\",\"params\":{\"claimsToken\":\"eyJhbGciOiJSUzUxMiIsInppcCI6IkRFRiIsInR5cCI6IkpXVCJ9.eJytVtfOo1gSfpf/lvaYcEgttbQYm2STwYBXc0E45GSyGfW7L9272p0H2LtS6TuVT33119fUVbCVk6/vX3HCYCRJJCcIk+QEMAw9MSgenwg2TFI6wtMIJF/fvopxnOEvPI5i9AnDTzjmYOA7oL6T+B8YQ70ODNz6YoDj30H430AU/guUFONUtNlcjDlMtLCBB5zXflAolrB4mFAEYHCSohgGZY+wQiKJABuC8NuBibrom+7+qLs4rH+5a+Ph008w4euwaA63f3314afuwl9hYqEkxkmyv16j5yLJakjV+waga49v2WgSNDXR27b1sZFktkVY9eh15dpUK0NorVuMCq6G0FABGlx3Noi6VcJ55EIrs9AR7JvgZ7EQrSbvTOycokw51H2akF3P3gntPsRnNElqjX+BxcYmE6RTMWPd7p6LWLeJBUOBmeiqMUc8F7/6LbpFRXrH5OpGR2rk3Qy1vIqrsNoMnpW41dICNk5lmnAivPRt17WVfclkY8Zeev6QtLca+YQeewFfGRb2agA1wkT/5E09pVXizhdbTFv+gyBP9obmgXu3EaPAROpBGkvfsJrPuilqFspuNZlnWIDRH1fgdrTzDFzpCrKxrDCEd8M57mj9SfkZGDCcENXrRjllODebhJmft+xrqb9T+LSYZK+8bfvSRaZyq731x4+jVxX8/G5Q3LXT0NU1HI4ePRWd7DxjE7KlWD1UIRDNLdbiyWxpbxtL62MUc7Z2yUZJoEPsJsirY40QJLdz/5maJ/VZo7hzH+qLOKPOYCmuosltRkjC55MUJpSht5ZkGeHPh4INZNWxdLmk54UxSEJ6A80kOJLGyxe/RGd2KGogTcGtiUve6YlVuV8KrtTP16UbzXMnhRJfYsXLtfXWhAVFKfJdfazkQzxXaHK1p8Gb3p5rLM2tCD5Q83YnD0SVUObV6WJB8s9570DoLlsvCau2HeUBrqdI2sgLjCI671xQPih2caz8RYlPCY6GS6Ble8kM2a/Mtafu1mVU6DoieGNGck/bHohHTeGNwwNildztHNESx7K4eRHvmQOugG9mY8kngqYK3ji3ecoRZSDGpZbupCCUNyuHdyh9mM4qdixIrjyFXHhyJguNW+lPdr5P1s5voZ8RVZDLouUL4Drshb3bjvq5eHGxbaNtXVr0fumMF5htMlBqIjs7yOjcN3kdREMt4jHcKSIvgRF74l28Gr7gzxMQtweJkLLIJzfI7z5Fci4jO7YaLbEQZuX17UE+T33N85PCIBB0jBxlfIq3nYvvQbjEdxuVtopq4e4oHwuEmXwrDe6Kl9nzXeQ+J8HVTy+V0vdDQOqLEkRljOdylqLJs3QMzx+J7oElmLbUHaJ/rAaSIN60vo8RRgbDlh17Ar8FwvIMuAsnZr9mGOA0m4ZseIqiMD0BPGVPERZHJ4IgkhQNmZgE2DHVR7rtqHIzVZKCxYqb8V5q3Xtj1g2EYOQxfwYpGiSEP5OuSgheZfGPy4Taoq4sCiKYerYNI2e+MCZ6S5B9Tw9vCJ9GIp7tI1/RiIpiDlL8ZoVW9wyk/ZicHCf05ROYOee9WlPC4nazHSCVYRbPMWp160MIbxGX+owxXC5IvJCvNapjpixbrSBu+bVbVvR+Dpg166xjiO99KVJq7CzypizyzraJ5HiUIRitXSGNCFXFsvswhmwcDwMId1CrJXolEA5vmPWFD9s7mwlzErh7dv2UYlcH1wrTJdQ2o2vkzmnyIkPVZF2tsoYnRan7Wp9xR0gaBlToKOLuqw6YnMkoTzGcmY+c8VJH3vIeelXg5wuXx1T7isnUxwfvNhRepaMVwrbhu311SXVniUV79SExRiKCWkqu2maIGGPnPXfEGfAe5SM6zW4ofOh3WoYhLGzpUYavwS4lWbnu8v6sRJpgVWlYlYnR56tS8ySc23rb80ADETHLqnTem49yVzD+vI6QAvfWQvTMn1W7z01RrtOq7SFhP/VEeAKvaSfBthdhNB5pQ+MpY9Z5YRmy++A12/C9K73w/XhWcJqfK7x6jJyhw+FRVuJbb0RXSYJih6jKypZgvDlUjqoLpyGFQR9LVmmyow13t0yPbWtj4kZ0Al2U01vnRWp/kzml4sTbZFV+irbLY0iVkko342qZP75+/vz21R/02f6PQ2ETFvUh/fPr4Nt/TGFUw/GPuGu+/vz2lRbDOP2HtI8NFn2Ob1GH/1U5v8GHLsx+WSoS2E7F9DGGbjnk4fe9EZEwpOMUPVGQJk8YBsGJZVDihDIoiqNozIYU9X88E478it/3AEgZNqaZE3s8PQEa0ofEghN52IkZKiEgwA+38wiH9t/eDjOHYgqz37UY4TT3X3/+/PkvlgX85A==.SLxNj8JFmaTa6WkHuXDEeAY/Dvlyb61lIBiEk0qUeBY/vWUMsF7IM9qGdncyXkkft0yuy7uxiqJE7yogGmrrX/v3ETTRHM+IkEHG4cpZEzuqelrGNx/bahkEeDv2Lc22kGbNdidSkAzkZz2CjuSDR6G4p18n57XgTpsfan3NPsPPJ6CGomQUATRI5KLNCeV3+QupJTihYnD255D7pqT/63wdmojxOQDyDszAva/9ooZHKJyGvtIGC+I1Uv10Lsa8DuSy3vTj5VPXwJw8WEx1tz7wN6IoxGox+63thSezk2xgr4oyUD91bd6NPIjmvodwrjPOQCxTFNubS2yvN5WRr7Or4CXXxhx61lpWLcd9olo2E+vwRP+gDwFmimQQVX0PGJ8QaFX3tu5UHUbyiCLHUt2D7DssUMTbRb0qq+GEOMp0Mrx9zBTys7UsVt6wp55WYj2e7j5l77GbWuQPUKBT/t0fOBhf5fITK9Hui8gidFqB83CetimyPI8s9qyI5QUj2LXEutc4r1GiVWNqQMevz9xmiSZzXypjBpEL+WvP7mFX7dCWeiTagW7WPXARwx/NsrBwd1ZD38aXBcJiOXVwnRLnbI1Lb5a+aBxUKco4U9bpcK2q4Nm3jU3hHo/qMdJyR3FZROoMN8VOOw9qmwo4IHRCyfw6kYj2w38WBlcErQE=\",\"entitlementToken\":\"eyJhbGciOiJSUzUxMiIsInppcCI6IkRFRiIsInR5cCI6IkpXVCJ9.eJylk2tr2zAYhf+LPkeeJEvx5dtGs9ZhpGV1Ye0IQTenIr6oke0uhPz3SmkozWBbYQhkOO8jnXOwvQd9t9FtoUAOkhTHGBMOE1RVkBKSQU5TBRmTGddapCJDYAKMc4MOPEE4gZhAgktMczrNGYlilDx4Rv+yZqvdb1BygkiaBUjW3DSufPOXKsWMxQpqrRSkGCOYIiJhnHFVJYJUgip/jNd1J3mvVWFBvgcj9Ucxi5Bf2I/H6dEV4VyJNEenhSnyGzj4aG1v+lo3/vmFO62+d0Nv2jXIK147fTb3+X/uQcsb7a90prG1XjndD3Y1W5Srq7K8CXFkb7r2Fe13NqCF/Syldu5t6rWQ+tkLbhAnqpd2NVgvPXbuaAVwQiKcRDhOIgKWE2C77esgRWB58IIyztZ8t/h7Itm1ygTbb93ayODdqvdyuHJ5mPy52U2xuPyfZkY2/6oWyOMAQcLYh9qdUn2s3fJcAVdPl9Vds50/PRbsq76e19fjLLuY34KzF34rt8aGwKDY3F+4WW02xTi9323uFB/ED/Np9Pzaf3vPfFeoY35KkqziGYdC8PDTVBkUWAoYx7GqEE8lo9jXewGQgRAI.k6N6FCiUyy2cf4CBwf21hGEnOYJWds8OzxyDVzOcX7BM25G3P90D86N2wQPQz1JpAZY7uL8bzE7JY3YhMEeeIX9Hjoc2laVpTrv0vWm5Mch9L1skn5NT7JHAvsKkDyPBVq7hI/cTzxB+mNGt3mnskZHTDorjlISR8bamRmDnujUUp3j3\n12-21 15:48:27.907  2400  2400 V Appgate : [simple_setup Site] UpdateCachedTokens: method: login\n12-21 15:48:27.907  2400  2400 V Appgate : [simple_setup Site] UpdateCachedTokens: updated\n12-21 15:48:27.916  2400  2630 V Appgate : [simple_setup Site] SENDTO\n12-21 15:48:27.916  2400  2630 V Appgate : [simple_setup Site] Compression: 0\n12-21 15:48:27.917  2400  2630 I Appgate : Info : SendTo reply {\"id\":null,\"site-id\":\"simple_setup Site\",\"message\":{\"error\":{\"code\":3,\"message\":\"claimstoken_invalid\"},\"id\":2,\"jsonrpc\":\"2.0\"}}\n12-21 15:48:28.908  2400  2476 W Appgate : Warn : Gateway 'envy-172-17-140-2.devops' rejected the claims token. Will get a new claims token from controller. Reason: ClaimsTokenInvalid\n12-21 15:48:29.911  2400  2446 I Appgate : Info : Retrieving claims token.\n12-21 15:48:29.911  2400  2446 I Appgate : Info : Fetching on-boarding cookie for 'OnBoardingCookie-44:c2:36:94:7f:ed:80:66:ee:4c:b0:af:00:ab:93:df:b3:c7:21:6a:31:86:87:94:99:6e:29:b5:e1:f8:c6:ae-local-bob' from secure storage.\n12-21 15:48:29.923  2400  2446 I Appgate : Info : On-boarding cookie available for 'OnBoardingCookie-44:c2:36:94:7f:ed:80:66:ee:4c:b0:af:00:ab:93:df:b3:c7:21:6a:31:86:87:94:99:6e:29:b5:e1:f8:c6:ae-local-bob'.\n12-21 15:48:29.925  2400  2446 I Appgate : Info : Existing REST connection lost. Reconnecting.\n12-21 15:48:29.925  2400  2446 I Appgate : Info : Resolving hostname '172.17.140.1'\n12-21 15:48:29.925  2400  2446 I Appgate : Info : Trying to connect '/172.17.140.1' with SPA UdpTcp and key name 'Built-in-be85360895242'.\n12-21 15:48:29.925  2400  2446 V Appgate : shim_connect(): Connecting to TLS://|172.17.140.1:443 (tunnel: no) ...\n12-21 15:48:29.927  2400  2709 V Appgate : Sending SPA data encapsulated in a DNS query\n12-21 15:48:29.927  2400  2709 V Appgate : Sending DTLS ClientHello with SPA extension\n12-21 15:48:30.728  2400  2446 V Appgate : shim_connect(): Connected to /172.17.140.1\n12-21 15:48:30.731  2400  2710 V Appgate : shim_ssl_connect(): Verification enabled for IP: 172.17.140.1\n12-21 15:48:30.832  2400  2710 V Appgate : TLS alert write:fatal:unknown CA\n12-21 15:48:30.833  2400  2710 V Appgate : connection_thread(): 0x981c0000 write(connect) failed\n12-21 15:48:30.835  2400  2446 I Appgate : Info : REST connection could not be established. 'Invalid certificate provided.'. Will try the next IP address.\n12-21 15:48:30.838  2400  2446 E Appgate : Error : SSL certificate of controller 'https://172.17.140.1/' is not accepted. Will check next CA certificate. Reason: Invalid certificate provided."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "OK, I debugged a bit and it looks like it verifies just fine. The logs above happen when sessiond is restarted but not yet vpnd with the new CA. My emulator reconnects too quickly I suppose."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "However, shim returns ERR\\"
                },
                {
                  "type": "text",
                  "text": "CONNECT\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "CERT\\"
                },
                {
                  "type": "text",
                  "text": "ERROR which is the same code we use for VPN cert failure. That still works but makes the client do some extra unnecessary rounds.",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Either, the assumption is wrong and VPN cert error happens with ERR\\"
                },
                {
                  "type": "text",
                  "text": "CONNECT\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "SSL\\"
                },
                {
                  "type": "text",
                  "text": "ERROR or shim needs to return a different error for bad server certificate.",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1514046335135
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Maybe add the extra error handling on to this commit? "
                },
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2627",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-client-shared/pull/2627"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1514538588254
      }
    ]
  },
  {
    "key": "SA-6933",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "When I go on the UI, appliances, and click download logs, I get an error saying that the controller is offline."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "This is what happens on the appliance. It never seems to reach configd at all."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Dec 21 14:39:53 envy-172-17-158-1.devops cz-managed[3252]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Authentication (controller-connector)\" 1\nDec 21 14:39:53 envy-172-17-158-1.devops cz-managed[3252]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Authorization (controller-connector)\" 1\nDec 21 14:39:53 envy-172-17-158-1.devops cz-authd[3121]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Management (controller-connector)\" 0\nDec 21 14:39:53 envy-172-17-158-1.devops cz-identityd[3196]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Authentication (controller-connector)\" 1\nDec 21 14:39:53 envy-172-17-158-1.devops cz-identityd[3196]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Authorization (controller-connector)\" 0\nDec 21 14:39:53 envy-172-17-158-1.devops cz-authord[3912]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Management (controller-connector)\" 1\nDec 21 14:39:53 envy-172-17-158-1.devops cz-authd[3121]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET /healthcheck HTTP/1.1\" 200 126 \"-\" \"python-requests/2.14.2\" 10\nDec 21 14:39:53 envy-172-17-158-1.devops cz-authord[3912]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET /healthcheck HTTP/1.1\" 200 145 \"-\" \"python-requests/2.14.2\" 12\nDec 21 14:39:53 envy-172-17-158-1.devops cz-managed[3252]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Identity (controller-connector)\" 1\nDec 21 14:39:53 envy-172-17-158-1.devops cz-identityd[3196]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Management (controller-connector)\" 0\nDec 21 14:39:53 envy-172-17-158-1.devops cz-managed[3252]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET /healthcheck HTTP/1.1\" 200 210 \"-\" \"python-requests/2.14.2\" 15\nDec 21 14:39:53 envy-172-17-158-1.devops cz-identityd[3196]: 127.0.0.1 - - [21/Dec/2017:14:39:53 +0000] \"GET /healthcheck HTTP/1.1\" 200 107 \"-\" \"python-requests/2.14.2\" 9\nDec 21 14:39:56 envy-172-17-158-1.devops nginx[4587]: 192.168.100.87 - - [21/Dec/2017:14:39:56 +0000] \"GET /admin/appliances/0e7bb42e-9753-48a8-911a-5dba2a6a3190/logs HTTP/2.0\" 406 161 \"https://envy-172-17-158-1.devops:444/ui/appliances\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36\"\nDec 21 14:39:56 envy-172-17-158-1.devops cz-managed[3252]: 192.168.100.87 - - [21/Dec/2017:14:39:56 +0000] \"GET /peer/appliances/0e7bb42e-9753-48a8-911a-5dba2a6a3190/logs HTTP/1.0\" 406 161 \"https://envy-172-17-158-1.devops:444/ui/appliances\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36\" 6\nDec 21 14:40:03 envy-172-17-158-1.devops cz-managed[3252]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Identity (controller-connector)\" 1\nDec 21 14:40:03 envy-172-17-158-1.devops cz-managed[3252]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Authorization (controller-connector)\" 1\nDec 21 14:40:03 envy-172-17-158-1.devops cz-authord[3912]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET /healthcheck HTTP/1.1\" 200 145 \"-\" \"python-requests/2.14.2\" 8\nDec 21 14:40:03 envy-172-17-158-1.devops cz-identityd[3196]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Authorization (controller-connector)\" 1\nDec 21 14:40:03 envy-172-17-158-1.devops cz-identityd[3196]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET /healthcheck HTTP/1.1\" 200 107 \"-\" \"python-requests/2.14.2\" 9\nDec 21 14:40:03 envy-172-17-158-1.devops cz-managed[3252]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Authentication (controller-connector)\" 0\nDec 21 14:40:03 envy-172-17-158-1.devops cz-identityd[3196]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Authentication (controller-connector)\" 0\nDec 21 14:40:03 envy-172-17-158-1.devops cz-authd[3121]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET /healthcheck HTTP/1.1\" 200 126 \"-\" \"python-requests/2.14.2\" 5\nDec 21 14:40:03 envy-172-17-158-1.devops cz-authd[3121]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Management (controller-connector)\" 1\nDec 21 14:40:03 envy-172-17-158-1.devops cz-authord[3912]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Management (controller-connector)\" 1\nDec 21 14:40:03 envy-172-17-158-1.devops cz-identityd[3196]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET / HTTP/1.1\" 404 0 \"-\" \"Service.Management (controller-connector)\" 1\nDec 21 14:40:03 envy-172-17-158-1.devops cz-managed[3252]: 127.0.0.1 - - [21/Dec/2017:14:40:03 +0000] \"GET /healthcheck HTTP/1.1\" 200 210 \"-\" \"python-requests/2.14.2\" 10"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It's a UI issue where it doesn't send the "
                },
                {
                  "type": "text",
                  "text": "......appgate-zip",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " (it sends ....appgate-json which was working until this version). It's fixed in the new UI. We're not maintaining the old UI."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1513868993124
      }
    ]
  },
  {
    "key": "SA-6909",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2017-12-19T10:31:55.608Z] Info : UI has connected to service.\n[2017-12-19T10:31:55.803Z] Info : UI is ready.\n[2017-12-19T10:31:55.804Z] Info : UI connected.\n[2017-12-19T10:31:55.824Z] Info : Setting locale to en-US.\n[2017-12-19T10:31:55.883Z] Info : Connecting to TUN driver.\n[2017-12-19T10:31:55.886Z] Info : Setting log level of TUN driver to Info.\n[2017-12-19T10:31:55.940Z] Info : Setting controller URL to 'https://envy-172-17-140-1.devops/'.\n[2017-12-19T10:31:55.945Z] Info : CA certificate found in the storage for 'envy-172-17-140-1.devops'.\n[2017-12-19T10:31:55.949Z] Info : Resolving hostname 'envy-172-17-140-1.devops'\n[2017-12-19T10:31:55.962Z] Info : Trying to connect 'envy-172-17-140-1.devops/172.17.140.1' with SPA UdpTcp and key name 'Built-in-be85360895242'.\n[2017-12-19T10:31:56.603Z] Info : Using Controller API V4\n[2017-12-19T10:31:56.623Z] Info : Certificate is already trusted. Moving on..\n[2017-12-19T10:31:56.630Z] Info : Retrieving provider names from controller.\n[2017-12-19T10:31:56.658Z] Info : Provider names: [local]\n[2017-12-19T10:31:56.679Z] Info : Provider 'local' selected.\n[2017-12-19T10:31:56.682Z] Info : User input required for 'ConnectCredentialsLoginHandler'.\n[2017-12-19T10:32:07.506Z] Info : User input required for 'ControllerUrlLoginHandler'.\n[2017-12-19T10:32:08.600Z] Info : Received a new URL config from user. Parsing..\n[2017-12-19T10:32:08.620Z] Info : URL config parsed. SPA mode: UdpTcp, Name: CryptZone\n[2017-12-19T10:32:08.623Z] Info : Setting controller URL to 'https://purple.cryptzone.com/'.\n[2017-12-19T10:32:08.628Z] Info : No CA certificate found in storage. Retrieving from controller.\n[2017-12-19T10:32:08.631Z] Info : Resolving hostname 'purple.cryptzone.com'\n[2017-12-19T10:32:08.673Z] Info : Trying to connect 'purple.cryptzone.com/35.157.222.129' with SPA UdpTcp and key name 'CryptZone'.\n[2017-12-19T10:32:12.685Z] Info : Using Controller API V4\n[2017-12-19T10:32:12.728Z] Info : Resolving hostname 'purple.cryptzone.com'\n[2017-12-19T10:32:12.732Z] Info : Trying to connect 'purple.cryptzone.com/35.157.222.129' with SPA UdpTcp and key name 'CryptZone'.\n[2017-12-19T10:32:13.743Z] Info : Using Controller API V4\n[2017-12-19T10:32:13.762Z] Info : Storing new SPA config.\n[2017-12-19T10:32:13.941Z] Info : User input required for 'TrustCertificateLoginHandler'.\n[2017-12-19T10:32:17.372Z] Info : Certificate accepted. Storing it.\n[2017-12-19T10:32:17.476Z] Info : User input required for 'IdentityProviderLoginHandler'."
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-6859",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "This is to be able to download and verify the upgrade file in advance of the actual upgrade."
            }
          ]
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  "
                    },
                    {
                      "type": "text",
                      "text": "POST /upgrade/prepare {\"image-url\": \"[file://..](file://..).\"}",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  "
                    },
                    {
                      "type": "text",
                      "text": "POST /upgrade {\"image-url\": \"file://<name>\"}",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": " Will use a relative path to install the upgrade image previously prepared. This will also verify the upgrade file and run the actual upgrade. This returns with HTTP 202 and an upgrade id."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "The image-url now supports specifying a controller with the "
                    },
                    {
                      "type": "text",
                      "text": "controller://<hostname>:<port>/<name>",
                      "marks": [
                        {
                          "type": "code"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": " scheme."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Download the upgrade file from the controller and verify it (checksum, signature etc...). This returns with HTTP 202 and an upgrade id."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "This API needs to be reflected on the controller on a per appliance level."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I think checking signature is already enough by itself no?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1513250725216
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Also, how do we get the expected checksum?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1513250736820
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I think checking signature is already enough by itself no?"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "True"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Also, how do we get the expected checksum?"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It's already there in the zip."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1513253902992
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The cyxtera keyring is in /usr/share/keyrings/cyxtera-keyring.pgp"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "You need to pass it to gpg to use that one to verify the signature. (You probably need to rebase)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1513330130359
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1753",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1753"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Add POST /upgrade/prepare route. This will download the upgrade file but"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "not actually install it. The upgrade can be resumed from the installed upgrade"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "file later."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Added cz-config upgrade –prepare flag to use this feature from the command line."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The cz-config upgrade command now waits for the upgrade to complete, printing the upgrade"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "status changes along the way."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Added cz-config upgrade –no-wait flag to return to the previous behavior."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The upgrade now returns an error if the destination file for an upgrade file download already exists."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The upgrade download now supports downloading the upgrade file from a controller using appliance"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "authentication."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Example usage with cz-config:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Prepare"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-172-17-132-2:~# cz-config upgrade --prepare https://testyd.ad.cryptzone.com:443/testsd/project/7/StratusAppliance_BuildStratusAppliance_2/master/artifact/appgate-4.0.0-8105-master.img.zip?is-build-type-id\nUpgrade status changed to downloading: https://testyd.ad.cryptzone.com:443/testsd/project/7/StratusAppliance_BuildStratusAppliance_2/master/artifact/appgate-4.0.0-8105-master.img.zip?is-build-type-id\nUpgrade status changed to ready: /mnt/data/download/appgate-4.0.0-8105-master.img.zip"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Install"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-172-17-132-2:~# cz-config upgrade --no-reboot /mnt/data/download/appgate-4.0.0-8105-master.img.zip\n\nAppliance upgrade started using /mnt/data/download/appgate-4.0.0-8105-master.im\ng.zip...                                                                               \nUpgrade status changed to installing: /mnt/data/download/appgate-4.0.0-8105-master.img.zip\n\nAppliance upgrade done, a reboot is required for the upgrade to go into effect.                                                                               \nUpgrade status changed to success: a reboot is required for the upgrade to go into effect"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1513686975094
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1786",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1786"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-controller/pull/1267",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-controller/pull/1267"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1516177389872
      }
    ]
  },
  {
    "key": "SA-6802",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "1> Add help URLs for the pages in the manual. This will make it easy to maintain all manual related text and link in one place - and make sure things end up in the right place."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "So for the Sites example "
            },
            {
              "type": "text",
              "text": "https://help.cryptzone.com/adminguide/v3.3/sites-configure.html",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://help.cryptzone.com/adminguide/v3.3/sites-configure.html"
                  }
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "2> Do something so it is easy to (automatically) to insert / change the the v3.3 according to the version being built?"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hum on the frontend it is easier if we keep the URL as it is right now. We are composing the URL on everypage using"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "const URL_base =  'https://help.cryptzone.com/adminguide'\nconst version = '3.3'\nconst directory = 'sites-configure'\n\nreturn final_URL = '{URL_base}/{version}/{directory}.html'"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " And we can also export these constants aside of the "
                },
                {
                  "type": "text",
                  "text": "helper-text.json",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "hadrien.luttiau",
        "created": 1512564094480
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ok but the version should be 3.3 in the above case as we don't plan on supporting point releases. So you would limit the version to x.y and strip any .z"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1513093241806
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yes it is actually without the "
                },
                {
                  "type": "text",
                  "text": ".z",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " I don't know why I added it. I'll update"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "hadrien.luttiau",
        "created": 1513093392057
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Move these variables into the json file at the top."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1513243687267
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Add language info"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1513245109542
      }
    ]
  },
  {
    "key": "SA-6721",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Clicking the custom URL through Windows 10 mail app delivers wrong base64 to AppGate. Apparently there is some mess with URL and base64. We probably need to URL\\"
            },
            {
              "type": "text",
              "text": "encode(base64(data)) or some trick of some sort to avoid the confusions",
              "marks": [
                {
                  "type": "em"
                }
              ]
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2017-11-27T21:27:26.284Z] Info : UI has connected to service.\n[2017-11-27T21:27:26.448Z] Info : UI is ready.\n[2017-11-27T21:27:26.449Z] Info : UI connected.\n[2017-11-27T21:27:26.457Z] Info : Connecting to TUN driver.\n[2017-11-27T21:27:26.461Z] Info : Setting log level of TUN driver to Info.\n[2017-11-27T21:27:26.477Z] Info : Setting locale to en-US.\n[2017-11-27T21:27:26.531Z] Info : Received a URL config from storage. Parsing..\n[2017-11-27T21:27:26.533Z] Warn : Invalid URL config received. Invalid length for a Base-64 char array or string.. config: eyJzcGEiOnsibW9kZSI6IlVEUC1UQ1AiLCJuYW1lIjoiQ3J5cHRab25lIiwia2V5IjoiY2QzMzdiMmE1OTU1Yjg3OTk3YzlkYzRjNGRhZTM1ZDRmNTA1ZTE0ZmZhZWU3NWFlZjVhZDZhZjQ1M2M5ODgyOCJ9fQ\n[2017-11-27T21:27:26.534Z] Info : Setting controller URL to 'https://purple.cryptzone.com/'.\n[2017-11-27T21:27:26.544Z] Info : CA certificate found in the storage for 'purple.cryptzone.com'.\n[2017-11-27T21:27:26.548Z] Info : Resolving hostname 'purple.cryptzone.com'\n[2017-11-27T21:27:26.634Z] Info : Trying to connect 'purple.cryptzone.com/35.157.222.129' with SPA UdpTcp and key name 'Built-in-be85360895242'.\n[2017-11-27T21:27:27.209Z] Info : Trying to connect 'purple.cryptzone.com/35.157.235.196' with SPA UdpTcp and key name 'Built-in-be85360895242'.\n[2017-11-27T21:27:27.519Z] Error : First connection to controller 'https://purple.cryptzone.com/' has failed. Details: Connection failed.\n[2017-11-27T21:27:27.523Z] Info : User input required for 'ControllerUrlLoginHandler'."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "On linux it seems to be passed correctly, I haven't seen such error, so I don't think it's related."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1511858899212
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Natan Abolafya",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/natan.abolafya",
                        "title": "natan.abolafya"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " checked and confirmed"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "Roy.nard",
        "created": 1512986982655
      }
    ]
  },
  {
    "key": "SA-6501",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[16:14:19][Step 1/1] java (3s)\n[16:14:19][java] make[1]: Entering directory '/home/builderbob/buildAgent/work/81fe2044905f47d9/java'\n[16:14:19][java] fakeroot ./build.sh\n[16:14:19][java] --2017-10-30 15:14:20--  http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/server-jre-8u144-linux-x64.tar.gz\n[16:14:20][java] Resolving download.oracle.com (download.oracle.com)... 80.239.237.17, 80.239.237.8\n[16:14:20][java] Connecting to download.oracle.com (download.oracle.com)|80.239.237.17|:80... connected.\n[16:14:20][java] HTTP request sent, awaiting response... 302 Moved Temporarily\n[16:14:20][java] Location: https://edelivery.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/server-jre-8u144-linux-x64.tar.gz [following]\n[16:14:20][java] --2017-10-30 15:14:20--  https://edelivery.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/server-jre-8u144-linux-x64.tar.gz\n[16:14:20][java] Resolving edelivery.oracle.com (edelivery.oracle.com)... 2.23.151.234, 2a02:26f0:18:499::2d3e, 2a02:26f0:18:489::2d3e\n[16:14:20][java] Connecting to edelivery.oracle.com (edelivery.oracle.com)|2.23.151.234|:443... connected.\n[16:14:20][java] HTTP request sent, awaiting response... 302 Moved Temporarily\n[16:14:20][java] Location: http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/server-jre-8u144-linux-x64.tar.gz?AuthParam=1509376580_943c57005242c86ea2e8833269dbd91e [following]\n[16:14:20][java] --2017-10-30 15:14:20--  http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/server-jre-8u144-linux-x64.tar.gz?AuthParam=1509376580_943c57005242c86ea2e8833269dbd91e\n[16:14:20][java] Connecting to download.oracle.com (download.oracle.com)|80.239.237.17|:80... connected.\n[16:14:23][java] HTTP request sent, awaiting response... 404 Not Found\n[16:14:23][java] 2017-10-30 15:14:23 ERROR 404: Not Found.\n[16:14:23][java]\n[16:14:23][java] make[1]: *** [package] Error 8"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This is a file and not an APT package so that would need to be hosted on some file server."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1509439380308
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I see it's http as well, no https link available from oracle?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1509439407353
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https works fine too actually, but no real point in using it as we check against checksum anyway"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1509610358362
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "From where do we get the ckecksum, so that we can do the comparison actually? Obviously if it is downloaded as well from the internetz through http then doesn't add any security..."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1509612030455
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "We use the checksum provided by Oracle, which we check manually each time."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1509612917569
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://www.oracle.com/webfolder/s/digest/8u151checksum.html",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.oracle.com/webfolder/s/digest/8u151checksum.html"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1509613070253
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "We could host the binaries in nexus (akira) which seems to have binary capabilities."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1510216049265
      }
    ]
  },
  {
    "key": "SA-6465",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2017-10-25T14:10:33.714Z] Info : Recieved requested configuration '{\n  \"username\": null,\n  \"password\": null,\n  \"controllerurl\": \"appgate://envy-172-17-114-1.devops/eyJzcGEiOnsibW9kZSI6IlVEUC1UQ1AiLCJuYW1lIjoidGVzdCIsImtleSI6ImIxZTM4ZmE0MDRjNTZmNjI4NDc1MmUxYzQ3ZTVlNjcxNzdjNjhlOGJmNmQ4N2VkMjAwMTNlZTU5NDc4MDdhZWIifX0=\",\n  \"identityProvider\": null,\n  \"trustedCertificatePath\": null,\n  \"authenticationCertificateName\": null,\n  \"authenticationCertificatePassword\": null\n}'\n[2017-10-25T14:10:33.794Z] Info : Trying to connect 'envy-172-17-114-1.devops/172.17.114.1' with SPA UdpTcp and key name 'test'.\n[2017-10-25T14:10:37.199Z] Info : Using Controller API V4\n[2017-10-25T14:10:37.199Z] Info : Storing new SPA config.\n[2017-10-25T14:10:37.209Z] Info : Certificate is already trusted. Moving on..\n[2017-10-25T14:10:37.309Z] Info : Retrieving provider names from controller.\n[2017-10-25T14:10:37.349Z] Info : Provider names: [AD, local]\n[2017-10-25T14:10:37.349Z] Info : User input required for 'IdentityProviderLoginHandler'.\n[2017-10-25T14:10:37.349Z] Info : Provider 'local' selected.\n[2017-10-25T14:10:37.449Z] Info : User input required for 'ConnectCredentialsLoginHandler'.\n[2017-10-25T14:10:37.449Z] Info : Logging in using 'local'.\n[2017-10-25T14:10:37.459Z] Info : Authenticating for the first time. RememberMe: False, Credentials: [Username '']\n[2017-10-25T14:10:37.459Z] Info : Retrieving claims token.\n[2017-10-25T14:10:37.469Z] Info : Fetching on-boarding cookie for 'OnBoardingCookie-66:aa:47:ad:6e:ba:b0:aa:99:4c:9a:ff:75:fb:39:5d:ec:82:58:a5:b3:4a:f6:4d:c3:6e:61:c1:28:29:2b:d3-local-' from secure storage.\n[2017-10-25T14:10:37.469Z] Info : No on-boarding cookie found.\n[2017-10-25T14:10:37.559Z] Warn : Controller 'https://envy-172-17-114-1.devops/' rejected authentication on login."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Well, after that it rejects any connection attempts from plap."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1508946750330
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "\\[2017-10-26T07:51:57Z\\] Warn : \\[ConnectableCredential::ConnectAndCheckConfiguration:453\\] Service is not correctly configured\n\n\\[2017-10-26T07:51:57Z\\] Error : \\[ConnectableCredential::GetSerialization:675\\] There was an error with status '5' during login to AppGate"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1509004373309
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ok, failure turned out to be irrelevant. However, authenticating with empty username is not a good idea. Maybe it's not audit logged (because of empty username) but still, each PLAP client will basically spam the controller for no reason."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1509009395124
      }
    ]
  },
  {
    "key": "SA-6340",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Oct 12 06:53:23 envy-172-17-100-2.devops cz-configd[13168]: INFO [ActionsRunner] SaveStateLabelAction done\nOct 12 06:53:23 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"POST /configuration HTTP/1.0\" 204 0 \"\" \"Service.Management (appliance-connector)\" 460\nOct 12 06:53:24 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 562 \"\" \"Service.Management (appliance-connector)\" 433\nOct 12 06:53:53 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"POST /event HTTP/1.0\" 204 0 \"\" \"python-requests/2.14.2\" 0\nOct 12 06:53:54 envy-172-17-100-2.devops cz-configd[13168]: INFO [StateMachine] Received event BDRNodeKickedEvent(pull_config=False, delay=10), transitioning from state waiting_bdr_removal to appliance_ready\nOct 12 06:53:54 envy-172-17-100-2.devops cz-configd[13168]: INFO Leaving BDR group and disabling controller\nOct 12 06:53:54 envy-172-17-100-2.devops cz-configd[13168]: INFO [ActionsRunner] Running action LeaveBDRGroupAction(node_name='envy-172-17-100-2.devops') ...\nOct 12 06:53:54 envy-172-17-100-2.devops cz-configd[13168]: INFO [LeaveBDRGroupAction] Leaving BDR group...\nOct 12 06:54:01 envy-172-17-100-2.devops cz-configd[13168]: INFO [postgresql] Dropping bdr extension in database controller_authorization\nOct 12 06:54:01 envy-172-17-100-2.devops cz-configd[13168]: INFO [postgresql] Dropping btree_gist extension in database controller_authorization\nOct 12 06:54:08 envy-172-17-100-2.devops cz-configd[13168]: INFO [postgresql] Dropping bdr extension in database controller_identity\nOct 12 06:54:08 envy-172-17-100-2.devops cz-configd[13168]: INFO [postgresql] Dropping btree_gist extension in database controller_identity\nOct 12 06:54:10 envy-172-17-100-2.devops cz-configd[13168]: INFO [postgresql] Dropping bdr extension in database controller_management\nOct 12 06:54:10 envy-172-17-100-2.devops cz-configd[13168]: INFO [postgresql] Dropping btree_gist extension in database controller_management\nOct 12 06:54:10 envy-172-17-100-2.devops cz-configd[13168]: INFO [postgresql] Dropping bdr supervisor database\nOct 12 06:54:10 envy-172-17-100-2.devops cz-configd[13168]: INFO [ActionsRunner] LeaveBDRGroupAction done\nOct 12 06:54:10 envy-172-17-100-2.devops cz-configd[13168]: INFO [ActionsRunner] Running action ApplyServicesAction(force=True) ...\nOct 12 06:54:10 envy-172-17-100-2.devops cz-configd[13168]: INFO [ApplyServicesAction] Applying services configuration with current configuration /mnt/state/config/20171012-065323-ek6hq45n and previous configurat\nOct 12 06:54:10 envy-172-17-100-2.devops cz-configd[13168]: INFO [service] cz-proxyd stop (reason: base system, service is disabled)\nOct 12 06:54:10 envy-172-17-100-2.devops cz-configd[13168]: INFO [service] postgresql@9.4-main stop (reason: controller, service is disabled)\nOct 12 06:54:13 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 521 \"\" \"Service.Management (appliance-connector)\" 408\nOct 12 06:54:18 envy-172-17-100-2.devops cz-configd[13168]: INFO [service] cz-authd stop (reason: service is disabled)\nOct 12 06:54:19 envy-172-17-100-2.devops cz-configd[13168]: INFO [service] cz-authord stop (reason: service is disabled)\nOct 12 06:54:19 envy-172-17-100-2.devops cz-configd[13168]: INFO [service] cz-identityd stop (reason: service is disabled)\nOct 12 06:54:19 envy-172-17-100-2.devops cz-configd[13168]: INFO [service] cz-managed stop (reason: service is disabled)\nOct 12 06:54:19 envy-172-17-100-2.devops cz-configd[13168]: INFO [service] cz-elasticrestore start (reason: log server, service is enabled, required files are present)\nOct 12 06:54:20 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 511 \"\" \"Service.Management (appliance-connector)\" 171\nOct 12 06:55:21 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 521 \"\" \"Service.Management (appliance-connector)\" 408\nOct 12 06:56:20 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 512 \"\" \"Service.Management (appliance-connector)\" 161\nOct 12 06:57:20 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 512 \"\" \"Service.Management (appliance-connector)\" 161\nOct 12 06:58:20 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 512 \"\" \"Service.Management (appliance-connector)\" 162\nOct 12 06:59:21 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 521 \"\" \"Service.Management (appliance-connector)\" 409\nOct 12 07:00:20 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 512 \"\" \"Service.Management (appliance-connector)\" 165\nOct 12 07:01:20 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 512 \"\" \"Service.Management (appliance-connector)\" 163\nOct 12 07:02:20 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 512 \"\" \"Service.Management (appliance-connector)\" 163\nOct 12 07:03:20 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 512 \"\" \"Service.Management (appliance-connector)\" 165\nOct 12 07:04:20 envy-172-17-100-2.devops cz-configd[13168]: INFO [rest] \"GET /status HTTP/1.0\" 200 512 \"\" \"Service.Management (appliance-connector)\" 159\nOct 12 07:05:19 envy-172-17-100-2.devops systemd[1]: Stopping AppGate appliance configuration daemon...\nOct 12 07:05:19 envy-172-17-100-2.devops systemd[1]: Stopped AppGate appliance configuration daemon.\nOct 12 07:05:19 envy-172-17-100-2.devops systemd[1]: Starting AppGate appliance configuration daemon...\nOct 12 07:05:19 envy-172-17-100-2.devops systemd[1]: Started AppGate appliance configuration daemon.\nOct 12 07:05:19 envy-172-17-100-2.devops cz-configd[8370]: INFO [logger] Set log level to info\nOct 12 07:05:19 envy-172-17-100-2.devops cz-configd[8370]: INFO [config-control] Starting configuration daemon...\nOct 12 07:05:19 envy-172-17-100-2.devops cz-configd[8370]: INFO [config-control] Loading appliance configuration plugin stratus...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [config-control] Starting State Machine...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [ActionsRunner] Running action InitStateMachineAction(recovery_state='waiting_bdr_removal') ...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [config-control] Starting JsonRPCActor service...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [JsonRPCEventsActor] Spawning config control thread...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [JsonRPCEventsActor] Waiting for requests...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [ActionsRunner] InitStateMachineAction done\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [ActionsRunner] Chaining event InitStateMachineEvent(recovery_state='waiting_bdr_removal', has_inbox=False)\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [StateMachine] Received event InitStateMachineEvent(recovery_state='waiting_bdr_removal', has_inbox=False), transitioning from state init to waiting\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [ActionsRunner] Running action ApplyServicesAction(force=True) ...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [config-control] Starting Seeding Thread service...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [config-control] Starting REST service on main thread...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [rest] Starting REST service on http://unix:/run/cz-configd/configd.socket ...\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [ApplyServicesAction] Applying services configuration with current configuration /mnt/state/config/20171012-065323-ek6hq45n and previous configurati\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: serving on http://unix:/run/cz-configd/configd.socket\nOct 12 07:05:20 envy-172-17-100-2.devops cz-configd[8370]: INFO [service] cz-elasticrestore start (reason: log server, service is enabled, required files are present)\nOct 12 07:05:21 envy-172-17-100-2.devops cz-configd[8370]: INFO [rest] \"GET /status HTTP/1.0\" 200 509 \"\" \"Service.Management (appliance-connector)\" 426"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Same happened to "
                },
                {
                  "type": "text",
                  "text": "Jamie Bodley-Scott",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/jamie.bodley-scott",
                        "title": "jamie.bodley-scott"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " with waiting\\"
                },
                {
                  "type": "text",
                  "text": "bdr\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "joining."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1510910984231
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "One solution would be to not save these two states to"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1517569620108
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "One solution would be to not save these two states to disk."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1517569620108
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1853",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.ad.cryptzone.com/cryptzone/stratus-appliance/pull/1853"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1517569947221
      }
    ]
  },
  {
    "key": "SA-6217",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "<13>Sep 28 12:10:29 cz-restore: Restoring ElasticSearch...\nElasticsearch is up, starting restore procedure\nThu Sep 28 12:10:29 UTC 2017\nRestoring: logstash-2017.09.27_restore\nUrl: http://localhost:9300/logstash-2017.09.27_restore\nGot none accepted status during put 400\npayload: {\"mappings\": {\"default\": {\"properties\": {\"geoip\": {\"dynamic\": true, \"type\": \"object\", \"properties\": {\"ip\": {\"type\": \"ip\"}, \"location\": {\"type\": \"geo_point\"}}}, \"@timestamp\": {\"type\": \"date\"}, \"message\": {\"index\": \"analyzed\", \"type\": \"string\"}}}}}\nTraceback (most recent call last):\n  File \"/usr/cz-elasticsearch/scripts/backup_restore.py\", line 216, in <module>\n    main()\n  File \"/usr/cz-elasticsearch/scripts/backup_restore.py\", line 213, in main\n    put_everything(args, \"http://localhost:9300\")\n  File \"/usr/cz-elasticsearch/scripts/backup_restore.py\", line 81, in put_everything\n    payload_with_meta = json.loads(line)\n  File \"/usr/lib/python3.5/json/init.py\", line 319, in loads\n    return _default_decoder.decode(s)\n  File \"/usr/lib/python3.5/json/decoder.py\", line 339, in decode\n    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n  File \"/usr/lib/python3.5/json/decoder.py\", line 357, in raw_decode\n    raise JSONDecodeError(\"Expecting value\", s, err.value) from None\njson.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)\nThu Sep 28 12:10:29 UTC 2017\nDb restore done\n<13>Sep 28 12:10:29 cz-restore: The services will be running again momentarily\nroot@envy-172-17-140-1:/mnt/data# "
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I of course can't replicate this on my env"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1507204824390
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I tried both normal and HA"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1507204837672
      }
    ]
  },
  {
    "key": "SA-6150",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Right now it can be hard to see what id corresponds to what test:"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "thomas@thomas:~$ for client in linux windows osx fedora android; do aitorbot test create -d aitorbot 403 --client $client -t testing_aitorbot_on_$client; done\nthomas:\n    id:   eb550063-0a52-49c9-9225-3521cf4609d6\n    url:  https://testrail.ad.cryptzone.com:443/index.php?/plans/view/309530\nthomas:\n    id:   b440c81b-9a35-4ede-b1fb-dfa58e661e7e\n    url:  https://testrail.ad.cryptzone.com:443/index.php?/plans/view/309536\nthomas:\n    id:   7d1e416f-03f5-475e-9a23-501f9c040765\n    url:  https://testrail.ad.cryptzone.com:443/index.php?/plans/view/309541\nthomas:\n    id:   575b35a8-dfeb-4bb1-984f-8d723e1aacab\n    url:  https://testrail.ad.cryptzone.com:443/index.php?/plans/view/309545\nthomas:\n    id:   d9b10fcb-45db-41c8-a5e0-8c83d5c04ffa\n    url:  https://testrail.ad.cryptzone.com:443/index.php?/plans/view/309549"
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-6145",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Err:4 https://dl.yarnpkg.com/debian stable InRelease             \n  The following signatures couldn't be verified because the public key is not available: NO_PUBKEY E074D16EB6FF4DE3\nGet:6 https://deb.nodesource.com/node_6.x stretch/main amd64 Packages [1005 B]                                                                                                        \nFetched 17.1 kB in 6s (2719 B/s) "
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "could you give some background here "
                },
                {
                  "type": "text",
                  "text": "Salvatore Tomaselli",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/salvatore.tomaselli",
                        "title": "salvatore.tomaselli"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1507542489744
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I tried to run updates on the chroot. This is needed since we statically link stuff, so we might need the security fixes that get released later on."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1507551585395
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "aha ok. generally we create chroot from scratch, so not a big deal."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1507552079091
      }
    ]
  },
  {
    "key": "SA-12019",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "We sitll have problems with the radix search stuff for url access, e.g. \\"
            },
            {
              "type": "text",
              "text": "/tests-dev\\",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " conflicts with \\"
            },
            {
              "type": "text",
              "text": "/tests/status\\",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": ". I set up 2 different entitlements for \\"
            },
            {
              "type": "text",
              "text": "aitorbot\\",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " and \\"
            },
            {
              "type": "text",
              "text": "aitorbot --dev-mode\\",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": ". Adding the separate \\"
            },
            {
              "type": "text",
              "text": "/tests-dev\\",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " entitlement results in: \\"
            },
            {
              "type": "text",
              "text": "\\",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": "\\"
            }
          ]
        },
        {
          "type": "heading",
          "content": [
            {
              "type": "text",
              "text": "403 Forbidden"
            }
          ],
          "attrs": {
            "level": 1
          }
        },
        {
          "type": "rule"
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "nginx"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "\\"
            },
            {
              "type": "text",
              "text": "\\",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": "\\"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "kosmas@kosmas-CELSIUS-W530-Power:~/git/stratus-contrib/nginx$ aitorbot env show\n¡Cojones! GET /executions HTTP 401: <html>\n<head><title>401 Authorization Required</title></head>\n<body>\n<center><h1>401 Authorization Required</h1></center>\n<hr><center>nginx</center>\n</body>\n</html>\n\nkosmas@kosmas-CELSIUS-W530-Power:~/git/stratus-contrib/nginx$ aitorbot env show\nkosmas-valianos [] | 2019-09-17 13:51:51\n    id:      11587a4e-7b94-498c-bd21-95a37215a810\n    state:    finished-execution\n    appliance build from beta[#15605] https://teamcity.ad.cryptzone.com/viewLog.html?buildId=429226&buildTypeId=StratusAppliance_BuildStratusAppliance_2\n    scenario: simple_v4\n    keep on error: False\n    nodes:\n        controller\n            roles:   controller, logserver\n            web ui:  https://envy-172-17-150-1.devops:444\n            connect: appgate://envy-172-17-150-1.devops\n            status:  Running\n            ip:      172.17.150.1\n            network: 172.17.150.0/24\n            hostname: envy-172-17-150-1.devops\n            admin username: admin\n            admin password: admin\n        gateway\n            roles:   gateway\n            status:  Running\n            ip:      172.17.150.2\n            network: 172.17.150.0/24\n            hostname: envy-172-17-150-2.devops\n        endpoint\n            roles:   endpoint\n            status:  Running\n            ip:      172.17.157.2\n            network: 172.17.157.0/24\n            hostname: envy-172-17-157-2.devops\nkosmas@kosmas-CELSIUS-W530-Power:~/git/stratus-contrib/nginx$"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1568733946710
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I can confirm it works fine for me too now."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1568790033727
      }
    ]
  },
  {
    "key": "SA-12106",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Remember is undefined, "
            },
            {
              "type": "text",
              "text": "Failed to sign in with credentials. Mot de passe ou nom d'utilisateur incorrect",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " And raises a warning when updated "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Warning: A component is changing an uncontrolled input of type checkbox to be controlled. Input elements should not switch from uncontrolled to controlled (or vice versa). Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://fb.me/react-controlled-components\n    in input (created by CredentialsLogin)\n    in div (created by CredentialsLogin)\n    ..."
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-12125",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "36:16]\n[rsyslog] E: Failed to fetch http://security.ubuntu.com/ubuntu/pool/main/m/mysql-5.7/libmysqlclient20_5.7.26-0ubuntu0.18.04.1_amd64.deb  404  Not Found [IP: 194.71.11.173 80]\n[08:36:16]\n[rsyslog] E: Failed to fetch http://security.ubuntu.com/ubuntu/pool/main/m/mysql-5.7/libmysqlclient-dev_5.7.26-0ubuntu0.18.04.1_amd64.deb  404  Not Found [IP: 194.71.11.173 80]\n[08:36:16]\n[rsyslog] E: Failed to fetch http://security.ubuntu.com/ubuntu/pool/main/c/curl/libcurl4-gnutls-dev_7.58.0-2ubuntu3.7_amd64.deb  404  Not Found [IP: 194.71.11.173 80]\n[08:36:16]\n[rsyslog] E: Failed to fetch http://security.ubuntu.com/ubuntu/pool/universe/z/zeromq3/libzmq3-dev_4.2.5-1ubuntu0.1_amd64.deb  404  Not Found [IP: 194.71.11.173 80]```"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Probably just needs an apt-get update before."
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-12162",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Initial crappy attempt, note the 0.0.0.0 ip: "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "sep 26 16:53:47 thomas appgate-sdp[12111]: Info : Updating tokens at gateway 'envy-172-17-142-3.devops'.\nsep 26 16:53:47 thomas appgate-sdp[12111]: Error : Client update download error: http://0.0.0.0:8000/appgate_5.0.0%2B17610%2Bbeta_amd64.deb , System.Net.WebException: IPv4 address 0.0.0.0 and IPv6 address ::0 are unspecified addresses that cannot be used as a target address.\n                                           Parameter name: hostName IPv4 address 0.0.0.0 and IPv6 address ::0 are unspecified addresses that cannot be used as a target address.\n                                           Parameter name: hostName ---> System.Net.Http.HttpRequestException: IPv4 address 0.0.0.0 and IPv6 address ::0 are unspecified addresses that cannot be used as a target address.\n                                           Parameter name: hostName ---> System.ArgumentException: IPv4 address 0.0.0.0 and IPv6 address ::0 are unspecified addresses that cannot be used as a target address.\n                                           Parameter name: hostName\n                                              at System.Net.Dns.HostResolutionBeginHelper(String hostName, Boolean justReturnParsedIp, Boolean throwOnIIPAny, AsyncCallback requestCallback, Object state)\n                                              at System.Net.Dns.BeginGetHostAddresses(String hostNameOrAddress, AsyncCallback requestCallback, Object state)\n                                              at System.Net.Sockets.MultipleConnectAsync.StartConnectAsync(SocketAsyncEventArgs args, DnsEndPoint endPoint)\n                                              at System.Net.Sockets.Socket.ConnectAsync(SocketType socketType, ProtocolType protocolType, SocketAsyncEventArgs e)\n                                              at System.Net.Http.ConnectHelper.ConnectAsync(String host, Int32 port, CancellationToken cancellationToken)\n                                              --- End of inner exception stack trace ---\n                                              at System.Net.Http.ConnectHelper.ConnectAsync(String host, Int32 port, CancellationToken cancellationToken)\n                                              at System.Threading.Tasks.ValueTask1.get_Result()                                               at System.Net.Http.HttpConnectionPool.CreateConnectionAsync(HttpRequestMessage request, CancellationToken cancellationToken)                                               at System.Threading.Tasks.ValueTask1.get_Result()\n                                              at System.Net.Http.HttpConnectionPool.WaitForCreatedConnectionAsync(ValueTask1 creationTask)                                               at System.Threading.Tasks.ValueTask1.get_Result()\n                                              at System.Net.Http.HttpConnectionPool.SendWithRetryAsync(HttpRequestMessage request, Boolean doRequestAuth, CancellationToken cancellationToken)\n                                              at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)\n                                              at System.Net.Http.HttpClient.FinishSendAsyncUnbuffered(Task1 sendTask, HttpRequestMessage request, CancellationTokenSource cts, Boolean disposeCts)                                               at System.Net.HttpWebRequest.SendRequest()                                               at System.Net.HttpWebRequest.EndGetResponse(IAsyncResult asyncResult)                                               --- End of inner exception stack trace ---                                               at System.Net.HttpWebRequest.EndGetResponse(IAsyncResult asyncResult)                                               at System.Net.WebClient.GetWebResponse(WebRequest request, IAsyncResult result)                                               at System.Net.WebClient.GetWebResponseTaskAsync(WebRequest request)                                               at System.Net.WebClient.DownloadBitsAsync(WebRequest request, Stream writeStream, AsyncOperation asyncOp, Action3 completionDelegate)\nsep 26 16:53:47 thomas appgatedriver[23932]: Deployment update successful"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Second attempt with a valid URL, no go :( "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "sep 26 16:56:15 thomas appgate-sdp[12111]: Info : 1 new entitlement token(s) retrieved.\nsep 26 16:56:15 thomas appgate-sdp[12111]: Info : Entitlements for 'Default Site': endpoint\nsep 26 16:56:15 thomas appgate-sdp[12111]: Info : Starting downloading package to '/tmp/.appgatesdp-updates-j2qscpom.piv/appgate_5.0.0+17610+beta_amd64.deb' from 'http://thomas0.ad.cryptzone.com:8000/appgate_5.0.0%2B17610%2Bbeta_amd64.deb'.\nsep 26 16:56:15 thomas appgate-sdp[12111]: Info : New entitlement token supplied for gateway 'envy-172-17-142-3.devops'. Will send it.\nsep 26 16:56:15 thomas appgate-sdp[12111]: Info : Checking next CA certificate.\nsep 26 16:56:15 thomas appgate-sdp[12111]: Error : Error during downloading file. An asynchronous socket operation is already in progress using this SocketAsyncEventArgs instance. An asynchronous socket operation is already in progress using this SocketAsyncEventArgs instance.\nsep 26 16:56:15 thomas appgate-sdp[12111]: Warn : File download possibly failed due to: An asynchronous socket operation is already in progress using this SocketAsyncEventArgs instance.\nsep 26 16:56:15 thomas appgate-sdp[12111]: Error : Client update download error: http://thomas0.ad.cryptzone.com:8000/appgate_5.0.0%2B17610%2Bbeta_amd64.deb , System.Net.WebException: An asynchronous socket operation is already in progress using this SocketAsyncEventArgs instance. An asynchronous socket operation is already in progress using this SocketAsyncEventArgs instance. ---> System.Net.Http.HttpRequestException: An asynchronous socket operation is already in progress using this SocketAsyncEventArgs instance. ---> System.InvalidOperationException: An asynchronous socket operation is already in progress using this SocketAsyncEventArgs instance.\n                                              at System.Net.Sockets.SocketAsyncEventArgs.ThrowForNonFreeStatus(Int32 status)\n                                              at System.Net.Sockets.SocketAsyncEventArgs.StartOperationCommon(Socket socket, SocketAsyncOperation operation)\n                                              at System.Net.Sockets.Socket.ConnectAsync(SocketType socketType, ProtocolType protocolType, SocketAsyncEventArgs e)\n                                              at System.Net.Http.ConnectHelper.ConnectAsync(String host, Int32 port, CancellationToken cancellationToken)\n                                              --- End of inner exception stack trace ---\n                                              at System.Net.Http.ConnectHelper.ConnectAsync(String host, Int32 port, CancellationToken cancellationToken)\n                                              at System.Threading.Tasks.ValueTask1.get_Result()                                               at System.Net.Http.HttpConnectionPool.CreateConnectionAsync(HttpRequestMessage request, CancellationToken cancellationToken)                                               at System.Threading.Tasks.ValueTask1.get_Result()\n                                              at System.Net.Http.HttpConnectionPool.WaitForCreatedConnectionAsync(ValueTask1 creationTask)                                               at System.Threading.Tasks.ValueTask1.get_Result()\n                                              at System.Net.Http.HttpConnectionPool.SendWithRetryAsync(HttpRequestMessage request, Boolean doRequestAuth, CancellationToken cancellationToken)\n                                              at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)\n                                              at System.Net.Http.HttpClient.FinishSendAsyncUnbuffered(Task1 sendTask, HttpRequestMessage request, CancellationTokenSource cts, Boolean disposeCts)                                               at System.Net.HttpWebRequest.SendRequest()                                               at System.Net.HttpWebRequest.EndGetResponse(IAsyncResult asyncResult)                                               --- End of inner exception stack trace ---                                               at System.Net.HttpWebRequest.EndGetResponse(IAsyncResult asyncResult)                                               at System.Net.WebClient.GetWebResponse(WebRequest request, IAsyncResult result)                                               at System.Net.WebClient.GetWebResponseTaskAsync(WebRequest request)                                               at System.Net.WebClient.DownloadBitsAsync(WebRequest request, Stream writeStream, AsyncOperation asyncOp, Action3 completionDelegate)\nsep 26 16:56:15 thomas appgate-sdp[12111]: Info : No next CA certificate in the system."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "A client restart is required to actually get the update file."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "interesting"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1569520433584
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Doing dispose, resetting etc did nothing. We need to rip this WebClient out and replace it with HttpClient for next release."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "manuel.moraga",
        "created": 1569832229375
      }
    ]
  },
  {
    "key": "SA-12171",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "After login with credentials and trying to access a resource that requires SAML password remedy user interaction, the SAML flow is triggered but then nothing happens on the client as the SAML Remedy cards remains the same and no access to the resource is granted."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "IMPORTANT: A login using SAML were performed before this test, so there was no need to retype SAML credentials on Remedy Action."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "![](image.png)"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "![](image1.png)"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Tested with: Version: 5.0.0-18586-beta"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "arturo.garcia",
        "created": 1569595562190
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "could you upload the logs?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1569595668102
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[2019-09-27T14:48:01.374Z] Info : Starting HTTP Server to receive SAML token.\n[2019-09-27T14:48:01.374Z] Info : Starting the browser to https://adfs-test.czse.local/adfs/ls/idpinitiatedsignon?SAMLRequest=fZDBSgMxEEDvfkWY%2B9YkTW0zbFIKIizoRasHLyVNs7qwm9RMVvx8V6tQLx4HhvfeTL3%2BGHr2HjJ1KRoQMw4sRJ8OXXwx8Li9qVawthc1uaGXR9yM5TXeh7cxUGHNtYFdq%2BervfRXcxWEF1q2wnOn2pbvAw9KamAN0RiaSMXFYkByoSuuK7ncCoVqiYvFTCr1DOzpN0J%2BRUxZkfCkNTDmiMlRRxjdEAiLx4fN3S1Oq3jMqSSferCnSvwW5nPC%2FwBHFHKZ1GDdoaVdmY6rL89Z9mf8%2BwD7CQ%3D%3D.\n[2019-09-27T14:48:05.644Z] Info : A new HTTP connection has been opened to the client.\n[2019-09-27T14:48:05.644Z] Info : Parsed HTTP header. Waiting for payload.\n[2019-09-27T14:48:05.644Z] Info : Received SAML token. Will send it to controller.\n[2019-09-27T14:48:05.645Z] Info : Sending Password to controller. [ClaimSuffix: 'ClaimSuffix username, ProviderId c629c2b9-977d-45d0-8b49-37b0f981a465, EntitlementName ']]\n[2019-09-27T14:48:06.057Z] Error : Request to controller during Password authentication has been rejected. Reason: (HTTP 401) Unauthorized"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "arturo.garcia",
        "created": 1569595756489
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "hmm, looks like controller didn't accept the token. The username from the SAML provider needs to match the username you used during login. Probably because of that. Try it like that."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Not showing a SAML error seems to be a regression though, so that's still a bug."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1569595985957
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yeah, it worked using same username as SAML when login. local: test1 - saml: test1 works!"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "arturo.garcia",
        "created": 1569596422836
      }
    ]
  },
  {
    "key": "SA-12200",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The problem is that it sometimes deploys new CA old VPN cert to tun driver."
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:00,648840Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:00.252Z] Info : TUN driver rejected the gateway certificate. Will check for the next CA certificate. [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:02,753549Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.338Z] Info : SSL certificate of controller 'envy-fd00-ffff-a-302-172-17-302-1.devops' was not accepted. Trying the next CA certificate stored in the system. [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:02,754634Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.341Z] Info : Resolving hostname 'envy-fd00-ffff-a-302-172-17-302-1.devops' [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:02,756793Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.344Z] Info : Trying to connect 'envy-fd00-ffff-a-302-172-17-302-1.devops/fd00:ffff:a:302::1' with SPA key name 'Built-in-be85360895242'. [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,024851Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:02.923Z] Info : [simple_setup Site] Connecting to TLS://[fd00:ffff:a:302::2]:443 ... [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,025850Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:02.924Z] Info : [simple_setup Site] Client DN: CN=ed3d2a428072e3776f3e761be8d4a149,CN=bob,OU=local [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,026849Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:02.925Z] Info : [simple_setup Site] Verification enabled for envy-fd00-ffff-a-302-172-17-302-2.devops [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,337103Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:02.927Z] Info : [simple_setup Site] Sending SPA-DNS/DTLS packets [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,338179Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:03.234Z] Info : [simple_setup Site] Stopped sending SPA-DNS/DTLS packets [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,338179Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:03.246Z] Info : [simple_setup Site] [gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,338179Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:03.249Z] Info : Sending reply to client <{ \"jsonrpc\": \"2.0\", \"method\": \"status\", \"params\": { \"id\": \"staticid\", \"sites\": { \"simple_setup Site\": {\"gw-id\": \"gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1\", \"status\": \"down\", \"error\": \"Certificate error: server sent no valid certificate - self signed certificate in certificate chain\", \"code\": 8}} }}> [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,339275Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:03.251Z] Info : [simple_setup Site] [gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,360513Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.863Z] Info : Using Controller API V4 [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,361590Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.863Z] Info : Next CA certificate is in use. Migrating storage. [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,361590Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.881Z] Info : Renaming credential '$AppGateSDP:onboardingcookie-3c:4b:b1:d3:6b:7b:38:02:e2:ed:78:b4:38:f0:dc:ed:2b:f5:9b:b7:db:7b:86:77:f5:d9:5c:73:db:71:3c:08-ldap_cert-user1-ed3d2a42-8072-e377-6f3e-761be8d4a149' to '$AppGateSDP:onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-ldap_cert-user1-ed3d2a42-8072-e377-6f3e-761be8d4a149'. [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,361590Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.891Z] Info : Renaming credential '$AppGateSDP:onboardingcookie-3c:4b:b1:d3:6b:7b:38:02:e2:ed:78:b4:38:f0:dc:ed:2b:f5:9b:b7:db:7b:86:77:f5:d9:5c:73:db:71:3c:08-local-bob1-ed3d2a42-8072-e377-6f3e-761be8d4a149' to '$AppGateSDP:onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-local-bob1-ed3d2a42-8072-e377-6f3e-761be8d4a149'. [0m\n[07:12:03] :     [Step 1/1]  [35m    2019-10-02T05:12:03,362676Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.909Z] Info : Renaming credential '$AppGateSDP:onboardingcookie-3c:4b:b1:d3:6b:7b:38:02:e2:ed:78:b4:38:f0:dc:ed:2b:f5:9b:b7:db:7b:86:77:f5:d9:5c:73:db:71:3c:08-ldap-stratus1001-ed3d2a42-8072-e377-6f3e-761be8d4a149' to '$AppGateSDP:onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-ldap-stratus1001-ed3d2a42-8072-e377-6f3e-761be8d4a149'. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,363756Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.926Z] Info : Renaming credential '$AppGateSDP:onboardingcookie-3c:4b:b1:d3:6b:7b:38:02:e2:ed:78:b4:38:f0:dc:ed:2b:f5:9b:b7:db:7b:86:77:f5:d9:5c:73:db:71:3c:08-adfs-test1-ed3d2a42-8072-e377-6f3e-761be8d4a149' to '$AppGateSDP:onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-adfs-test1-ed3d2a42-8072-e377-6f3e-761be8d4a149'. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,363756Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.944Z] Info : Renaming credential '$AppGateSDP:onboardingcookie-3c:4b:b1:d3:6b:7b:38:02:e2:ed:78:b4:38:f0:dc:ed:2b:f5:9b:b7:db:7b:86:77:f5:d9:5c:73:db:71:3c:08-ldap-stratus1000-ed3d2a42-8072-e377-6f3e-761be8d4a149' to '$AppGateSDP:onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-ldap-stratus1000-ed3d2a42-8072-e377-6f3e-761be8d4a149'. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,363756Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.969Z] Info : Renaming credential '$AppGateSDP:onboardingcookie-3c:4b:b1:d3:6b:7b:38:02:e2:ed:78:b4:38:f0:dc:ed:2b:f5:9b:b7:db:7b:86:77:f5:d9:5c:73:db:71:3c:08-local-bob-ed3d2a42-8072-e377-6f3e-761be8d4a149' to '$AppGateSDP:onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-local-bob-ed3d2a42-8072-e377-6f3e-761be8d4a149'. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,365918Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:02.986Z] Info : Renaming credential '$AppGateSDP:onboardingcookie-3c:4b:b1:d3:6b:7b:38:02:e2:ed:78:b4:38:f0:dc:ed:2b:f5:9b:b7:db:7b:86:77:f5:d9:5c:73:db:71:3c:08-local-test1-ed3d2a42-8072-e377-6f3e-761be8d4a149' to '$AppGateSDP:onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-local-test1-ed3d2a42-8072-e377-6f3e-761be8d4a149'. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,366998Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.003Z] Info : Renaming credential '$AppGateSDP:onboardingcookie-3c:4b:b1:d3:6b:7b:38:02:e2:ed:78:b4:38:f0:dc:ed:2b:f5:9b:b7:db:7b:86:77:f5:d9:5c:73:db:71:3c:08-local-bob0-ed3d2a42-8072-e377-6f3e-761be8d4a149' to '$AppGateSDP:onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-local-bob0-ed3d2a42-8072-e377-6f3e-761be8d4a149'. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,368082Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.027Z] Info : Renaming credential '$AppGateSDP:onboardingcookie-3c:4b:b1:d3:6b:7b:38:02:e2:ed:78:b4:38:f0:dc:ed:2b:f5:9b:b7:db:7b:86:77:f5:d9:5c:73:db:71:3c:08-ldap-stratus1002-ed3d2a42-8072-e377-6f3e-761be8d4a149' to '$AppGateSDP:onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-ldap-stratus1002-ed3d2a42-8072-e377-6f3e-761be8d4a149'. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,369162Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.048Z] Info : Retrieving claims token. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,369162Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.049Z] Info : Fetching on-boarding cookie for 'onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-local-bob-ED3D2A42-8072-E377-6F3E-761BE8D4A149' from secure storage. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,370168Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.056Z] Info : On-boarding cookie available for 'onboardingcookie-35:57:3b:ea:46:cf:4e:61:be:03:1c:f1:92:60:76:72:73:d8:f5:d8:d1:22:d6:db:63:dc:37:0e:fe:33:2b:2c-local-bob-ED3D2A42-8072-E377-6F3E-761BE8D4A149'. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,370168Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.097Z] Info : Authentication succeeded. Claims Token: [TokenId: 84f8d4bc-441d-4ff2-89e4-dee62553a8bf, DistinguishedName: CN=ed3d2a428072e3776f3e761be8d4a149,CN=bob,OU=local, FirstName: Bobby, LastName: Tables, ExpirationTime: 2019-10-03 07:12:00], On-demand Claims: [[]], Device Scripts: [[]] [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,371250Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.098Z] Info : New claims token [84f8d4bc-441d-4ff2-89e4-dee62553a8bf] supplied for gateway 'envy-fd00-ffff-a-302-172-17-302-2.devops'. Will send it. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,371250Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.278Z] Info : Processing on-demand Claims: [] [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,372335Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.281Z] Info : Retrieving entitlement tokens. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,372335Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.344Z] Info : 1 new entitlement token(s) retrieved. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,372335Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.344Z] Info : Entitlements for 'simple_setup Site': simple_setup_ENT_HTTP, simple_setup_ENT_PING [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,373420Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.345Z] Info : New entitlement token supplied for gateway 'envy-fd00-ffff-a-302-172-17-302-2.devops'. Will send it. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,373420Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.345Z] Info : Checking next CA certificate. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,374491Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.346Z] Info : Existing REST connection lost. Reconnecting. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,374491Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.346Z] Info : Resolving hostname 'envy-fd00-ffff-a-302-172-17-302-1.devops' [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:03,375573Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.346Z] Info : Trying to connect 'envy-fd00-ffff-a-302-172-17-302-1.devops/fd00:ffff:a:302::1' with SPA key name 'Built-in-be85360895242'. [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:04,066539Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:03.963Z] Info : Got request from client <{\"jsonrpc\":\"2.0\",\"method\":\"deploy\",\"params\":{\"clientp12\":\"\",\"cacert\":\"\",\"sites\":[{\"id\":\"simple_setup Site\",\"ip4\":\"15.0.0.0\",\"ip6\":\"2001:db8:0:0:0:0:1400:0\",\"gateways\":[{\"id\":\"gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1\",\"address\":\"envy-fd00-ffff-a-302-172-17-302-2.devops:443\",\"protocol\":\"tls\",\"weight\":100}],\"entitlement-based-routing\":false,\"routes\":[\"fd00:ffff:a:303::/64\"],\"excluded-routes\":[],\"spa\":{\"mode\":\"udp-tcp\",\"name\":\"74f2c610-ec4c-4398-b8d8-8a0eff3a6bcb\",\"key\":\"*\"}}],\"id\":\"staticid\",\"dns-servers\":[],\"dns-search-domains\":[],\"controllers\":[\"envy-fd00-ffff-a-302-172-17-302-1.devops:443\"],\"block-local-dns\":false,\"ringfence-rules\":[],\"verify-firewall\":true,\"verify-routes\":true}}> [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:04,066622Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:03.968Z] Warn : Certificate validation failure - error:0407008A:rsa routines:RSA_padding_check_PKCS1_type_1:invalid padding (407008a) [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:04,066622Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:03.970Z] Warn : Error when handling request: Certificate validation failure - invalid padding (7) [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:04,067708Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:03.971Z] Info : Sending reply to client <{ \"jsonrpc\": \"2.0\", \"error\": { \"code\": 7, \"message\": \"Certificate validation failure - invalid padding\" }, \"id\": null}> [0m\n[07:12:04] :     [Step 1/1]  [35m    2019-10-02T05:12:04,479465Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.961Z] Info : REST connection could not be established. 'Connection failed.'. Will try the next IP address. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:04,479465Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.961Z] Error : Connection to controller 'https://envy-fd00-ffff-a-302-172-17-302-1.devops/' has failed. Reason: Connection failed. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:04,479465Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.976Z] Warn : TUN driver returned error 'BadCertificate'. Message: Certificate validation failure - invalid padding [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:04,480533Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:03.976Z] Info : TUN driver rejected the VPN certificate with 'Certificate validation failure - invalid padding'. Will renew it. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:06,023036Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:05.920Z] Info : [simple_setup Site] Connecting to TLS://[fd00:ffff:a:302::2]:443 ... [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:06,023036Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:05.922Z] Info : [simple_setup Site] Client DN: CN=ed3d2a428072e3776f3e761be8d4a149,CN=bob,OU=local [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:06,024119Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:05.923Z] Info : [simple_setup Site] Verification enabled for envy-fd00-ffff-a-302-172-17-302-2.devops [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:06,340491Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:05.925Z] Info : [simple_setup Site] Sending SPA-DNS/DTLS packets [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:06,340491Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:06.236Z] Info : [simple_setup Site] Stopped sending SPA-DNS/DTLS packets [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:06,340491Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:06.252Z] Info : [simple_setup Site] [gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:06,341591Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:06.254Z] Info : Sending reply to client <{ \"jsonrpc\": \"2.0\", \"method\": \"status\", \"params\": { \"id\": \"staticid\", \"sites\": { \"simple_setup Site\": {\"gw-id\": \"gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1\", \"status\": \"down\", \"error\": \"Certificate error: server sent no valid certificate - self signed certificate in certificate chain\", \"code\": 8}} }}> [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:06,342682Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:06.255Z] Info : [simple_setup Site] [gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:06,585539Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:06.257Z] Info : TUN driver rejected the gateway certificate. Will check for the next CA certificate. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:07,688761Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:07.387Z] Info : SSL certificate of controller 'envy-fd00-ffff-a-302-172-17-302-1.devops' was not accepted. Trying the next CA certificate stored in the system. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:07,688761Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:07.388Z] Info : No next CA certificate found. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:07,689844Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:07.388Z] Info : Checking next CA certificate. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:07,689844Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:07.388Z] Info : Resolving hostname 'envy-fd00-ffff-a-302-172-17-302-1.devops' [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:07,689844Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:07.391Z] Info : Trying to connect 'envy-fd00-ffff-a-302-172-17-302-1.devops/fd00:ffff:a:302::1' with SPA key name 'Built-in-be85360895242'. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:08,294611Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:07.923Z] Info : No next CA certificate in the system. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,027832Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:08.925Z] Info : [simple_setup Site] Connecting to TLS://[fd00:ffff:a:302::2]:443 ... [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,028920Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:08.926Z] Info : [simple_setup Site] Client DN: CN=ed3d2a428072e3776f3e761be8d4a149,CN=bob,OU=local [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,028920Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:08.928Z] Info : [simple_setup Site] Verification enabled for envy-fd00-ffff-a-302-172-17-302-2.devops [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,334322Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:08.930Z] Info : [simple_setup Site] Sending SPA-DNS/DTLS packets [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,335321Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:09.231Z] Info : [simple_setup Site] Stopped sending SPA-DNS/DTLS packets [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,336395Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:09.242Z] Info : [simple_setup Site] [gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,336395Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:09.244Z] Info : Sending reply to client <{ \"jsonrpc\": \"2.0\", \"method\": \"status\", \"params\": { \"id\": \"staticid\", \"sites\": { \"simple_setup Site\": {\"gw-id\": \"gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1\", \"status\": \"down\", \"error\": \"Certificate error: server sent no valid certificate - self signed certificate in certificate chain\", \"code\": 8}} }}> [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,337480Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:09.245Z] Info : [simple_setup Site] [gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,398177Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:09.247Z] Info : TUN driver rejected the gateway certificate. Will check for the next CA certificate. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,399258Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:09.334Z] Info : SSL certificate of controller 'envy-fd00-ffff-a-302-172-17-302-1.devops' was not accepted. Trying the next CA certificate stored in the system. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:09,399258Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:09.336Z] Info : No next CA certificate found. [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:12,027219Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:11.924Z] Info : [simple_setup Site] Connecting to TLS://[fd00:ffff:a:302::2]:443 ... [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:12,027219Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:11.926Z] Info : [simple_setup Site] Client DN: CN=ed3d2a428072e3776f3e761be8d4a149,CN=bob,OU=local [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:12,028302Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:11.927Z] Info : [simple_setup Site] Verification enabled for envy-fd00-ffff-a-302-172-17-302-2.devops [0m\n[07:12:12] :     [Step 1/1]  [35m    2019-10-02T05:12:12,344645Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:11.929Z] Info : [simple_setup Site] Sending SPA-DNS/DTLS packets [0m\n[07:12:21] :     [Step 1/1]  [35m    2019-10-02T05:12:12,344680Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:12.240Z] Info : [simple_setup Site] Stopped sending SPA-DNS/DTLS packets [0m\n[07:12:21] :     [Step 1/1]  [35m    2019-10-02T05:12:12,344680Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:12.251Z] Info : [simple_setup Site] [gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[07:12:21] :     [Step 1/1]  [35m    2019-10-02T05:12:12,345762Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:12.253Z] Info : Sending reply to client <{ \"jsonrpc\": \"2.0\", \"method\": \"status\", \"params\": { \"id\": \"staticid\", \"sites\": { \"simple_setup Site\": {\"gw-id\": \"gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1\", \"status\": \"down\", \"error\": \"Certificate error: server sent no valid certificate - self signed certificate in certificate chain\", \"code\": 8}} }}> [0m\n[07:12:21] :     [Step 1/1]  [35m    2019-10-02T05:12:12,345762Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-02T05:12:12.254Z] Info : [simple_setup Site] [gateway-7d680dad-0080-4ab6-9989-7646be57e840-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[07:12:21] :     [Step 1/1]  [35m    2019-10-02T05:12:12,504920Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:12.257Z] Info : TUN driver rejected the gateway certificate. Will check for the next CA certificate. [0m\n[07:12:21] :     [Step 1/1]  [35m    2019-10-02T05:12:12,504920Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:12.355Z] Info : SSL certificate of controller 'envy-fd00-ffff-a-302-172-17-302-1.devops' was not accepted. Trying the next CA certificate stored in the system. [0m\n[07:12:21] :     [Step 1/1]  [35m    2019-10-02T05:12:12,505994Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-02T05:12:12.356Z] Info : No next CA certificate found. [0m\n.... and so on"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Looks like not fixed :("
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:08,749436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:08.567Z] Info : Authentication succeeded. Claims Token: [TokenId: 39492b46-7a6f-45a7-84b0-6028b5ce4506, DistinguishedName: CN=be532a42943366f68b8fd40238b01ef8,CN=bob,OU=local, FirstName: Bobby, LastName: Tables, ExpirationTime: 2019-10-30 11:10:07], On-demand Claims: [[]], Device Scripts: [[]] [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:08,749436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:08.568Z] Info : Waiting for VPN certificate to be updated before deploying. [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:08,753438Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:08.568Z] Info : New claims token [39492b46-7a6f-45a7-84b0-6028b5ce4506] supplied for gateway 'envy-172-17-166-2.devops'. Will send it. [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:08,755436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:08.568Z] Info : Waiting for VPN certificate to be updated before deploying. [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:09,343436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:08.860Z] Info : Processing on-demand Claims: [] [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:09,343436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:08.865Z] Info : Retrieving entitlement tokens. [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:09,345437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:08.866Z] Info : Existing REST connection lost. Reconnecting. [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:09,345437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:08.873Z] Info : Resolving hostname 'envy-172-17-166-1.devops' [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:09,346436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:08.877Z] Info : Trying to connect 'envy-172-17-166-1.devops/172.17.166.1' with SPA key name 'Built-in-be85360895242'. [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:09,977437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:09.389Z] Info : REST connection could not be established. 'Connection failed.'. Will try the next IP address. [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:09,978437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:09.390Z] Error : Connection to controller 'https://envy-172-17-166-1.devops/' has failed. Reason: Connection failed. [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:11,427437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-29T10:10:11.324Z] Info : [simple_setup Site] Connecting to TLS://172.17.166.2:443 ... [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:11,427437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-29T10:10:11.326Z] Info : [simple_setup Site] Client DN: CN=be532a42943366f68b8fd40238b01ef8,CN=bob,OU=local [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:11,428437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-29T10:10:11.328Z] Info : [simple_setup Site] Verification enabled for envy-172-17-166-2.devops [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:11,738441Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-29T10:10:11.329Z] Info : [simple_setup Site] Sending SPA-DNS/DTLS packets [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:11,741431Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-29T10:10:11.631Z] Info : [simple_setup Site] Stopped sending SPA-DNS/DTLS packets [0m\n[11:10:11] :     [Step 1/1]  [35m    2019-10-29T10:10:11,742436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-29T10:10:11.643Z] Info : [simple_setup Site] [gateway-28a74895-f04c-4f0a-9dde-8411c54b42ea-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:11,742436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-29T10:10:11.644Z] Info : Sending reply to client <{ \"jsonrpc\": \"2.0\", \"method\": \"status\", \"params\": { \"id\": \"staticid\", \"sites\": { \"simple_setup Site\": {\"gw-id\": \"gateway-28a74895-f04c-4f0a-9dde-8411c54b42ea-site1\", \"status\": \"down\", \"error\": \"Certificate error: server sent no valid certificate - self signed certificate in certificate chain\", \"code\": 8}} }}> [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:11,743437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [tun-service/stdout] [2019-10-29T10:10:11.646Z] Info : [simple_setup Site] [gateway-28a74895-f04c-4f0a-9dde-8411c54b42ea-site1] Closing (Certificate error: server sent no valid certificate - self signed certificate in certificate chain) [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:12,090437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:11.649Z] Info : VPN driver rejected the gateway certificate. Will check for the next CA certificate. [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,203436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:12.943Z] Info : SSL certificate of controller 'envy-172-17-166-1.devops' was not accepted. Trying the next CA certificate stored in the system. [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,209437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:12.945Z] Info : No next CA certificate found. [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,218437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:12.946Z] Info : Retrieving entitlement tokens. [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,219436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:12.947Z] Info : Resolving hostname 'envy-172-17-166-1.devops' [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,219436Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:12.960Z] Info : Trying to connect 'envy-172-17-166-1.devops/172.17.166.1' with SPA key name 'Built-in-be85360895242'. [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,826431Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:13.565Z] Info : 1 new entitlement token(s) retrieved. [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,826431Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:13.566Z] Info : Entitlements for 'simple_setup Site': simple_setup_ENT_PING, simple_setup_ENT_HTTP [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,826431Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:13.566Z] Info : Waiting for VPN certificate to be updated before deploying. [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,827489Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:13.566Z] Info : New entitlement token supplied for gateway 'envy-172-17-166-2.devops'. Will send it. [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,827489Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:13.566Z] Info : Checking next CA certificate. [0m\n[11:10:18] :     [Step 1/1]  [35m    2019-10-29T10:10:13,828437Z [STREAM] [ca_renewal\\ca_renewal_client_connected] [client-service/stdout] [2019-10-29T10:10:13.574Z] Info : No next CA certificate in the system. [0m"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1572346544779
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "nop, still failing"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1573750813606
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "the last one probably was a false alarm as it hasn't failed once for the past 10 days."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1578502993621
      }
    ]
  },
  {
    "key": "SA-12227",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "On the login page we get "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Warning: componentWillReceiveProps has been renamed, and is not recommended for use. See https://fb.me/react-unsafe-component-lifecycles for details.\n\nMove data fetching code or side effects to componentDidUpdate.\n\nIf you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://fb.me/react-derived-state\n\nRename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 17.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run npx react-codemod rename-unsafe-lifecycles in your project source folder.\n\nPlease update the following components: Locations"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I believe that one comes from the router, anyways changing the router is a good idea."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "mikael.harsjo",
        "created": 1570178347161
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Task to remove the UNSAFE"
                },
                {
                  "type": "text",
                  "text": "CWRP leftover ",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "https://code.cyxtera.com/appgate/stratus-frontend/pull/2560",
                  "marks": [
                    {
                      "type": "em"
                    },
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://code.cyxtera.com/appgate/stratus-frontend/pull/2560"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The router change will fix the error above in a different PR"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "hadrien.luttiau",
        "created": 1570542692556
      }
    ]
  },
  {
    "key": "SA-12238",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "We have several options:"
            }
          ]
        },
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Host binaries on akira."
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Build from source, (see "
                    },
                    {
                      "type": "text",
                      "text": "https://github.com/cockroachdb/cockroach)",
                      "marks": [
                        {
                          "type": "link",
                          "attrs": {
                            "href": "https://github.com/cockroachdb/cockroach)"
                          }
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "text": "."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "Building from source gives us the possibility of applying patches. We could start with having the binaries on akira if it makes our life easier."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "As we discussed, we can create a debian package to install it like everything else on the appliance. The debian package can be versioned by the cockroachdb major version so we can have multiple versions at the  same time."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1570525980267
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.com/cockroachdb/cockroach/pull/41464",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/cockroachdb/cockroach/pull/41464"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1570626877100
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I probably named the mypy branch wrong :D :D"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1570705912587
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "haha"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1570711548299
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The thing uses git submodules to download a bunch of stuff then compile it, then fail because they stick to some old commit that no longer works because C++11 deprecated something and gcc is now enforcing it."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I am going to try to just make it use the versions that are already built and working in debian instead. That will save build time and I hope also hassle."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1570787406396
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "OK sounds good if its such a pain to build. We should try going with pull requests to the official repo for our changes anyways."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1570787909121
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I'm not sure how feasible that is though… I made the 1 simple pull request. The tests are failing but I have no access to the tests so ???????"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Nobody else commented anything on my PR."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1570788000220
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.com/cockroachdb/cockroach/issues/41531",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/cockroachdb/cockroach/issues/41531"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1570791728859
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "All the changes I'm making are tracked on this fork "
                },
                {
                  "type": "text",
                  "text": "https://github.com/ltworf/cockroach/tree/yarnpkg",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/ltworf/cockroach/tree/yarnpkg"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " I made it on my personal so I can make prs if they make sense in general."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1570801925986
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Status update: I managed to build it on my machine."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I cherry picked a patch that one developer made after I reported a bug. I had to make a similar one."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "We need to have a discussion if we want to keep the fork internally or on public github to be able to send prs."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571063964439
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "We can discuss in person but I think public github is best and we try to get our fixes upstream. For last resort patches we can patch in the deb build with patch files no?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1571124978451
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yeah that'd be possible as well. Anyway I opened another bugreport asking them to cherrypick the facebook branch where they fix the issue I bumped into, while I just \"fixed\" it by telling gcc to ignore the error :D"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571125952100
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.com/cockroachdb/rocksdb/issues/66",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/cockroachdb/rocksdb/issues/66"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571142051458
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So I forked their repo internally. Meanwhile they pushed one fix due to a bug i had opened so i bumped and removed my changes for that. There are still changes however. I will try to bug them more."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Their makefile has a target to generate a .tar.gz that includes all the submodules."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "My plan for the moment is to manually run this, put the .tar.gz in contrib and from there compile it and make the .deb package. In that way we avoid having to set up submodules and subsubmodules on the contrib repo and the packaging would look more normal."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "However we might also consider doing a separate build instead. On my machine it takes a bit more than 10 minutes to build. We should add the time to compress and so on."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571237145314
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yes I think it would be good to split both the BDR and Cockroach builds on teamcity, even though they run from the same git repo."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1571296596825
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Of course now that it builds on my machine, it won't build in a clean chroot."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571310029737
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "With this awesome error message: "
                },
                {
                  "type": "text",
                  "text": "make: * [Makefile:6: buildoss] Error 2",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571310063495
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.com/cockroachdb/cockroach/pull/41799",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/cockroachdb/cockroach/pull/41799"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571740077785
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://github.com/cockroachdb/cockroach/issues/41796",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/cockroachdb/cockroach/issues/41796"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571740108556
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "remote: Resolving deltas: 100% (3/3), completed with 1 local object.\nremote: error: GH001: Large files detected. You may want to try Git Large File Storage - https://git-lfs.github.com.\nremote: error: File cockroach/cz-cockroachdb_1.orig.tar.gz is 110.00 MB; this exceeds GitHub Enterprise's file size limit of 100.00 MB\nTo code.cyxtera.com:appgate/stratus-contrib.git"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571757498393
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hah. Can we host it on akira instead?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1571816899015
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I guess so. I don't think I have access there to the web thing. Just ssh."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1571817524824
      }
    ]
  },
  {
    "key": "SA-12293",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "After waiting 15-20 minutes the upgrade of the second controller had not completed and the upgrade script was still showing installing. The dashboard showed status of healthy and the appliance as only an Appliance and not a controller. A cz-config upgrade --status  showed “upgrade status is success: a reboot is required for the upgrade to go into effect”. After running the sudo cz-config upgrade --switch-partition command the appliance rebooted. We then waited a couple of minutes but the upgrade script did not have any change and the upgrade appeared to not have continued. However in the time it took us to grab information and create the case, approximately 5-10 minutes after the switch partition command was run, the script did kick back in and the upgrade completed without any further issues."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The 5.0 upgrade script should be the one that was used."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "T-Mobile would like a root cause of why this happened and how we will prevent it going forward. Logs are too large to add to youtrack but they are in the case. Case created in SNOW: CS1189844 "
            },
            {
              "type": "text",
              "text": "https://cyxtera.service-now.com/nav",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://cyxtera.service-now.com/nav"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": "to.do?uri=sn",
              "marks": [
                {
                  "type": "em"
                }
              ]
            },
            {
              "type": "text",
              "text": "customerservice"
            },
            {
              "type": "text",
              "text": "case.do?sys",
              "marks": [
                {
                  "type": "em"
                }
              ]
            },
            {
              "type": "text",
              "text": "id=268ffbdfdb94c890a4a99eb6db961984%26sysparm"
            },
            {
              "type": "text",
              "text": "view=case",
              "marks": [
                {
                  "type": "em"
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "As far as I can see from the logs the second controller never got the reboot order, could you grab the logs from the first controller if they are still available? Also the output of the upgrade script would have been good."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The log download from the second controller got truncated because the disk was too slow, maybe something fishy with that VM."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1571125994006
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Logs from the first controller have been attached to the SNOW case but they are too big to put in youtrack."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "tristan.cooper",
        "created": 1571207165142
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It looks like for some reason the second controller wasn't connected to the first controller when getting the switch partition order. I don't think there is anything we can fix right other than saying that there was a connectivity glitch."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1571402166124
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Oct 10 18:40:15.627902 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.102:15164] Received websocket message.\nOct 10 18:40:15.629048 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.107:11830] Received websocket message.\nOct 10 18:40:15.631746 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.103:15216] Received websocket message.\nOct 10 18:40:15.810790 cycpol01.t-mobile.com cz-controllerd[3097]: 76.121.54.18 - - [10/Oct/2019:18:40:15 +0000] \"GET /admin/stats/appliances HTTP/1.0\" 200 6921 \"https://admin.controller.appgate.t-mobile.com:444/ui/\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0\" 245\nOct 10 18:40:17.162452 cycpol01.t-mobile.com cz-controllerd[3097]: 76.121.54.18 - - [10/Oct/2019:18:40:17 +0000] \"GET /admin/appliances/04f8f611-682a-4f56-9e0c-9459c60aceca/upgrade HTTP/1.0\" 200 61 \"-\" \"Python-urllib/3.7\" 54\nOct 10 18:40:22.304848 cycpol01.t-mobile.com cz-controllerd[3097]: 76.121.54.18 - - [10/Oct/2019:18:40:22 +0000] \"GET /admin/appliances/04f8f611-682a-4f56-9e0c-9459c60aceca/upgrade HTTP/1.0\" 200 87 \"-\" \"Python-urllib/3.7\" 51\nOct 10 18:40:22.464442 cycpol01.t-mobile.com cz-controllerd[3097]: 76.121.54.18 - - [10/Oct/2019:18:40:22 +0000] \"POST /admin/appliances/04f8f611-682a-4f56-9e0c-9459c60aceca/upgrade/switchPartition HTTP/1.0\" 200 45 \"-\" \"Python-urllib/3.7\" 56\nOct 10 18:40:22.790771 cycpol01.t-mobile.com cz-controllerd[3097]: 76.121.54.18 - - [10/Oct/2019:18:40:22 +0000] \"POST /admin/appliances/0c72fcf2-7b21-489b-9eb4-5b8c313f471c/upgrade/switchPartition HTTP/1.0\" 200 45 \"-\" \"Python-urllib/3.7\" 227\nOct 10 18:40:22.948301 cycpol01.t-mobile.com cz-controllerd[3097]: 76.121.54.18 - - [10/Oct/2019:18:40:22 +0000] \"POST /admin/appliances/3d4548b5-83a1-4d01-83f3-f450fd78ae89/upgrade/switchPartition HTTP/1.0\" 200 45 \"-\" \"Python-urllib/3.7\" 58\nOct 10 18:40:23.278005 cycpol01.t-mobile.com cz-controllerd[3097]: 76.121.54.18 - - [10/Oct/2019:18:40:23 +0000] \"POST /admin/appliances/abb996fa-6162-4769-b5f7-45262bdc3b6d/upgrade/switchPartition HTTP/1.0\" 200 45 \"-\" \"Python-urllib/3.7\" 236\nOct 10 18:40:23.403123 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.152.217:15258] Received websocket message.\nOct 10 18:40:23.406368 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.152.214:15240] Received websocket message.\nOct 10 18:40:23.406536 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/127.0.0.1:63294] Received websocket message.\nOct 10 18:40:23.407463 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.152.220:14378] Received websocket message.\nOct 10 18:40:23.440535 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.102:15164] Received websocket message.\nOct 10 18:40:23.447385 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.107:11830] Received websocket message.\nOct 10 18:40:23.451417 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.103:15216] Received websocket message.\nOct 10 18:40:23.452016 cycpol01.t-mobile.com cz-controllerd[3097]: WARN [AppliancesStatsProvider] Error on appliance status check. javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: Connect to cygttn22.t-mobile.com:444 [cygttn22.t-mobile.com/208.54.108.105] failed: Connection refused (Connection refused)\nOct 10 18:40:23.452142 cycpol01.t-mobile.com cz-controllerd[3097]: WARN [AppliancesStatsProvider] Error on appliance status check. javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: Connect to cygpol01.t-mobile.com:444 [cygpol01.t-mobile.com/208.54.152.216] failed: Connection refused (Connection refused)\nOct 10 18:40:23.452244 cycpol01.t-mobile.com cz-controllerd[3097]: WARN [AppliancesStatsProvider] Error on appliance status check. javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: Connect to cygpol22.t-mobile.com:444 [cygpol22.t-mobile.com/208.54.152.219] failed: Connection refused (Connection refused)\nOct 10 18:40:23.452330 cycpol01.t-mobile.com cz-controllerd[3097]: WARN [AppliancesStatsProvider] Error on appliance status check. javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: Connect to cygttn02.t-mobile.com:444 [cygttn02.t-mobile.com/208.54.108.101] failed: Connection refused (Connection refused)\nOct 10 18:40:23.453838 cycpol01.t-mobile.com cz-controllerd[3097]: 76.121.54.18 - - [10/Oct/2019:18:40:23 +0000] \"GET /admin/stats/appliances HTTP/1.0\" 200 7444 \"-\" \"Python-urllib/3.7\" 76\nOct 10 18:40:33.625190 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.152.217:15258] Received websocket message.\nOct 10 18:40:33.625754 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/127.0.0.1:63294] Received websocket message.\nOct 10 18:40:33.627190 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.152.214:15240] Received websocket message.\nOct 10 18:40:33.627339 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.152.220:14378] Received websocket message.\nOct 10 18:40:33.666296 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.102:15164] Received websocket message.\nOct 10 18:40:33.667108 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.107:11830] Received websocket message.\nOct 10 18:40:33.671350 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.103:15216] Received websocket message.\nOct 10 18:40:33.672139 cycpol01.t-mobile.com cz-controllerd[3097]: WARN [AppliancesStatsProvider] Error on appliance status check. javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: Connect to cygttn22.t-mobile.com:444 [cygttn22.t-mobile.com/208.54.108.105] failed: Connection refused (Connection refused)\nOct 10 18:40:33.672262 cycpol01.t-mobile.com cz-controllerd[3097]: WARN [AppliancesStatsProvider] Error on appliance status check. javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: Connect to cygpol01.t-mobile.com:444 [cygpol01.t-mobile.com/208.54.152.216] failed: Connection refused (Connection refused)\nOct 10 18:40:33.672348 cycpol01.t-mobile.com cz-controllerd[3097]: WARN [AppliancesStatsProvider] Error on appliance status check. javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: Connect to cygpol22.t-mobile.com:444 [cygpol22.t-mobile.com/208.54.152.219] failed: Connection refused (Connection refused)\nOct 10 18:40:33.672434 cycpol01.t-mobile.com cz-controllerd[3097]: WARN [AppliancesStatsProvider] Error on appliance status check. javax.ws.rs.ProcessingException: org.apache.http.conn.HttpHostConnectException: Connect to cygttn02.t-mobile.com:444 [cygttn02.t-mobile.com/208.54.108.101] failed: Connection refused (Connection refused)\nOct 10 18:40:33.673666 cycpol01.t-mobile.com cz-controllerd[3097]: 76.121.54.18 - - [10/Oct/2019:18:40:33 +0000] \"GET /admin/stats/appliances HTTP/1.0\" 200 7444 \"-\" \"Python-urllib/3.7\" 70\nOct 10 18:40:43.792261 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/127.0.0.1:63294] Received websocket message.\nOct 10 18:40:43.792903 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.152.214:15240] Received websocket message.\nOct 10 18:40:43.793032 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.152.217:15258] Received websocket message.\nOct 10 18:40:43.795325 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.152.220:14378] Received websocket message.\nOct 10 18:40:43.834245 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.102:15164] Received websocket message.\nOct 10 18:40:43.834473 cycpol01.t-mobile.com cz-controllerd[3097]: INFO [PeerWebSocketEndpoint] [/208.54.108.107:11830] Received websocket message."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1571402189455
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I don't think there is much we can do about this for now without the matching upgrade script logs. I haven't been able to reproduce it either. It's probably linked to the fact that controller1 was running 5.0 and controller2 4.3 plus some timing issue and bad luck but I'm just speculating here as there are no relevant errors in the logs."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1571644025390
      }
    ]
  },
  {
    "key": "SA-12387",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Hotspot Controllerd: (idle)\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                 \n\n17524 czd-ca    20   0 13.392g 633.2m  24.1m S   0.0  3.2   0:33.45 java                                                                                                                                    \n\nOpenJ9 Controllerd: (idle)\n\n28878 czd-ca    20   0 13.263g 535.2m  20.7m S   0.0  2.7   0:11.78 java\n\nHotspot Sessiond (idle):\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                 \n\n27078 czd-priv  20   0 3822.5m 259.8m  19.8m S   0.7  5.2   0:24.77 java \n\nOpenJ9 Sessiond: (idle)\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                 \n\n 6685 czd-priv  20   0 3815.1m 224.3m  18.6m S   0.7  4.5   0:08.09 java  "
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1571993494191
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Per Allansson",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/per.allansson",
                        "title": "per.allansson"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " can you share your finding here... by using OpenJ9 in systemtest"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1571993526710
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Sessiond mem use from a stress test with 3000 users x 256 actions, with no -Xms/x arguments to java:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "jdk8:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "COMMAND     VSZ   RSS\n\njava     14354244 701408"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "jdk8-j9:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "\\# ps -o fname,vsz,rss -p 18014\n\nCOMMAND     VSZ   RSS\n\njava     5385996 389196"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1571993675920
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "[Gokhan Berberoglu]("
                },
                {
                  "type": "text",
                  "text": "http://got-youtrack.agi.appgate.com:8112/users/gokhan.berberoglu",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/gokhan.berberoglu"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " \"gokhan.berberoglu\") "
                },
                {
                  "type": "text",
                  "text": "Natan Abolafya",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/natan.abolafya",
                        "title": "natan.abolafya"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " Any objections in moving into OpenJ9 instead.. it feels like it give quite a boost.. atleast memory wise.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1571993803806
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Reminder: We need to modify/scrap the -Xms/-Xmx arguments for J9 - it doesn't even accept giving a too high value for -Xms for example."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1571993916525
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "as long as it works."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1571994030152
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ok.. Assigning you "
                },
                {
                  "type": "text",
                  "text": "Per Allansson",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/per.allansson",
                        "title": "per.allansson"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to this.. Feels like we should test it out a bit more.. like checking that the perfomance of controller/sessiond has not degraded.. i mean it needs to be atleast \"on par\" with hotspot.."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "but so far, it looks really good"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1571994314184
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "i guess we are going to need some configd changes later on also for the -Xms/-Xmx things.. so dragging in "
                },
                {
                  "type": "text",
                  "text": "Thomas Cellerier",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/thomas.cellerier",
                        "title": "thomas.cellerier"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " into the info loop aswell"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1571994388431
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Also, if someone whats to try.. a easy way to install it, and try it.. is running the following commands:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "wget -qO - https://adoptopenjdk.jfrog.io/adoptopenjdk/api/gpg/key/public | sudo apt-key add -\nsudo apt-get install -y software-properties-common\nsudo add-apt-repository --yes https://adoptopenjdk.jfrog.io/adoptopenjdk/deb/\nsudo apt-get install adoptopenjdk-8-hotspot\nsudo ln -s -f /usr/lib/jvm/adoptopenjdk-8-hotspot-amd64/bin/java /etc/alternatives/java\n\nsudo service cz-sessiond restart\nsudo service cz-controllerd restart"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1571994556289
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "nah, those are defined in the systemd file which are in the repo of each project"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1571994566989
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "they are in shell scripts actually as they adjust the values a bit - some further expirements show that we need to set both -Xms and -Xmx - as J9 doesn't seem to adjust the max if we only set the min"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1571995876426
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "sessiond mem use, 3000 users x 3000 actions, -Xms1g -Xmx4g:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "jdk8"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "COMMAND     VSZ   RSS\n\njava     10208360 4343580"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "jdk8-j9"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "COMMAND     VSZ   RSS\n\njava     9132960 2284900"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1571995949562
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Should we not generate these values actually.. ( -Xms -Xmx ) feels like it would be sane that they flollow the amount of ram that is available.. If the appliance is a stand-alone controller for example.. it feels like Xmx percent wise of the memory should be quite high.. and then adjusted to if its combined in different ways.. But.. thats a completly different story (not this task)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1571996099327
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Those a really nice numbers "
                },
                {
                  "type": "text",
                  "text": "Per Allansson",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/per.allansson",
                        "title": "per.allansson"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1571996190946
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Attached graph over some more sessiond tests."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1572246563525
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I get no visible difference in login times in either controllerd or sessiond with J9 - and controllerd RSS mem use is lower with J9 as well - 1.4G vs 1.9G."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So looks golden to me."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1572855940419
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "That sounds awsome.. then i think we should switch in 5.1"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1573030583867
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "We should also make tests for running on Graalvm .. Since Oracle is throwing out nashorn from the JDK.. then there is need for a replacement.. So, it might come to, that we need to run on Graal in the future.. So, if we can get the same performance on Graalvm compared to OpenJ9, then Graalvm is probaly the way to go"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1573207765026
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://youtrack.ad.cryptzone.com/issue/SA-11969",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://youtrack.ad.cryptzone.com/issue/SA-11969"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " fyi"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1573208944185
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "i see it as 2 different tasks.. because the Graalvm seems to be a comple JVM... so you should be able to run any java application on it without doing any changes.... so it would be very interesting to just run using this JVM, to see if it works... Then.. if we are in luck, and the performance is acceptable, we can also change the scripengine to use the graal instead of the nashorn"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1573209744476
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I was able to get sessiond running atleast using the following command:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "`cd ~"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "wget "
                },
                {
                  "type": "text",
                  "text": "https://github.com/oracle/graal/releases/download/vm-19.2.1/graalvm-ce-linux-amd64-19.2.1.tar.gz",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/oracle/graal/releases/download/vm-19.2.1/graalvm-ce-linux-amd64-19.2.1.tar.gz"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "tar xvf graalvm-ce-linux-amd64-19.2.1.tar.gz"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "sudo mv graalvm-ce-19.2.1 /usr/lib/jvm/"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "sudo ln -s /usr/lib/jvm/graalvm-ce-19.2.1 /usr/lib/jvm/graalvm"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/graalvm/bin/java 1"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "sudo update-alternatives --config java"
                }
              ]
            },
            {
              "type": "heading",
              "content": [
                {
                  "type": "text",
                  "text": "choose 1"
                }
              ],
              "attrs": {
                "level": 3
              }
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "sudo service cz-sessiond restart`"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1573210355647
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ah, I didn't read much about GraalVM. It seems it's a bigger concept than a javascript engine."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1573210601166
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "graalvm is said to be (even more) memory hungry though..."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1573210971241
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Would however be nice, to know for sure.. to see the numbers"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1573211247236
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "https://www.youtube.com/watch?v=eO6OaVnbqaY",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.youtube.com/watch?v=eO6OaVnbqaY"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1573211505530
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\=)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1573211534169
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I will try to see if i can do native compiling.. seems like graal is able todo so even from a jar.. so let see"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1573211589348
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So, i have done some more investigation, You can actually run GraalJs without GraalVm , here is a example "
                },
                {
                  "type": "text",
                  "text": "https://github.com/graalvm/graal-js-jdk11-maven-demo",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://github.com/graalvm/graal-js-jdk11-maven-demo"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " so that makes it a opener för openJ9 again.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1573227137688
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Too late for 5.1 now, moving to 5.2"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1576681706791
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "very good.. really want to test the graal before going all openJ9 also"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1576682054874
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "per.allansson",
                    "text": "@per.allansson",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": "  i dont think there is a dependency  between the jvm and the js-engine. Its for example possible to run the GraalJS on hotspot for example"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1584974065404
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Well, that depends on if the GraalJS is so much faster on GraalVM that the speed improvement is to be preferred over the memory use improvements in OpenJ9."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1585040349182
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "OpenJ9 will not work with ELK though: "
                },
                {
                  "type": "text",
                  "text": "https://www.elastic.co/support/matrix#matrix",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.elastic.co/support/matrix#matrix"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "jvm",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1585040405067
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And I have tested the GraalVM with sessiond, and the memory use is pretty much exactly as with OpenJDK."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1585041032969
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ok.. thats shit.  i was expecting better =("
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1585121263415
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ah ok.. maybe graal is more going into the AOT "
                },
                {
                  "type": "text",
                  "text": "https://www.graalvm.org/docs/why-graal/",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.graalvm.org/docs/why-graal/"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " model .. and its probably there it shines.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1585121466866
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So updated graph with OpenJRE-11, OpenJ9-11 and GraalVM"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1585822339111
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The numbers don't look the same as the previous tests, but that's because test is different. The interesting part is the difference anyhow."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Tests were using: -Xms2g"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The ones with -Xmx were using -Xmx{4,6,8}g depending on how much memory was needed."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "OpenJ9 is clearly the best one in terms of memory use - but using -Xmx on Oracle makes it a lot better as well - although that number needs to be kept high enough to support whatever use case the customer has - so it's hard to autotune."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1585822548818
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So, how does controllerd compare with J9 vs Oracle? The difference in memory use is not as visible as for sessiond - J9 generally keeps a lower profile but over time they end up very close to each other. J9 seems to be on the order of 10% slower on a typical login flow though."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1586180229730
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So to sum it up, J9 looks good for sessiond, not really for controllerd, and it can't be used for ELK stuff."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Since Oracle JVM memory use can be made better by add -Xmx flags - and then it's lower than J9 without -Xmx - and the difference J9 vs Oracle is less when both use -Xmx - I think it makes more sense to keep Oracle JVM to have a single JVM that we use everywhere, and instead look at setting some reasonable -Xmx - and/or having it as some extra tuning parameter that we can apply on an install basis."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1586180516842
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Interesting turnout =)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1586258086006
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "close the task?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1588086391955
      }
    ]
  },
  {
    "key": "SA-12405",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Oct 22 23:20:49 cyxsdp-gw01.cyxtera.com cz-configd[622]: ERROR [jsonrpcapp] Internal server error\n                                                         Traceback (most recent call last):\n                                                           File \"/usr/cz-configd/configd/jsonrpcapp.py\", line 228, in handle_request\n                                                             return handler.function(request)\n                                                           File \"/usr/cz-configd/configd/jsonrpcapp.py\", line 200, in typed_fn\n                                                             result = fn(params)\n                                                           File \"/usr/cz-configd/configd/webservice.py\", line 596, in handle_get_session_info\n                                                             return sessiond_get_session_info(params.distinguished_name)\n                                                           File \"/usr/cz-configd/configd/sessiond.py\", line 91, in sessiond_get_session_info\n                                                             return sessiond_request('sessions', 'info', distinguished_name).json()\n                                                           File \"/usr/cz-configd/configd/sessiond.py\", line 82, in sessiond_request\n                                                             r.raise_for_status()\n                                                           File \"/usr/lib/python3/dist-packages/requests/models.py\", line 935, in raise_for_status\n                                                             raise HTTPError(http_error_msg, response=self)\n                                                         requests.exceptions.HTTPError: 404 Client Error: Not Found for url: http://127.0.0.1:9200/sessions/info/CN=1104eb6742784661bc0347772b791bd6,CN=jorge.briceno,OU=Cyxtera Corp AD\nOct 22 23:20:49 cyxsdp-gw01.cyxtera.com cz-configd[622]: INFO [jsonrpcapp] cyxsdp-ctrl01.cyxtera.com 12925 \"get_session_info\" fail 2"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Maybes is nothing but have a look at it. The journal even compressed cannot be uploaded here but we have it"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1572335403373
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The client is not found in sessiond."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1574841687349
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I could improve the jsonrpc error message to say client not found but that's it."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1574841720392
      }
    ]
  },
  {
    "key": "SA-12439",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "es-tools",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " contains this"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "import sys\nimport requests\nimport logdclient\nimport json\nif len(sys.argv) != 2 :\n    print(\"\"\"Example:%s logstash-2017-06-11\"\"\" % sys.argv[0])\n    sys.exit(1)\nresponse = requests.delete(\"http://localhost:9300/%s\" % sys.argv[1])\nif response.ok :\n    logd_client = logdclient.LogdClient('cz-appliance')\n    logd_client.send(json.dumps({\n        \"event_type\":\"index_removed\",\n        \"name\": sys.argv[1],\n    }))\nelse:\n    print(\"Could not delete %s. Got status %d from elasticsearch\" % (sys.argv[1], response.status_code))\n    exit(1)"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I simplified it into this"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "import logdclient\nimport json\n\nlogd_client = logdclient.LogdClient('cz-test')\n\na = {\"event_type\":\"ciao\", \"name\": \"aaaa\"}\nlogd_client.send(json.dumps(a))"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "And I ran it."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "I can't see anything at all in kibana."
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Probably because the call is completely wrong"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "sendto(-1, \"{\\\"method\\\":\\\"audit\\\",\\\"params\\\":{\\\"version\\\":2, \\\"timestamp\\\":\\\"2019-11-05T12:18:34.493Z\\\", \\\"daemon\\\":\\\"cz-appliance\\\", \\\"log\\\":{\\\"event_type\\\": \\\"index_removed\\\", \\\"name\\\": \\\"pigna\\\"}},\\\"jsonrpc\\\":\\\"2.0\\\"}\\n\", 179, MSG_NOSIGNAL, NULL, 0) = -1 EBADF (Bad file descriptor)"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "and it tries to send data to a "
            },
            {
              "type": "text",
              "text": "-1",
              "marks": [
                {
                  "type": "code"
                }
              ]
            },
            {
              "type": "text",
              "text": " file descriptor, and later on it connects to the socket, so it can never possibly work."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It seems the problem is more minor. After uselessly trying to send it to an invalid file descriptor, it creates a connection and tries again."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "salvatore.tomaselli",
        "created": 1572957413835
      }
    ]
  },
  {
    "key": "SA-12474",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "We come across this a couple of times where the SAML provider has two choices for signature. Whole token or assertion. Today we only support assertion. We can support the whole token too, so less support headache."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "<samlp:Response Destination=\"http://127.0.0.1:29001/saml\" IssueInstant=\"2020-02-26T16:32:48.563Z\" ID=\"I1lfZBD0urwHhDDjCDMQKBhBzssHsnhhAM80dvGduF8HFzTaeTsQ\" Version=\"2.0\"\n    xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\">\n    <saml:Issuer\n        xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\">https://pingone.com/idp/cd-1240574988.cyxtera\n    </saml:Issuer>\n    <ds:Signature\n        xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n        ds:SignedInfo\n            <ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n            <ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/>\n            <ds:Reference URI=\"#I1lfZBD0urwHhDDjCDMQKBhBzssHsnhhAM80dvGduF8HFzTaeTsQ\">\n                ds:Transforms\n                    <ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/>\n                    <ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n                </ds:Transforms>\n                <ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/>\n                ds:DigestValuemVyNHTwv70X38rUBD8pAi/Pbh+NVzREBn2wGh/byVFM=</ds:DigestValue>\n            </ds:Reference>\n        </ds:SignedInfo>\n        ds:SignatureValue\nxkZmtxWrm2BI7BktR9meBNfUasLPF14X23CGpSo0PpN5Zr63Z/qTr6dw5tuTkJfuZN8xTTf8aJlf\nzpBhEFHYQSmmQkDbh9HaX1um5AzMd3waJVljZ16s0q6SVzC/Yj7B1yazJlO+pdXS/UkAjEiJwupP\nJ1yT+TiK7j1fnKPPGwL7GDH42/ZTtftL9p7dWNuRQvvXmb50sdiUIcUDgQCQeDC/EvK8JtIIZwtV\n8YnAB4SKPqW+FHbombc0o/GDJjpMb84es229v6cWqlmD6CPcUbpRAr0zZvJ/MUsmDEf4JT4BAjhJ\nDpZoZC0FvEHYqPxJX/dhpxYIOK3mNTh7hVkSOw==\n</ds:SignatureValue>\n        ds:KeyInfo\n            ds:X509Data\n                ds:X509Certificate\nMIIDWjCCAkKgAwIBAgIGAV5R6OrxMA0GCSqGSIb3DQEBCwUAMG4xCzAJBgNVBAYTAlVTMQswCQYD\nVQQIEwJDTzEPMA0GA1UEBxMGRGVudmVyMRYwFAYDVQQKEw1QaW5nIElkZW50aXR5MSkwJwYDVQQD\nEyA1OTMyY2RhZjAwYmI0YjY1ODBlZmI5YjIzYzhkNGEyODAeFw0xNzA5MDUxMTU5MzJaFw0yMDA5\nMDQxMTU5MzJaMG4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDTzEPMA0GA1UEBxMGRGVudmVyMRYw\nFAYDVQQKEw1QaW5nIElkZW50aXR5MSkwJwYDVQQDEyA1OTMyY2RhZjAwYmI0YjY1ODBlZmI5YjIz\nYzhkNGEyODCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAN8Bci8fB8g/N96iaWmMrSFs\n4G4riau4hcsHDwgRO5Goxe5Nu4S8u7okdZJefxUTCY1fchpOxnxkAvYlW5p4Yr108QYHURGNYX1y\nO729vt4CnCxmovHtJBLB199gMMSUBKy9F9+eXMvTBgGwjjDamL9266oJ07d7KngbD9Jduix/HCMg\noj6HgwYQjGcrOpIMb3G0nHX7oN0MDNeSkaD5AMEwvEmpaQut3r6+lc1zXMWAREVrditsVSwbFPf2\nLHA6hLyqpLY7MRLf0G+sg4+eaeUAy3geIj3incTqusj7GszNzDWK1PaRk9V0Oe6PtLC89ooJKEOq\nH2S8/Tes9gcArRsCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAM24um0Eqf+0e9xQ3pzk28EVFd8I+\nmNOBy1s4w9sstxuWQUcTqtGn6ATvkH9/TRLa2xYJICAgTm8mh3xuJZ/PFqOvCgnd1t5oQA4jeBnb\ntMRT6LPsoq6Nlg4LO+kDUG2uIJIqF9Lj/DPFyf2FUmt0UAFYU0KvIu3sOTLPtkPASy97PpJOX2iv\nAKypchLxmYDY3bKTjL48vSXosd2RnyIGFPaBJG+wCMPrJkJk8tNK5AAF8zA0seskWmmXZN/X6rK9\nVnUwjHG05S3OHDS3jkjhX1QOfanqUWMLi6A7WwRWouZFBpD/XbjPJmyQ0wkdD0kt+nWkFwCFm3h4\nbH3bvI33/Q==\n</ds:X509Certificate>\n            </ds:X509Data>\n            ds:KeyValue\n                ds:RSAKeyValue\n                    ds:Modulus\n3wFyLx8HyD833qJpaYytIWzgbiuJq7iFywcPCBE7kajF7k27hLy7uiR1kl5/FRMJjV9yGk7GfGQC\n9iVbmnhivXTxBgdREY1hfXI7vb2+3gKcLGai8e0kEsHX32AwxJQErL0X355cy9MGAbCOMNqYv3br\nqgnTt3sqeBsP0l26LH8cIyCiPoeDBhCMZys6kgxvcbScdfug3QwM15KRoPkAwTC8SalpC63evr6V\nzXNcxYBERWt2K2xVLBsU9/YscDqEvKqktjsxEt/Qb6yDj55p5QDLeB4iPeKdxOq6yPsazM3MNYrU\n9pGT1XQ57o+0sLz2igkoQ6ofZLz9N6z2BwCtGw==\n</ds:Modulus>\n                    ds:ExponentAQAB</ds:Exponent>\n                </ds:RSAKeyValue>\n            </ds:KeyValue>\n        </ds:KeyInfo>\n    </ds:Signature>\n    samlp:Status\n        <samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/>\n    </samlp:Status>\n    <saml:Assertion Version=\"2.0\" IssueInstant=\"2020-02-26T16:32:48.563Z\" ID=\"I1aj0Qj3thRQrfoDRD-OGJkS5YzmWYsHxkmzxbU4p7u410zUnv7Q\"\n        xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\">\n        saml:Issuer<https://pingone.com/idp/cd-1240574988.cyxtera</saml:Issuer>>\n        saml:Subject\n            <saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">natan.abolafya@cyxtera.com</saml:NameID>\n            <saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\">\n                <saml:SubjectConfirmationData NotOnOrAfter=\"2020-02-26T16:47:48.563Z\" Recipient=\"http://127.0.0.1:29001/saml\"/>\n            </saml:SubjectConfirmation>\n        </saml:Subject>\n        <saml:Conditions NotOnOrAfter=\"2020-02-26T16:47:48.563Z\" NotBefore=\"2020-02-26T16:27:48.563Z\">\n            saml:AudienceRestriction\n                saml:Audienceappgate-test</saml:Audience>\n            </saml:AudienceRestriction>\n        </saml:Conditions>\n        <saml:AuthnStatement AuthnInstant=\"2020-02-26T16:32:48.564Z\" SessionIndex=\"I1rEWL8sLc4prfNB7jDIePK7I2euAZS0FZ_IekZclob_1WpQNDEA\">\n            saml:AuthnContext\n                saml:AuthnContextClassRefurn:oasis:names:tc:SAML:2.0:ac:classes:Password</saml:AuthnContextClassRef>\n                saml:AuthenticatingAuthority<https://pingone.com/idp/cd-1240574988.cyxtera</saml:AuthenticatingAuthority>>\n            </saml:AuthnContext>\n        </saml:AuthnStatement>\n        <saml:AttributeStatement\n            xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"emails\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">natan.abolafya@cyxtera.com\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"firstName\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">Natan\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"lastName\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">Abolafya\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"PingOne.idpid\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">40af977b-c9ce-4883-90e4-88ad54b74c6c\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"PingOne.AuthenticatingAuthority\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">https://pingone.com/idp/cd-1240574988.cyxtera\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"username\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">natan.abolafya@cyxtera.com\n                </saml:AttributeValue>\n            </saml:Attribute>\n        </saml:AttributeStatement>\n    </saml:Assertion>\n</samlp:Response>"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1582734820335
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Any settings or anything?  or do we just look and see what we get and if we like it we move on......"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1590488545800
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "the latter. First we look at the assertion signature like we used to. If we can't find it, we look at the token signature."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1590488719863
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Is the example above showing both or?"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1591284733018
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "natan.abolafya",
                    "text": "@natan.abolafya",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " maybe show me an example of both and I will update the detailed SAML paper we have written"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1591341400717
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The above was the new style: token signature."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The below is an assertion signature example:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "<?xml version=\"1.0\"?>\n<samlp:Response xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"_3a753188-0bdc-44c9-af49-f9218a2e0a27\" Version=\"2.0\" IssueInstant=\"2016-04-19T10:18:23.509Z\" Destination=\"https://turquoise.cryptzone.com/saml\" Consent=\"urn:oasis:names:tc:SAML:2.0:consent:unspecified\">\n<Issuer xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"><http://adfs-test.czse.local/adfs/services/trust</Issuer>>\nsamlp:Status\n    <samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/>\n</samlp:Status>\n<Assertion xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\" ID=\"_d6f94926-fded-4157-a1d3-a1bacc9f4f06\" IssueInstant=\"2016-04-19T10:18:23.509Z\" Version=\"2.0\">\n    <Issuer><http://adfs-test.czse.local/adfs/services/trust</Issuer>>\n    <ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n    ds:SignedInfo\n        <ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n        <ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/>\n        <ds:Reference URI=\"#_d6f94926-fded-4157-a1d3-a1bacc9f4f06\">\n            ds:Transforms\n                <ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/>\n                <ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n            </ds:Transforms>\n            <ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/>\n            ds:DigestValueihZOd0op/onEoHMsS+ALDkee9BGbHoYsqlbQ8OmP7J4=</ds:DigestValue>\n        </ds:Reference>\n    </ds:SignedInfo>\n    ds:SignatureValueka1ZflX26Ad19Sqbx5gq7DMmin3DbMrPMZWdt5mwyrom7YsZKl8nCCRk8N3ygrVsx0VZpBrAFI8DS5zCg+5Cil963/wyTY1QzdvhzRzmA6iXnzqKhG7tdJN/WxMCgurJdWDvsVBJU3gJTu2Lxk8t7RlwQxIMzhB3zG4ovdYFnI7yPEKCDvzDfTm5TH5APguaUdF0d6xzVQJD2oTnpPiTQY+DoTeaTzcIidBB05Pz9Y4ZZfXqarqZy/kyz+h1DjV24UWncGAjLnc6iFxE2gD4qN6UHIugskrYc1IzVvJr6Ih4LsD+NLP3/cUDrJPEOsDmyjBW4bus4QQOQ7wUGmLCRQ==</ds:SignatureValue>\n    <KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n    ds:X509Data\n        ds:X509CertificateMIIC5DCCAcygAwIBAgIQEOu46DWrZ5hDn60ZG9px1zANBgkqhkiG9w0BAQsFADAuMSwwKgYDVQQDEyNBREZTIFNpZ25pbmcgLSBhZGZzLXRlc3QuY3pzZS5sb2NhbDAeFw0xNTA5MDgwODQ1NDlaFw0xNjA5MDcwODQ1NDlaMC4xLDAqBgNVBAMTI0FERlMgU2lnbmluZyAtIGFkZnMtdGVzdC5jenNlLmxvY2FsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3c6j34fXJmguutMd1Qy6VoNr7T+62bI7JVgFvP12fJBCm1qB1sVM4gGoWqMhnsYozZyGTwn62t/Elt0+RFnqpdkRdCcUBGLSaXvdsybAeKwcOhChKilAYpTsYPEWejIQ5hXjJnwofu6DDCEbw04JAXMRFWV6v2Vz6khuKoDJMJ9mjaY4BHYpUQXS3nSjGn4HSmN42FQeW4dEwkpdbmsMuwsQTLtpKDouXbfbCgN/6adTASRKwQz5mPMsuemEjvoRQxMw3Mt0KcEL02G83llNiKceuIjnDaKQXzvoa1YeWK/unYod+ErhSnOR56udlG5i5LQr5cBr8xK9Ix6zLyg9KQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQDb+vNVXAluh7Evt8TSE1IyZYFJ1s3OIep57ClxlSvTkfUE4CVxpxjsKnizgEF/IXxm3iq6FVrTW22Vog0gThbpLlRGaJjDLYQllUCG2v1uh072EQUMnCdLTBrKbyX5bQa3evk+A0iRSRk/3PBNyULritmsrgaQp3wrqkgGvn/WHqzF6ItWtJfqI1iy/ls8HYjxeUt3c2i0rQSfsoU/JIsc2SkpM+59+O2eRozYEENNfLWZryUDMXCTgO5CgmO2g9GyyOwxKKdCXJlroBSUXmpqSuF8GYZtfLhRCYPa26Qgj+ZiB/YH8k2+JPeRDIVapHGfkLtH4YyBkqfK+VLLUQgS</ds:X509Certificate>\n    </ds:X509Data>\n</KeyInfo>\n</ds:Signature>\n<Subject>\n    <SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\">\n        <SubjectConfirmationData NotOnOrAfter=\"2016-04-19T10:23:23.509Z\" Recipient=\"https://turquoise.cryptzone.com/saml\"/>\n    </SubjectConfirmation>\n</Subject>\n<Conditions NotBefore=\"2016-04-19T10:18:23.506Z\" NotOnOrAfter=\"2016-04-19T11:18:23.506Z\">\n    <AudienceRestriction>\n        <Audience>adfs_test</Audience>\n    </AudienceRestriction>\n</Conditions>\n<AttributeStatement>\n    <Attribute Name=\"emails\">\n        <AttributeValue>test1@cryptzone.com</AttributeValue>\n    </Attribute>\n    <Attribute Name=\"id\">\n        <AttributeValue>xiWdImmyMEKo8HqxLKWaHg==</AttributeValue>\n    </Attribute>\n    <Attribute Name=\"username\">\n        <AttributeValue>test1</AttributeValue>\n    </Attribute>\n    <Attribute Name=\"firstName\">\n        <AttributeValue>Test1</AttributeValue>\n    </Attribute>\n    <Attribute Name=\"lastName\">\n        <AttributeValue>Lastname 1</AttributeValue>\n    </Attribute>\n    <Attribute Name=\"groups\">\n        <AttributeValue>CN=test group,OU=adfstest,DC=czse,DC=local</AttributeValue>\n    </Attribute>\n</AttributeStatement>\n<AuthnStatement AuthnInstant=\"2016-04-19T10:18:23.445Z\">\n    <AuthnContext>\n        <AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</AuthnContextClassRef>\n    </AuthnContext>\n</AuthnStatement>\n</Assertion>\n</samlp:Response>"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1591347173809
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "eh, this looks wrong "
                },
                {
                  "type": "text",
                  "text": "Jamie Bodley-Scott",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/jamie.bodley-scott",
                        "title": "jamie.bodley-scott"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", I'll be updating the example above."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1591348065204
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So, the difference is:"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  Token signature (new) has the signature under \"Response - Signature\""
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  Assertion Signature (old) has the signature under \"Response - Assertion - Signature\""
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1591348379699
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "thx all very clear - have updated the SAML paper."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1593185133293
      }
    ]
  },
  {
    "key": "SA-12634",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The only way to make NTLM authentication work is to have a configuration with an explicit upstream block with the "
                },
                {
                  "type": "text",
                  "text": "keepalive",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " directive and in the "
                },
                {
                  "type": "text",
                  "text": "proxy_pass",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " directive replace "
                },
                {
                  "type": "text",
                  "text": "$host:$server_port$request_uri",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " with that upstream block e.g. :"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "<samlp:Response Destination=\"http://127.0.0.1:29001/saml\" IssueInstant=\"2020-02-26T16:32:48.563Z\" ID=\"I1lfZBD0urwHhDDjCDMQKBhBzssHsnhhAM80dvGduF8HFzTaeTsQ\" Version=\"2.0\"\n    xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\">\n    <saml:Issuer\n        xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\">https://pingone.com/idp/cd-1240574988.cyxtera\n    </saml:Issuer>\n    <ds:Signature\n        xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n        ds:SignedInfo\n            <ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n            <ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/>\n            <ds:Reference URI=\"#I1lfZBD0urwHhDDjCDMQKBhBzssHsnhhAM80dvGduF8HFzTaeTsQ\">\n                ds:Transforms\n                    <ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/>\n                    <ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n                </ds:Transforms>\n                <ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/>\n                ds:DigestValuemVyNHTwv70X38rUBD8pAi/Pbh+NVzREBn2wGh/byVFM=</ds:DigestValue>\n            </ds:Reference>\n        </ds:SignedInfo>\n        ds:SignatureValue\nxkZmtxWrm2BI7BktR9meBNfUasLPF14X23CGpSo0PpN5Zr63Z/qTr6dw5tuTkJfuZN8xTTf8aJlf\nzpBhEFHYQSmmQkDbh9HaX1um5AzMd3waJVljZ16s0q6SVzC/Yj7B1yazJlO+pdXS/UkAjEiJwupP\nJ1yT+TiK7j1fnKPPGwL7GDH42/ZTtftL9p7dWNuRQvvXmb50sdiUIcUDgQCQeDC/EvK8JtIIZwtV\n8YnAB4SKPqW+FHbombc0o/GDJjpMb84es229v6cWqlmD6CPcUbpRAr0zZvJ/MUsmDEf4JT4BAjhJ\nDpZoZC0FvEHYqPxJX/dhpxYIOK3mNTh7hVkSOw==\n</ds:SignatureValue>\n        ds:KeyInfo\n            ds:X509Data\n                ds:X509Certificate\nMIIDWjCCAkKgAwIBAgIGAV5R6OrxMA0GCSqGSIb3DQEBCwUAMG4xCzAJBgNVBAYTAlVTMQswCQYD\nVQQIEwJDTzEPMA0GA1UEBxMGRGVudmVyMRYwFAYDVQQKEw1QaW5nIElkZW50aXR5MSkwJwYDVQQD\nEyA1OTMyY2RhZjAwYmI0YjY1ODBlZmI5YjIzYzhkNGEyODAeFw0xNzA5MDUxMTU5MzJaFw0yMDA5\nMDQxMTU5MzJaMG4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDTzEPMA0GA1UEBxMGRGVudmVyMRYw\nFAYDVQQKEw1QaW5nIElkZW50aXR5MSkwJwYDVQQDEyA1OTMyY2RhZjAwYmI0YjY1ODBlZmI5YjIz\nYzhkNGEyODCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAN8Bci8fB8g/N96iaWmMrSFs\n4G4riau4hcsHDwgRO5Goxe5Nu4S8u7okdZJefxUTCY1fchpOxnxkAvYlW5p4Yr108QYHURGNYX1y\nO729vt4CnCxmovHtJBLB199gMMSUBKy9F9+eXMvTBgGwjjDamL9266oJ07d7KngbD9Jduix/HCMg\noj6HgwYQjGcrOpIMb3G0nHX7oN0MDNeSkaD5AMEwvEmpaQut3r6+lc1zXMWAREVrditsVSwbFPf2\nLHA6hLyqpLY7MRLf0G+sg4+eaeUAy3geIj3incTqusj7GszNzDWK1PaRk9V0Oe6PtLC89ooJKEOq\nH2S8/Tes9gcArRsCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAM24um0Eqf+0e9xQ3pzk28EVFd8I+\nmNOBy1s4w9sstxuWQUcTqtGn6ATvkH9/TRLa2xYJICAgTm8mh3xuJZ/PFqOvCgnd1t5oQA4jeBnb\ntMRT6LPsoq6Nlg4LO+kDUG2uIJIqF9Lj/DPFyf2FUmt0UAFYU0KvIu3sOTLPtkPASy97PpJOX2iv\nAKypchLxmYDY3bKTjL48vSXosd2RnyIGFPaBJG+wCMPrJkJk8tNK5AAF8zA0seskWmmXZN/X6rK9\nVnUwjHG05S3OHDS3jkjhX1QOfanqUWMLi6A7WwRWouZFBpD/XbjPJmyQ0wkdD0kt+nWkFwCFm3h4\nbH3bvI33/Q==\n</ds:X509Certificate>\n            </ds:X509Data>\n            ds:KeyValue\n                ds:RSAKeyValue\n                    ds:Modulus\n3wFyLx8HyD833qJpaYytIWzgbiuJq7iFywcPCBE7kajF7k27hLy7uiR1kl5/FRMJjV9yGk7GfGQC\n9iVbmnhivXTxBgdREY1hfXI7vb2+3gKcLGai8e0kEsHX32AwxJQErL0X355cy9MGAbCOMNqYv3br\nqgnTt3sqeBsP0l26LH8cIyCiPoeDBhCMZys6kgxvcbScdfug3QwM15KRoPkAwTC8SalpC63evr6V\nzXNcxYBERWt2K2xVLBsU9/YscDqEvKqktjsxEt/Qb6yDj55p5QDLeB4iPeKdxOq6yPsazM3MNYrU\n9pGT1XQ57o+0sLz2igkoQ6ofZLz9N6z2BwCtGw==\n</ds:Modulus>\n                    ds:ExponentAQAB</ds:Exponent>\n                </ds:RSAKeyValue>\n            </ds:KeyValue>\n        </ds:KeyInfo>\n    </ds:Signature>\n    samlp:Status\n        <samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/>\n    </samlp:Status>\n    <saml:Assertion Version=\"2.0\" IssueInstant=\"2020-02-26T16:32:48.563Z\" ID=\"I1aj0Qj3thRQrfoDRD-OGJkS5YzmWYsHxkmzxbU4p7u410zUnv7Q\"\n        xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\">\n        saml:Issuer<https://pingone.com/idp/cd-1240574988.cyxtera</saml:Issuer>>\n        saml:Subject\n            <saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">natan.abolafya@cyxtera.com</saml:NameID>\n            <saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\">\n                <saml:SubjectConfirmationData NotOnOrAfter=\"2020-02-26T16:47:48.563Z\" Recipient=\"http://127.0.0.1:29001/saml\"/>\n            </saml:SubjectConfirmation>\n        </saml:Subject>\n        <saml:Conditions NotOnOrAfter=\"2020-02-26T16:47:48.563Z\" NotBefore=\"2020-02-26T16:27:48.563Z\">\n            saml:AudienceRestriction\n                saml:Audienceappgate-test</saml:Audience>\n            </saml:AudienceRestriction>\n        </saml:Conditions>\n        <saml:AuthnStatement AuthnInstant=\"2020-02-26T16:32:48.564Z\" SessionIndex=\"I1rEWL8sLc4prfNB7jDIePK7I2euAZS0FZ_IekZclob_1WpQNDEA\">\n            saml:AuthnContext\n                saml:AuthnContextClassRefurn:oasis:names:tc:SAML:2.0:ac:classes:Password</saml:AuthnContextClassRef>\n                saml:AuthenticatingAuthority<https://pingone.com/idp/cd-1240574988.cyxtera</saml:AuthenticatingAuthority>>\n            </saml:AuthnContext>\n        </saml:AuthnStatement>\n        <saml:AttributeStatement\n            xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"emails\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">natan.abolafya@cyxtera.com\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"firstName\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">Natan\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"lastName\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">Abolafya\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"PingOne.idpid\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">40af977b-c9ce-4883-90e4-88ad54b74c6c\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"PingOne.AuthenticatingAuthority\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">https://pingone.com/idp/cd-1240574988.cyxtera\n                </saml:AttributeValue>\n            </saml:Attribute>\n            <saml:Attribute NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\" Name=\"username\">\n                <saml:AttributeValue xsi:type=\"xs:string\"\n                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">natan.abolafya@cyxtera.com\n                </saml:AttributeValue>\n            </saml:Attribute>\n        </saml:AttributeStatement>\n    </saml:Assertion>\n</samlp:Response>"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "There is a major gotcha here. The "
                },
                {
                  "type": "text",
                  "text": "proxy_pass",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " ends up pointing to a fixed IP:Port instead of the dynamic "
                },
                {
                  "type": "text",
                  "text": "$host:$server_port",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". This means that you have to set the IP:Port in the upstream block yourself with an appliance customization. Note that if you have multiple backend servers you have to add an upstream block for each one of them along with equal amount of "
                },
                {
                  "type": "text",
                  "text": "proxy_pass",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to those blocks."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1575454048832
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The problem in the first place is the NTLM authentication (note "
                },
                {
                  "type": "text",
                  "text": "WWW-Authenticate: NTLM ...",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "), AKA Windows Authentication."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "NTLM authentication authenticates connections instead of requests, and this is somewhat contradicts HTTP protocol, which is expected to be stateless. As a result it doesn't generally work through proxies, including nginx."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Simplest solution would be to change authentication to \"Basic\" on IIS side. If this not an option for some reason, other possibilities include:"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  Use stream proxy as available in nginx 1.9.x. This will map connections from clients to upstream server, and thus NTLM authentication will work."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "  Use ntlm feature as available in commercial nginx version."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Note that there are some recommendations to use upstream with keepalive for NTLM authentication to work. These recommendations are incorrect and harmful - unless you are using the proxy for just one user. And the worst thing is that it may appear to work correctly. The problem is that keepalive connections to upstream server are kept in a common cache, and these connections can be used for all clients. So if there is an authenticated connection in the cache, an unrelated client who happens to use this connection will be able to bypass authentication."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1575454876804
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Re-opening this to PoC some stuff. cz-configd could talk with cz-sessiond and generate the proper upstream (stream proxy) and server blocks required, depending on the Action objects"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1576443284755
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I'm pretty sure that's not happening in 5.1 so moving it."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "thomas.cellerier",
        "created": 1579076903964
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Will add the word PoC in the story as here I just tried different approaches/implementation. I have only the nginx official ntlm support to PoC so it can be 5.1"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1579267207571
      }
    ]
  },
  {
    "key": "SA-12685",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "cool =)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1576063265615
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "muy bien "
                },
                {
                  "type": "text",
                  "text": "Kosmas Valianos",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "http://got-youtrack.agi.appgate.com:8112/users/kosmas.valianos",
                        "title": "kosmas.valianos"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " lets do this"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1576068878682
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Remember that you must be able to handle a scenario like this:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "  ALLOW https://example.com/somewebapplication\n  ALLOW wss://example.com/somewebapplication/websocket\n  BLOCK https://example.com/"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.allansson",
        "created": 1576070835851
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Yeap. The only way is to play with the headers so the module can figure what \"type\" of request it is. They will also arrive in different virtual server as it will be different marking"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1576071547137
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "here is a example from sessiond tests.."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Configured URLS:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "`wss://192.168.111.111:8080/somepath"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ws://192.168.111.111:8080/somepath`"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "NGINX:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "`{"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"uris\": [{"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"uri\": \"192.168.111.111:8080/somepath\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"allow-ips\": [\"dead{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0}}0{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0}}0{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0}}0:beef\", \"10.0.1.1\"],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"report-ips\": [],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"block-ips\": [],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"name\": \"TCP/URL Entitlement 0-0\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"scheme\": \"wss\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "}, {"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"uri\": \"192.168.111.111:8080/somepath\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"allow-ips\": [\"dead{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0}}0{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0}}0{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0}}0:beef\", \"10.0.1.1\"],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"report-ips\": [],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"block-ips\": [],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"name\": \"TCP/URL Entitlement 1-0\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"scheme\": \"ws\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "}],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"ip-to-dn\": [{"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"ip\": \"dead{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0}}0{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0}}0{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "0}}0:beef\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"dn\": \"CN=c42f8f1c95c54975a7f925f922c8f679,CN=stratus6,OU=OKTA\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "}, {"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"ip\": \"10.0.1.1\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"dn\": \"CN=c42f8f1c95c54975a7f925f922c8f679,CN=stratus6,OU=OKTA\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "}],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"debug\": false"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "}`"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "VPND:"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "`{"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"method\": \"access-control-list\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"params\": {"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"entitlement-based-routing\": false,"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"dn\": \"CN=c42f8f1c95c54975a7f925f922c8f679,CN=stratus6,OU=OKTA\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"token-id\": \"cd00946f-b2c8-413e-aeda-15ce59bb0ca2\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"acl-rules\": [{"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"protocol\": \"tcp\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"action-id\": \"a45d5483-6427-3b9d-9164-a761e076f4ed\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"name\": \"TCP\\/URL Entitlement 1-0\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"rule\": \"allow\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"subnets\": [\"192.168.111.111\\/32\"],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"url-access\": \"ws\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"ports\": [\"8080\"],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"direction\": \"up\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "}, {"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"protocol\": \"tcp\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"action-id\": \"dbc1ca22-4fb0-3e09-8e36-ab35edb0dc01\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"name\": \"TCP\\/URL Entitlement 0-0\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"rule\": \"allow\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"subnets\": [\"192.168.111.111\\/32\"],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"url-access\": \"wss\","
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"ports\": [\"8080\"],"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"direction\": \"up\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "}]"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "},"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\"jsonrpc\": \"2.0\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "}`"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1576075810364
      }
    ]
  },
  {
    "key": "SA-12711",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "this might be a good start:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "#!/usr/bin/python3\nimport argparse\nimport json\nimport os\nimport sys\nimport requests\n\ndef print_hits(args, hits):\n    for log in hits['hits']:\n        if args.include_es_meta:\n            print(json.dumps(log))\n        else:\n            print(json.dumps(log['_source']))\n\ndef export_logs(args) :\n    r = requests.get(\"%s/_cat/indices?format=json\" % args.es_base)\n    if r.status_code <= 200 or r.status_code > 299:\n        indexes = []\n        tmp = json.loads(r.text)\n        for index_meta in tmp:\n            index_name = index_meta['index']\n            if index_name.startswith('logstash') :\n                indexes.append(index_meta['index'])\n        request_session = requests.Session()\n        for index in indexes:\n            headers = {'Content-Type': 'application/json'}\n            url = \"%s/%s/_search?scroll=1m&pretty\" % (args.es_base, index)\n            search = {\n                \"size\": 100,\n                \"query\": {\n                    \"match_all\" : {}\n                }\n            }\n            if args.event_type != None:\n                search[\"query\"] = {\n                        \"terms\":{\n                            \"event_type\":[args.event_type]\n                        }\n                }\n            scoll = False\n            while True:\n                if scoll:\n                    url = url = \"%s/_search/scroll\" % args.es_base\n                    search = {\"scroll_id\": scoll_id}\n                r = request_session.post(url, data=json.dumps(search), headers=headers)\n                if r.status_code <= 200 or r.status_code > 299:\n                    result = json.loads(r.text)\n                    hits = result['hits']\n                    if len(hits['hits']) == 0 :\n                        break\n                    print_hits(args, hits)\n                    if not scoll :\n                        scoll_id = result['_scroll_id']\n                    scoll = True\n                else:\n                    break\n    else:\n        print(\"Not Ok status from ES: %d\" % r.status_code)\n\ndef add_arguments(parser) :\n    parser.add_argument(\"--event_type\", help=\"Export by event_type\", default=None)\n    parser.add_argument(\"--daemon\", help=\"Export by daemon\", default=None)\n    parser.add_argument(\"--es_base\", default=\"http://localhost:9300\", help=\"Elasticsearch base url\")\n    parser.add_argument(\"--include_es_meta\", default=False, help=\"Include elasticsearch related data\")\n\ndef main() :\n    parser = argparse.ArgumentParser()\n    add_arguments(parser)\n    args = parser.parse_args()\n    export_logs(args)\n\nif name == \"main\":\n    main()"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1576850790518
      }
    ]
  },
  {
    "key": "SA-12769",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Since the new year, the ssl certificate used in the nutanix bootstrap img is invalid and causes failure on cURL"
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "ubuntu@nutanix-bootstrap:~$ curl --verbose -o appgate.img.zip  \"https://artifacts.ad.cryptzone.com/project/7/StratusAppliance_BuildStratusAppliance_2/master/artifact/appgate-5.1.0-16547-master.img.zip?is-build-type-id&build-number=16547\"\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 52.238.255.154...\n\nTCP_NODELAY set\n\nConnected to artifacts.ad.cryptzone.com (52.238.255.154) port 443 (#0)\n\nALPN, offering h2\n\nALPN, offering http/1.1\n\nsuccessfully set certificate verify locations:\n\nCAfile: /etc/ssl/certs/ca-certificates.crt\nCApath: /etc/ssl/certs\n} [5 bytes data]\n\nTLSv1.3 (OUT), TLS handshake, Client hello (1):\n} [512 bytes data]\n\nTLSv1.3 (IN), TLS handshake, Server hello (2):\n{ [108 bytes data]\n\nTLSv1.2 (IN), TLS handshake, Certificate (11):\n{ [2906 bytes data]\n\nTLSv1.2 (IN), TLS handshake, Server key exchange (12):\n{ [300 bytes data]\n\nTLSv1.2 (IN), TLS handshake, Server finished (14):\n{ [4 bytes data]\n\nTLSv1.2 (OUT), TLS handshake, Client key exchange (16):\n} [37 bytes data]\n\nTLSv1.2 (OUT), TLS change cipher, Client hello (1):\n} [1 bytes data]\n\nTLSv1.2 (OUT), TLS handshake, Finished (20):\n} [16 bytes data]\n\nTLSv1.2 (IN), TLS handshake, Finished (20):\n{ [16 bytes data]\n\nSSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384\n\nALPN, server accepted to use http/1.1\n\nServer certificate:\n\nsubject: C=US; ST=Florida; L=Coral Gables; O=Cyxtera Technologies, Inc.; CN=*.cyxtera.com\n\nstart date: Aug 13 00:00:00 2018 GMT\n\nexpire date: Oct  7 12:00:00 2020 GMT\n\nsubjectAltName does not match artifacts.ad.cryptzone.com\n\nSSL: no alternative certificate subject name matches target host name 'artifacts.ad.cryptzone.com'\n\nstopped the pause stream!\n0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n\nClosing connection 0\n} [5 bytes data]\n\nTLSv1.2 (OUT), TLS alert, Client hello (1):\n} [2 bytes data]\ncurl: (51) SSL: no alternative certificate subject name matches target host name 'artifacts.ad.cryptzone.com'\nubuntu@nutanix-bootstrap:~$ \n\n"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": " The cert is a copy of "
            },
            {
              "type": "text",
              "text": "https://code.cyxtera.com/appgate/helvetest/blob/master/certs/DigiCertSHA2SecureServerCA.crt",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "https://code.cyxtera.com/appgate/helvetest/blob/master/certs/DigiCertSHA2SecureServerCA.crt"
                  }
                }
              ]
            },
            {
              "type": "text",
              "text": " and located in located /usr/share/ca-certificates/appgate/DigiCertSHA2SecureServerCA.crt on bootstrap img. on the nutanix bootstrap img "
            },
            {
              "type": "text",
              "text": "88dd2f03-39ff-4b96-9ef5-df26253113c1",
              "marks": [
                {
                  "type": "code"
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "resolved, Tyron fixed it, it was problems with the DNS."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "daniel.nilsson",
        "created": 1578040692299
      }
    ]
  },
  {
    "key": "SA-12772",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Check if there is something we need todo to prepare for 7.X"
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "the folloing configuration seems to get the node started atleast:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "cluster.name: appgate\ncluster.routing.allocation.disk.watermark.high: 94%\ncluster.routing.allocation.disk.watermark.low: 93%\ndiscovery.zen.minimum_master_nodes: 1\ndiscovery.zen.ping.unicast.hosts: []\ngateway.expected_nodes: 0\nhttp.max_header_size: 256kb\nhttp.port: 9300\nnetwork.host: 127.0.0.1\nnode.name: ${HOSTNAME}\npath:\n  data: /mnt/data/elasticsearch5/data/\n  logs: /mnt/data/elasticsearch5/log/\n  repo:\n    - /tmp/kibanaBackup\n    - /mnt/data/elasticsearch5/backup\nthread_pool.search.queue_size: '10000'\ntransport.publish_port: 9350\ntransport.tcp.keep_alive: false\ntransport.tcp.port: 9301"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1577977817319
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "an 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "08}}24 envy-172-17-104-1.devops cz-elasticsearch[32564]: [WARN ][o.e.d.c.s.Settings ] [envy-172-17-104-1.devops] [discovery.zen.ping.unicast.hosts] setting was deprecated in Elasticsearch and will be removed in a future release! See the breaking changes documentation for the next major version."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "08}}24 envy-172-17-104-1.devops cz-elasticsearch[32564]: [WARN ][o.e.d.c.s.Settings ] [envy-172-17-104-1.devops] [discovery.zen.minimum"
                },
                {
                  "type": "text",
                  "text": "master",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "nodes] setting was deprecated in Elasticsearch and will be removed in a future release! See the breaking changes documentation for the next major version."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "08}}26 envy-172-17-104-1.devops cz-elasticsearch[32564]: [INFO ][o.e.d.DiscoveryModule ] [envy-172-17-104-1.devops] using discovery type [zen] and seed hosts providers [settings]"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1577977843430
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "08}}30 envy-172-17-104-1.devops cz-elasticsearch[32564]: [INFO ][o.e.c.r.a.AllocationService] [envy-172-17-104-1.devops] Cluster health status changed from [RED] to [YELLOW] (reason: [shards started [[.kibana\\"
                },
                {
                  "type": "text",
                  "text": "7][0]]]).",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "08}}30 envy-172-17-104-1.devops cz-elasticsearch[32564]: [WARN ][o.e.d.a.b.BulkRequestParser] [envy-172-17-104-1.devops] [types removal] Specifying types in bulk requests is deprecated."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "l"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1577977871208
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "07}}05 envy-172-17-104-1.devops cz-elasticsearch[31604]: [INFO ][o.e.h.AbstractHttpServerTransport] [envy-172-17-104-1.devops] publish"
                },
                {
                  "type": "text",
                  "text": "address {127.0.0.1:9300}, bound",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "addresses {127.0.0.1:9300}"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "07}}05 envy-172-17-104-1.devops cz-elasticsearch[31604]: [INFO ][o.e.n.Node ] [envy-172-17-104-1.devops] started"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "07}}05 envy-172-17-104-1.devops cz-elasticsearch[31604]: [INFO ][o.e.g.GatewayService ] [envy-172-17-104-1.devops] recovered [0] indices into cluster"
                },
                {
                  "type": "text",
                  "text": "state",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "07}}06 envy-172-17-104-1.devops cz-elasticsearch[31604]: [INFO ][o.e.c.m.MetaDataIndexTemplateService] [envy-172-17-104-1.devops] adding template [kibana"
                },
                {
                  "type": "text",
                  "text": "template] for index patterns [.kibana]",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "07}}06 envy-172-17-104-1.devops cz-elasticsearch[31604]: [INFO ][o.e.c.m.MetaDataIndexTemplateService] [envy-172-17-104-1.devops] adding template [logstash"
                },
                {
                  "type": "text",
                  "text": "template] for index patterns [logstash-",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "]"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "07}}06 envy-172-17-104-1.devops cz-elasticsearch[31604]: [INFO ][o.e.r.RepositoriesService] [envy-172-17-104-1.devops] put repository [kibana"
                },
                {
                  "type": "text",
                  "text": "backup]",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan 02 15{{COLON"
                },
                {
                  "type": "text",
                  "text": "NUM",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "07}}06 envy-172-17-104-1.devops cz-elasticsearch[31604]: [WARN ][o.e.s.RestoreService ] [envy-172-17-104-1.devops] [snapshot"
                },
                {
                  "type": "text",
                  "text": "1/J8",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "VazJR8qe1OtVNs9UEw] failed to restore snapshot",
                  "marks": [
                    {
                      "type": "strong"
                    },
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Jan"
                },
                {
                  "type": "text",
                  "text": "\\",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "so.. it seems like it does not like the default .kibana index.. will be intresting to update from a elasticsearch 6 to 7.. so see if there is a issue.."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "But feels like the \"original\" .kibana snapshot (for the saved searches) needs to rebuilt."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1577978197823
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Looks like the kibana-6 index is at replica mode 1 for some reason:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-172-17-104-1:~# es-tools -c list-shards\nindex               shard prirep state      docs  store ip        node\nlogstash-2020-01-02 0     p      STARTED      33 96.3kb 127.0.0.1 envy-172-17-104-1.devops\n.kibana-6           0     p      STARTED       9 12.3kb 127.0.0.1 envy-172-17-104-1.devops\n.kibana-6           0     r      UNASSIGNED                       \n.kibana_7           0     p      STARTED      23 12.7kb 127.0.0.1 envy-172-17-104-1.devops\nroot@envy-172-17-104-1:~# "
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1577978314902
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "following kibana config, kind of works:"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "console.enabled: false\nnewsfeed.enabled: false\nelasticsearch.hosts:\n\nhttp://127.0.0.1:9300\nelasticsearch.preserveHost: true\nelasticsearch.ssl.verificationMode: full\nkibana.defaultAppId: discover\nkibana.index: .kibana\nmap.tilemap.url: https://tiles.elastic.co/v2/default/{z}/{x}/{y}.png\npath.data: /mnt/data/kibana/data/\npid.file: /run/czd/kibana.pid\nserver.basePath: /auditlogs\nserver.host: 127.0.0.1\nserver.port: 9310\nserver.rewriteBasePath: true\n\n"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578037614068
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "seems like the temple.js.hbs has a less vital role into kibana.... it has moved to ./src/legacy/ui/ui\\"
                },
                {
                  "type": "text",
                  "text": "render/bootstrap/template.js.hbs the \"legacy\" feels like its being phased out.. anyway the auth.lua seems to work, after changeing the destination of the \"mods\"",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578041610163
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "saved searches and such needs to be updated.. seems like the snapshot we have, is not compatible with the new kibana version.."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I will try to take another snapshot, using a empty kibana index. and see if that works.. Really really annoying is also that they changed the name of the .kibana index.."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "to .kibana\\"
                },
                {
                  "type": "text",
                  "text": "2 and .kibana\\",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "1 ... and in Appgate 5 we name them like .kibana\\"
                },
                {
                  "type": "text",
                  "text": "7 so... need to check for both.. before adding the snapshot",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578043334472
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "hum.. seems like the content type is needed now adays in the creation of snapshot location.. so README in logging repo will need a update.."
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "curl -XPUT 'http://localhost:9300/_snapshot/kibana_backup' -H 'Content-Type: application/json' -d '{\n    \"type\": \"fs\",\n    \"settings\": {\n        \"compress\" : true,\n        \"location\": \"/tmp/kibanaBackup\"\n    }\n}'"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578043534817
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Maybe we should be using the \"kibana.index\" setting. "
                },
                {
                  "type": "text",
                  "text": "https://www.elastic.co/guide/en/kibana/current/settings.html",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.elastic.co/guide/en/kibana/current/settings.html"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to specify the index.. so we always know its name"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578043978018
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "aha.. we already have that setting... so i guess kibana uses the name as a \"prefix\""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578044781755
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "OR.. its a alias... because doing a snapshot of it.. like :"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "root@envy-172-17-104-1:/tmp/kibanaBackup# rm -rf *\nroot@envy-172-17-104-1:/tmp/kibanaBackup# cd ..\nroot@envy-172-17-104-1:/tmp# curl -XPUT 'http://localhost:9300/_snapshot/kibana_backup/snapshot_1?wait_for_completion=true&pretty' -H 'Content-Type: application/json' -d '{\n     \"indices\": \".kibana\",\n     \"ignore_unavailable\": \"false\",\n     \"include_global_state\": \"false\"\n}'\n{\n  \"snapshot\" : {\n    \"snapshot\" : \"snapshot_1\",\n    \"uuid\" : \"kVYW7ynGQ2OHYcrCQBT3Aw\",\n    \"version_id\" : 7050199,\n    \"version\" : \"7.5.1\",\n    \"indices\" : [\n      \".kibana_2\"\n    ],\n    \"include_global_state\" : false,\n    \"state\" : \"SUCCESS\",\n    \"start_time\" : \"2020-01-03T09:49:22.821Z\",\n    \"start_time_in_millis\" : 1578044962821,\n    \"end_time\" : \"2020-01-03T09:49:23.021Z\",\n    \"end_time_in_millis\" : 1578044963021,\n    \"duration_in_millis\" : 200,\n    \"failures\" : [ ],\n    \"shards\" : {\n      \"total\" : 1,\n      \"failed\" : 0,\n      \"successful\" : 1\n    }\n  }\n}"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578045040096
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "But.. adding and removing searches/visualizations/dashboards is not working like it used to..."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "they however has added a new API.. that is experimental "
                },
                {
                  "type": "text",
                  "text": "https://www.elastic.co/guide/en/kibana/7.x/dashboard-import-api.html",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.elastic.co/guide/en/kibana/7.x/dashboard-import-api.html"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578047507466
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ok.. so if you know the id of a saved search.. you can do like :"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": " curl -X GET \"localhost:9310/auditlogs/api/saved\\_objects/search/SSH-access-log\""
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": " to export it.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578054903129
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "And.. we can for example use the following command to change how the saved search looks.. (here we only include the event\\"
                },
                {
                  "type": "text",
                  "text": "type in the collumns for example)",
                  "marks": [
                    {
                      "type": "em"
                    }
                  ]
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "curl -X POST \"localhost:9310/auditlogs/api/saved\\_objects/search/SSH-access-log?overwrite=true\" -H 'kbn-xsrf: true' -H 'Content-Type: application/json' -d'{\"attributes\":{\"hits\":0,\"columns\":\\[\"event\\_type\"\\],\"description\":\"\",\"sort\":\\[\"@timestamp\",\"desc\"\\],\"title\":\"SSH access log\",\"version\":1,\"kibanaSavedObjectMeta\":{\"searchSourceJSON\":\"{\\\\\"index\\\\\":\\\\\"logstash-\\*\\\\\",\\\\\"highlight\\\\\":{\\\\\"pre\\_tags\\\\\":\\[\\\\\"@kibana-highlighted-field@\\\\\"\\],\\\\\"post\\_tags\\\\\":\\[\\\\\"@/kibana-highlighted-field@\\\\\"\\],\\\\\"fields\\\\\":{\\\\\"\\*\\\\\":{}},\\\\\"require\\_field\\_match\\\\\":false,\\\\\"fragment\\_size\\\\\":2147483647},\\\\\"filter\\\\\":\\[{\\\\\"$state\\\\\":{\\\\\"store\\\\\":\\\\\"appState\\\\\"},\\\\\"meta\\\\\":{\\\\\"alias\\\\\":null,\\\\\"disabled\\\\\":false,\\\\\"index\\\\\":\\\\\"logstash-\\*\\\\\",\\\\\"key\\\\\":\\\\\"daemon\\\\\",\\\\\"negate\\\\\":false,\\\\\"value\\\\\":\\\\\"cz-appliance\\\\\"},\\\\\"query\\\\\":{\\\\\"match\\\\\":{\\\\\"daemon\\\\\":{\\\\\"query\\\\\":\\\\\"cz-appliance\\\\\",\\\\\"type\\\\\":\\\\\"phrase\\\\\"}}}}\\],\\\\\"query\\\\\":{\\\\\"query\\_string\\\\\":{\\\\\"analyze\\_wildcard\\\\\":true,\\\\\"query\\\\\":\\\\\"\\*\\\\\"}}}\"}}}'"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578055428788
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "so... using this.. i guess it would be possible to have all the latest version of searches/visualizations/dashboards.. and if they can not be found... they are inserted."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578055501246
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "mention",
                  "attrs": {
                    "id": "per.leino",
                    "text": "@per.leino",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " - Is this just a task that is designed to keep "
                },
                {
                  "type": "mention",
                  "attrs": {
                    "id": "natan.abolafya",
                    "text": "@natan.abolafya",
                    "accessLevel": ""
                  }
                },
                {
                  "type": "text",
                  "text": " busy having to update the sprints or ???"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "jamie.bodley-scott",
        "created": 1609761313422
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ha ha.. he does that with a script.. so dont worry about that.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1610441039116
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Elasticsearch 7 is something that needs to happen.. once elatic has releases a LTS version of elasticsearch 7..  and also a a first patch release.. it never good to run a 0 version."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1610441096245
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "So here is the list: "
                },
                {
                  "type": "text",
                  "text": "https://www.elastic.co/support/eol",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://www.elastic.co/support/eol"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "   we can see that 6.8.x is supported until 8..0.0 is relased.. and that has not happend yet.. 7.9.x for example. is only supported until 7.10.0..  so those releases are not good to use..  But it should happens any time now that a LTS release is released.. and then we should update.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1610441413046
      }
    ]
  },
  {
    "key": "SA-12783",
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Since "
                },
                {
                  "type": "text",
                  "text": "https://youtrack.ad.cryptzone.com/issue/SA-12782",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://youtrack.ad.cryptzone.com/issue/SA-12782"
                      }
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is implemented.. Then it would make sense, to remove the complete default index creation.. since its not needed anymore."
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "it would be much better if kibana did that it self.. So since we are able to insert the saved searches and similar.. we can do the same thing with the index.."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578065022304
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "Jan 08 09:18:13 envy-172-17-110-1.devops cz-configd[819]: INFO [ActionsRunner] ApplyLogServerServicesAction done\nJan 08 09:18:13 envy-172-17-110-1.devops cz-configd[819]: INFO [ActionsRunner] Running action KibanaExportService() ...\nJan 08 09:18:13 envy-172-17-110-1.devops cz-configd[819]: usage: kibanaImpExp.py [-h] [--export_file EXPORT_FILE]\nJan 08 09:18:13 envy-172-17-110-1.devops cz-configd[819]:                        [--output_dir OUTPUT_DIR] [--version VERSION]\nJan 08 09:18:13 envy-172-17-110-1.devops cz-configd[819]:                        [--input_dir INPUT_DIR] [--kibana_saved KIBANA_SAVED]\nJan 08 09:18:13 envy-172-17-110-1.devops cz-configd[819]:                        [--version_file VERSION_FILE] [--kibana_url KIBANA_URL]\nJan 08 09:18:13 envy-172-17-110-1.devops cz-configd[819]: kibanaImpExp.py: error: unrecognized arguments: --elastic_search http://127.0.0.1:9300\nJan 08 09:18:13 envy-172-17-110-1.devops cz-configd[819]: ERROR [ActionsRunner] Unhandled error while running action KibanaExportService(), carry on...\n                                                          Traceback (most recent call last):\n                                                            File \"/usr/cz-configd/configd/action/actions_runner.py\", line 155, in run\n                                                              action_result = action()\n                                                            File \"/usr/cz-configd/configd/logserver/actions.py\", line 66, in call\n                                                              'http://127.0.0.1:{}'.format(LocalhostPortsTcp.elasticsearch_http.value)])\n                                                            File \"/usr/lib/python3.6/subprocess.py\", line 311, in check_call\n                                                              raise CalledProcessError(retcode, cmd)\n                                                          subprocess.CalledProcessError: Command '['/usr/cz-kibanaBackup/kibanaImpExp.py', '--input_dir', '/usr/cz-kibanaBackup/', '--version_file', '/mnt/data/kib\nJan 08 09:18:13 envy-172-17-110-1.devops cz-configd[819]: INFO [ActionsRunner] Running action LogServerChangeNrOfReplicasAction(number_of_replicas=0) ..."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1578479117094
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "This was fixed here "
                },
                {
                  "type": "text",
                  "text": "https://youtrack.ad.cryptzone.com/issue/SA-12782",
                  "marks": [
                    {
                      "type": "link",
                      "attrs": {
                        "href": "https://youtrack.ad.cryptzone.com/issue/SA-12782"
                      }
                    }
                  ]
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "per.leino",
        "created": 1582882807775
      }
    ]
  },
  {
    "key": "SA-12786",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "[2020-01-06T13:48:34.121Z] Info: Navigation: https://sdphelp.appgate.com/userguide/v5.1/\n[2020-01-06T13:48:42.453Z] Info: About by app menu.\n[2020-01-06T13:52:09.526Z] Info: About by app menu.\n[2020-01-06T17:18:50.252Z] Error: TypeError: Cannot read property 'selectedProfile' of undefined\n[2020-01-06T17:18:50.254Z] Error: Uncaught TypeError: Cannot read property 'selectedProfile' of undefined\n[2020-01-06T17:18:50.589Z] Info: Automatically signed out. Due to administrative policy, you have been signed out after staying idle for too long."
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Only happens when you're on the about page lol."
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1578413296989
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "[^image1578413331278.png]"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1578413344267
      }
    ]
  },
  {
    "key": "SA-12851",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "bulletList",
          "content": [
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Controller"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  Frontend"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  purple auto-update script"
                    }
                  ]
                }
              ]
            },
            {
              "type": "listItem",
              "content": [
                {
                  "type": "paragraph",
                  "content": [
                    {
                      "type": "text",
                      "text": "  test redhat"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "minion@kg-centos8 ~]$ cat /etc/os-release\nNAME=\"CentOS Linux\"\nVERSION=\"8 (Core)\"\nID=\"centos\"\nID_LIKE=\"rhel fedora\"\nVERSION_ID=\"8\"\nPLATFORM_ID=\"platform:el8\"\nPRETTY_NAME=\"CentOS Linux 8 (Core)\"\nANSI_COLOR=\"0;31\"\nCPE_NAME=\"cpe:/o:centos:centos:8\"\nHOME_URL=\"https://www.centos.org/\"\nBUG_REPORT_URL=\"https://bugs.centos.org/\"\n\nCENTOS_MANTISBT_PROJECT=\"CentOS-8\"\nCENTOS_MANTISBT_PROJECT_VERSION=\"8\"\nREDHAT_SUPPORT_PRODUCT=\"centos\"\nREDHAT_SUPPORT_PRODUCT_VERSION=\"8\""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1579184091562
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[minion@kg-centos7 ~]$ cat /etc/os-release\nNAME=\"CentOS Linux\"\nVERSION=\"7 (Core)\"\nID=\"centos\"\nID_LIKE=\"rhel fedora\"\nVERSION_ID=\"7\"\nPRETTY_NAME=\"CentOS Linux 7 (Core)\"\nANSI_COLOR=\"0;31\"\nCPE_NAME=\"cpe:/o:centos:centos:7\"\nHOME_URL=\"https://www.centos.org/\"\nBUG_REPORT_URL=\"https://bugs.centos.org/\"\n\nCENTOS_MANTISBT_PROJECT=\"CentOS-7\"\nCENTOS_MANTISBT_PROJECT_VERSION=\"7\"\nREDHAT_SUPPORT_PRODUCT=\"centos\"\nREDHAT_SUPPORT_PRODUCT_VERSION=\"7\""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1579184111903
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "[minion@pantagruel ~]$ cat /etc/os-release\nNAME=\"Red Hat Enterprise Linux Workstation\"\nVERSION=\"7.7 (Maipo)\"\nID=\"rhel\"\nID_LIKE=\"fedora\"\nVARIANT=\"Workstation\"\nVARIANT_ID=\"workstation\"\nVERSION_ID=\"7.7\"\nPRETTY_NAME=\"Red Hat Enterprise Linux\"\nANSI_COLOR=\"0;31\"\nCPE_NAME=\"cpe:/o:redhat:enterprise_linux:7.7:GA:workstation\"\nHOME_URL=\"https://www.redhat.com/\"\nBUG_REPORT_URL=\"https://bugzilla.redhat.com/\"\n\nREDHAT_BUGZILLA_PRODUCT=\"Red Hat Enterprise Linux 7\"\nREDHAT_BUGZILLA_PRODUCT_VERSION=7.7\nREDHAT_SUPPORT_PRODUCT=\"Red Hat Enterprise Linux\"\nREDHAT_SUPPORT_PRODUCT_VERSION=\"7.7\""
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1579184125299
      }
    ]
  },
  {
    "key": "SA-12877",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "http://nginx.org/en/docs/http/ngx\\_http\\_upstream\\_module.html#ntlm",
              "marks": [
                {
                  "type": "link",
                  "attrs": {
                    "href": "http://nginx.org/en/docs/http/ngx_http_upstream_module.html#ntlm"
                  }
                }
              ]
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Subscribed for the 30 days trial of nginx plus. It works perfect... and the most important thing is that it works in the http level where our module hooks"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "nginx conf"
                }
              ]
            },
            {
              "type": "codeBlock",
              "attrs": {},
              "content": [
                {
                  "type": "text",
                  "text": "upstream http_backend {\n    server 172.17.93.58;\n    ntlm;\n}\n\nserver {\n    listen 172.17.142.2:8080;\n    resolver 127.0.0.1:9253;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for\n\n    location /ntlm {\n       proxy_pass <http://http_backend;>\n       proxy_http_version 1.1;\n       proxy_set_header Connection \"\";\n    }\n\n}\n\n"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "kosmas.valianos",
        "created": 1580307269988
      }
    ]
  },
  {
    "key": "SA-12923",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Referencing this email from jamie: Quoting jamie "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Hi all\n\nIn v5 the resolver is completely broken (so no one is using it).\nIt may have worked in v4 but we realised that it returned internal IPs from within the container which the Gateways do not have access to - so the resolver does not do what was intended and could not have been used.\n\nSince multiple applications are hosted behind the same IP in Kubernetes, for access control, we've introduced url-filtering feature with v5.0, which restricts access based on hostname or path. For example you can create an entitlement that allows following apps: \"Allow https://app1.company.com\" or \"Allow https://apps.company.com/app1\".\n\nAs it is now (in 5.1) where it works again - it presents a security risk because the returned IPs are from an isolated network, different from the Gateway's network where the same IP address range might be used for some other purpose.\n\nIt is therefore my intention to make the K8S resolver disappear in the 5.1 release.\n\nDoes anyone have an issue with this late surprise?\n\nJ."
            }
          ]
        }
      ],
      "version": 1
    }
  },
  {
    "key": "SA-12980",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "To be able to use the open api specification for code generation, we need to resolve the issue from the validator and generator (see attached files)"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "How to re-produce "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "the appgate_sdp_controller.json  file is downloaded from an appliance envrionment at https://controllerAddr.devops:444/api_specs.html\n\nRun open api validation\n\n docker run --rm -v ${PWD}:/local openapitools/openapi-generator-cli validate \\\n    -i /local/appgate_sdp_controller.json \n\nGenerate go code from the openAPI spec file\n\ndocker run --rm -v ${PWD}:/local openapitools/openapi-generator-cli generate \\\n    -i /local/appgate_sdp_controller.json \\\n    -g go \\\n    -o /local/out/go "
            }
          ]
        }
      ],
      "version": 1
    },
    "comments": [
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "well, it complains about every API, not sure what I'm supposed to do :D"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "natan.abolafya",
        "created": 1580132492861
      },
      {
        "body": {
          "type": "doc",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "I don't either unfortunately, I'm not that familiar with openapi yet. need to debug further, any help is welcome :)"
                }
              ]
            }
          ],
          "version": 1
        },
        "author": "daniel.nilsson",
        "created": 1580137186890
      }
    ]
  },
  {
    "key": "SA-11867",
    "description": {
      "type": "doc",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "The following error (seen on purple31): "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "{'error': {'code': 403, 'message': 'Request had insufficient authentication scopes.', 'status': 'PERMISSION_DENIED'}}"
            }
          ]
        },
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Results in a stack trace when parsing the error: "
            }
          ]
        },
        {
          "type": "codeBlock",
          "attrs": {},
          "content": [
            {
              "type": "text",
              "text": "Aug 29 15:36:22 purple31.cryptzone.com cz-named[3544]: [DEBUG] [gcp] API Request https://cloudresourcemanager.googleapis.com/v1/projects - query: {'filter': 'lifecycleState:ACTIVE AND (appgate-dev)', 'fields': 'projects.projectId'} - response 403\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]: [DEBUG] [gcp] End of pagination, no more results for https://cloudresourcemanager.googleapis.com/v1/projects .\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]: [ERROR] [Resolver \"GCP Resolver - appgate-dev, GCP Resolver - product-team-222016\"] Error occurred when resolving uri label:deployment=test-harish\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]: Traceback (most recent call last):\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]:   File \"/usr/cz-named/named/resolvers/resolver.py\", line 176, in resolve\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]:     return await self.resolve_name(name=name, backoff_f=backoff_f)\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]:   File \"/usr/cz-named/named/resolvers/gcp/resolver.py\", line 216, in resolve_name\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]:     projects = list(await client.get_projects(project_filter=gcp_name.filter_project))\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]:   File \"/usr/cz-named/named/resolvers/gcp/client.py\", line 259, in get_projects\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]:     callback=instance_resolver_from_project_response))\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]:   File \"/usr/cz-named/named/resolvers/gcp/client.py\", line 305, in traverse_request\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]:     for error in response.content['error']['errors']:\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]: KeyError: 'errors'\nAug 29 15:36:22 purple31.cryptzone.com cz-named[3544]: [DEBUG] [Resolver \"GCP Resolver - appgate-dev, GCP Resolver - product-team-222016\"] Names batch 0 resolved in 0.11 seconds"
            }
          ]
        }
      ],
      "version": 1
    }
  }
]