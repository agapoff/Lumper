{
    "key": "SA-266",
    "description": {
        "version": 1,
        "type": "doc",
        "content": [
            {
                "type": "paragraph",
                "content": [
                    {
                        "type": "text",
                        "text": "Logs coming from the Azure Gateway to the log server hosted at Connect (log.sa.cryptzone.com) time out from now and then.Here is a better description of this from a conversation between Per Leino and Kristinn:Per Leino [16:13] hi Kristinn... when you setup azure.. did you specify any tcp source port range ?Per Leino [16:14]when azure gw is connecting to logserver , i usually see a port like 1081 -&gt; 1087 ..Per Leino [16:14]but at some times, it does a port reuse, when a new tcp connection is made...Per Leino [16:14]and at those times i can see that there is a delay to connect..Kristinn \u00d6rn Sigur\u00f0sson [16:17] hm nope not to my knowledgeKristinn \u00d6rn Sigur\u00f0sson [16:17]that's weirdKristinn \u00d6rn Sigur\u00f0sson [16:17]so it's trying to reuse a port that is already in use or?Per Leino [16:26] i dont know.. it is strange.. from azure i just do a simple connect to the logging server...Per Leino [16:26]all goes ok...Per Leino [16:26]i can see that azure is using portsPer Leino [16:26]like 1080Per Leino [16:26]1081Per Leino [16:26]1082Per Leino [16:27]1083Per Leino [16:27]etc etc..Per Leino [16:27]but then all the sudden it uses 1064Per Leino [16:27]and for some reason the SYN fails.Per Leino [16:27]it does not get any responce from the log serverPer Leino [16:27]same pattern every timeKristinn \u00d6rn Sigur\u00f0sson [16:27] I'm wondering if it has something to do with the natting of the log serverKristinn \u00d6rn Sigur\u00f0sson [16:28]or does it work from aws?Per Leino [16:28] it allways work from amazonKristinn \u00d6rn Sigur\u00f0sson [16:28] okKristinn \u00d6rn Sigur\u00f0sson [16:28]hmKristinn \u00d6rn Sigur\u00f0sson [16:28]let me look into itKristinn \u00d6rn Sigur\u00f0sson [16:28]need to google and stuff, not sure what it can bePer Leino [16:29] i reproduce it like:Per Leino [16:29]nc -vz log.sa.cryptzone.com 5000  &lt;-- on azurePer Leino [16:29]sudo tcpdump -i eth0 tcp port 5000 -n -X &lt;-- on logging serverKristinn \u00d6rn Sigur\u00f0sson [16:29] ok coolKristinn \u00d6rn Sigur\u00f0sson [16:29]I will investigate this nowKristinn \u00d6rn Sigur\u00f0sson [16:29]thanksPer Leino [16:30] npPer Leino [17:01] there is a article @ "
                    },
                    {
                        "type": "text",
                        "text": "https://msdn.microsoft.com/en-us/library/azure/dn848316.aspx",
                        "marks": [
                            {
                                "type": "link",
                                "attrs": {
                                    "href": "https://msdn.microsoft.com/en-us/library/azure/dn848316.aspx"
                                }
                            }
                        ]
                    },
                    {
                        "type": "text",
                        "text": "  where the number of source ports can be configured?Kristinn \u00d6rn Sigur\u00f0sson [17:02] maybe we will need to use the security groups feature. It isn't available in the GUI (at least I haven't found it) so we didn't know about it, that's the reason we use the SNAT hackKristinn \u00d6rn Sigur\u00f0sson [17:02]but if this can be fixed by using security groups then we might need to do thatKristinn \u00d6rn Sigur\u00f0sson [17:23] I think it just uses the next available port. I don't know why this would be an issueKristinn \u00d6rn Sigur\u00f0sson [17:24]weirdKristinn \u00d6rn Sigur\u00f0sson [17:24]it's using 1024-1040 ca. for me now and it's workingKristinn \u00d6rn Sigur\u00f0sson [17:24]from a different azure vmKristinn \u00d6rn Sigur\u00f0sson [17:24]we should investigate this further after RSAKristinn \u00d6rn Sigur\u00f0sson [17:24]I can't do any good tests nowKristinn \u00d6rn Sigur\u00f0sson [17:28]I'll add this to the devops backlog in youtrackKristinn \u00d6rn Sigur\u00f0sson [17:28]we'll take a better look after RSA, unless this is a showstopper for RSA"
                    }
                ]
            }
        ]
    }
}