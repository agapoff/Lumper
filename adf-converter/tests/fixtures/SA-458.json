{
  "key": "SA-458",
  "scenarios": [
    "Real data from SA-458"
  ],
  "fields": {
    "description": "<div class=\"wiki text prewrapped\">1. Client [tun-service and high level app]<br />2. Sessiond<br />3. logd [<a href=\"/issue/SA-852\" class=\"issue-resolved\" target=\"_self\" rel=\"noopener noreferrer nofollow\" data-issue-id=\"36-10247\" title=\"Remove stream module's security settings and build nginx without this module at all\">SA-852</a>]<br />4. Controller [all its micro-services] [<a href=\"/issue/SA-833\" class=\"issue-resolved\" target=\"_self\" rel=\"noopener noreferrer nofollow\" data-issue-id=\"36-10200\" title=\"Upgrade AESUtils class to use AES256\">SA-833</a>]<br />5. Nginx settings: Nginx is a TLS endpoint hiding controller and sessiond behind. It must be verified in same manner like our VPN daemon. there is a know security flaw already [<a href=\"/issue/SA-1069\" class=\"issue-resolved\" target=\"_self\" rel=\"noopener noreferrer nofollow\" data-issue-id=\"36-8032\" title=\"Enable certificate verification in nginx\">GW-356</a>]<br /><br />Examples: There was a case long time ago that the client could start a TLS connection with simple DH instead of ECDHE. The correct behavior is to drop everything except ECDHE-RSA-AES256-GCM-SHA384. Another case were that the certificates produced had poor key size and SHA1 as signature.</div>",
    "comments": [
      {
        "author": {
          "login": "kosmas.valianos",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">This task can be marked as verified if and only if:<br/>1. All the components have a clear list of security requirements [ciphers, protocols etc]<br/>2. Has been verified that all the above are followed by our system<br/><br/>In case it is found that something is not followed (step 2) or requirements for components do not even exist (step 1) a new task shall be created and linked here as &quot;depends on&quot;</div>\n",
        "created": 1437298191026,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "kosmas.valianos",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Example with using the openssl s_client tool<br/><br/><pre class=\"wikicode prettyprint\">Command: openssl s_client -connect 192.168.111.116:23232 -cert certs/client-cert.pem -key certs/client-key.pem<br/><br/>Output:<br/><br/>kova@ubuntu:~/github/stratus-gateway/vpnd$ openssl s_client -connect 192.168.111.116:23232 -cert certs/client-cert.pem -key certs/client-key.pem<br/>CONNECTED(00000003)<br/>depth=1 CN = Cryptzone Controller Root<br/>verify error:num=19:self signed certificate in certificate chain<br/>verify return:0<br/>---<br/>Certificate chain<br/> 0 s:/serialNumber=I6eyJyYXdDbGFpbXNUb2tlbiI<br/>   i:/CN=Cryptzone Controller Root<br/> 1 s:/CN=Cryptzone Controller Root<br/>   i:/CN=Cryptzone Controller Root<br/>---<br/>Server certificate<br/>-----BEGIN CERTIFICATE-----<br/>MIIC3TCCAcWgAwIBAgIGAUopFThZMA0GCSqGSIb3DQEBDQUAMCQxIjAgBgNVBAMM<br/>GUNyeXB0em9uZSBDb250cm9sbGVyIFJvb3QwHhcNMTQxMjA4MDg0NzQ0WhcNMTUx<br/>MjA4MDg0NzQ0WjAkMSIwIAYDVQQFExlJNmV5SnlZWGREYkdGcGJYTlViMnRsYmlJ<br/>MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAr4nCKXv5r0sWkPwyQnA9<br/>SbK0S86BcGbY0etgj0eISrSg4sTzYTG6lIiaguBCpKG4p+E8TrakotM/11OA2T8A<br/>1Z4daXLMmHeKJfQxOVgXde9c73/fdQpin1RDmUZ6RIGEwwbby/4cLgReD87/ISC7<br/>l7UrKxER4EuBDGLzZ6Ul8hIysQBPSsexNa7vTqCOQ2WLqDHrSJLPE1FR6igTCYkw<br/>PIl3LjLxLHPXhfswDpSqNq/iK5tTWLMnaWIcq1UQLeQLHDDHJxQr8nuGw3ZLGKLj<br/>hv1KMmljEsZtJumpC2ElYbg9DFQK56JQBZfRIQXgW0juU6c+KNIP6Z19nAsuxnSJ<br/>wQIDAQABoxUwEzARBglghkgBhvhCAQEEBAMCB4AwDQYJKoZIhvcNAQENBQADggEB<br/>AIQakrjmL/NJYdtjZjEDNGB+sTOm+tLI1s0K+OsOAnNZWBf0ADdaMAuAlvAJbdNb<br/>wgcZS0kE/3DAIsPpRVjGS4UlAjezIhKjd7cBMR9kabMR5LWhWBWoj3Q6bNjHMStN<br/>SUqxE0uRIHheafgFZuAbp2WjiSMOSq1uSJlLFdd3R/7x/ihf8OfLhZvF84h51fEE<br/>bvDtMjfoldeAfm/mFT8wNWZeImHnx7qLp6Ul5ITcO3wMGZ0ON91lOJK1YDqzwuZD<br/>zDKQ9odBTiSicE75sV5Ij80fJCeD40MOwICqWzBr6BE2Gf1aj6ckeKm28D4vxyFA<br/>VEG0lIxGPhnHffgrnhSiI5I=<br/>-----END CERTIFICATE-----<br/>subject=/serialNumber=I6eyJyYXdDbGFpbXNUb2tlbiI<br/>issuer=/CN=Cryptzone Controller Root<br/>---<br/>Acceptable client certificate CA names<br/>/CN=Cryptzone Controller Root<br/>---<br/>SSL handshake has read 3358 bytes and written 2145 bytes<br/>---<br/>New, TLSv1/SSLv3, Cipher is ECDHE-RSA-AES256-GCM-SHA384<br/>Server public key is 2048 bit<br/>Secure Renegotiation IS supported<br/>Compression: NONE<br/>Expansion: NONE<br/>SSL-Session:<br/>    Protocol  : TLSv1.2<br/>    Cipher    : ECDHE-RSA-AES256-GCM-SHA384<br/>    Session-ID: 37106A0E60B772DBFBB20138B329F89B4A555805737482D5C5E723D3FAC87124<br/>    Session-ID-ctx: <br/>    Master-Key: E1C8F6749C2CBDA967019EEC2A966347DDA8DB8F15D4ADF7619757076928484E622A3E415ED777B75591E509E2984D39<br/>    Key-Arg   : None<br/>    PSK identity: None<br/>    PSK identity hint: None<br/>    SRP username: None<br/>    TLS session ticket lifetime hint: 7200 (seconds)<br/>    TLS session ticket:<br/>    0000 - 51 4b 02 c1 8d 0c 73 9f-ba 5a 09 d6 61 16 a8 33   QK....s..Z..a..3<br/>    0010 - 26 77 7d f3 0a 70 bd d8-72 c5 f4 f4 af 30 4b ae   &amp;w}..p..r....0K.<br/>    0020 - d6 4b c7 de ee 35 66 c9-ea 87 09 35 79 5b 6b d2   .K...5f....5y[k.<br/>    0030 - 69 74 23 8c 9a 1d ed 29-51 36 63 8b 3e 1c 66 76   it#....)Q6c.&gt;.fv<br/>    0040 - d7 67 ed 11 7a 36 7a f0-ef d4 b6 4a 98 70 24 76   .g..z6z....J.p$v<br/>    0050 - 6e 64 12 65 84 8d 66 0b-b8 cb b3 55 f4 c2 bc f1   nd.e..f....U....<br/>    0060 - 33 20 53 39 e2 12 d3 88-14 a3 54 ab d4 18 be be   3 S9......T.....<br/>    0070 - 6f 73 cb fe 12 1b aa 35-5b 3f 2f e9 a2 9d ab 66   os.....5[?/....f<br/>    0080 - 13 e6 7d 6a 28 57 66 01-d8 96 a1 21 ff c2 d6 76   ..}j(Wf....!...v<br/>    0090 - 7a b0 29 da 45 96 23 8d-e5 b4 88 41 c8 64 3a 3e   z.).E.#....A.d:&gt;<br/>    00a0 - a0 a2 50 34 72 10 89 f7-7d 7c 49 30 75 1c c8 49   ..P4r...}|I0u..I<br/>    00b0 - ec d4 6f 1f 92 a2 ba 73-cb 88 15 7e 08 8a 35 64   ..o....s...~..5d<br/>    00c0 - e6 99 8f 62 12 eb 1c 3c-72 ca 5b ca 3d 34 63 ae   ...b...&lt;r.[.=4c.<br/>    00d0 - d5 a9 55 fc 82 fe dd a4-06 ab bc 3b f1 31 8d 1e   ..U........;.1..<br/>    00e0 - d5 ed 31 cf c5 f1 ed 57-39 eb f7 0d 4a ed 50 37   ..1....W9...J.P7<br/>    00f0 - 9f da 93 66 c7 af 55 b2-50 fb 7f 90 21 71 94 1c   ...f..U.P...!q..<br/>    0100 - 14 57 24 c2 93 ba da ca-33 85 c0 80 ae 5e 61 5f   .W$.....3....^a_<br/>    0110 - ea ea a4 e9 c8 3d b1 a2-0a 62 a8 28 19 08 aa 2b   .....=...b.(...+<br/>    0120 - 17 80 37 47 70 19 16 f3-d0 84 8f 8e d0 4a 9a d3   ..7Gp........J..<br/>    0130 - 21 0a fe d2 50 15 07 75-fe 3e d2 16 10 62 1e 6b   !...P..u.&gt;...b.k<br/>    0140 - 3e 7b 60 71 51 57 71 0c-9e af 5a e9 df 9f 72 4c   &gt;{`qQWq...Z...rL<br/>    0150 - 18 aa 9b 01 a9 28 2d 7c-75 dc 6a 7b ac 39 08 13   .....(-|u.j{.9..<br/>    0160 - 47 66 ff 2a 25 2f 93 c1-4f 6b 5d fa e6 83 a2 bf   Gf.*%/..Ok].....<br/>    0170 - 86 21 f2 d4 ea 33 41 54-cf 6a 16 cf fd cb 50 18   .!...3AT.j....P.<br/>    0180 - c4 1a c0 df 7b b8 44 bd-51 65 13 b6 9e 6e 55 ad   ....{.D.Qe...nU.<br/>    0190 - e0 43 43 20 a2 b3 cd fa-a1 89 e1 94 09 77 e1 44   .CC .........w.D<br/>    01a0 - fa b8 b2 ae eb fc d3 8d-05 c1 92 66 fe c1 f8 ba   ...........f....<br/>    01b0 - 3c f7 8b 40 b7 17 89 3a-91 60 65 55 b4 a3 ff e7   &lt;..@...:.`eU....<br/>    01c0 - 8d 50 e1 87 3f ec 87 be-4a b0 6b 1f 10 ae 86 85   .P..?...J.k.....<br/>    01d0 - bf 50 ec a4 2f 59 79 b7-0f cf 7b b7 90 72 00 36   .P../Yy...{..r.6<br/>    01e0 - 19 68 ec 81 8e 96 b2 57-2c 56 9f 39 29 6c 78 41   .h.....W,V.9)lxA<br/>    01f0 - c1 f9 ea 28 ab c1 b5 09-20 c0 21 08 86 ea f7 3c   ...(.... .!....&lt;<br/>    0200 - ff 45 ba 46 3c d5 f7 a7-a5 9b 9c 43 5d e1 57 75   .E.F&lt;......C].Wu<br/>    0210 - c4 e3 b7 59 2b 2b 85 e7-48 0f 4d 82 2d 5e e2 a7   ...Y++..H.M.-^..<br/>    0220 - 38 94 2f 02 2b 7f 03 41-9a d2 aa fb 10 4c 6c 10   8./.+..A.....Ll.<br/>    0230 - cf 80 86 e6 67 72 64 f5-de 58 3c 4e 92 de 04 1e   ....grd..X&lt;N....<br/>    0240 - cc 4e 2f 03 b1 a9 24 2f-22 eb e6 85 09 e9 ff 41   .N/...$/&quot;......A<br/>    0250 - 28 19 08 10 51 2a a9 15-1c 34 33 cf 13 6a 4d 30   (...Q*...43..jM0<br/>    0260 - a5 23 80 1a 74 92 1b 3a-4c e4 25 8e 2b 07 bc 5b   .#..t..:L.%.+..[<br/>    0270 - e5 5d aa 0b 5d ab 99 d1-21 bd c9 58 d3 76 1c 55   .]..]...!..X.v.U<br/>    0280 - ae 54 22 43 ad 9f b0 09-27 ae 8d e0 70 a9 98 78   .T&quot;C....&#39;...p..x<br/>    0290 - fe 22 4d 4f ab 39 ec 48-9e 94 14 aa 98 31 ef 1a   .&quot;MO.9.H.....1..<br/>    02a0 - e3 a4 04 7b c6 62 5c de-15 b4 ce d5 c2 7b 21 4c   ...{.b\\......{!L<br/>    02b0 - 2b 69 ad fe d4 cb ec ee-ba 7a 27 33 43 e7 79 db   +i.......z&#39;3C.y.<br/>    02c0 - df 6c 68 b8 28 b1 f9 a1-a9 12 7c e4 fa 65 cd 17   .lh.(.....|..e..<br/>    02d0 - fa ea 66 d9 32 54 b4 d3-64 3b 91 23 89 0c d8 c4   ..f.2T..d;.#....<br/>    02e0 - cf ca 1d 04 ef a1 66 21-c6 c1 a1 c7 b6 cb 7d 35   ......f!......}5<br/>    02f0 - d3 fc 31 b5 cf 5f 4b 17-2e f1 c2 98 b9 0f 9d ba   ..1.._K.........<br/>    0300 - 9b e6 7f 51 35 b2 6d 29-b8 22 b4 d6 b2 32 08 b5   ...Q5.m).&quot;...2..<br/>    0310 - d6 50 3b b1 81 3a f6 f4-e6 50 15 e4 10 e6 62 cc   .P;..:...P....b.<br/>    0320 - ad 5b 12 ef 86 32 40 18-0b dd c7 06 c0 bb 0b c8   .[...2@.........<br/>    0330 - 67 3a c9 9f dd 7e 38 6b-a1 6d f7 e8 10 03 ad 5a   g:...~8k.m.....Z<br/>    0340 - 82 0e 03 2e 1d f4 09 15-ba 8b 0c e7 3f 26 d2 a5   ............?&amp;..<br/>    0350 - 14 d5 5d 4c d2 56 3e 10-e9 c9 0c 25 f1 27 55 c0   ..]L.V&gt;....%.&#39;U.<br/>    0360 - 92 75 4c 60 e9 44 57 a9-f4 52 cf 03 e5 01 86 9f   .uL`.DW..R......<br/>    0370 - 94 d7 02 52 e7 13 60 56-16 2d 73 3d 60 fc 39 1a   ...R..`V.-s=`.9.<br/>    0380 - b8 d3 fa 9d fe 6a 7e 50-37 0e fc 3a fd 9c cf c7   .....j~P7..:....<br/>    0390 - 2e 14 f5 57 20 cd c0 06-92 67 ac 64 13 6c 1a 4a   ...W ....g.d.l.J<br/>    03a0 - 4d 96 f3 51 a7 19 fb dc-8d a3 c7 1e b2 5d f2 e5   M..Q.........]..<br/>    03b0 - 6e 92 86 bb fe 64 a6 f6-db 0d 6f a1 ec 38 9a e6   n....d....o..8..<br/>    03c0 - 0d 7b 17 4d 9d 9a bb 21-83 56 32 87 02 6b 0c 1a   .{.M...!.V2..k..<br/>    03d0 - d4 8c cb a5 28 b1 b5 84-a5 5f 28 e3 78 c7 51 dd   ....(...._(.x.Q.<br/>    03e0 - 6e f2 81 69 c3 e2 82 24-62 78 f3 05 80 d3 e4 08   n..i...$bx......<br/>    03f0 - 64 d8 08 b8 c4 5a 62 2d-b8 62 af 68 46 db e1 9d   d....Zb-.b.hF...<br/>    0400 - 7a 96 28 32 b9 ac f9 9b-b4 6b 3e 83 8d d6 db bf   z.(2.....k&gt;.....<br/>    0410 - c8 19 8a 08 ee 75 e5 be-97 43 d4 60 0e 26 40 15   .....u...C.`.&amp;@.<br/>    0420 - f5 3f 23 03 94 7b b0 1e-56 45 a4 92 2f 45 b7 90   .?#..{..VE../E..<br/>    0430 - 91 6e cf da ad 78 2a 87-0a 23 f7 dc 6f 8d de b5   .n...x*..#..o...<br/>    0440 - 33 e0 69 90 88 ea 7e f3-15 91 42 a1 6d 8c 53 d4   3.i...~...B.m.S.<br/>    0450 - 6f ba eb db 2e ce 18 8a-6c 80 cc 31 bb 3e f5 ee   o.......l..1.&gt;..<br/>    0460 - f0 01 3a ef de 91 3e 90-6f a3 9c 62 d7 f2 98 43   ..:...&gt;.o..b...C<br/>    0470 - bc 9d 50 37 fe 11 c3 15-97 af a1 68 b4 22 0f bd   ..P7.......h.&quot;..<br/>    0480 - 3c fd 70 7d df f0 27 9b-9c b3 8d d0 a8 51 97 80   &lt;.p}..&#39;......Q..<br/>    0490 - b6 25 09 b4 91 08 26 3d-3e be 6e 79 70 8c 86 37   .%....&amp;=&gt;.nyp..7<br/>    04a0 - 27 88 f9 5b 99 3b 3b 60-df 28 00 25 ae ce 78 74   &#39;..[.;;`.(.%..xt<br/>    04b0 - ea 51 fd 54 c5 7c fc e3-d3 33 5f 18 29 3a 32 02   .Q.T.|...3_.):2.<br/>    04c0 - e5 47 7f c1 5b ef cb e9-4b 68 a1 a0 7c 97 27 dd   .G..[...Kh..|.&#39;.<br/>    04d0 - cf 81 29 62 91 84 d3 30-e9 62 4e ca 07 57 01 c8   ..)b...0.bN..W..<br/><br/>    Start Time: 1424266380<br/>    Timeout   : 300 (sec)<br/>    Verify return code: 19 (self signed certificate in certificate chain)</pre><br/>As you can see the output lists all the security settings. If there is a mismatch the test shall fail. Moreover you should try to connect with other ciphers, protocols etc... You MUST not be able to have a successful connection. That way you can test the security settings! The program takes arguments so you can try a connection for example with &quot;tls1_1&quot;. This shall fail. The same by giving as argument a specific cipher that is not supported. You can do that with the &quot;-ciphers&quot; option.<br/><br/><pre class=\"wikicode prettyprint\">openssl s_client -tls1_1 -connect 192.168.111.116:23232 -cert certs/client-cert.pem -key certs/client-key.pem<br/><br/>Output:<br/>kova@ubuntu:~/github/stratus-gateway/vpnd$ openssl s_client -tls1_1 -connect 192.168.111.116:23232 -cert certs/client-cert.pem -key certs/client-key.pem<br/>CONNECTED(00000003)<br/>139634997827232:error:1409442E:SSL routines:SSL3_READ_BYTES:tlsv1 alert protocol version:s3_pkt.c:1262:SSL alert number 70<br/>139634997827232:error:1409E0E5:SSL routines:SSL3_WRITE_BYTES:ssl handshake failure:s3_pkt.c:598:</pre><br/><strong>Which verifies that the handshake failed</strong><br/></div>\n",
        "created": 1437300831764,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "gokhan.berberoglu",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">controller does not do https.. all behind nginx.</div>\n",
        "created": 1437395668004,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">What about <a href=\"/issue/SA-1069\" class=\"issue-resolved\" target=\"_self\" data-issue-id=\"36-8032\" title=\"Enable certificate verification in nginx\">GW-356</a>, do we need it? Wouldn&#39;t it make it difficult to login to the admin UI, if it is served on the same port as the rest? I guess the nginx setting to require a client cert is per port, not per location?</div>\n",
        "created": 1438702099261,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">I ran an ssllabs.com test against appgate2: <a href=\"https://www.ssllabs.com/ssltest/analyze.html?d=appgate2.cryptzone.com&amp;hideResults=on\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.ssllabs.com/ssltest/analyze.html?d=appgate2.cryptzone.com&hideResults=on</a><br/><br/>Apart from the cert not being trusted, they claim that the ciphers are incompatible with a bunch of browsers:<br/><br/><div class=\"wiki quote\">Handshake Simulation<br/>Android 2.3.7   No SNI 2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Android 4.0.4<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Android 4.1.1<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Android 4.2.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Android 4.3<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Android 4.4.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>256<br/>Android 5.0.0<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>128<br/>Baidu Jan 2015<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>BingPreview Jan 2015<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>256<br/>Chrome 43 / OS X  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>128<br/>Firefox 31.3.0 ESR / Win 7<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>128<br/>Firefox 39 / OS X  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>128<br/>Googlebot Feb 2015<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>128<br/>IE 6 / XP   No FS 1<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>  No SNI 2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>IE 7 / Vista<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>IE 8 / XP   No FS 1<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>  No SNI 2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>IE 8-10 / Win 7  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>IE 11 / Win 7  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>IE 11 / Win 8.1  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>IE 10 / Win Phone 8.0<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>IE 11 / Win Phone 8.1  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>IE 11 / Win Phone 8.1 Update  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Edge 12 / Win 10 (Build 10130)  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>256<br/>Java 6u45   No SNI 2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Java 7u25<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Java 8u31<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>128<br/>OpenSSL 0.9.8y<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>OpenSSL 1.0.1l  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>256<br/>OpenSSL 1.0.2  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>256<br/>Safari 5.1.9 / OS X 10.6.8<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Safari 6 / iOS 6.0.1  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Safari 6.0.4 / OS X 10.8.4  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Safari 7 / iOS 7.1  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Safari 7 / OS X 10.9  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Safari 8 / iOS 8.4  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Safari 8 / OS X 10.10  R<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Protocol or cipher suite mismatch<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>Fail3<br/>Yahoo Slurp Jan 2015<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>256<br/>YandexBot Jan 2015<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS 1.2<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)   FS<span class=\"wiki tab\">&nbsp;&nbsp;&nbsp;&nbsp;</span>256<br/>(1) Clients that do not support Forward Secrecy (FS) are excluded when determining support for it.<br/>(2) No support for virtual SSL hosting (SNI). Connects to the default site if the server uses SNI.<br/>(3) Only first connection attempt simulated. Browsers tend to retry with a lower protocol version.<br/>(R) Denotes a reference browser or client, with which we expect better effective security.<br/>(All) We use defaults, but some platforms do not use their best protocols and features (e.g., Java 6 &amp; 7, older IE).</div><br/><br/>Not sure if this is serious, since<br/><br/><div class=\"wiki quote\">(3) Only first connection attempt simulated. Browsers tend to retry with a lower protocol version.</div><br/><br/>However, can it be that we only allow TLS 1.2? The following softwares apparently don&#39;t support it:<br/><br/>Android 4.3<br/>IE 7 / Vista<br/>IE 8-10 / Win 7<br/>IE 10 / Win Phone 8.0<br/>Java 7u25<br/>OpenSSL 0.9.8y<br/>Safari 6.0.4 / OS X 10.8.4<br/><br/>My phone is Android 4.3 :-(</div>\n",
        "created": 1438704784247,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "gokhan.berberoglu",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">@tom I also ran lots of online ssl checkers.. the incompatibility you&#39;ve listed is as expected.. we only support latest versions of chrome and firefox. rest of the browsers should not work.<br/><br/>I think we should leave that as is for now.. we should check with android (chrome) / ios tablets (safari &gt; ios 8+), if they work then we don&#39;t need to do add any more fall-backs.</div>\n",
        "created": 1439279642923,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "gokhan.berberoglu",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">about <a href=\"/issue/SA-1069\" class=\"issue-resolved\" target=\"_self\" data-issue-id=\"36-8032\" title=\"Enable certificate verification in nginx\">GW-356</a>, we already have different prefixes for /admin and /client .. /admin, where the admin rest api and admin ui is located needs to have different ssl configuration, because of certificate. we should allow customer to upload a valid certificate, otherwise it will be very annoying for admins AND it&#39;ll be a problem to consume an API behind a self-signed cert.</div>\n",
        "created": 1439279758976,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "kosmas.valianos",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\"><div class=\"wiki quote\">controller does not do https.. all behind nginx</div><br/>It does not have to be https handling to use ciphers for some reason :)<br/><br/><br/>Found that in controller <a href=\"https://github.cryptzone.ad/cryptzone/stratus-controller/blob/master/Common.Library/src/main/java/com/cryptzone/controller/common/library/crypto/AESUtils.java\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.cryptzone.ad/cryptzone/stratus-controller/blob/master/Common.Library/src/main/java/com/cryptzone/controller/common/library/crypto/AESUtils.java</a><br/><br/>AESUtils class was not using AES256. Created a ticket for it <a href=\"/issue/SA-833\" class=\"issue-resolved\" target=\"_self\" data-issue-id=\"36-10200\" title=\"Upgrade AESUtils class to use AES256\">SA-833</a></div>\n",
        "created": 1440427537515,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "kosmas.valianos",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Found that:<br/>1. We do not use the best key size for the HMAC in DTLS cookie<br/>2. Not taking advantage of the RDRAND instruction for generating random numbers provided by intel CPUs<br/><br/>Created <a href=\"/issue/SA-844\" class=\"issue-resolved\" target=\"_self\" data-issue-id=\"36-10236\" title=\"Update DTLS cookie creation\">SA-844</a></div>\n",
        "created": 1440592844384,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "kosmas.valianos",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Totally wrong settings:<br/><br/><pre class=\"wikicode prettyprint\">root@appgate2:/etc/nginx/streams-enabled# cat default <br/>server {<br/>    listen 6000 ssl;<br/>    proxy_pass localhost:5000;<br/>    ssl_certificate /etc/cz-common/appliance-cert.pem;<br/>    ssl_certificate_key /etc/cz-common/appliance-priv.pem;<br/>    ssl_ciphers AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;<br/>    ssl_prefer_server_ciphers on;<br/>    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;<br/>    ssl_session_cache off;<br/>}<br/></pre><br/>Do we even need anymore the stream module?<br/><br/>The sites-enabled:<br/><pre class=\"wikicode prettyprint\">ssl_certificate /etc/cz-common/appliance-cert.pem;<br/>    ssl_certificate_key /etc/cz-common/appliance-priv.pem;<br/>    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256;<br/>    ssl_client_certificate /etc/cz-common/controller-cert.pem;<br/>    ssl_prefer_server_ciphers on;<br/>    ssl_protocols TLSv1.2;<br/>    ssl_session_cache off;<br/>    ssl_verify_client optional;<br/>    ssl_verify_depth 1;<br/></pre><br/>is fine except the &quot;ssl_verify_client optional&quot; which will be changed with <a href=\"/issue/SA-1069\" class=\"issue-resolved\" target=\"_self\" data-issue-id=\"36-8032\" title=\"Enable certificate verification in nginx\">GW-356</a></div>\n",
        "created": 1440601370623,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "kosmas.valianos",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Moving to &quot;done&quot;. All the &quot;depends on&quot; tasks have been identified, all the other aspects have been verified<br/>Re-open in case that something was forgotten, not found</div>\n",
        "created": 1440661948798,
        "$type": "IssueComment"
      }
    ]
  }
}