{
  "key": "SA-459",
  "scenarios": [
    "Real data from SA-459"
  ],
  "fields": {
    "description": "<div class=\"wiki text prewrapped\">The appliance shall have:<br/>1. Open ports only 443 and 22<br/>2. A basic set of rules by default<br/>3. Key-pair generation [Following the highest standards]: key file must have proper file permissions and be as protected as possible. If it is compromised then game over...<br/>4. A certificate [appliance sends its public key for signing to the controller] with the <strong>signature verified</strong>. This means that the appliance must be installed with controller&#39;s CA as trusted certificate, so that it can verify the certificate that it will receive.<br/>5. IPC (Inter Process Communication): The ONLY processes that have direct contact with the outer world are proxyd and sshd (ssh shall be configured to listen only in the internal network). All others must listen on Unix Domain Sockets.<br/><pre class=\"wikicode prettyprint\">      |------Unix Domain Socket------Nginx|-----Unix Domain Sockets------Controller&#39;s services, Session daemon etc<br/>proxyd|<br/>      |------Unix Domain Socket------VPN daemon (File descriptor passing, traffic is NOT flowing through proxyd after first TCP segment)</pre>In case proxyd is absent VPN daemon and Nginx go in front. It shall be verified that all the other components are totally deaf. They must use unix domain sockets and if that is not applicable their sockets must listen only localhost. There was a case for example were all daemons had a pure IP socket so anyone could contact them and start sending, receiving stuff... Cool to demo as we had vpnd on machine A, sessiond on machine B and controller on machine C but total security nakedness (<a href=\"/issue/GW-151\" class=\"issue-resolved\" target=\"_self\" data-issue-id=\"36-6899\" title=\"Secure communication between sessiond and vpnd\">GW-151</a>, <a href=\"/issue/GW-252\" class=\"issue-resolved\" target=\"_self\" data-issue-id=\"36-7466\" title=\"Sessiond must listen on localhost\">GW-252</a>). AFAIK sessiond still has dead code that enable pure IP socket! This shall ripped off to make the probability of a mistake 0.<br/>6. No process should have more privileges than it needs i.e. none of our processes should be running as root longer than they need to [as far as I know no process has taken any care for it. Identify when each process need root privileges and make the appropriate changes]<br/><br/>Example: ICMP redirections are a source of an attack and shall be blocked. A research have been done already <a href=\"https://youtrack.cryptzone.ad/issue/GW-295#comment=48-18610\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>. It was about applying some rules in the firewall engine of the VPN daemon but the exact same rules must be applied at the appliance level</div>\n",
    "comments": [
      {
        "author": {
          "login": "kosmas.valianos",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">This task can be marked as verified if and only if:<br/>1. A complete list of the set of rules have been created and written here as a comment<br/>2. The steps 1, 3, 4, 5, 6 have been verified [In case anything fails an implementation task shall be created and linked here as &quot;depends on&quot;]<br/>3. It has been verified that these rules indeed are exist in appliance and achieve their intentions</div>\n",
        "created": 1437298812852,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "per.allansson",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">And the biggest point of them all - no process should have more privileges than it needs. Ie none of our processes should be running as root longer than they need to.</div>\n",
        "created": 1437331478146,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "kosmas.valianos",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">All of them are big enough and basic enough :P. We shall fix them before even claiming we have a secuirty product :P. <br/>Yeap adding it to the list</div>\n",
        "created": 1437377178820,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\"><a href=\"https://benchmarks.cisecurity.org/tools2/linux/CIS_Ubuntu_14.04_LTS_Server_Benchmark_v1.0.0.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">https://benchmarks.cisecurity.org/tools2/linux/CIS_Ubuntu_14.04_LTS_Server_Benchmark_v1.0.0.pdf</a><br/><a href=\"https://cisofy.com/download/lynis/\" target=\"_blank\" rel=\"noopener noreferrer\">https://cisofy.com/download/lynis/</a><br/><a href=\"https://benchmarks.cisecurity.org/freetrial/index.cfm\" target=\"_blank\" rel=\"noopener noreferrer\">https://benchmarks.cisecurity.org/freetrial/index.cfm</a></div>\n",
        "created": 1438702510083,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">What is this about??<br/><br/>/etc/nginx/.htpasswd with cz: Sema2007!</div>\n",
        "created": 1438705906162,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\"><div class=\"wiki quote\">Have you thought the issue that the user can actually edit the code of python?<br/><br/>Kosmas Valianos [12:04] <br/>Which can fuck the system up<br/><br/>Kosmas Valianos [12:04]<br/>Maybe we should deliver the python stuff like &quot;executables &quot;<br/><br/>Tom Weber [12:04] <br/>Eh, the scripts are not user-writable<br/><br/>Tom Weber [12:04]<br/><ul class=\"wiki-list0\"><li>rwxr-xr-x root root</li></ul><br/>Kosmas Valianos [12:05] <br/>Still reading them may reveal ...holes<br/><br/>Kosmas Valianos [12:05]<br/>Maybe removing reading as well<br/><br/>Kosmas Valianos [12:05]<br/>?<br/><br/>Tom Weber [12:06] <br/>Hmm, maybe. I&#39;ll add it to YT.</div></div>\n",
        "created": 1438855652215,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\"><div class=\"wiki quote\">Natan Abolafya [12:08] <br/>security by obscurity?<br/><br/>Kosmas Valianos [12:08] <br/>@thomas_cellerier also mentioned this &quot;executable &quot; python thing which is like a binary so to say so you cannot actually read any code there<br/><br/>Kosmas Valianos [12:09]<br/>So even if you manage to get rights to open the scripts you will see crap (edited)<br/><br/>Tom Weber [12:09] <br/>Please, no. I&#39;ve fixed bugs in live environments many times thanks to being able to edit the scripts<br/><br/>Kosmas Valianos [12:09] <br/>:)<br/><br/>Kosmas Valianos [12:10]<br/>Were they giving you the root password? (edited)<br/><br/>Kosmas Valianos [12:10]<br/>So you could edit the files. Interesting :)<br/><br/>Tom Weber [12:10] <br/>I mean in my own appliance, while developing<br/><br/>Tom Weber [12:11]<br/>having to recompile for every change is boring<br/><br/>Kosmas Valianos [12:11] <br/>Aha yeah sure development like that is easier<br/><br/>Kosmas Valianos [12:11]<br/>Maybe just baking the python &quot;binaries &quot; fir the real customers environment<br/><br/>Kosmas Valianos [12:12]<br/>Version ing like any other daemon<br/><br/>Kosmas Valianos [12:12]<br/>Etc<br/><br/>Kosmas Valianos [12:13]<br/>Alright time to jump in to sea again<br/><br/>Tom Weber [12:13] <br/>I think that <strong>IF</strong> we want obfuscation, it should be done properly, otherwise the only gain is that we are annoying ourselves with it<br/><br/>Kosmas Valianos [12:13] <br/>Yeah we should think about it<br/><br/>Kosmas Valianos [12:13]<br/>For sure (edited)<br/><br/>Tom Weber [12:14] <br/>Real anti-reverse-engineering is hard<br/><br/>Tom Weber [12:14]<br/>and the easy ways are just an annoyance, mostly to development and support<br/><br/>Kosmas Valianos [12:15] <br/>Maybe add it as a bullet to the security story<br/><br/>Kosmas Valianos [12:15]<br/>So we remember to think about it</div></div>\n",
        "created": 1438856176871,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "per.allansson",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Obfuscation has nothing to do with security. Rather the opposite. Security standards actually discourages this strongly, for obvious reasons.</div>\n",
        "created": 1438864879745,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Agreed!</div>\n",
        "created": 1438948497456,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Suggestions and warnings from the lynis tool:<br/><br/><div class=\"wiki quote\">[13:02:11] Test: Search for session timeout tools or settings in shell<br/>[13:02:11] IsRunning: process &#39;timeoutd&#39; not found<br/>[13:02:11] IsRunning: process &#39;autolog&#39; not found<br/>[13:02:11] Result: could not find TMOUT setting in /etc/profile<br/>[13:02:11] Result: could not find export, readonly or typeset -r in /etc/profile<br/><strong>FIXED</strong><br/><br/>[13:02:11] Suggestion: Configure password aging limits to enforce password changing on a regular base [AUTH-9286]<br/><strong>FIXED</strong><br/><br/>[13:02:11] Suggestion: Default umask in /etc/login.defs could be more strict like 027 [AUTH-9328]<br/><strong>FIXED</strong><br/><br/>[13:02:11] Suggestion: Default umask in /etc/init.d/rc could be more strict like 027 [AUTH-9328]<br/><strong>FIXED</strong><br/><br/>[13:02:11] Suggestion: To decrease the impact of a full /home file system, place /home on a separated partition [FILE-6310]<br/><br/>[13:02:11] Suggestion: To decrease the impact of a full /tmp file system, place /tmp on a separated partition [FILE-6310]<br/><br/>[13:02:11] Suggestion: To decrease the impact of a full /var file system, place /var on a separated partition [FILE-6310]<br/><br/>[13:02:11] Suggestion: Disable drivers like USB storage when not used, to prevent unauthorized storage or data theft [STRG-1840]<br/><br/>[13:02:13] Suggestion: Install debsums utility for the verification of packages with known good database. [PKGS-7370]<br/><br/>[13:02:13] Warning: Can&#39;t find any security repository in /etc/apt/sources.list or sources.list.d directory [PKGS-7388]<br/><br/>[13:02:17] Suggestion: Install package apt-show-versions for patch management purposes [PKGS-7394]<br/><br/>[13:02:17] Suggestion: Install a package audit tool to determine vulnerable packages [PKGS-7398]<br/><br/>[13:02:19] Suggestion: Add a legal banner to /etc/issue, to warn unauthorized users [BANN-7126]<br/><strong>FIXED</strong><br/><br/>[13:02:19] Suggestion: Add legal banner to /etc/issue.net, to warn unauthorized users [BANN-7130]<br/><strong>FIXED</strong><br/><br/>[13:02:19] Suggestion: Enable process accounting [ACCT-9622]<br/><br/>[13:02:19] Suggestion: Enable sysstat to collect accounting (disabled) [ACCT-9626]<br/><br/>[13:02:19] Suggestion: Enable auditd to collect audit information [ACCT-9628]<br/><br/>[13:02:20] Suggestion: Install a file integrity tool to monitor changes to critical and sensitive files [FINT-4350]<br/><br/>[13:02:20] Suggestion: One or more sysctl values differ from the scan profile and could be tweaked [KRNL-6000]<br/><strong>FIXED</strong><br/><br/>kernel.core_uses_pid (exp. 1)<br/>kernel.sysrq (exp. 0)<br/>net.ipv4.conf.all.forwarding (exp. 0)<br/>net.ipv4.conf.all.log_martians (exp. 1)<br/>net.ipv4.conf.all.send_redirects (exp. 0)<br/>net.ipv4.conf.default.accept_redirects (exp. 0)<br/>net.ipv4.conf.default.accept_source_route (exp. 0)<br/>net.ipv4.conf.default.log_martians (exp. 1)<br/>net.ipv4.tcp_timestamps (exp. 0)<br/>net.ipv6.conf.all.accept_redirects (exp. 0)<br/>net.ipv6.conf.default.accept_redirects (exp. 0)<br/><br/>[13:02:20] Performing test ID MACF-6204 (Check AppArmor presence)<br/>[13:02:20] Result: aa-status binary not found, AppArmor not installed<br/>[13:02:20] Performing test ID MACF-6232 (Check SELINUX presence)<br/>[13:02:20] Result: sestatus binary NOT found<br/>[13:02:20] Performing test ID RBAC-6272 (Check grsecurity presence)<br/>[13:02:20] Result: grsecurity not present (/dev/grsec not found)<br/><br/>[13:02:21] Suggestion: Harden the system by installing at least one malware scanner, to perform periodic file system scans [HRDN-7230]</div><br/><br/>I would say that the sysctl settings should be fixed ASAP, and the shell autologout, but the rest might not be so important in our case.</div>\n",
        "created": 1438953809262,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Doing the CIS Ubuntu 14.04 LTS Server Benchmark manually...<br/><br/>1.1 Install Updates, Patches and Additional Security Software (Not Scored) - <strong>Not applicable</strong><br/>2.1 Create Separate Partition for /tmp (Scored) - <strong>Should be done later</strong><br/>2.2 Set nodev option for /tmp Partition (Scored) - <strong>Not applicable right now</strong><br/>2.3 Set nosuid option for /tmp Partition (Scored) - <strong>Not applicable right now</strong><br/>2.4 Set noexec option for /tmp Partition (Scored) - <strong>Not applicable right now</strong><br/>2.5 Create Separate Partition for /var (Scored) - <strong>Should be done later</strong><br/>2.6 Bind Mount the /var/tmp directory to /tmp (Scored) - <strong>Not applicable right now</strong><br/>2.7 Create Separate Partition for /var/log (Scored) - <strong>Might not be needed, we use /mnt/data/log</strong><br/>2.8 Create Separate Partition for /var/log/audit (Scored) - <strong>We are not using auditd</strong><br/>2.9 Create Separate Partition for /home (Scored) - <strong>Should be done later</strong><br/>2.10 Add nodev Option to /home (Scored) - <strong>Not applicable right now</strong><br/>2.11 Add nodev Option to Removable Media Partitions (Not Scored) - <strong>Skip this, only used when provisioning</strong><br/>2.12 Add noexec Option to Removable Media Partitions (Not Scored) - <strong>Skip this, only used when provisioning</strong><br/>2.13 Add nosuid Option to Removable Media Partitions (Not Scored) - <strong>Skip this, only used when provisioning</strong><br/>2.14 Add nodev Option to /run/shm Partition (Scored) - <strong>Should look into this</strong><br/>2.15 Add nosuid Option to /run/shm Partition (Scored) - <strong>Should look into this</strong><br/>2.16 Add noexec Option to /run/shm Partition (Scored) - <strong>Should look into this</strong><br/>2.17 Set Sticky Bit on All World-Writable Directories (Scored) - <strong>Should look into this</strong><br/>2.18 Disable Mounting of cramfs Filesystems (Not Scored) - <strong>Should look into this</strong><br/>2.19 Disable Mounting of freevxfs Filesystems (Not Scored) - <strong>Should look into this</strong><br/>2.20 Disable Mounting of jffs2 Filesystems (Not Scored) - <strong>Should look into this</strong><br/>2.21 Disable Mounting of hfs Filesystems (Not Scored) - <strong>Should look into this</strong><br/>2.22 Disable Mounting of hfsplus Filesystems (Not Scored) - <strong>Should look into this</strong><br/>2.23 Disable Mounting of squashfs Filesystems (Not Scored) - <strong>Should look into this</strong><br/>2.24 Disable Mounting of udf Filesystems (Not Scored) - <strong>Nah, we want to support optical discs</strong><br/>2.25 Disable Automounting (Scored) - <strong>Nah, we want to support optical discs and USBs</strong><br/>3.1 Set User/Group Owner on bootloader config (Scored) - <strong>OK</strong><br/>3.2 Set Permissions on bootloader config (Scored) - <strong>OK</strong><br/>3.3 Set Boot Loader Password (Scored) - <strong>Not applicable, we make headless systems</strong><br/>3.4 Require Authentication for Single-User Mode (Scored) - <strong>Should be done later</strong><br/>4.1 Restrict Core Dumps (Scored) - <strong>No setting, should look into this</strong><br/>4.2 Enable XD/NX Support on 32-bit x86 Systems (Not Scored) - <strong>Not applicable, we use 64-bit only</strong><br/>4.3 Enable Randomized Virtual Memory Region Placement (Scored) - <strong>OK</strong><br/>4.4 Disable Prelink (Scored) - <strong>OK</strong><br/>4.5 Activate AppArmor (Scored) - <strong>Should look into this</strong><br/>5.1.1 Ensure NIS is not installed (Scored) - <strong>OK</strong><br/>5.1.2 Ensure rsh server is not enabled (Scored) - <strong>OK</strong><br/>5.1.3 Ensure rsh client is not installed (Scored) - <strong>OK</strong><br/>5.1.4 Ensure talk server is not enabled (Scored) - <strong>OK</strong><br/>5.1.5 Ensure talk client is not installed (Scored) - <strong>OK</strong><br/>5.1.6 Ensure telnet server is not enabled (Scored) - <strong>OK</strong><br/>5.1.7 Ensure tftp-server is not enabled (Scored) - <strong>OK</strong><br/>5.1.8 Ensure xinetd is not enabled (Scored) - <strong>OK</strong><br/>5.2 Ensure chargen is not enabled (Scored) - <strong>OK</strong><br/>5.3 Ensure daytime is not enabled (Scored) - <strong>OK</strong><br/>5.4 Ensure echo is not enabled (Scored) - <strong>OK</strong><br/>5.5 Ensure discard is not enabled (Scored) - <strong>OK</strong><br/>5.6 Ensure time is not enabled (Scored) - <strong>OK</strong><br/>6.1 Ensure the X Window system is not installed (Scored) - <strong>OK</strong><br/>6.2 Ensure Avahi Server is not enabled (Scored) - <strong>OK</strong><br/>6.3 Ensure print server is not enabled (Not Scored) - <strong>OK</strong><br/>6.4 Ensure DHCP Server is not enabled (Scored) - <strong>OK</strong><br/>6.5 Configure Network Time Protocol (NTP) (Scored) - <strong><del>Missing &quot;restrict&quot; lines, fix</del> OK</strong><br/>6.6 Ensure LDAP is not enabled (Not Scored) - <strong>OK</strong><br/>6.7 Ensure NFS and RPC are not enabled (Not Scored) - <strong>OK</strong><br/>6.8 Ensure DNS Server is not enabled (Not Scored) - <strong>OK</strong><br/>6.9 Ensure FTP Server is not enabled (Not Scored) - <strong>OK</strong><br/>6.10 Ensure HTTP Server is not enabled (Not Scored) - <strong>OK, but they only check apache</strong><br/>6.11 Ensure IMAP and POP server is not enabled (Not Scored) - <strong>OK</strong><br/>6.12 Ensure Samba is not enabled (Not Scored) - <strong>OK</strong><br/>6.13 Ensure HTTP Proxy Server is not enabled (Not Scored) - <strong>OK</strong><br/>6.14 Ensure SNMP Server is not enabled (Not Scored) - <strong>OK</strong><br/>6.15 Configure Mail Transfer Agent for Local-Only Mode (Scored) - <strong>Not applicable</strong><br/>6.16 Ensure rsync service is not enabled (Scored) - <strong>OK</strong><br/>6.17 Ensure Biosdevname is not enabled (Scored) - <strong>OK</strong><br/>7.1.1 Disable IP Forwarding (Scored) - <strong>Nah, we need it</strong><br/>7.1.2 Disable Send Packet Redirects (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>7.2.1 Disable Source Routed Packet Acceptance (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>7.2.2 Disable ICMP Redirect Acceptance (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>7.2.3 Disable Secure ICMP Redirect Acceptance (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>7.2.4 Log Suspicious Packets (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>7.2.5 Enable Ignore Broadcast Requests (Scored) - <strong>OK</strong><br/>7.2.6 Enable Bad Error Message Protection (Scored) - <strong>OK</strong><br/>7.2.7 Enable RFC-recommended Source Route Validation (Scored) - <strong>OK</strong><br/>7.2.8 Enable TCP SYN Cookies (Scored) - <strong>OK</strong><br/>7.3.1 Disable IPv6 Router Advertisements (Not Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>7.3.2 Disable IPv6 Redirect Acceptance (Not Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>7.3.3 Disable IPv6 (Not Scored) - <strong>Not applicable</strong><br/>7.4.1 Install TCP Wrappers (Scored) - <strong>OK</strong><br/>7.4.2 Create /etc/hosts.allow (Not Scored) - <strong>OK, but probably not needed</strong><br/>7.4.3 Verify Permissions on /etc/hosts.allow (Scored) - <strong>OK</strong><br/>7.4.4 Create /etc/hosts.deny (Not Scored) - <strong>OK, but probably not needed</strong><br/>7.4.5 Verify Permissions on /etc/hosts.deny (Scored) - <strong>OK</strong><br/>7.5.1 Disable DCCP (Not Scored) - <strong>OK</strong><br/>7.5.2 Disable SCTP (Not Scored) - <strong>OK</strong><br/>7.5.3 Disable RDS (Not Scored) - <strong>OK</strong><br/>7.5.4 Disable TIPC (Not Scored) - <strong>OK</strong><br/>7.6 Deactivate Wireless Interfaces (Not Scored) - <strong>Not applicable, depends on config</strong><br/>7.7 Ensure Firewall is active (Scored) - <strong>Not applicable, depends on config</strong><br/>8.1 Configure System Accounting (auditd) - <strong>Whole section skipped, we don&#39;t use auditd</strong><br/>8.2.1 Install the rsyslog package (Scored) - <strong>OK</strong><br/>8.2.2 Ensure the rsyslog Service is activated (Scored) - <strong>OK</strong><br/>8.2.3 Configure /etc/rsyslog.conf (Not Scored) - <strong>OK</strong><br/>8.2.4 Create and Set Permissions on rsyslog Log Files (Scored) - <strong>FAIL, investigate</strong><br/>8.2.5 Configure rsyslog to Send Logs to a Remote Log Host (Scored) - <strong>Not applicable, depends on config</strong><br/>8.2.6 Accept Remote rsyslog Messages Only on Designated Log Hosts (Not Scored) - <strong>OK, but this only tested TCP, we do accept UDP...</strong><br/>8.3.1 Install AIDE (Scored) - <strong>Should look into this</strong><br/>8.4 Configure logrotate (Not Scored) - <strong>FAIL, fix</strong><br/>9.1.1 Enable cron Daemon (Scored) - <strong>OK</strong><br/>9.1.2 Set User/Group Owner and Permission on /etc/crontab (Scored) - <strong>OK</strong><br/>9.1.3 Set User/Group Owner and Permission on /etc/cron.hourly (Scored) - <strong>OK</strong><br/>9.1.4 Set User/Group Owner and Permission on /etc/cron.daily (Scored) - <strong>OK</strong><br/>9.1.5 Set User/Group Owner and Permission on /etc/cron.weekly (Scored) - <strong>OK</strong><br/>9.1.6 Set User/Group Owner and Permission on /etc/cron.monthly (Scored) - <strong>OK</strong><br/>9.1.7 Set User/Group Owner and Permission on /etc/cron.d (Scored) - <strong>OK</strong><br/>9.1.8 Restrict at/cron to Authorized Users (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>9.2.1 Set Password Creation Requirement Parameters Using pam_cracklib (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>9.2.2 Set Lockout for Failed Password Attempts (Not Scored) - <strong><del>FAIL, fix</del> Not wanted, let&#39;s not lock out the cz (admin) account!</strong><br/>9.2.3 Limit Password Reuse (Scored) - <strong><del>FAIL, fix</del> OK (but quite useless, the remembered passwords disappear on reboot)</strong><br/>9.3.1 Set SSH Protocol to 2 (Scored) - <strong>OK</strong><br/>9.3.2 Set LogLevel to INFO (Scored) - <strong>OK</strong><br/>9.3.3 Set Permissions on /etc/ssh/sshd_config (Scored) - <strong>FAIL, fix (have 644, not 600) [EDIT: The document is contradicting itself here, it implies that the permissions should be 644 after all!]</strong><br/>9.3.4 Disable SSH X11 Forwarding (Scored) - <strong>OK</strong><br/>9.3.5 Set SSH MaxAuthTries to 4 or Less (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>9.3.6 Set SSH IgnoreRhosts to Yes (Scored) - <strong>OK</strong><br/>9.3.7 Set SSH HostbasedAuthentication to No (Scored) - <strong>OK</strong><br/>9.3.8 Disable SSH Root Login (Scored) - <strong>OK</strong><br/>9.3.9 Set SSH PermitEmptyPasswords to No (Scored) - <strong>OK</strong><br/>9.3.10 Do Not Allow Users to Set Environment Options (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>9.3.11 Use Only Approved Cipher in Counter Mode (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>9.3.12 Set Idle Timeout Interval for User Login (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>9.3.13 Limit Access via SSH (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>9.3.14 Set SSH Banner (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>9.4 Restrict root Login to System Console (Not Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>9.5 Restrict Access to the su Command (Scored) - <strong><del>FAIL, fix</del> OK</strong><br/>10.1.1 Set Password Expiration Days (Scored) - <strong><del>FAIL, investigate</del> OK</strong><br/>10.1.2 Set Password Change Minimum Number of Days (Scored) - <strong><del>FAIL, investigate</del> Not wanted</strong><br/>10.1.3 Set Password Expiring Warning Days (Scored) - <strong>OK</strong><br/>10.2 Disable System Accounts (Scored) - <strong>FAIL, postgres has a login shell</strong><br/>10.3 Set Default Group for root Account (Scored) - <strong>OK</strong><br/>10.4 Set Default umask for Users (Scored) - <strong><del>FAIL, investigate</del> OK</strong><br/>10.5 Lock Inactive User Accounts (Scored) - <strong>Not applicable</strong><br/>11.1 Set Warning Banner for Standard Login Services (Scored) - <strong>FAIL, but motd is dynamically generated</strong><br/>11.2 Remove OS Information from Login Warning Banners (Scored) - <strong>OK</strong><br/>11.3 Set Graphical Warning Banner (Not Scored) - <strong>Not applicable</strong><br/>12.1 Verify Permissions on /etc/passwd (Scored) - <strong>OK</strong><br/>12.2 Verify Permissions on /etc/shadow (Scored) - <strong>OK</strong><br/>12.3 Verify Permissions on /etc/group (Scored) - <strong>OK</strong><br/>12.4 Verify User/Group Ownership on /etc/passwd (Scored) - <strong>OK</strong><br/>12.5 Verify User/Group Ownership on /etc/shadow (Scored) - <strong>OK</strong><br/>12.6 Verify User/Group Ownership on /etc/group (Scored) - <strong>OK</strong><br/>12.7 Find World Writable Files (Not Scored) - <strong>OK, none found</strong><br/>12.8 Find Un-owned Files and Directories (Scored) - <strong>Not applicable</strong><br/>12.9 Find Un-grouped Files and Directories (Scored) - <strong>Not applicable</strong><br/>12.10 Find SUID System Executables (Not Scored) - <strong>OK, seems legit</strong><br/>12.11 Find SGID System Executables (Not Scored) - <strong>OK, seems legit</strong><br/>13.1 Ensure Password Fields are Not Empty (Scored) - <strong>OK</strong><br/>13.2 Verify No Legacy &quot;+&quot; Entries Exist in /etc/passwd File (Scored) - <strong>OK</strong><br/>13.3 Verify No Legacy &quot;+&quot; Entries Exist in /etc/shadow File (Scored) - <strong>OK</strong><br/>13.4 Verify No Legacy &quot;+&quot; Entries Exist in /etc/group File (Scored) - <strong>OK</strong><br/>13.5 Verify No UID 0 Accounts Exist Other Than root (Scored) - <strong>OK</strong><br/>13.6 Ensure root PATH Integrity (Scored) - <strong>OK</strong><br/>13.7 Check Permissions on User Home Directories (Scored) - <strong><del>FAIL, investigate</del> OK</strong><br/>13.8 Check User Dot File Permissions (Scored) - <strong>OK</strong><br/>13.9 Check Permissions on User .netrc Files (Scored) - <strong>Not applicable</strong><br/>13.10 Check for Presence of User .rhosts Files (Scored) - <strong>OK</strong><br/>13.11 Check Groups in /etc/passwd (Scored) - <strong>OK</strong><br/>13.12 Check That Users Are Assigned Valid Home Directories (Scored) - <strong>OK, valid for cz user</strong><br/>13.13 Check User Home Directory Ownership (Scored) - <strong>OK</strong><br/>13.14 Check for Duplicate UIDs (Scored) - <strong>OK</strong><br/>13.15 Check for Duplicate GIDs (Scored) - <strong>OK</strong><br/>13.16 Check for Duplicate User Names (Scored) - <strong>OK</strong><br/>13.17 Check for Duplicate Group Names (Scored) - <strong>OK</strong><br/>13.18 Check for Presence of User .netrc Files (Scored) - <strong>OK</strong><br/>13.19 Check for Presence of User .forward Files (Scored) - <strong>OK</strong><br/>13.20 Ensure shadow group is empty (Scored) - <strong>OK</strong><br/></div>\n",
        "created": 1438965402512,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\"><h3>Conclusions so far</h3><br/>These are weaknesses in our first line of defense (network traffic) and should be fixed before a beta is released:<br/><br/><ul class=\"wiki-list0\"><li>sysctl variables<br/></li><li>sshd_config<br/></li><li>ntp &quot;restrict&quot;</li></ul><br/>Additionally, logrotate should be correctly configured so we don&#39;t get a mastodont syslog file.<br/><br/>These are weaknesses in our second line of defense (user accounts, privilege elevation) and should be fixed before the final version is released:<br/><br/><ul class=\"wiki-list0\"><li>set autologout on shells<br/></li><li>configure password strength and max/min age<br/></li><li>less liberal umask<br/></li><li>permissions on home directories<br/></li><li>postgres has login shell</li></ul><br/>These are good suggestions for hardening in general:<br/><br/><ul class=\"wiki-list0\"><li>separate partitions for /home, /var and /tmp, with restricted options (plus /run/shm)<br/></li><li>disable obscure filesystem support<br/></li><li>restrict core dumps<br/></li><li>use auditd, apparmor and file integrity checker</li></ul><br/>(There are smaller points above, I just summarized the major ones)</div>\n",
        "created": 1438966244249,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "tom.weber",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Half of the points in the last comment were fixed in this PR: <a href=\"https://github.cryptzone.ad/cryptzone/stratus-appliance/pull/196\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.cryptzone.ad/cryptzone/stratus-appliance/pull/196</a><br/><br/>This task is poorly scoped, so I don&#39;t know whether to close it or keep it open. It&#39;s done as far as the beta is concerned, but there is stuff researched here which will be done later.</div>\n",
        "created": 1439563837380,
        "$type": "IssueComment"
      },
      {
        "author": {
          "login": "kosmas.valianos",
          "$type": "User"
        },
        "text": "<div class=\"wiki text prewrapped\">Adding <a href=\"/issue/SA-682\" class=\"issue-resolved\" target=\"_self\" data-issue-id=\"36-9950\" title=\"Do not run daemons as root\">SA-682</a> as depends on as it is about appliance security [making daemons not run as root]<br/><br/><div class=\"wiki quote\">This task is poorly scoped, so I don&#39;t know whether to close it or keep it open. It&#39;s done as far as the beta is concerned</div><br/>This task is created about the &quot;real&quot; thing no segregation between beta or not beta or whatever. At the very least we must find and link all the &quot;depends on&quot; tasks. Then according to our plans we fix these depending tasks. When everything is done it can be moved to &quot;verified&quot;. If all the depending tasks have been identified and we know what needs to be done then &quot;fixed&quot; state is ok</div>\n",
        "created": 1440600377896,
        "$type": "IssueComment"
      }
    ]
  }
}